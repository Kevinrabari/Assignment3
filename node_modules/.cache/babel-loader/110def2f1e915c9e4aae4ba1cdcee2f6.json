{"ast":null,"code":"/**\n* DevExpress Analytics (widgets\\common\\_codeCompletor.js)\n* Version:  22.1.3\n* Build date: Jun 14, 2022\n* Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\n* License: https://www.devexpress.com/Support/EULAs/universal.xml\n*/\n\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.trimBrackets = exports.createFunctionCompletion = exports.CodeCompletor = void 0;\n\nvar ko = require(\"knockout\");\n\nvar $ = require(\"jquery\");\n\nvar _functions_1 = require(\"../expressioneditor/tools/_functions\");\n\nvar utils_1 = require(\"../../serializer/utils\");\n\nvar _utils_1 = require(\"../_utils\");\n\nvar localization_utils_1 = require(\"../../property-grid/localization/localization_utils\");\n\nvar pathRequest_1 = require(\"./pathRequest\");\n\nvar _expressioneditor_1 = require(\"../expressioneditor/_expressioneditor\");\n\nvar _operatorNames_1 = require(\"../expressioneditor/tools/_operatorNames\");\n\nvar criteriaOperatorStateMachine_1 = require(\"../criteria/utils/criteriaOperatorStateMachine\");\n\nvar CodeCompletor = function (_super) {\n  __extends(CodeCompletor, _super);\n\n  function CodeCompletor(_options) {\n    var _this = _super.call(this) || this;\n\n    _this._options = _options;\n    _this._contextPath = null;\n\n    _this._isInContext = function () {\n      return _this._contextPath !== null;\n    };\n\n    _this._getPath = function () {\n      return _this._contextPath ? _this._path() + '.' + _this._contextPath : _this._path();\n    };\n\n    _this.identifierRegexps = [/\\./, /\\[/];\n    _this._fieldListProvider = _options.fieldListProvider;\n    _this._path = _options.path;\n    _this._editor = _options.editor;\n    _this._functions = ko.computed(function () {\n      return ko.unwrap(_options.functions) || _functions_1.functionDisplay();\n    });\n    _this._rootItems = _options.rootItems || [{\n      name: 'Parameters',\n      needPrefix: true\n    }];\n\n    _this._disposables.push(_this._functions);\n\n    return _this;\n  }\n\n  CodeCompletor.prototype._previousSymbol = function () {\n    var cursorPosition = this._editor.getCursorPosition();\n\n    return this._editor.session.getLine(cursorPosition.row)[cursorPosition.column - 1];\n  };\n\n  CodeCompletor.prototype.beforeInsertMatch = function (editor, token, parentPrefix) {\n    var cursorPosition = editor.getCursorPosition();\n\n    if (parentPrefix === 'Parameters.') {\n      token = token || !this['_isInContext']() && editor.session.getTokenAt(cursorPosition.row, cursorPosition.column);\n\n      if (token) {\n        if (token.type === 'support.variable.other' || token.type === 'support.function') {\n          editor.session.remove({\n            start: {\n              column: token.start - 1 || 0,\n              row: cursorPosition.row\n            },\n            end: {\n              column: Math.max(token.start + token.value.length || 0, cursorPosition.column),\n              row: cursorPosition.row\n            }\n          });\n        } else if (token.type === 'support.variable.parameter') {\n          editor.session.remove({\n            start: {\n              column: token.start || 0,\n              row: cursorPosition.row\n            },\n            end: {\n              column: Math.max(token.start + token.value.length + 1 || 0, cursorPosition.column),\n              row: cursorPosition.row\n            }\n          });\n        } else if (token.type === 'text' && token.value[token.value.length - 1] === '?') {\n          editor.session.remove({\n            start: {\n              column: token.start + token.value.length - 1 || 0,\n              row: cursorPosition.row\n            },\n            end: {\n              column: token.start + token.value.length || 0,\n              row: cursorPosition.row\n            }\n          });\n        }\n      }\n    } else {\n      token = token || editor.session.getTokenAt(cursorPosition.row, cursorPosition.column);\n      if (!token) return;\n      var endColumn = null;\n\n      if (token.type === 'support.variable.other' || token.type === 'support.function') {\n        endColumn = Math.max(token.start + token.value.length || 0, cursorPosition.column);\n      } else if (token.type === 'support.context.start' && cursorPosition.column < token.start + token.value.length) {\n        endColumn = token.start + token.value.length - 1 || 0;\n      }\n\n      if (endColumn !== null) editor.session.remove({\n        start: {\n          column: token.start || 0,\n          row: cursorPosition.row\n        },\n        end: {\n          column: endColumn,\n          row: cursorPosition.row\n        }\n      });\n    }\n  };\n\n  CodeCompletor.prototype.insertMatch = function (editor, parentPrefix, fieldName) {\n    if (parentPrefix === 'Parameters.') {\n      editor.insert('?' + fieldName);\n    } else {\n      editor.insert('[' + (parentPrefix || '') + fieldName + ']');\n    }\n  };\n\n  CodeCompletor.prototype.generateFieldDisplayName = function (parentPrefix, displayName) {\n    if (parentPrefix === 'Parameters.') {\n      return '?' + displayName;\n    }\n\n    return '[' + displayName + ']';\n  };\n\n  CodeCompletor.prototype._convertDataMemberInfoToCompletions = function (fields, token, parentPrefix) {\n    var _this = this;\n\n    if (parentPrefix === void 0) {\n      parentPrefix = '';\n    }\n\n    return (fields || []).map(function (field) {\n      var displayName = _this.generateFieldDisplayName(parentPrefix, field.displayName);\n\n      return {\n        caption: field.displayName || field.name,\n        snippet: displayName,\n        meta: _utils_1.isList(field) && localization_utils_1.getLocalization('list', 'DxDesignerStringId.CodeCompletion_List') || localization_utils_1.getLocalization('field', 'DxDesignerStringId.CodeCompletion_Field'),\n        score: _utils_1.isList(field) && 200 || 100,\n        completer: {\n          insertMatch: function (editor, data) {\n            _this.beforeInsertMatch(editor, token, parentPrefix);\n\n            _this.insertMatch(editor, parentPrefix, _this._options.getRealExpression ? field.displayName || field.name : field.name);\n          }\n        }\n      };\n    });\n  };\n\n  CodeCompletor.prototype._combinePath = function (parentPrefix) {\n    var path = this._getPath();\n\n    if (parentPrefix) {\n      var rootItem = this._rootItems.filter(function (item) {\n        return parentPrefix.indexOf(item.name) === 0;\n      })[0];\n\n      if (rootItem && rootItem.rootPath) path = [rootItem.rootPath, parentPrefix].join('.');else path = [path, parentPrefix].join('.');\n    }\n\n    return path;\n  };\n\n  CodeCompletor.prototype._getParentPrefix = function (token) {\n    var position = this._editor.getCursorPosition().column - token.start - 1;\n    var dotIndex = token.value.lastIndexOf('.', position);\n    var closeIndex = token.value.lastIndexOf(']', position);\n    dotIndex = Math.max(closeIndex, dotIndex);\n    var startIndex = token.type === 'support.variable.other' || token.type === 'support.context.start' ? 1 : 0;\n    var parentPrefix = token.value.substring(startIndex, dotIndex);\n    if (parentPrefix[0] === '[') parentPrefix = parentPrefix.substr(1);\n    if (parentPrefix[parentPrefix.length - 1] === ']') parentPrefix = parentPrefix.substring(0, parentPrefix.length - 1);\n    return parentPrefix;\n  };\n\n  CodeCompletor.prototype._getRealPath = function (path) {\n    var pathArray = path.split('.');\n    var $deferred = $.Deferred();\n\n    if (this._options.getRealExpression) {\n      this._options.getRealExpression(pathArray[0], this.generateFieldDisplayName(null, pathArray.splice(1).join('.'))).done(function (result) {\n        result = result.slice(1, result.length - 1);\n        $deferred.resolve(result && [pathArray[0], result].join('.') || pathArray[0]);\n      }).fail(function () {\n        $deferred.resolve(path);\n      });\n    } else {\n      $deferred.resolve(path);\n    }\n\n    return $deferred.promise();\n  };\n\n  CodeCompletor.prototype._getFields = function (token, completions, ignorePrefix) {\n    var _this = this;\n\n    if (token === void 0) {\n      token = null;\n    }\n\n    if (completions === void 0) {\n      completions = [];\n    }\n\n    if (ignorePrefix === void 0) {\n      ignorePrefix = false;\n    }\n\n    var $deferred = $.Deferred();\n    var parentPrefix = undefined;\n\n    if (token && (token.type === 'support.variable.other' || token.type === 'support.function' || token.type === 'support.context.start')) {\n      parentPrefix = this._getParentPrefix(token);\n    }\n\n    this._getRealPath(this._combinePath(parentPrefix)).done(function (path) {\n      var $fields = ko.unwrap(_this._fieldListProvider).getItems(new pathRequest_1.PathRequest(path)).done(function (fields) {\n        completions.push.apply(completions, _this._convertDataMemberInfoToCompletions(CodeCompletor._cleanupFields(fields), token, ignorePrefix ? null : parentPrefix && parentPrefix + '.'));\n      });\n      var $deferreds = [$fields];\n      var rootPathRequests = [];\n\n      if (!parentPrefix) {\n        _this._rootItems.forEach(function (item) {\n          var path = item.rootPath || item.name;\n\n          if (rootPathRequests.indexOf(path) === -1) {\n            rootPathRequests.push(path);\n            $deferreds.push(ko.unwrap(_this._fieldListProvider).getItems(new pathRequest_1.PathRequest(path)).done(function (fields) {\n              _this._processFields($deferreds, fields, completions, path, token, item.needPrefix ? item.name + '.' : '', true);\n            }));\n          }\n        });\n      }\n\n      $.when($deferreds).always(function () {\n        $deferred.resolve(completions);\n      });\n    });\n\n    return $deferred.promise();\n  };\n\n  CodeCompletor._cleanupFields = function (fields) {\n    if (fields === void 0) {\n      fields = [];\n    }\n\n    return fields.filter(function (x) {\n      return x.specifics !== 'parameters' && x.specifics !== 'none';\n    });\n  };\n\n  CodeCompletor.prototype._processFields = function ($deferreds, fields, completions, path, token, parentPrefix, needCleanup) {\n    var _this = this;\n\n    if (parentPrefix === void 0) {\n      parentPrefix = '';\n    }\n\n    if (needCleanup === void 0) {\n      needCleanup = false;\n    }\n\n    var pushToCompletions = function (fields) {\n      completions.push.apply(completions, _this._convertDataMemberInfoToCompletions(needCleanup ? CodeCompletor._cleanupFields(fields) : fields, token, parentPrefix));\n    };\n\n    fields.forEach(function (item) {\n      if (item.specifics === _expressioneditor_1.RangeSpecific && _utils_1.isList(item)) {\n        $deferreds.push(ko.unwrap(_this._fieldListProvider).getItems(new pathRequest_1.PathRequest(path + '.' + item.name)).done(function (subFields) {\n          pushToCompletions(subFields);\n        }).fail(function () {\n          pushToCompletions([item]);\n        }));\n      } else {\n        pushToCompletions([item]);\n      }\n    });\n  };\n\n  CodeCompletor.prototype.getFunctionsCompletions = function () {\n    var functions = [];\n    var functionsWithoutAggregates = ko.unwrap(this._functions).filter(function (fnDisplay) {\n      return fnDisplay.category !== 'Aggregate';\n    });\n    functionsWithoutAggregates.forEach(function (fnDisplay) {\n      Object.keys(fnDisplay.items).forEach(function (fnKey) {\n        if (fnDisplay.items[fnKey]) {\n          functions.push(createFunctionCompletion(fnDisplay.items[fnKey][0], fnKey));\n        }\n      });\n    });\n    return functions;\n  };\n\n  CodeCompletor.prototype.getAggregateCompletions = function () {\n    var functions = [];\n    var aggregates = ko.unwrap(this._functions).filter(function (fnDisplay) {\n      return fnDisplay.category === 'Aggregate';\n    })[0];\n    if (aggregates) Object.keys(aggregates.items).forEach(function (fnKey) {\n      if (aggregates.items[fnKey]) {\n        functions.push(createFunctionCompletion(aggregates.items[fnKey][0], fnKey, fnKey + '()'));\n      }\n    });\n    return functions;\n  };\n\n  CodeCompletor.prototype.getOperatorCompletions = function (prefix) {\n    return _operatorNames_1.operatorNames.map(function (operator) {\n      return {\n        caption: operator.text,\n        snippet: prefix + operator.text,\n        meta: localization_utils_1.getLocalization('operator', 'DxDesignerStringId.CodeCompletion_Operator')\n      };\n    });\n  };\n\n  CodeCompletor.prototype._addFunctions = function (completions) {\n    completions.push.apply(completions, this.getFunctionsCompletions());\n  };\n\n  CodeCompletor.prototype._addAggregates = function (completions) {\n    completions.push.apply(completions, this.getAggregateCompletions());\n  };\n\n  CodeCompletor.prototype._addOperators = function (completions, text) {\n    var prefix = /\\s/.test(text[text.length - 1]) ? '' : ' ';\n    completions.push.apply(completions, this.getOperatorCompletions(prefix));\n  };\n\n  CodeCompletor.prototype._addParameterOperators = function (completions, token) {\n    var _this = this;\n\n    var $deferred = $.Deferred();\n    var $parametersPromises = [];\n    var paramPath = 'Parameters';\n    $parametersPromises.push(ko.unwrap(this['_fieldListProvider']).getItems(new pathRequest_1.PathRequest(paramPath)).done(function (fields) {\n      _this._processFields($parametersPromises, fields, completions, paramPath, token, paramPath + '.');\n    }));\n    $.when($parametersPromises).always(function () {\n      $deferred.resolve(completions);\n    });\n    return $deferred.promise();\n  };\n\n  CodeCompletor.prototype._getOperands = function (token) {\n    if (token === void 0) {\n      token = null;\n    }\n\n    var result = [];\n\n    this._addFunctions(result);\n\n    return this._getFields(token, result);\n  };\n\n  CodeCompletor.prototype._getOperandsOrOperators = function (token, text, completions) {\n    var exceptionInfo;\n\n    try {\n      criteriaOperatorStateMachine_1.CriteriaOperatorStateMachine.parse(text);\n    } catch (exception) {\n      exceptionInfo = exception.hash;\n    }\n\n    var trimmedText = text.trim();\n    var lastNonSpaceSymbol = trimmedText[trimmedText.length - 1];\n\n    if (lastNonSpaceSymbol === '?' && text[text.length - 1] !== ' ') {\n      this._addParameterOperators(completions, token);\n    } else if (!exceptionInfo && trimmedText || lastNonSpaceSymbol === ']' || lastNonSpaceSymbol === ')') {\n      this._addOperators(completions, text);\n    } else {\n      return this._getOperands();\n    }\n  };\n\n  CodeCompletor.prototype._findStartContextTokenPosition = function (tokens, index) {\n    var blocks = 0;\n    var path = [];\n\n    for (var i = index; i > -1; i--) {\n      if (tokens[i].type === 'support.context.end') {\n        blocks++;\n      } else if (tokens[i].type === 'support.context.start') {\n        if (blocks > 0) blocks--;else return i;\n      }\n    }\n  };\n\n  CodeCompletor.prototype._findOpenedStartContext = function (tokens, index) {\n    var openedContextIndexes = [];\n    var contextItems = tokens.filter(function (token, tokenIndex) {\n      return (token.type === 'support.context.start' || token.type === 'support.context.end') && tokenIndex < index;\n    });\n\n    for (var i = 0; i < contextItems.length; i++) {\n      if (contextItems[i].type === 'support.context.start') {\n        openedContextIndexes.push(tokens.indexOf(contextItems[i]));\n      } else {\n        openedContextIndexes.pop();\n      }\n    }\n\n    return openedContextIndexes;\n  };\n\n  CodeCompletor.prototype._findOpenedAggregates = function (tokens, index) {\n    var openedAggregatesIndexes = [];\n    var aggregates = tokens.filter(function (token, tokenIndex) {\n      return token.type === 'support.other.aggregate' && tokenIndex < index;\n    });\n\n    if (aggregates.length > 0) {\n      var currentToken = tokens[index];\n      var currentCursorPosition = this._editor.getCursorPosition().column - (currentToken && currentToken.start || 0);\n\n      for (var i = aggregates.length - 1; i > -1; i--) {\n        var aggregateIndex = tokens.indexOf(aggregates[i]);\n        var openBrace = 0;\n        var closeBrace = 0;\n        var isClosedAggregate = false;\n\n        if (aggregateIndex + 1 === index && tokens[aggregateIndex + 1].value.substr(0, currentCursorPosition).indexOf('()') !== -1 || aggregateIndex + 1 < index && tokens[aggregateIndex + 1].value.indexOf('()') !== -1) {\n          isClosedAggregate = true;\n          index = aggregateIndex;\n          continue;\n        }\n\n        for (var j = aggregateIndex; j < index; j++) {\n          if (tokens[j].value.trim() === '(') {\n            openBrace++;\n          } else if (tokens[j].value.trim() === ')') {\n            closeBrace++;\n          }\n\n          if (openBrace === closeBrace && openBrace !== 0) {\n            isClosedAggregate = true;\n            break;\n          }\n        }\n\n        if (!isClosedAggregate) openedAggregatesIndexes.splice(0, 0, aggregateIndex);\n        index = aggregateIndex;\n      }\n    }\n\n    return openedAggregatesIndexes;\n  };\n\n  CodeCompletor.prototype._getContextPath = function (tokens, currentPosition) {\n    var path = [];\n\n    var openedAggregatePositions = this._findOpenedAggregates(tokens, currentPosition);\n\n    var openedContextPositions = this._findOpenedStartContext(tokens, currentPosition);\n\n    var contextPath = openedContextPositions.concat.apply(openedContextPositions, openedAggregatePositions).sort(function (a, b) {\n      return a - b;\n    });\n\n    if (contextPath.length > 0) {\n      for (var i = 0; i < contextPath.length; i++) {\n        if (tokens[contextPath[i]].type === 'support.other.aggregate') {\n          if (tokens[contextPath[i] - 1].type === 'support.context.end') {\n            var startContextToken = this._findStartContextTokenPosition(tokens, contextPath[i] - 2);\n\n            var member = trimBrackets(tokens[startContextToken].value.match(/^\\[(?:[^\\]\\)])*\\]/)[0]);\n            path.push(member);\n          } else if (tokens[contextPath[i] - 1].type === 'support.variable.other') {\n            path.push(trimBrackets(tokens[contextPath[i] - 1].value));\n          }\n        } else {\n          var member = trimBrackets(tokens[contextPath[i]].value.match(/^\\[(?:[^\\]\\)])*\\]/)[0]);\n          path.push(member);\n        }\n      }\n    }\n\n    return path.filter(function (x) {\n      return !!x;\n    }).join('.');\n  };\n\n  CodeCompletor.prototype._getCompletions = function (editor, session, pos, prefix) {\n    var $deferred;\n    var completions = [];\n    var currentToken = session.getTokenAt(pos.row, pos.column);\n    var text = editor.session.getLine(pos.row).substring(0, pos.column);\n    var tokens = session.getTokens(pos.row);\n    var currentTokenIndex = currentToken ? currentToken.index : -1;\n    this._contextPath = this._getContextPath(tokens, currentTokenIndex);\n\n    if (!currentToken) {\n      $deferred = this._getOperands();\n    } else if (currentToken.type === 'support.context.start') {\n      var ignorePrefix = this._editor.getCursorPosition().column - currentToken.start === currentToken.value.length;\n\n      if (ignorePrefix) {\n        var functions = [];\n\n        this._addFunctions(functions);\n      }\n\n      $deferred = this._getFields(currentToken, functions, ignorePrefix);\n    } else if (currentToken.type === 'string.quoted.single') {} else if (currentToken.type.indexOf('support.variable') === 0) {\n      $deferred = this._getFields(currentToken);\n    } else if (currentToken.type === 'support.function') {\n      $deferred = this.defaultProcess(currentToken, text.substring(0, currentToken.start), completions);\n    } else if (currentToken.type === 'support.other.aggregate') {\n      var previousToken = tokens[currentTokenIndex - 1];\n\n      this._addAggregates(completions);\n\n      if (previousToken && trimBrackets(previousToken.value).trim()) {\n        $deferred = this._getFields({\n          start: currentToken.start - (previousToken.value || '').length || 0,\n          value: previousToken.value + currentToken.value,\n          type: 'support.function'\n        }, completions);\n      }\n    } else {\n      if (!(currentToken.type.indexOf('comment') === 0)) {\n        $deferred = this.defaultProcess(currentToken, text, completions);\n      }\n    }\n\n    return $deferred ? $deferred.promise() : $.Deferred().resolve(completions).promise();\n  };\n\n  CodeCompletor.prototype.defaultProcess = function (token, text, completions) {\n    return this._getOperandsOrOperators(token, text, completions);\n  };\n\n  CodeCompletor.prototype.getCompletions = function (aceEditor, session, pos, prefix, callback) {\n    this._getCompletions(aceEditor, session, pos, prefix).done(function (completions) {\n      callback(null, completions);\n    });\n  };\n\n  CodeCompletor.prototype.getDocTooltip = function (item) {\n    if (item.tooltip && !item.docHTML) {\n      item.docHTML = [item.tooltip].join('');\n    }\n  };\n\n  return CodeCompletor;\n}(utils_1.Disposable);\n\nexports.CodeCompletor = CodeCompletor;\n\nfunction createFunctionCompletion(fnInfo, name, insertValue) {\n  if (insertValue === void 0) {\n    insertValue = null;\n  }\n\n  var insertValue = insertValue || fnInfo.text;\n  return {\n    caption: name,\n    snippet: insertValue,\n    meta: localization_utils_1.getLocalization('function', 'DxDesignerStringId.CodeCompletion_Function'),\n    tooltip: fnInfo.description || localization_utils_1.getLocalization(fnInfo.text, fnInfo.descriptionStringId) || null,\n    score: 10,\n    completer: {\n      insertMatch: function (editor, data) {\n        var completions = editor.completer.completions;\n\n        if (completions.filterText) {\n          var ranges = editor.selection.getAllRanges();\n\n          for (var i = 0, range; range = ranges[i]; i++) {\n            range.start.column -= completions.filterText.length;\n            editor.session.remove(range);\n          }\n        }\n\n        if (insertValue.substr(0, 3) === '[].') {\n          var ranges = editor.selection.getAllRanges();\n\n          for (var i = 0, range; range = ranges[i]; i++) {\n            range.start.column -= 2;\n            if (editor.session.getTextRange(range) === '].') insertValue = insertValue.substr(3);\n          }\n        }\n\n        editor.insert(insertValue);\n\n        _utils_1.setCursorInFunctionParameter(fnInfo.paramCount, editor, insertValue);\n      }\n    }\n  };\n}\n\nexports.createFunctionCompletion = createFunctionCompletion;\n\nfunction trimBrackets(value) {\n  return value.substring(value[0] === '[' ? 1 : 0, value[value.length - 1] === ']' ? value.length - 1 : value.length);\n}\n\nexports.trimBrackets = trimBrackets;","map":{"version":3,"sources":["/Users/kevinrabari/Desktop/Georgian College Work/1005_ Mobile Web Application/Assignment3/node_modules/@devexpress/analytics-core/widgets/common/_codeCompletor.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","TypeError","String","__","constructor","create","defineProperty","exports","value","trimBrackets","createFunctionCompletion","CodeCompletor","ko","require","$","_functions_1","utils_1","_utils_1","localization_utils_1","pathRequest_1","_expressioneditor_1","_operatorNames_1","criteriaOperatorStateMachine_1","_super","_options","_this","_contextPath","_isInContext","_getPath","_path","identifierRegexps","_fieldListProvider","fieldListProvider","path","_editor","editor","_functions","computed","unwrap","functions","functionDisplay","_rootItems","rootItems","name","needPrefix","_disposables","push","_previousSymbol","cursorPosition","getCursorPosition","session","getLine","row","column","beforeInsertMatch","token","parentPrefix","getTokenAt","type","remove","start","end","Math","max","length","endColumn","insertMatch","fieldName","insert","generateFieldDisplayName","displayName","_convertDataMemberInfoToCompletions","fields","map","field","caption","snippet","meta","isList","getLocalization","score","completer","data","getRealExpression","_combinePath","rootItem","filter","item","indexOf","rootPath","join","_getParentPrefix","position","dotIndex","lastIndexOf","closeIndex","startIndex","substring","substr","_getRealPath","pathArray","split","$deferred","Deferred","splice","done","result","slice","resolve","fail","promise","_getFields","completions","ignorePrefix","undefined","$fields","getItems","PathRequest","apply","_cleanupFields","$deferreds","rootPathRequests","forEach","_processFields","when","always","x","specifics","needCleanup","pushToCompletions","RangeSpecific","subFields","getFunctionsCompletions","functionsWithoutAggregates","fnDisplay","category","keys","items","fnKey","getAggregateCompletions","aggregates","getOperatorCompletions","prefix","operatorNames","operator","text","_addFunctions","_addAggregates","_addOperators","test","_addParameterOperators","$parametersPromises","paramPath","_getOperands","_getOperandsOrOperators","exceptionInfo","CriteriaOperatorStateMachine","parse","exception","hash","trimmedText","trim","lastNonSpaceSymbol","_findStartContextTokenPosition","tokens","index","blocks","i","_findOpenedStartContext","openedContextIndexes","contextItems","tokenIndex","pop","_findOpenedAggregates","openedAggregatesIndexes","currentToken","currentCursorPosition","aggregateIndex","openBrace","closeBrace","isClosedAggregate","j","_getContextPath","currentPosition","openedAggregatePositions","openedContextPositions","contextPath","concat","sort","a","startContextToken","member","match","_getCompletions","pos","getTokens","currentTokenIndex","defaultProcess","previousToken","getCompletions","aceEditor","callback","getDocTooltip","tooltip","docHTML","Disposable","fnInfo","insertValue","description","descriptionStringId","filterText","ranges","selection","getAllRanges","range","getTextRange","setCursorInFunctionParameter","paramCount"],"mappings":"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","sourcesContent":["/**\n* DevExpress Analytics (widgets\\common\\_codeCompletor.js)\n* Version:  22.1.3\n* Build date: Jun 14, 2022\n* Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\n* License: https://www.devexpress.com/Support/EULAs/universal.xml\n*/\n\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.trimBrackets = exports.createFunctionCompletion = exports.CodeCompletor = void 0;\nvar ko = require(\"knockout\");\nvar $ = require(\"jquery\");\nvar _functions_1 = require(\"../expressioneditor/tools/_functions\");\nvar utils_1 = require(\"../../serializer/utils\");\nvar _utils_1 = require(\"../_utils\");\nvar localization_utils_1 = require(\"../../property-grid/localization/localization_utils\");\nvar pathRequest_1 = require(\"./pathRequest\");\nvar _expressioneditor_1 = require(\"../expressioneditor/_expressioneditor\");\nvar _operatorNames_1 = require(\"../expressioneditor/tools/_operatorNames\");\nvar criteriaOperatorStateMachine_1 = require(\"../criteria/utils/criteriaOperatorStateMachine\");\nvar CodeCompletor = (function (_super) {\n    __extends(CodeCompletor, _super);\n    function CodeCompletor(_options) {\n        var _this = _super.call(this) || this;\n        _this._options = _options;\n        _this._contextPath = null;\n        _this._isInContext = function () { return _this._contextPath !== null; };\n        _this._getPath = function () { return _this._contextPath ? _this._path() + '.' + _this._contextPath : _this._path(); };\n        _this.identifierRegexps = [/\\./, /\\[/];\n        _this._fieldListProvider = _options.fieldListProvider;\n        _this._path = _options.path;\n        _this._editor = _options.editor;\n        _this._functions = ko.computed(function () { return ko.unwrap(_options.functions) || _functions_1.functionDisplay(); });\n        _this._rootItems = _options.rootItems || [{ name: 'Parameters', needPrefix: true }];\n        _this._disposables.push(_this._functions);\n        return _this;\n    }\n    CodeCompletor.prototype._previousSymbol = function () {\n        var cursorPosition = this._editor.getCursorPosition();\n        return this._editor.session.getLine(cursorPosition.row)[cursorPosition.column - 1];\n    };\n    CodeCompletor.prototype.beforeInsertMatch = function (editor, token, parentPrefix) {\n        var cursorPosition = editor.getCursorPosition();\n        if (parentPrefix === 'Parameters.') {\n            token = token || !this['_isInContext']() && editor.session.getTokenAt(cursorPosition.row, cursorPosition.column);\n            if (token) {\n                if ((token.type === 'support.variable.other' || token.type === 'support.function')) {\n                    editor.session.remove({\n                        start: { column: token.start - 1 || 0, row: cursorPosition.row },\n                        end: { column: Math.max(token.start + token.value.length || 0, cursorPosition.column), row: cursorPosition.row }\n                    });\n                }\n                else if (token.type === 'support.variable.parameter') {\n                    editor.session.remove({\n                        start: { column: token.start || 0, row: cursorPosition.row },\n                        end: { column: Math.max(token.start + token.value.length + 1 || 0, cursorPosition.column), row: cursorPosition.row }\n                    });\n                }\n                else if (token.type === 'text' && token.value[token.value.length - 1] === '?') {\n                    editor.session.remove({\n                        start: { column: token.start + token.value.length - 1 || 0, row: cursorPosition.row },\n                        end: { column: token.start + token.value.length || 0, row: cursorPosition.row },\n                    });\n                }\n            }\n        }\n        else {\n            token = token || editor.session.getTokenAt(cursorPosition.row, cursorPosition.column);\n            if (!token)\n                return;\n            var endColumn = null;\n            if (token.type === 'support.variable.other' || token.type === 'support.function') {\n                endColumn = Math.max(token.start + token.value.length || 0, cursorPosition.column);\n            }\n            else if (token.type === 'support.context.start' && cursorPosition.column < token.start + token.value.length) {\n                endColumn = token.start + token.value.length - 1 || 0;\n            }\n            if (endColumn !== null)\n                editor.session.remove({\n                    start: { column: token.start || 0, row: cursorPosition.row },\n                    end: { column: endColumn, row: cursorPosition.row }\n                });\n        }\n    };\n    CodeCompletor.prototype.insertMatch = function (editor, parentPrefix, fieldName) {\n        if (parentPrefix === 'Parameters.') {\n            editor.insert('?' + fieldName);\n        }\n        else {\n            editor.insert('[' + (parentPrefix || '') + fieldName + ']');\n        }\n    };\n    CodeCompletor.prototype.generateFieldDisplayName = function (parentPrefix, displayName) {\n        if (parentPrefix === 'Parameters.') {\n            return '?' + displayName;\n        }\n        return '[' + displayName + ']';\n    };\n    CodeCompletor.prototype._convertDataMemberInfoToCompletions = function (fields, token, parentPrefix) {\n        var _this = this;\n        if (parentPrefix === void 0) { parentPrefix = ''; }\n        return (fields || []).map(function (field) {\n            var displayName = _this.generateFieldDisplayName(parentPrefix, field.displayName);\n            return {\n                caption: field.displayName || field.name,\n                snippet: displayName,\n                meta: _utils_1.isList(field) && localization_utils_1.getLocalization('list', 'DxDesignerStringId.CodeCompletion_List') || localization_utils_1.getLocalization('field', 'DxDesignerStringId.CodeCompletion_Field'),\n                score: _utils_1.isList(field) && 200 || 100,\n                completer: {\n                    insertMatch: function (editor, data) {\n                        _this.beforeInsertMatch(editor, token, parentPrefix);\n                        _this.insertMatch(editor, parentPrefix, _this._options.getRealExpression ? (field.displayName || field.name) : field.name);\n                    }\n                }\n            };\n        });\n    };\n    CodeCompletor.prototype._combinePath = function (parentPrefix) {\n        var path = this._getPath();\n        if (parentPrefix) {\n            var rootItem = this._rootItems.filter(function (item) { return parentPrefix.indexOf(item.name) === 0; })[0];\n            if (rootItem && rootItem.rootPath)\n                path = [rootItem.rootPath, parentPrefix].join('.');\n            else\n                path = [path, parentPrefix].join('.');\n        }\n        return path;\n    };\n    CodeCompletor.prototype._getParentPrefix = function (token) {\n        var position = this._editor.getCursorPosition().column - token.start - 1;\n        var dotIndex = token.value.lastIndexOf('.', position);\n        var closeIndex = token.value.lastIndexOf(']', position);\n        dotIndex = Math.max(closeIndex, dotIndex);\n        var startIndex = token.type === 'support.variable.other' || token.type === 'support.context.start' ? 1 : 0;\n        var parentPrefix = token.value.substring(startIndex, dotIndex);\n        if (parentPrefix[0] === '[')\n            parentPrefix = parentPrefix.substr(1);\n        if (parentPrefix[parentPrefix.length - 1] === ']')\n            parentPrefix = parentPrefix.substring(0, parentPrefix.length - 1);\n        return parentPrefix;\n    };\n    CodeCompletor.prototype._getRealPath = function (path) {\n        var pathArray = path.split('.');\n        var $deferred = $.Deferred();\n        if (this._options.getRealExpression) {\n            this._options.getRealExpression(pathArray[0], this.generateFieldDisplayName(null, pathArray.splice(1).join('.'))).done(function (result) {\n                result = result.slice(1, result.length - 1);\n                $deferred.resolve(result && [pathArray[0], result].join('.') || pathArray[0]);\n            }).fail(function () { $deferred.resolve(path); });\n        }\n        else {\n            $deferred.resolve(path);\n        }\n        return $deferred.promise();\n    };\n    CodeCompletor.prototype._getFields = function (token, completions, ignorePrefix) {\n        var _this = this;\n        if (token === void 0) { token = null; }\n        if (completions === void 0) { completions = []; }\n        if (ignorePrefix === void 0) { ignorePrefix = false; }\n        var $deferred = $.Deferred();\n        var parentPrefix = undefined;\n        if (token && (token.type === 'support.variable.other' || token.type === 'support.function' || token.type === 'support.context.start')) {\n            parentPrefix = this._getParentPrefix(token);\n        }\n        this._getRealPath(this._combinePath(parentPrefix)).done(function (path) {\n            var $fields = ko.unwrap(_this._fieldListProvider).getItems(new pathRequest_1.PathRequest(path))\n                .done(function (fields) {\n                completions.push.apply(completions, _this._convertDataMemberInfoToCompletions(CodeCompletor._cleanupFields(fields), token, ignorePrefix ? null : parentPrefix && parentPrefix + '.'));\n            });\n            var $deferreds = [$fields];\n            var rootPathRequests = [];\n            if (!parentPrefix) {\n                _this._rootItems.forEach(function (item) {\n                    var path = item.rootPath || item.name;\n                    if (rootPathRequests.indexOf(path) === -1) {\n                        rootPathRequests.push(path);\n                        $deferreds.push(ko.unwrap(_this._fieldListProvider).getItems(new pathRequest_1.PathRequest(path))\n                            .done(function (fields) {\n                            _this._processFields($deferreds, fields, completions, path, token, item.needPrefix ? item.name + '.' : '', true);\n                        }));\n                    }\n                });\n            }\n            $.when($deferreds).always(function () { $deferred.resolve(completions); });\n        });\n        return $deferred.promise();\n    };\n    CodeCompletor._cleanupFields = function (fields) {\n        if (fields === void 0) { fields = []; }\n        return fields.filter(function (x) { return x.specifics !== 'parameters' && x.specifics !== 'none'; });\n    };\n    CodeCompletor.prototype._processFields = function ($deferreds, fields, completions, path, token, parentPrefix, needCleanup) {\n        var _this = this;\n        if (parentPrefix === void 0) { parentPrefix = ''; }\n        if (needCleanup === void 0) { needCleanup = false; }\n        var pushToCompletions = function (fields) {\n            completions.push.apply(completions, _this._convertDataMemberInfoToCompletions(needCleanup ? CodeCompletor._cleanupFields(fields) : fields, token, parentPrefix));\n        };\n        fields.forEach(function (item) {\n            if (item.specifics === _expressioneditor_1.RangeSpecific && _utils_1.isList(item)) {\n                $deferreds.push(ko.unwrap(_this._fieldListProvider).getItems(new pathRequest_1.PathRequest(path + '.' + item.name))\n                    .done(function (subFields) {\n                    pushToCompletions(subFields);\n                })\n                    .fail(function () {\n                    pushToCompletions([item]);\n                }));\n            }\n            else {\n                pushToCompletions([item]);\n            }\n        });\n    };\n    CodeCompletor.prototype.getFunctionsCompletions = function () {\n        var functions = [];\n        var functionsWithoutAggregates = ko.unwrap(this._functions).filter(function (fnDisplay) { return fnDisplay.category !== 'Aggregate'; });\n        functionsWithoutAggregates.forEach(function (fnDisplay) {\n            Object.keys(fnDisplay.items).forEach(function (fnKey) {\n                if (fnDisplay.items[fnKey]) {\n                    functions.push(createFunctionCompletion(fnDisplay.items[fnKey][0], fnKey));\n                }\n            });\n        });\n        return functions;\n    };\n    CodeCompletor.prototype.getAggregateCompletions = function () {\n        var functions = [];\n        var aggregates = ko.unwrap(this._functions).filter(function (fnDisplay) { return fnDisplay.category === 'Aggregate'; })[0];\n        if (aggregates)\n            Object.keys(aggregates.items).forEach(function (fnKey) {\n                if (aggregates.items[fnKey]) {\n                    functions.push(createFunctionCompletion(aggregates.items[fnKey][0], fnKey, fnKey + '()'));\n                }\n            });\n        return functions;\n    };\n    CodeCompletor.prototype.getOperatorCompletions = function (prefix) {\n        return _operatorNames_1.operatorNames.map(function (operator) {\n            return { caption: operator.text, snippet: prefix + operator.text, meta: localization_utils_1.getLocalization('operator', 'DxDesignerStringId.CodeCompletion_Operator') };\n        });\n    };\n    CodeCompletor.prototype._addFunctions = function (completions) {\n        completions.push.apply(completions, this.getFunctionsCompletions());\n    };\n    CodeCompletor.prototype._addAggregates = function (completions) {\n        completions.push.apply(completions, this.getAggregateCompletions());\n    };\n    CodeCompletor.prototype._addOperators = function (completions, text) {\n        var prefix = /\\s/.test(text[text.length - 1]) ? '' : ' ';\n        completions.push.apply(completions, this.getOperatorCompletions(prefix));\n    };\n    CodeCompletor.prototype._addParameterOperators = function (completions, token) {\n        var _this = this;\n        var $deferred = $.Deferred();\n        var $parametersPromises = [];\n        var paramPath = 'Parameters';\n        $parametersPromises.push(ko.unwrap(this['_fieldListProvider']).getItems(new pathRequest_1.PathRequest(paramPath))\n            .done(function (fields) {\n            _this._processFields($parametersPromises, fields, completions, paramPath, token, paramPath + '.');\n        }));\n        $.when($parametersPromises).always(function () { $deferred.resolve(completions); });\n        return $deferred.promise();\n    };\n    CodeCompletor.prototype._getOperands = function (token) {\n        if (token === void 0) { token = null; }\n        var result = [];\n        this._addFunctions(result);\n        return this._getFields(token, result);\n    };\n    CodeCompletor.prototype._getOperandsOrOperators = function (token, text, completions) {\n        var exceptionInfo;\n        try {\n            criteriaOperatorStateMachine_1.CriteriaOperatorStateMachine.parse(text);\n        }\n        catch (exception) {\n            exceptionInfo = exception.hash;\n        }\n        var trimmedText = text.trim();\n        var lastNonSpaceSymbol = trimmedText[trimmedText.length - 1];\n        if (lastNonSpaceSymbol === '?' && text[text.length - 1] !== ' ') {\n            this._addParameterOperators(completions, token);\n        }\n        else if (!exceptionInfo && trimmedText || (lastNonSpaceSymbol === ']' || lastNonSpaceSymbol === ')')) {\n            this._addOperators(completions, text);\n        }\n        else {\n            return this._getOperands();\n        }\n    };\n    CodeCompletor.prototype._findStartContextTokenPosition = function (tokens, index) {\n        var blocks = 0;\n        var path = [];\n        for (var i = index; i > -1; i--) {\n            if (tokens[i].type === 'support.context.end') {\n                blocks++;\n            }\n            else if (tokens[i].type === 'support.context.start') {\n                if (blocks > 0)\n                    blocks--;\n                else\n                    return i;\n            }\n        }\n    };\n    CodeCompletor.prototype._findOpenedStartContext = function (tokens, index) {\n        var openedContextIndexes = [];\n        var contextItems = tokens.filter(function (token, tokenIndex) { return (token.type === 'support.context.start' || token.type === 'support.context.end') && tokenIndex < index; });\n        for (var i = 0; i < contextItems.length; i++) {\n            if (contextItems[i].type === 'support.context.start') {\n                openedContextIndexes.push(tokens.indexOf(contextItems[i]));\n            }\n            else {\n                openedContextIndexes.pop();\n            }\n        }\n        return openedContextIndexes;\n    };\n    CodeCompletor.prototype._findOpenedAggregates = function (tokens, index) {\n        var openedAggregatesIndexes = [];\n        var aggregates = tokens.filter(function (token, tokenIndex) { return token.type === 'support.other.aggregate' && tokenIndex < index; });\n        if (aggregates.length > 0) {\n            var currentToken = tokens[index];\n            var currentCursorPosition = this._editor.getCursorPosition().column - (currentToken && currentToken.start || 0);\n            for (var i = aggregates.length - 1; i > -1; i--) {\n                var aggregateIndex = tokens.indexOf(aggregates[i]);\n                var openBrace = 0;\n                var closeBrace = 0;\n                var isClosedAggregate = false;\n                if (aggregateIndex + 1 === index && tokens[aggregateIndex + 1].value.substr(0, currentCursorPosition).indexOf('()') !== -1 ||\n                    aggregateIndex + 1 < index && tokens[aggregateIndex + 1].value.indexOf('()') !== -1) {\n                    isClosedAggregate = true;\n                    index = aggregateIndex;\n                    continue;\n                }\n                for (var j = aggregateIndex; j < index; j++) {\n                    if (tokens[j].value.trim() === '(') {\n                        openBrace++;\n                    }\n                    else if (tokens[j].value.trim() === ')') {\n                        closeBrace++;\n                    }\n                    if (openBrace === closeBrace && openBrace !== 0) {\n                        isClosedAggregate = true;\n                        break;\n                    }\n                }\n                if (!isClosedAggregate)\n                    openedAggregatesIndexes.splice(0, 0, aggregateIndex);\n                index = aggregateIndex;\n            }\n        }\n        return openedAggregatesIndexes;\n    };\n    CodeCompletor.prototype._getContextPath = function (tokens, currentPosition) {\n        var path = [];\n        var openedAggregatePositions = this._findOpenedAggregates(tokens, currentPosition);\n        var openedContextPositions = this._findOpenedStartContext(tokens, currentPosition);\n        var contextPath = openedContextPositions.concat.apply(openedContextPositions, openedAggregatePositions).sort(function (a, b) { return a - b; });\n        if (contextPath.length > 0) {\n            for (var i = 0; i < contextPath.length; i++) {\n                if (tokens[contextPath[i]].type === 'support.other.aggregate') {\n                    if (tokens[contextPath[i] - 1].type === 'support.context.end') {\n                        var startContextToken = this._findStartContextTokenPosition(tokens, contextPath[i] - 2);\n                        var member = trimBrackets(tokens[startContextToken].value.match(/^\\[(?:[^\\]\\)])*\\]/)[0]);\n                        path.push(member);\n                    }\n                    else if (tokens[contextPath[i] - 1].type === 'support.variable.other') {\n                        path.push(trimBrackets(tokens[contextPath[i] - 1].value));\n                    }\n                }\n                else {\n                    var member = trimBrackets(tokens[contextPath[i]].value.match(/^\\[(?:[^\\]\\)])*\\]/)[0]);\n                    path.push(member);\n                }\n            }\n        }\n        return path.filter(function (x) { return !!x; }).join('.');\n    };\n    CodeCompletor.prototype._getCompletions = function (editor, session, pos, prefix) {\n        var $deferred;\n        var completions = [];\n        var currentToken = session.getTokenAt(pos.row, pos.column);\n        var text = editor.session.getLine(pos.row).substring(0, pos.column);\n        var tokens = session.getTokens(pos.row);\n        var currentTokenIndex = currentToken ? currentToken.index : -1;\n        this._contextPath = this._getContextPath(tokens, currentTokenIndex);\n        if (!currentToken) {\n            $deferred = this._getOperands();\n        }\n        else if (currentToken.type === 'support.context.start') {\n            var ignorePrefix = this._editor.getCursorPosition().column - currentToken.start === currentToken.value.length;\n            if (ignorePrefix) {\n                var functions = [];\n                this._addFunctions(functions);\n            }\n            $deferred = this._getFields(currentToken, functions, ignorePrefix);\n        }\n        else if (currentToken.type === 'string.quoted.single') {\n        }\n        else if (currentToken.type.indexOf('support.variable') === 0) {\n            $deferred = this._getFields(currentToken);\n        }\n        else if (currentToken.type === 'support.function') {\n            $deferred = this.defaultProcess(currentToken, text.substring(0, currentToken.start), completions);\n        }\n        else if (currentToken.type === 'support.other.aggregate') {\n            var previousToken = tokens[currentTokenIndex - 1];\n            this._addAggregates(completions);\n            if (previousToken && trimBrackets(previousToken.value).trim()) {\n                $deferred = this._getFields({\n                    start: (currentToken.start - (previousToken.value || '').length) || 0,\n                    value: previousToken.value + currentToken.value,\n                    type: 'support.function'\n                }, completions);\n            }\n        }\n        else {\n            if (!(currentToken.type.indexOf('comment') === 0)) {\n                $deferred = this.defaultProcess(currentToken, text, completions);\n            }\n        }\n        return $deferred ? $deferred.promise() : $.Deferred().resolve(completions).promise();\n    };\n    CodeCompletor.prototype.defaultProcess = function (token, text, completions) {\n        return this._getOperandsOrOperators(token, text, completions);\n    };\n    CodeCompletor.prototype.getCompletions = function (aceEditor, session, pos, prefix, callback) {\n        this._getCompletions(aceEditor, session, pos, prefix).done(function (completions) {\n            callback(null, completions);\n        });\n    };\n    CodeCompletor.prototype.getDocTooltip = function (item) {\n        if (item.tooltip && !item.docHTML) {\n            item.docHTML = [\n                item.tooltip\n            ].join('');\n        }\n    };\n    return CodeCompletor;\n}(utils_1.Disposable));\nexports.CodeCompletor = CodeCompletor;\nfunction createFunctionCompletion(fnInfo, name, insertValue) {\n    if (insertValue === void 0) { insertValue = null; }\n    var insertValue = insertValue || fnInfo.text;\n    return {\n        caption: name,\n        snippet: insertValue,\n        meta: localization_utils_1.getLocalization('function', 'DxDesignerStringId.CodeCompletion_Function'),\n        tooltip: fnInfo.description || localization_utils_1.getLocalization(fnInfo.text, fnInfo.descriptionStringId) || null,\n        score: 10,\n        completer: {\n            insertMatch: function (editor, data) {\n                var completions = editor.completer.completions;\n                if (completions.filterText) {\n                    var ranges = editor.selection.getAllRanges();\n                    for (var i = 0, range; range = ranges[i]; i++) {\n                        range.start.column -= completions.filterText.length;\n                        editor.session.remove(range);\n                    }\n                }\n                if (insertValue.substr(0, 3) === '[].') {\n                    var ranges = editor.selection.getAllRanges();\n                    for (var i = 0, range; range = ranges[i]; i++) {\n                        range.start.column -= 2;\n                        if (editor.session.getTextRange(range) === '].')\n                            insertValue = insertValue.substr(3);\n                    }\n                }\n                editor.insert(insertValue);\n                _utils_1.setCursorInFunctionParameter(fnInfo.paramCount, editor, insertValue);\n            }\n        }\n    };\n}\nexports.createFunctionCompletion = createFunctionCompletion;\nfunction trimBrackets(value) {\n    return value.substring(value[0] === '[' ? 1 : 0, value[value.length - 1] === ']' ? value.length - 1 : value.length);\n}\nexports.trimBrackets = trimBrackets;\n"]},"metadata":{},"sourceType":"script"}