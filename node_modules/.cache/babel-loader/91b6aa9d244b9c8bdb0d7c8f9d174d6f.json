{"ast":null,"code":"/**\n* DevExpress Analytics (widgets\\formatstring\\formatstringeditor.js)\n* Version:  22.1.3\n* Build date: Jun 14, 2022\n* Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\n* License: https://www.devexpress.com/Support/EULAs/universal.xml\n*/\n\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.FormatStringEditor = void 0;\n\nvar ko = require(\"knockout\");\n\nvar $ = require(\"jquery\");\n\nvar utils_1 = require(\"../../serializer/utils\");\n\nvar _patterns_1 = require(\"./_patterns\");\n\nvar localization_utils_1 = require(\"../../property-grid/localization/localization_utils\");\n\nvar _localizationStringIds_1 = require(\"../../property-grid/localization/_localizationStringIds\");\n\nvar _popupService_1 = require(\"../../property-grid/internal/_popupService\");\n\nvar scroll_view_1 = require(\"devextreme/ui/scroll_view\");\n\nvar FormatStringEditor = function (_super) {\n  __extends(FormatStringEditor, _super);\n\n  function FormatStringEditor(value, disabled, defaultPatterns, customPatterns, actions, rtl, popupContainer) {\n    var _this = _super.call(this) || this;\n\n    _this._isDisabled = ko.observable(false);\n    _this._timeout = null;\n    _this.currentType = ko.observable();\n    _this.patternList = ko.observableArray([]);\n    _this.canAddCustomFormat = ko.observable(false);\n    _this.formatPrefix = ko.observable('');\n    _this.formatSuffix = ko.observable('');\n    _this.previewString = ko.observable('Preview string');\n    _this.formatResult = ko.observable('');\n    _this.selectedFormats = ko.observable([]);\n    _this.selectedTypes = ko.observable([]);\n    _this.popupVisible = ko.observable(false);\n    _this.localizationIdMap = {\n      'title': {\n        text: 'FormatString Editor',\n        localizationId: 'AnalyticsCoreStringId.FormatStringEditor_Title'\n      },\n      'category': {\n        text: 'Category',\n        localizationId: 'AnalyticsCoreStringId.Category'\n      },\n      'preview': {\n        text: 'Preview',\n        localizationId: 'AnalyticsCoreStringId.TooltipButtons_Preview'\n      },\n      'types': {\n        text: 'Types',\n        localizationId: 'AnalyticsCoreStringId.FormatStringEditor_Types'\n      },\n      'add': {\n        text: 'Add',\n        localizationId: 'DataAccessUIStringId.Button_Add'\n      },\n      'prefix': {\n        text: 'Prefix',\n        localizationId: 'AnalyticsCoreStringId.Prefix'\n      },\n      'suffix': {\n        text: 'Suffix',\n        localizationId: 'AnalyticsCoreStringId.FormatStringEditor_Suffix'\n      }\n    };\n\n    _this.option('value', value);\n\n    _this.option('disabled', disabled || false);\n\n    _this.option('rtl', rtl || false);\n\n    _this.option('popupContainer', popupContainer || '.dx-designer-viewport');\n\n    var self = _this;\n    _this.popupService = new _popupService_1.PopupService();\n    _this._standardPatternSource = defaultPatterns || _patterns_1.formatStringStandardPatterns;\n    _this._customPatternSource = customPatterns || {};\n    _this.types = _this._convertArray(Object.keys(_this._standardPatternSource));\n\n    _this._disposables.push(_this.currentType.subscribe(function (newVal) {\n      if (self.isGeneralType) {\n        self.formatResult('');\n        self.selectedFormats([]);\n      } else {\n        self._updateFormatList();\n      }\n    }));\n\n    _this.currentType(_this.types[0].name);\n\n    _this._disposables.push(_this.formatResult.subscribe(function (newVal) {\n      self._updateCanAddCustomFormat(newVal);\n\n      self._updatePreview();\n    }));\n\n    _this._disposables.push(_this.formatPrefix.subscribe(function (newVal) {\n      self._updatePreview();\n    }));\n\n    _this._disposables.push(_this.formatSuffix.subscribe(function (newVal) {\n      self._updatePreview();\n    }));\n\n    _this._disposables.push(_this.popupVisible.subscribe(function (newVal) {\n      if (!newVal) return;\n\n      self._initEditor(value());\n\n      self.selectedTypes(self.types.filter(function (item) {\n        return item.name === self.currentType();\n      }));\n    }));\n\n    _this._createMainPopupButtons();\n\n    actions && actions.updatePreview && (_this.updatePreview = actions.updatePreview);\n\n    _this.setType = function (e) {\n      self.currentType(e.itemData.name);\n\n      self._updateSelection();\n    };\n\n    _this.setFormat = function (e) {\n      self.formatResult(e.itemData.name);\n    };\n\n    _this.addCustomFormat = function () {\n      if (self.formatResult() && self.canAddCustomFormat()) {\n        self.customPatterns.push(self.formatResult());\n\n        self._updateFormatList();\n\n        self._scrollToBottom();\n\n        actions && actions.saveCustomPattern(self.currentType(), self.formatResult());\n\n        self._updateSelection(self.patternList().length - 1);\n\n        self.canAddCustomFormat(false);\n      }\n    };\n\n    _this.removeCustomFormat = function (data) {\n      var currentSelection = self.selectedFormats()[0];\n      var patternList = self.patternList();\n      var removedItemIndex = patternList.map(function (item) {\n        return item.name;\n      }).indexOf(data.name);\n      self.customPatterns.splice(self.customPatterns.indexOf(data.name), 1);\n\n      self._updateFormatList();\n\n      actions && actions.removeCustomPattern(self.currentType(), data.name);\n\n      if (currentSelection.name === data.name) {\n        self._updateSelection(removedItemIndex === patternList.length - 1 ? self.patternList().length - 1 : removedItemIndex);\n      } else {\n        self.selectedFormats(self.patternList().filter(function (item) {\n          return item.name === currentSelection.name;\n        }));\n      }\n    };\n\n    return _this;\n  }\n\n  FormatStringEditor.prototype.okAction = function () {\n    var result = this.isGeneralType ? this._getGeneralPreview('{0}') : this._wrapFormat();\n    this.option('value', result);\n    this.popupVisible(false);\n  };\n\n  FormatStringEditor.prototype._createMainPopupButtons = function () {\n    var self = this;\n    this.buttonItems = [{\n      toolbar: 'bottom',\n      location: 'after',\n      widget: 'dxButton',\n      options: {\n        text: localization_utils_1.getLocalization('OK', _localizationStringIds_1.StringId.DataAccessBtnOK),\n        type: 'default',\n        stylingMode: 'contained',\n        disabled: this._isDisabled,\n        onClick: function () {\n          self.okAction();\n        }\n      }\n    }, {\n      toolbar: 'bottom',\n      location: 'after',\n      widget: 'dxButton',\n      options: {\n        text: localization_utils_1.getLocalization('Cancel', _localizationStringIds_1.StringId.DataAccessBtnCancel),\n        type: 'normal',\n        stylingMode: 'contained',\n        onClick: function () {\n          self.popupVisible(false);\n        }\n      }\n    }];\n  };\n\n  FormatStringEditor.prototype._convertArray = function (array, canRemove) {\n    return array.map(function (item) {\n      return {\n        name: item,\n        displayName: localization_utils_1.getLocalization(item),\n        canRemove: !!canRemove\n      };\n    });\n  };\n\n  FormatStringEditor.prototype._scrollToBottom = function () {\n    var $scrollView = $('.dx-format-string .dx-format-string-formats').find('.dx-scrollview').filter(':visible');\n    var scrollViewInstance = scroll_view_1.default.getInstance($scrollView.get(0));\n    scrollViewInstance && scrollViewInstance['scrollTo'] && scrollViewInstance['scrollTo'](scrollViewInstance['scrollHeight']());\n  };\n\n  FormatStringEditor.prototype._updateFormatList = function () {\n    this.selectedFormats([]);\n\n    var currentTypeInfo = this._standardPatternSource[this.currentType()];\n\n    this.patternList(this._convertArray(currentTypeInfo.patterns).concat(this._convertArray(this.customPatterns, true)));\n  };\n\n  FormatStringEditor.prototype._updateSelection = function (selectedItemIndex) {\n    var currectFormat = this.patternList()[selectedItemIndex || 0];\n\n    if (currectFormat) {\n      this.selectedFormats([currectFormat]);\n      this.formatResult(currectFormat.name);\n    }\n  };\n\n  FormatStringEditor.prototype._setPreviewString = function (previewString) {\n    this.previewString(previewString);\n\n    this._isDisabled(false);\n  };\n\n  FormatStringEditor.prototype._setErrorMessage = function (setDisabled) {\n    this.previewString(localization_utils_1.getLocalization('Preview string is not available', 'AnalyticsCoreStringId.FormatStringEditor_PreviewNotAvailable_Text'));\n\n    this._isDisabled(setDisabled);\n  };\n\n  FormatStringEditor.prototype._updatePreview = function () {\n    var _this = this;\n\n    this._timeout && clearTimeout(this._timeout);\n    this._timeout = setTimeout(function () {\n      if (_this.isGeneralType) {\n        _this.previewString(_this._getGeneralPreview(undefined));\n\n        return;\n      }\n\n      var category = _this._standardPatternSource[_this.currentType()];\n\n      var updatedPreviewPromise = _this.updatePreview(category.value, category.type, _this._wrapFormat());\n\n      _this._lastUpdatePreviewPromise = updatedPreviewPromise;\n      updatedPreviewPromise.done(function (previewResult) {\n        if (_this._lastUpdatePreviewPromise === updatedPreviewPromise) {\n          if (previewResult.Result) _this._setPreviewString(previewResult.Result);else _this._setErrorMessage(previewResult.IsError);\n        }\n      }).fail(function (error) {\n        if (_this._lastUpdatePreviewPromise === updatedPreviewPromise) _this.previewString(localization_utils_1.getLocalization('Preview string is not available', 'AnalyticsCoreStringId.FormatStringEditor_PreviewNotAvailable_Text'));\n      });\n    }, 100);\n  };\n\n  FormatStringEditor.prototype._getGeneralPreview = function (value) {\n    if (value === void 0) {\n      value = '###';\n    }\n\n    return this.formatPrefix() + value + this.formatSuffix();\n  };\n\n  FormatStringEditor.prototype._wrapFormat = function (format) {\n    var pattern = format || this.formatResult();\n\n    if (pattern && pattern.indexOf('{0:') !== -1) {\n      return pattern;\n    }\n\n    return pattern ? '{0:' + pattern + '}' : '';\n  };\n\n  FormatStringEditor.prototype._updateCanAddCustomFormat = function (newFormat) {\n    var _this = this;\n\n    if (!newFormat) {\n      this.canAddCustomFormat(false);\n      return;\n    }\n\n    var canAddCustomFormat = true;\n    Object.keys(this._standardPatternSource).some(function (name) {\n      canAddCustomFormat = _this._standardPatternSource[name].patterns.indexOf(newFormat) === -1;\n      return !canAddCustomFormat;\n    });\n    this.canAddCustomFormat(canAddCustomFormat ? this.customPatterns.indexOf(newFormat) === -1 : canAddCustomFormat);\n  };\n\n  FormatStringEditor.prototype._initEditor = function (formatStringValue) {\n    var _this = this;\n\n    if (!formatStringValue) {\n      this.setType({\n        itemData: this.types[0]\n      });\n      return;\n    }\n\n    if (formatStringValue.indexOf('{0}') !== -1) {\n      this.currentType('General');\n      this.formatPrefix(formatStringValue.substring(0, formatStringValue.indexOf('{0}')));\n      this.formatSuffix(formatStringValue.substring(formatStringValue.indexOf('{0}') + 3));\n      return;\n    }\n\n    var startIndex = formatStringValue.indexOf('{0:'),\n        closingBracketIndex = formatStringValue.indexOf('}', startIndex),\n        formatPattern = formatStringValue.substring(startIndex + 3, closingBracketIndex),\n        isFormatPatternFind;\n\n    var selectTypePatternPair = function (name) {\n      _this.currentType(name);\n\n      if (startIndex === 0 && closingBracketIndex === formatStringValue.length - 1) {\n        _this.selectedFormats(_this.patternList().filter(function (item) {\n          return item.name === formatPattern;\n        }));\n\n        _this.formatResult(formatPattern);\n\n        isFormatPatternFind = true;\n      }\n    };\n\n    Object.keys(this._standardPatternSource).some(function (name) {\n      if (_this._standardPatternSource[name].patterns.indexOf(formatPattern) !== -1) {\n        selectTypePatternPair(name);\n        return true;\n      }\n\n      var customPatterns = _this._customPatternSource[_this._standardPatternSource[name].type];\n\n      if (customPatterns && customPatterns.indexOf(formatPattern) !== -1) {\n        selectTypePatternPair(name);\n        return true;\n      }\n\n      return false;\n    });\n\n    if (!isFormatPatternFind) {\n      this.currentType(this.types[0].name);\n      this.selectedFormats([]);\n      this.formatResult(formatStringValue);\n    }\n  };\n\n  FormatStringEditor.prototype.updateInputText = function (propertyName, componentInstance) {\n    this[propertyName](componentInstance.option('text'));\n  };\n\n  FormatStringEditor.prototype.option = function (name, value) {\n    if (value !== void 0) {\n      if (ko.isObservable(this[name])) {\n        this[name](value);\n      } else {\n        this[name] = value;\n      }\n    }\n\n    return ko.unwrap(this[name]);\n  };\n\n  FormatStringEditor.prototype.updatePreview = function (value, category, pattern) {\n    return $.Deferred().resolve({\n      Result: value || 'preview string'\n    }).promise();\n  };\n\n  Object.defineProperty(FormatStringEditor.prototype, \"customPatterns\", {\n    get: function () {\n      var currentTypeInfo = this._standardPatternSource[this.currentType()];\n\n      return this._customPatternSource[currentTypeInfo.type] = this._customPatternSource[currentTypeInfo.type] || [];\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(FormatStringEditor.prototype, \"isGeneralType\", {\n    get: function () {\n      return this.currentType() === 'General';\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  FormatStringEditor.prototype.getDisplayText = function (key) {\n    return localization_utils_1.getLocalization(this.localizationIdMap[key].text, this.localizationIdMap[key].localizationId);\n  };\n\n  FormatStringEditor.prototype.getPopupContainer = function (el) {\n    return $(el).closest(this.option('popupContainer'));\n  };\n\n  return FormatStringEditor;\n}(utils_1.Disposable);\n\nexports.FormatStringEditor = FormatStringEditor;","map":{"version":3,"sources":["/Users/krunalpatel/Downloads/React-Firebase-Auth-master 3/node_modules/@devexpress/analytics-core/widgets/formatstring/formatstringeditor.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","TypeError","String","__","constructor","create","defineProperty","exports","value","FormatStringEditor","ko","require","$","utils_1","_patterns_1","localization_utils_1","_localizationStringIds_1","_popupService_1","scroll_view_1","_super","disabled","defaultPatterns","customPatterns","actions","rtl","popupContainer","_this","_isDisabled","observable","_timeout","currentType","patternList","observableArray","canAddCustomFormat","formatPrefix","formatSuffix","previewString","formatResult","selectedFormats","selectedTypes","popupVisible","localizationIdMap","text","localizationId","option","self","popupService","PopupService","_standardPatternSource","formatStringStandardPatterns","_customPatternSource","types","_convertArray","keys","_disposables","push","subscribe","newVal","isGeneralType","_updateFormatList","name","_updateCanAddCustomFormat","_updatePreview","_initEditor","filter","item","_createMainPopupButtons","updatePreview","setType","e","itemData","_updateSelection","setFormat","addCustomFormat","_scrollToBottom","saveCustomPattern","length","removeCustomFormat","data","currentSelection","removedItemIndex","map","indexOf","splice","removeCustomPattern","okAction","result","_getGeneralPreview","_wrapFormat","buttonItems","toolbar","location","widget","options","getLocalization","StringId","DataAccessBtnOK","type","stylingMode","onClick","DataAccessBtnCancel","array","canRemove","displayName","$scrollView","find","scrollViewInstance","default","getInstance","get","currentTypeInfo","patterns","concat","selectedItemIndex","currectFormat","_setPreviewString","_setErrorMessage","setDisabled","clearTimeout","setTimeout","undefined","category","updatedPreviewPromise","_lastUpdatePreviewPromise","done","previewResult","Result","IsError","fail","error","format","pattern","newFormat","some","formatStringValue","substring","startIndex","closingBracketIndex","formatPattern","isFormatPatternFind","selectTypePatternPair","updateInputText","propertyName","componentInstance","isObservable","unwrap","Deferred","resolve","promise","enumerable","configurable","getDisplayText","key","getPopupContainer","el","closest","Disposable"],"mappings":"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","sourcesContent":["/**\n* DevExpress Analytics (widgets\\formatstring\\formatstringeditor.js)\n* Version:  22.1.3\n* Build date: Jun 14, 2022\n* Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\n* License: https://www.devexpress.com/Support/EULAs/universal.xml\n*/\n\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.FormatStringEditor = void 0;\nvar ko = require(\"knockout\");\nvar $ = require(\"jquery\");\nvar utils_1 = require(\"../../serializer/utils\");\nvar _patterns_1 = require(\"./_patterns\");\nvar localization_utils_1 = require(\"../../property-grid/localization/localization_utils\");\nvar _localizationStringIds_1 = require(\"../../property-grid/localization/_localizationStringIds\");\nvar _popupService_1 = require(\"../../property-grid/internal/_popupService\");\nvar scroll_view_1 = require(\"devextreme/ui/scroll_view\");\nvar FormatStringEditor = (function (_super) {\n    __extends(FormatStringEditor, _super);\n    function FormatStringEditor(value, disabled, defaultPatterns, customPatterns, actions, rtl, popupContainer) {\n        var _this = _super.call(this) || this;\n        _this._isDisabled = ko.observable(false);\n        _this._timeout = null;\n        _this.currentType = ko.observable();\n        _this.patternList = ko.observableArray([]);\n        _this.canAddCustomFormat = ko.observable(false);\n        _this.formatPrefix = ko.observable('');\n        _this.formatSuffix = ko.observable('');\n        _this.previewString = ko.observable('Preview string');\n        _this.formatResult = ko.observable('');\n        _this.selectedFormats = ko.observable([]);\n        _this.selectedTypes = ko.observable([]);\n        _this.popupVisible = ko.observable(false);\n        _this.localizationIdMap = {\n            'title': { text: 'FormatString Editor', localizationId: 'AnalyticsCoreStringId.FormatStringEditor_Title' },\n            'category': { text: 'Category', localizationId: 'AnalyticsCoreStringId.Category' },\n            'preview': { text: 'Preview', localizationId: 'AnalyticsCoreStringId.TooltipButtons_Preview' },\n            'types': { text: 'Types', localizationId: 'AnalyticsCoreStringId.FormatStringEditor_Types' },\n            'add': { text: 'Add', localizationId: 'DataAccessUIStringId.Button_Add' },\n            'prefix': { text: 'Prefix', localizationId: 'AnalyticsCoreStringId.Prefix' },\n            'suffix': { text: 'Suffix', localizationId: 'AnalyticsCoreStringId.FormatStringEditor_Suffix' }\n        };\n        _this.option('value', value);\n        _this.option('disabled', disabled || false);\n        _this.option('rtl', rtl || false);\n        _this.option('popupContainer', popupContainer || '.dx-designer-viewport');\n        var self = _this;\n        _this.popupService = new _popupService_1.PopupService();\n        _this._standardPatternSource = defaultPatterns || _patterns_1.formatStringStandardPatterns;\n        _this._customPatternSource = customPatterns || {};\n        _this.types = _this._convertArray(Object.keys(_this._standardPatternSource));\n        _this._disposables.push(_this.currentType.subscribe(function (newVal) {\n            if (self.isGeneralType) {\n                self.formatResult('');\n                self.selectedFormats([]);\n            }\n            else {\n                self._updateFormatList();\n            }\n        }));\n        _this.currentType(_this.types[0].name);\n        _this._disposables.push(_this.formatResult.subscribe(function (newVal) {\n            self._updateCanAddCustomFormat(newVal);\n            self._updatePreview();\n        }));\n        _this._disposables.push(_this.formatPrefix.subscribe(function (newVal) {\n            self._updatePreview();\n        }));\n        _this._disposables.push(_this.formatSuffix.subscribe(function (newVal) {\n            self._updatePreview();\n        }));\n        _this._disposables.push(_this.popupVisible.subscribe(function (newVal) {\n            if (!newVal)\n                return;\n            self._initEditor(value());\n            self.selectedTypes(self.types.filter(function (item) { return item.name === self.currentType(); }));\n        }));\n        _this._createMainPopupButtons();\n        actions && actions.updatePreview && (_this.updatePreview = actions.updatePreview);\n        _this.setType = function (e) {\n            self.currentType(e.itemData.name);\n            self._updateSelection();\n        };\n        _this.setFormat = function (e) {\n            self.formatResult(e.itemData.name);\n        };\n        _this.addCustomFormat = function () {\n            if (self.formatResult() && self.canAddCustomFormat()) {\n                self.customPatterns.push(self.formatResult());\n                self._updateFormatList();\n                self._scrollToBottom();\n                actions && actions.saveCustomPattern(self.currentType(), self.formatResult());\n                self._updateSelection(self.patternList().length - 1);\n                self.canAddCustomFormat(false);\n            }\n        };\n        _this.removeCustomFormat = function (data) {\n            var currentSelection = self.selectedFormats()[0];\n            var patternList = self.patternList();\n            var removedItemIndex = patternList.map(function (item) { return item.name; }).indexOf(data.name);\n            self.customPatterns.splice(self.customPatterns.indexOf(data.name), 1);\n            self._updateFormatList();\n            actions && actions.removeCustomPattern(self.currentType(), data.name);\n            if (currentSelection.name === data.name) {\n                self._updateSelection(removedItemIndex === (patternList.length - 1) ? (self.patternList().length - 1) : removedItemIndex);\n            }\n            else {\n                self.selectedFormats(self.patternList().filter(function (item) { return item.name === currentSelection.name; }));\n            }\n        };\n        return _this;\n    }\n    FormatStringEditor.prototype.okAction = function () {\n        var result = this.isGeneralType ? this._getGeneralPreview('{0}') : this._wrapFormat();\n        this.option('value', result);\n        this.popupVisible(false);\n    };\n    FormatStringEditor.prototype._createMainPopupButtons = function () {\n        var self = this;\n        this.buttonItems = [\n            { toolbar: 'bottom', location: 'after', widget: 'dxButton', options: { text: localization_utils_1.getLocalization('OK', _localizationStringIds_1.StringId.DataAccessBtnOK), type: 'default', stylingMode: 'contained', disabled: this._isDisabled, onClick: function () { self.okAction(); } } },\n            { toolbar: 'bottom', location: 'after', widget: 'dxButton', options: { text: localization_utils_1.getLocalization('Cancel', _localizationStringIds_1.StringId.DataAccessBtnCancel), type: 'normal', stylingMode: 'contained', onClick: function () { self.popupVisible(false); } } }\n        ];\n    };\n    FormatStringEditor.prototype._convertArray = function (array, canRemove) {\n        return array.map(function (item) { return { name: item, displayName: localization_utils_1.getLocalization(item), canRemove: !!canRemove }; });\n    };\n    FormatStringEditor.prototype._scrollToBottom = function () {\n        var $scrollView = $('.dx-format-string .dx-format-string-formats').find('.dx-scrollview').filter(':visible');\n        var scrollViewInstance = scroll_view_1.default.getInstance($scrollView.get(0));\n        scrollViewInstance && scrollViewInstance['scrollTo'] && scrollViewInstance['scrollTo'](scrollViewInstance['scrollHeight']());\n    };\n    FormatStringEditor.prototype._updateFormatList = function () {\n        this.selectedFormats([]);\n        var currentTypeInfo = this._standardPatternSource[this.currentType()];\n        this.patternList(this._convertArray(currentTypeInfo.patterns).concat(this._convertArray(this.customPatterns, true)));\n    };\n    FormatStringEditor.prototype._updateSelection = function (selectedItemIndex) {\n        var currectFormat = this.patternList()[selectedItemIndex || 0];\n        if (currectFormat) {\n            this.selectedFormats([currectFormat]);\n            this.formatResult(currectFormat.name);\n        }\n    };\n    FormatStringEditor.prototype._setPreviewString = function (previewString) {\n        this.previewString(previewString);\n        this._isDisabled(false);\n    };\n    FormatStringEditor.prototype._setErrorMessage = function (setDisabled) {\n        this.previewString(localization_utils_1.getLocalization('Preview string is not available', 'AnalyticsCoreStringId.FormatStringEditor_PreviewNotAvailable_Text'));\n        this._isDisabled(setDisabled);\n    };\n    FormatStringEditor.prototype._updatePreview = function () {\n        var _this = this;\n        this._timeout && clearTimeout(this._timeout);\n        this._timeout = setTimeout(function () {\n            if (_this.isGeneralType) {\n                _this.previewString(_this._getGeneralPreview(undefined));\n                return;\n            }\n            var category = _this._standardPatternSource[_this.currentType()];\n            var updatedPreviewPromise = _this.updatePreview(category.value, category.type, _this._wrapFormat());\n            _this._lastUpdatePreviewPromise = updatedPreviewPromise;\n            updatedPreviewPromise\n                .done(function (previewResult) {\n                if (_this._lastUpdatePreviewPromise === updatedPreviewPromise) {\n                    if (previewResult.Result)\n                        _this._setPreviewString(previewResult.Result);\n                    else\n                        _this._setErrorMessage(previewResult.IsError);\n                }\n            }).fail(function (error) {\n                if (_this._lastUpdatePreviewPromise === updatedPreviewPromise)\n                    _this.previewString(localization_utils_1.getLocalization('Preview string is not available', 'AnalyticsCoreStringId.FormatStringEditor_PreviewNotAvailable_Text'));\n            });\n        }, 100);\n    };\n    FormatStringEditor.prototype._getGeneralPreview = function (value) {\n        if (value === void 0) { value = '###'; }\n        return this.formatPrefix() + value + this.formatSuffix();\n    };\n    FormatStringEditor.prototype._wrapFormat = function (format) {\n        var pattern = format || this.formatResult();\n        if (pattern && pattern.indexOf('{0:') !== -1) {\n            return pattern;\n        }\n        return pattern ? '{0:' + pattern + '}' : '';\n    };\n    FormatStringEditor.prototype._updateCanAddCustomFormat = function (newFormat) {\n        var _this = this;\n        if (!newFormat) {\n            this.canAddCustomFormat(false);\n            return;\n        }\n        var canAddCustomFormat = true;\n        Object.keys(this._standardPatternSource).some(function (name) {\n            canAddCustomFormat = _this._standardPatternSource[name].patterns.indexOf(newFormat) === -1;\n            return !canAddCustomFormat;\n        });\n        this.canAddCustomFormat(canAddCustomFormat ? this.customPatterns.indexOf(newFormat) === -1 : canAddCustomFormat);\n    };\n    FormatStringEditor.prototype._initEditor = function (formatStringValue) {\n        var _this = this;\n        if (!formatStringValue) {\n            this.setType({ itemData: this.types[0] });\n            return;\n        }\n        if (formatStringValue.indexOf('{0}') !== -1) {\n            this.currentType('General');\n            this.formatPrefix(formatStringValue.substring(0, formatStringValue.indexOf('{0}')));\n            this.formatSuffix(formatStringValue.substring(formatStringValue.indexOf('{0}') + 3));\n            return;\n        }\n        var startIndex = formatStringValue.indexOf('{0:'), closingBracketIndex = formatStringValue.indexOf('}', startIndex), formatPattern = formatStringValue.substring(startIndex + 3, closingBracketIndex), isFormatPatternFind;\n        var selectTypePatternPair = function (name) {\n            _this.currentType(name);\n            if (startIndex === 0 && closingBracketIndex === (formatStringValue.length - 1)) {\n                _this.selectedFormats(_this.patternList().filter(function (item) { return item.name === formatPattern; }));\n                _this.formatResult(formatPattern);\n                isFormatPatternFind = true;\n            }\n        };\n        Object.keys(this._standardPatternSource).some(function (name) {\n            if (_this._standardPatternSource[name].patterns.indexOf(formatPattern) !== -1) {\n                selectTypePatternPair(name);\n                return true;\n            }\n            var customPatterns = _this._customPatternSource[_this._standardPatternSource[name].type];\n            if (customPatterns && customPatterns.indexOf(formatPattern) !== -1) {\n                selectTypePatternPair(name);\n                return true;\n            }\n            return false;\n        });\n        if (!isFormatPatternFind) {\n            this.currentType(this.types[0].name);\n            this.selectedFormats([]);\n            this.formatResult(formatStringValue);\n        }\n    };\n    FormatStringEditor.prototype.updateInputText = function (propertyName, componentInstance) {\n        this[propertyName](componentInstance.option('text'));\n    };\n    FormatStringEditor.prototype.option = function (name, value) {\n        if (value !== void 0) {\n            if (ko.isObservable(this[name])) {\n                this[name](value);\n            }\n            else {\n                this[name] = value;\n            }\n        }\n        return ko.unwrap(this[name]);\n    };\n    FormatStringEditor.prototype.updatePreview = function (value, category, pattern) {\n        return $.Deferred().resolve({ Result: value || 'preview string' }).promise();\n    };\n    Object.defineProperty(FormatStringEditor.prototype, \"customPatterns\", {\n        get: function () {\n            var currentTypeInfo = this._standardPatternSource[this.currentType()];\n            return this._customPatternSource[currentTypeInfo.type] = this._customPatternSource[currentTypeInfo.type] || [];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(FormatStringEditor.prototype, \"isGeneralType\", {\n        get: function () {\n            return this.currentType() === 'General';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    FormatStringEditor.prototype.getDisplayText = function (key) {\n        return localization_utils_1.getLocalization(this.localizationIdMap[key].text, this.localizationIdMap[key].localizationId);\n    };\n    FormatStringEditor.prototype.getPopupContainer = function (el) {\n        return $(el).closest(this.option('popupContainer'));\n    };\n    return FormatStringEditor;\n}(utils_1.Disposable));\nexports.FormatStringEditor = FormatStringEditor;\n"]},"metadata":{},"sourceType":"script"}