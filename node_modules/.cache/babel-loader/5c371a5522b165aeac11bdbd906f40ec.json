{"ast":null,"code":"/**\n* DevExpress Analytics (query-builder\\wizard\\internal\\federationDataSource\\_federationUnionQueryBuilderPopup.js)\n* Version:  22.1.3\n* Build date: Jun 14, 2022\n* Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\n* License: https://www.devexpress.com/Support/EULAs/universal.xml\n*/\n\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.FederationUnionQueryBuilderPopup = void 0;\n\nvar ko = require(\"knockout\");\n\nvar _localization_1 = require(\"../../../../property-grid/localization/_localization\");\n\nvar unionQuery_1 = require(\"../../../dataSource/federation/federatedQueries/unionQuery\");\n\nvar templateUtils_1 = require(\"../../../../property-grid/widgets/templateUtils\");\n\nvar pathRequest_1 = require(\"../../../../widgets/common/pathRequest\");\n\nvar _federationQueryBuilderPopupBase_1 = require(\"./_federationQueryBuilderPopupBase\");\n\nvar _arrayutils_1 = require(\"../../../../core/utils/_arrayutils\");\n\nvar FederationUnionQueryBuilderPopup = function (_super) {\n  __extends(FederationUnionQueryBuilderPopup, _super);\n\n  function FederationUnionQueryBuilderPopup(onSaveCallback, dataSource, rtl) {\n    if (rtl === void 0) {\n      rtl = false;\n    }\n\n    var _this = _super.call(this, onSaveCallback, dataSource, rtl) || this;\n\n    _this.unionQuery = ko.observable();\n    _this.unionAll = ko.observable(false);\n    _this.columns = ko.observableArray();\n    _this.popupContentTemplate = 'dxrd-querybuilder-union-popup-content';\n\n    _this.buttonItems.push({\n      toolbar: 'bottom',\n      location: 'before',\n      widget: 'dxCheckBox',\n      options: {\n        text: _localization_1.getLocalization('Union All', 'DataAccessUIStringId.FederationDataSourceQueryBuilder_NodeType_UnionAll'),\n        value: _this.unionAll\n      }\n    });\n\n    var sources = ko.pureComputed(function () {\n      return _this.unionQuery() && _this.unionQuery().queries().map(function (x) {\n        var alias = x.alias.peek();\n        return {\n          source: alias.split('_').join(' - '),\n          name: alias\n        };\n      });\n    });\n\n    _this._disposables.push(sources);\n\n    _this.sourcesGrid = {\n      rtlEnabled: rtl,\n      noDataText: function () {\n        return _localization_1.getLocalization('Drop a table or view here to create a query.', 'AnalyticsCoreStringId.QueryBuilder_SurfacePlaceholder');\n      },\n      dataSource: sources,\n      showRowLines: true,\n      paging: {\n        enabled: false\n      },\n      scrolling: {\n        mode: 'infinite'\n      },\n      columns: [{\n        dataField: 'source',\n\n        get caption() {\n          return _localization_1.getLocalization('Source', 'DataAccessUIStringId.QueryBuilderColumns_Source');\n        }\n\n      }, {\n        type: 'buttons',\n        width: 30,\n        buttons: [{\n          icon: 'delete',\n          onClick: function (e) {\n            _this.unionQuery().removeQuery(e.row.data.name);\n\n            _this.unionQuery.valueHasMutated();\n          },\n          cssClass: 'dxrd-image-recycle-bin',\n          template: templateUtils_1.getTemplate('dxrd-svg-operations-recycle_bin')\n        }]\n      }]\n    };\n\n    _this._disposables.push(_this.unionQuery.subscribe(function (unionQuery) {\n      var expressionArrays = [];\n      var resultExpressions = [];\n\n      _this.columns([]);\n\n      if (!unionQuery || unionQuery.queries().length === 0) {\n        return;\n      }\n\n      unionQuery.queries().forEach(function (query) {\n        return expressionArrays.push(query.expressions());\n      });\n      expressionArrays[0] && expressionArrays[0].forEach(function (expression) {\n        if (expressionArrays.every(function (array) {\n          return !!array.filter(function (x) {\n            return x.name() === expression.name();\n          })[0];\n        })) {\n          resultExpressions.push({\n            name: expression.name(),\n            alias: expression.alias(),\n            key: expression.table() + '.' + expression.name()\n          });\n        }\n      });\n\n      _this.columns(resultExpressions);\n    }));\n\n    _this._disposables.push(_this.unionAll.subscribe(function (value) {\n      if (!_this.unionQuery()) return;\n\n      if (value) {\n        _this.unionQuery().unionType(unionQuery_1.UnionTypes[unionQuery_1.UnionTypes.UnionAll]);\n      } else {\n        _this.unionQuery().unionType(unionQuery_1.UnionTypes[unionQuery_1.UnionTypes.Union]);\n      }\n    }));\n\n    _this.aliasGrid = {\n      rtlEnabled: rtl,\n      dataSource: _this.columns,\n      showRowLines: true,\n      editing: {\n        allowUpdating: true,\n        mode: 'cell'\n      },\n      paging: {\n        enabled: false\n      },\n      scrolling: {\n        mode: 'infinite'\n      },\n      height: '100%',\n      columns: [{\n        dataField: 'name',\n        caption: 'Column Name',\n        allowEditing: false\n      }, {\n        dataField: 'alias',\n\n        get caption() {\n          return _localization_1.getLocalization('Alias', 'DataAccessUIStringId.QueryBuilderColumns_Alias');\n        },\n\n        validationRules: [_this._aliasValidationRule]\n      }],\n      onRowUpdating: function (event) {\n        event.oldData.alias = event.newData.alias;\n      }\n    };\n    return _this;\n  }\n\n  FederationUnionQueryBuilderPopup.prototype._aliasValidationCallback = function (alias, data) {\n    var existedColumn = _arrayutils_1.findFirstItemMatchesCondition(this.columns(), function (source) {\n      return source.alias === alias;\n    });\n\n    if (existedColumn && existedColumn.key === data.key) return true;\n    return !existedColumn;\n  };\n\n  FederationUnionQueryBuilderPopup.prototype.dispose = function () {\n    _super.prototype.dispose.call(this);\n\n    this.sourcesGrid = null;\n    this.aliasGrid = null;\n  };\n\n  FederationUnionQueryBuilderPopup.prototype.addDataMember = function (item) {\n    var _this = this;\n\n    this._dataSource.fielListProvider.getItems(new pathRequest_1.PathRequest(item.path)).done(function (result) {\n      result.forEach(function (x) {\n        return _this.unionQuery().addSelectQuery(item.path, x.name);\n      });\n\n      _this.unionQuery.valueHasMutated();\n    });\n  };\n\n  FederationUnionQueryBuilderPopup.prototype.canSave = function () {\n    return this.unionQuery() && this.unionQuery().queries().length > 0;\n  };\n\n  FederationUnionQueryBuilderPopup.prototype.save = function () {\n    var _this = this;\n\n    this.unionQuery().queries().forEach(function (query) {\n      query.expressions(query.expressions().filter(function (expression) {\n        var column = _this.columns().filter(function (column) {\n          return column.name === expression.name();\n        })[0];\n\n        if (column) {\n          expression.alias(column.alias);\n          return true;\n        }\n\n        return false;\n      }));\n    });\n    this.onSaveCallback(this.unionQuery());\n    this.close();\n  };\n\n  FederationUnionQueryBuilderPopup.prototype.onHiding = function () {\n    this.unionQuery(null);\n    this.unionAll(false);\n  };\n\n  FederationUnionQueryBuilderPopup.prototype.show = function (query) {\n    this.unionQuery(query);\n    this.popupVisible(true);\n    this.unionAll(query.unionType() === unionQuery_1.UnionTypes[unionQuery_1.UnionTypes.UnionAll]);\n  };\n\n  return FederationUnionQueryBuilderPopup;\n}(_federationQueryBuilderPopupBase_1.FederationQueryBuilderPopupBase);\n\nexports.FederationUnionQueryBuilderPopup = FederationUnionQueryBuilderPopup;","map":{"version":3,"sources":["/Users/krunalpatel/Downloads/React-Firebase-Auth-master 3/node_modules/@devexpress/analytics-core/query-builder/wizard/internal/federationDataSource/_federationUnionQueryBuilderPopup.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","TypeError","String","__","constructor","create","defineProperty","exports","value","FederationUnionQueryBuilderPopup","ko","require","_localization_1","unionQuery_1","templateUtils_1","pathRequest_1","_federationQueryBuilderPopupBase_1","_arrayutils_1","_super","onSaveCallback","dataSource","rtl","_this","unionQuery","observable","unionAll","columns","observableArray","popupContentTemplate","buttonItems","push","toolbar","location","widget","options","text","getLocalization","sources","pureComputed","queries","map","x","alias","peek","source","split","join","name","_disposables","sourcesGrid","rtlEnabled","noDataText","showRowLines","paging","enabled","scrolling","mode","dataField","caption","type","width","buttons","icon","onClick","e","removeQuery","row","data","valueHasMutated","cssClass","template","getTemplate","subscribe","expressionArrays","resultExpressions","length","forEach","query","expressions","expression","every","array","filter","key","table","unionType","UnionTypes","UnionAll","Union","aliasGrid","editing","allowUpdating","height","allowEditing","validationRules","_aliasValidationRule","onRowUpdating","event","oldData","newData","_aliasValidationCallback","existedColumn","findFirstItemMatchesCondition","dispose","addDataMember","item","_dataSource","fielListProvider","getItems","PathRequest","path","done","result","addSelectQuery","canSave","save","column","close","onHiding","show","popupVisible","FederationQueryBuilderPopupBase"],"mappings":"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","sourcesContent":["/**\n* DevExpress Analytics (query-builder\\wizard\\internal\\federationDataSource\\_federationUnionQueryBuilderPopup.js)\n* Version:  22.1.3\n* Build date: Jun 14, 2022\n* Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\n* License: https://www.devexpress.com/Support/EULAs/universal.xml\n*/\n\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.FederationUnionQueryBuilderPopup = void 0;\nvar ko = require(\"knockout\");\nvar _localization_1 = require(\"../../../../property-grid/localization/_localization\");\nvar unionQuery_1 = require(\"../../../dataSource/federation/federatedQueries/unionQuery\");\nvar templateUtils_1 = require(\"../../../../property-grid/widgets/templateUtils\");\nvar pathRequest_1 = require(\"../../../../widgets/common/pathRequest\");\nvar _federationQueryBuilderPopupBase_1 = require(\"./_federationQueryBuilderPopupBase\");\nvar _arrayutils_1 = require(\"../../../../core/utils/_arrayutils\");\nvar FederationUnionQueryBuilderPopup = (function (_super) {\n    __extends(FederationUnionQueryBuilderPopup, _super);\n    function FederationUnionQueryBuilderPopup(onSaveCallback, dataSource, rtl) {\n        if (rtl === void 0) { rtl = false; }\n        var _this = _super.call(this, onSaveCallback, dataSource, rtl) || this;\n        _this.unionQuery = ko.observable();\n        _this.unionAll = ko.observable(false);\n        _this.columns = ko.observableArray();\n        _this.popupContentTemplate = 'dxrd-querybuilder-union-popup-content';\n        _this.buttonItems.push({\n            toolbar: 'bottom', location: 'before', widget: 'dxCheckBox', options: { text: _localization_1.getLocalization('Union All', 'DataAccessUIStringId.FederationDataSourceQueryBuilder_NodeType_UnionAll'), value: _this.unionAll }\n        });\n        var sources = ko.pureComputed(function () { return _this.unionQuery() && _this.unionQuery().queries().map(function (x) {\n            var alias = x.alias.peek();\n            return {\n                source: alias.split('_').join(' - '),\n                name: alias\n            };\n        }); });\n        _this._disposables.push(sources);\n        _this.sourcesGrid = {\n            rtlEnabled: rtl,\n            noDataText: function () { return _localization_1.getLocalization('Drop a table or view here to create a query.', 'AnalyticsCoreStringId.QueryBuilder_SurfacePlaceholder'); },\n            dataSource: sources,\n            showRowLines: true,\n            paging: { enabled: false },\n            scrolling: { mode: 'infinite' },\n            columns: [{\n                    dataField: 'source',\n                    get caption() {\n                        return _localization_1.getLocalization('Source', 'DataAccessUIStringId.QueryBuilderColumns_Source');\n                    },\n                }, {\n                    type: 'buttons',\n                    width: 30,\n                    buttons: [{\n                            icon: 'delete',\n                            onClick: function (e) {\n                                _this.unionQuery().removeQuery(e.row.data.name);\n                                _this.unionQuery.valueHasMutated();\n                            },\n                            cssClass: 'dxrd-image-recycle-bin',\n                            template: templateUtils_1.getTemplate('dxrd-svg-operations-recycle_bin'),\n                        }]\n                }\n            ]\n        };\n        _this._disposables.push(_this.unionQuery.subscribe(function (unionQuery) {\n            var expressionArrays = [];\n            var resultExpressions = [];\n            _this.columns([]);\n            if (!unionQuery || unionQuery.queries().length === 0) {\n                return;\n            }\n            unionQuery.queries().forEach(function (query) { return expressionArrays.push(query.expressions()); });\n            expressionArrays[0] && expressionArrays[0].forEach(function (expression) {\n                if (expressionArrays.every(function (array) { return !!array.filter(function (x) { return x.name() === expression.name(); })[0]; })) {\n                    resultExpressions.push({\n                        name: expression.name(),\n                        alias: expression.alias(),\n                        key: expression.table() + '.' + expression.name()\n                    });\n                }\n            });\n            _this.columns(resultExpressions);\n        }));\n        _this._disposables.push(_this.unionAll.subscribe(function (value) {\n            if (!_this.unionQuery())\n                return;\n            if (value) {\n                _this.unionQuery().unionType(unionQuery_1.UnionTypes[unionQuery_1.UnionTypes.UnionAll]);\n            }\n            else {\n                _this.unionQuery().unionType(unionQuery_1.UnionTypes[unionQuery_1.UnionTypes.Union]);\n            }\n        }));\n        _this.aliasGrid = {\n            rtlEnabled: rtl,\n            dataSource: _this.columns,\n            showRowLines: true,\n            editing: {\n                allowUpdating: true,\n                mode: 'cell',\n            },\n            paging: { enabled: false },\n            scrolling: { mode: 'infinite' },\n            height: '100%',\n            columns: [{\n                    dataField: 'name',\n                    caption: 'Column Name',\n                    allowEditing: false\n                }, {\n                    dataField: 'alias',\n                    get caption() {\n                        return _localization_1.getLocalization('Alias', 'DataAccessUIStringId.QueryBuilderColumns_Alias');\n                    },\n                    validationRules: [_this._aliasValidationRule]\n                }],\n            onRowUpdating: function (event) {\n                event.oldData.alias = event.newData.alias;\n            }\n        };\n        return _this;\n    }\n    FederationUnionQueryBuilderPopup.prototype._aliasValidationCallback = function (alias, data) {\n        var existedColumn = _arrayutils_1.findFirstItemMatchesCondition(this.columns(), function (source) { return source.alias === alias; });\n        if (existedColumn && existedColumn.key === data.key)\n            return true;\n        return !existedColumn;\n    };\n    FederationUnionQueryBuilderPopup.prototype.dispose = function () {\n        _super.prototype.dispose.call(this);\n        this.sourcesGrid = null;\n        this.aliasGrid = null;\n    };\n    FederationUnionQueryBuilderPopup.prototype.addDataMember = function (item) {\n        var _this = this;\n        this._dataSource.fielListProvider.getItems(new pathRequest_1.PathRequest(item.path)).done(function (result) {\n            result.forEach(function (x) { return _this.unionQuery().addSelectQuery(item.path, x.name); });\n            _this.unionQuery.valueHasMutated();\n        });\n    };\n    FederationUnionQueryBuilderPopup.prototype.canSave = function () {\n        return this.unionQuery() && this.unionQuery().queries().length > 0;\n    };\n    FederationUnionQueryBuilderPopup.prototype.save = function () {\n        var _this = this;\n        this.unionQuery().queries().forEach(function (query) {\n            query.expressions(query.expressions().filter(function (expression) {\n                var column = _this.columns().filter(function (column) { return column.name === expression.name(); })[0];\n                if (column) {\n                    expression.alias(column.alias);\n                    return true;\n                }\n                return false;\n            }));\n        });\n        this.onSaveCallback(this.unionQuery());\n        this.close();\n    };\n    FederationUnionQueryBuilderPopup.prototype.onHiding = function () {\n        this.unionQuery(null);\n        this.unionAll(false);\n    };\n    FederationUnionQueryBuilderPopup.prototype.show = function (query) {\n        this.unionQuery(query);\n        this.popupVisible(true);\n        this.unionAll(query.unionType() === unionQuery_1.UnionTypes[unionQuery_1.UnionTypes.UnionAll]);\n    };\n    return FederationUnionQueryBuilderPopup;\n}(_federationQueryBuilderPopupBase_1.FederationQueryBuilderPopupBase));\nexports.FederationUnionQueryBuilderPopup = FederationUnionQueryBuilderPopup;\n"]},"metadata":{},"sourceType":"script"}