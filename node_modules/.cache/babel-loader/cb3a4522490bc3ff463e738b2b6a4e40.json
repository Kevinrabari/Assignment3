{"ast":null,"code":"/**\r\n* DevExpress Dashboard (_inline-edit-collection-editor-viewmodel.js)\r\n* Version:  22.1.3\r\n* Build date: Jun 13, 2022\r\n* Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n* License: https://www.devexpress.com/Support/EULAs/universal.xml\r\n*/\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.InlineEditCollectionEditorViewModel = void 0;\n\nvar data_source_1 = require(\"devextreme/data/data_source\");\n\nvar ko = require(\"knockout\");\n\nvar _default_1 = require(\"../../../data/localization/_default\");\n\nvar _jquery_helpers_1 = require(\"../../../data/_jquery-helpers\");\n\nvar GridDataSourceMapper = function () {\n  function GridDataSourceMapper(dataFields) {\n    this.dataFields = dataFields;\n    this.gridDataSourceKeyCache = [];\n  }\n\n  GridDataSourceMapper.prototype.mapDataSource = function (srcData) {\n    var _this = this;\n\n    var updatedCache = [];\n    var latestCacheItemKey = this.gridDataSourceKeyCache.reduce(function (acc, item) {\n      return item && item.key > acc ? item.key : acc;\n    }, 0);\n    var data = ko.unwrap(srcData).map(function (dataSourceItem) {\n      var cacheItem = _this.gridDataSourceKeyCache.filter(function (cacheItem) {\n        return cacheItem.objRef === dataSourceItem;\n      })[0];\n\n      if (!cacheItem) {\n        cacheItem = {\n          key: ++latestCacheItemKey,\n          objRef: dataSourceItem\n        };\n      }\n\n      updatedCache.push(cacheItem);\n      return _this.dataFields.reduce(function (acc, field) {\n        acc[field] = cacheItem.objRef && ko.unwrap(cacheItem.objRef[field]);\n        return acc;\n      }, {\n        keyField: cacheItem.key\n      });\n    });\n    this.gridDataSourceKeyCache = updatedCache;\n    return data;\n  };\n\n  GridDataSourceMapper.prototype.updateDataSourceItem = function (key, newValues) {\n    var cacheItem = this.gridDataSourceKeyCache.filter(function (cacheItem) {\n      return cacheItem.key === key;\n    })[0];\n    var container = cacheItem && cacheItem.objRef;\n\n    if (container) {\n      this.dataFields.forEach(function (field) {\n        newValues.hasOwnProperty(field) && ko.isWritableObservable(container[field]) && container[field](newValues[field]);\n      });\n    }\n  };\n\n  GridDataSourceMapper.prototype.getObjectByKey = function (key) {\n    var cacheItem = this.gridDataSourceKeyCache.filter(function (item) {\n      return item.key === key;\n    })[0];\n    return cacheItem && cacheItem.objRef;\n  };\n\n  GridDataSourceMapper.prototype.getKeyByObject = function (obj) {\n    var cacheItem = this.gridDataSourceKeyCache.filter(function (item) {\n      return item.objRef === obj;\n    })[0];\n    return cacheItem && cacheItem.key;\n  };\n\n  return GridDataSourceMapper;\n}();\n\nvar InlineEditCollectionEditorViewModel = function () {\n  function InlineEditCollectionEditorViewModel(params, dataSource) {\n    var _this = this;\n\n    this.add = function () {\n      return _this._addNewItemRow();\n    };\n\n    this.remove = function () {\n      return _this.dataSource.remove(_this.selectedValue);\n    };\n\n    this.down = function () {\n      return _this.downEnabled() && _this._moveSelectedGridRow('down');\n    };\n\n    this.up = function () {\n      return _this.upEnabled() && _this._moveSelectedGridRow('up');\n    };\n\n    this.dataFields = params.dataFields;\n    this.dataSource = dataSource;\n    this.noDataText = _default_1.getLocalizationById(params.noDataText);\n    this.gridColumns = params.gridColumns;\n    this.createNewItemHandler = params.createNewItemHandler;\n    this.customizeInlineEditor = params.customizeInlineEditor;\n    this.customizeCell = params.customizeCell;\n    this.enableAddItem = params.enableAddItem;\n    this.enableRemoveItem = params.enableRemoveItem;\n    this.enableEditItem = params.enableEditItem;\n    this.isToolbarVisible = params.isToolbarVisible === undefined || params.isToolbarVisible;\n    this.allowAddItem = params.allowAddItem === undefined || params.allowAddItem;\n    this.allowRemoveItem = params.allowRemoveItem === undefined || params.allowRemoveItem;\n    this.allowReorderItem = params.allowReorderItem === undefined || params.allowReorderItem;\n    this.addEnabled = ko.observable(true);\n    this.removeEnabled = ko.observable(false);\n    this.upEnabled = ko.observable(false);\n    this.downEnabled = ko.observable(false);\n    this.dataSourceMapper = new GridDataSourceMapper(this.dataFields);\n    params.forceRefreshCallback && params.forceRefreshCallback.subscribe(function () {\n      return _this.gridInstance && _this.gridInstance.refresh();\n    });\n  }\n\n  InlineEditCollectionEditorViewModel.prototype.getGridOptions = function () {\n    var _this = this;\n\n    var gridDataSource = new data_source_1.default({\n      loadMode: 'raw',\n      key: 'keyField',\n      load: function () {\n        return _this.dataSourceMapper.mapDataSource(_this.dataSource);\n      },\n      update: function (key, values) {\n        _this.dataSourceMapper.updateDataSourceItem(key, values);\n\n        return _jquery_helpers_1.$promiseAdapter(_jquery_helpers_1.createJQueryDeferred().resolve().promise());\n      },\n      insert: function (newRow) {\n        var newDataSourceItem = _this.createNewItemHandler();\n\n        if (newDataSourceItem) {\n          _this.dataFields.forEach(function (field) {\n            return newDataSourceItem[field](ko.unwrap(newRow[field]));\n          });\n\n          _this.dataSource.push(newDataSourceItem);\n        }\n\n        return _jquery_helpers_1.$promiseAdapter(_jquery_helpers_1.createJQueryDeferred().resolve(newDataSourceItem).promise());\n      }\n    });\n    this.dataSourceSubscription = this.dataSource.subscribe(function () {\n      return _this.gridInstance.refresh();\n    });\n    var dataGridOptions = {\n      onInitialized: function (e) {\n        return _this.gridInstance = e.component;\n      },\n      dataSource: gridDataSource,\n      remoteOperations: false,\n      showColumnHeaders: false,\n      noDataText: this.noDataText,\n      showColumnLines: false,\n      showRowLines: true,\n      loadPanel: {\n        enabled: false\n      },\n      paging: {\n        enabled: false\n      },\n      selection: {\n        mode: 'single'\n      },\n      columns: !!this.gridColumns ? this.gridColumns : this.dataFields,\n      editing: {\n        allowUpdating: true,\n        mode: 'cell',\n        startEditAction: 'dblClick'\n      },\n      onCellClick: function (e) {\n        if (e.row && e.row.isSelected) {\n          _this.gridInstance.editCell(e.rowIndex, e.columnIndex);\n        }\n      },\n      onCellPrepared: this.customizeCell,\n      onEditingStart: function (e) {\n        return e.cancel = _this.enableEditItem && !_this.enableEditItem(_this.selectedValue, e);\n      },\n      onSelectionChanged: function (e) {\n        return _this._updateActionsState();\n      },\n      onContentReady: function (e) {\n        return _this._updateActionsState();\n      },\n      onEditorPreparing: function (e) {\n        return _this.customizeInlineEditor && _this.customizeInlineEditor(e);\n      }\n    };\n    return dataGridOptions;\n  };\n\n  Object.defineProperty(InlineEditCollectionEditorViewModel.prototype, \"selectedValue\", {\n    get: function () {\n      var selectedKey = this.gridInstance && this.gridInstance.getSelectedRowKeys()[0];\n      return this.dataSourceMapper.getObjectByKey(selectedKey);\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  InlineEditCollectionEditorViewModel.prototype.dispose = function () {\n    this.dataSourceSubscription && this.dataSourceSubscription.dispose();\n  };\n\n  InlineEditCollectionEditorViewModel.prototype._addNewItemRow = function () {\n    var _this = this;\n\n    var insertedObject;\n    if (this.gridInstance.hasEditData()) this.gridInstance.saveEditData();\n    this.gridInstance.beginUpdate();\n    var newObject = this.createNewItemHandler();\n    this.gridInstance.getDataSource().store().insert(this.dataFields.reduce(function (acc, field) {\n      acc[field] = newObject[field];\n      return acc;\n    }, {})).then(function (obj) {\n      return insertedObject = obj;\n    });\n    this.gridInstance.endUpdate();\n    this.gridInstance.refresh().then(function () {\n      setTimeout(function () {\n        var rowKey = _this.dataSourceMapper.getKeyByObject(insertedObject);\n\n        if (rowKey) {\n          var rowIndex = _this.gridInstance.getRowIndexByKey(rowKey);\n\n          _this.gridInstance.focus(_this.gridInstance.getCellElement(rowIndex, 0));\n\n          _this.gridInstance.editCell(rowIndex, 0);\n        }\n      }, 1);\n    });\n  };\n\n  InlineEditCollectionEditorViewModel.prototype._moveSelectedGridRow = function (direction) {\n    var selectedValue = this.selectedValue;\n    if (!selectedValue) return;\n    this.gridInstance.beginUpdate();\n    var index = this.dataSource().indexOf(selectedValue);\n    this.dataSource.splice(index, 1);\n    this.dataSource.splice(direction === 'up' ? index - 1 : index + 1, 0, selectedValue);\n    this.gridInstance.endUpdate();\n  };\n\n  InlineEditCollectionEditorViewModel.prototype._updateActionsState = function () {\n    this.addEnabled(!!this.enableAddItem ? this.enableAddItem(this.selectedValue) : true);\n    this.removeEnabled(!!this.enableRemoveItem ? this.enableRemoveItem(this.selectedValue) : !!this.selectedValue);\n    var selectedRowIndex = this.dataSource.indexOf(this.selectedValue);\n    this.upEnabled(this.selectedValue && selectedRowIndex > 0);\n    this.downEnabled(this.selectedValue && selectedRowIndex < this.gridInstance.getDataSource().totalCount() - 1);\n  };\n\n  return InlineEditCollectionEditorViewModel;\n}();\n\nexports.InlineEditCollectionEditorViewModel = InlineEditCollectionEditorViewModel;","map":{"version":3,"sources":["/Users/krunalpatel/Downloads/React-Firebase-Auth-master 3/node_modules/devexpress-dashboard/designer/ui-widgets/collection-editor/_inline-edit-collection-editor-viewmodel.js"],"names":["Object","defineProperty","exports","value","InlineEditCollectionEditorViewModel","data_source_1","require","ko","_default_1","_jquery_helpers_1","GridDataSourceMapper","dataFields","gridDataSourceKeyCache","prototype","mapDataSource","srcData","_this","updatedCache","latestCacheItemKey","reduce","acc","item","key","data","unwrap","map","dataSourceItem","cacheItem","filter","objRef","push","field","keyField","updateDataSourceItem","newValues","container","forEach","hasOwnProperty","isWritableObservable","getObjectByKey","getKeyByObject","obj","params","dataSource","add","_addNewItemRow","remove","selectedValue","down","downEnabled","_moveSelectedGridRow","up","upEnabled","noDataText","getLocalizationById","gridColumns","createNewItemHandler","customizeInlineEditor","customizeCell","enableAddItem","enableRemoveItem","enableEditItem","isToolbarVisible","undefined","allowAddItem","allowRemoveItem","allowReorderItem","addEnabled","observable","removeEnabled","dataSourceMapper","forceRefreshCallback","subscribe","gridInstance","refresh","getGridOptions","gridDataSource","default","loadMode","load","update","values","$promiseAdapter","createJQueryDeferred","resolve","promise","insert","newRow","newDataSourceItem","dataSourceSubscription","dataGridOptions","onInitialized","e","component","remoteOperations","showColumnHeaders","showColumnLines","showRowLines","loadPanel","enabled","paging","selection","mode","columns","editing","allowUpdating","startEditAction","onCellClick","row","isSelected","editCell","rowIndex","columnIndex","onCellPrepared","onEditingStart","cancel","onSelectionChanged","_updateActionsState","onContentReady","onEditorPreparing","get","selectedKey","getSelectedRowKeys","enumerable","configurable","dispose","insertedObject","hasEditData","saveEditData","beginUpdate","newObject","getDataSource","store","then","endUpdate","setTimeout","rowKey","getRowIndexByKey","focus","getCellElement","direction","index","indexOf","splice","selectedRowIndex","totalCount"],"mappings":"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","sourcesContent":["/**\r\n* DevExpress Dashboard (_inline-edit-collection-editor-viewmodel.js)\r\n* Version:  22.1.3\r\n* Build date: Jun 13, 2022\r\n* Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n* License: https://www.devexpress.com/Support/EULAs/universal.xml\r\n*/\r\n\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.InlineEditCollectionEditorViewModel = void 0;\nvar data_source_1 = require(\"devextreme/data/data_source\");\nvar ko = require(\"knockout\");\nvar _default_1 = require(\"../../../data/localization/_default\");\nvar _jquery_helpers_1 = require(\"../../../data/_jquery-helpers\");\nvar GridDataSourceMapper = (function () {\n    function GridDataSourceMapper(dataFields) {\n        this.dataFields = dataFields;\n        this.gridDataSourceKeyCache = [];\n    }\n    GridDataSourceMapper.prototype.mapDataSource = function (srcData) {\n        var _this = this;\n        var updatedCache = [];\n        var latestCacheItemKey = this.gridDataSourceKeyCache\n            .reduce(function (acc, item) {\n            return item && item.key > acc ? item.key : acc;\n        }, 0);\n        var data = ko.unwrap(srcData)\n            .map(function (dataSourceItem) {\n            var cacheItem = _this.gridDataSourceKeyCache\n                .filter(function (cacheItem) { return cacheItem.objRef === dataSourceItem; })[0];\n            if (!cacheItem) {\n                cacheItem = {\n                    key: ++latestCacheItemKey,\n                    objRef: dataSourceItem,\n                };\n            }\n            updatedCache.push(cacheItem);\n            return _this.dataFields.reduce(function (acc, field) {\n                acc[field] = cacheItem.objRef && ko.unwrap(cacheItem.objRef[field]);\n                return acc;\n            }, { keyField: cacheItem.key });\n        });\n        this.gridDataSourceKeyCache = updatedCache;\n        return data;\n    };\n    GridDataSourceMapper.prototype.updateDataSourceItem = function (key, newValues) {\n        var cacheItem = this.gridDataSourceKeyCache\n            .filter(function (cacheItem) { return cacheItem.key === key; })[0];\n        var container = cacheItem && cacheItem.objRef;\n        if (container) {\n            this.dataFields.forEach(function (field) {\n                newValues.hasOwnProperty(field) && ko.isWritableObservable(container[field]) && container[field](newValues[field]);\n            });\n        }\n    };\n    GridDataSourceMapper.prototype.getObjectByKey = function (key) {\n        var cacheItem = this.gridDataSourceKeyCache\n            .filter(function (item) { return item.key === key; })[0];\n        return cacheItem && cacheItem.objRef;\n    };\n    GridDataSourceMapper.prototype.getKeyByObject = function (obj) {\n        var cacheItem = this.gridDataSourceKeyCache\n            .filter(function (item) { return item.objRef === obj; })[0];\n        return cacheItem && cacheItem.key;\n    };\n    return GridDataSourceMapper;\n}());\nvar InlineEditCollectionEditorViewModel = (function () {\n    function InlineEditCollectionEditorViewModel(params, dataSource) {\n        var _this = this;\n        this.add = function () { return _this._addNewItemRow(); };\n        this.remove = function () { return _this.dataSource.remove(_this.selectedValue); };\n        this.down = function () { return _this.downEnabled() && _this._moveSelectedGridRow('down'); };\n        this.up = function () { return _this.upEnabled() && _this._moveSelectedGridRow('up'); };\n        this.dataFields = params.dataFields;\n        this.dataSource = dataSource;\n        this.noDataText = _default_1.getLocalizationById(params.noDataText);\n        this.gridColumns = params.gridColumns;\n        this.createNewItemHandler = params.createNewItemHandler;\n        this.customizeInlineEditor = params.customizeInlineEditor;\n        this.customizeCell = params.customizeCell;\n        this.enableAddItem = params.enableAddItem;\n        this.enableRemoveItem = params.enableRemoveItem;\n        this.enableEditItem = params.enableEditItem;\n        this.isToolbarVisible = params.isToolbarVisible === undefined || params.isToolbarVisible;\n        this.allowAddItem = params.allowAddItem === undefined || params.allowAddItem;\n        this.allowRemoveItem = params.allowRemoveItem === undefined || params.allowRemoveItem;\n        this.allowReorderItem = params.allowReorderItem === undefined || params.allowReorderItem;\n        this.addEnabled = ko.observable(true);\n        this.removeEnabled = ko.observable(false);\n        this.upEnabled = ko.observable(false);\n        this.downEnabled = ko.observable(false);\n        this.dataSourceMapper = new GridDataSourceMapper(this.dataFields);\n        params.forceRefreshCallback && params.forceRefreshCallback.subscribe(function () { return _this.gridInstance && _this.gridInstance.refresh(); });\n    }\n    InlineEditCollectionEditorViewModel.prototype.getGridOptions = function () {\n        var _this = this;\n        var gridDataSource = new data_source_1.default({\n            loadMode: 'raw',\n            key: 'keyField',\n            load: function () {\n                return _this.dataSourceMapper.mapDataSource(_this.dataSource);\n            },\n            update: function (key, values) {\n                _this.dataSourceMapper.updateDataSourceItem(key, values);\n                return _jquery_helpers_1.$promiseAdapter(_jquery_helpers_1.createJQueryDeferred().resolve().promise());\n            },\n            insert: function (newRow) {\n                var newDataSourceItem = _this.createNewItemHandler();\n                if (newDataSourceItem) {\n                    _this.dataFields.forEach(function (field) { return newDataSourceItem[field](ko.unwrap(newRow[field])); });\n                    _this.dataSource.push(newDataSourceItem);\n                }\n                return _jquery_helpers_1.$promiseAdapter(_jquery_helpers_1.createJQueryDeferred().resolve(newDataSourceItem).promise());\n            },\n        });\n        this.dataSourceSubscription = this.dataSource.subscribe(function () { return _this.gridInstance.refresh(); });\n        var dataGridOptions = {\n            onInitialized: function (e) { return _this.gridInstance = e.component; },\n            dataSource: gridDataSource,\n            remoteOperations: false,\n            showColumnHeaders: false,\n            noDataText: this.noDataText,\n            showColumnLines: false,\n            showRowLines: true,\n            loadPanel: {\n                enabled: false,\n            },\n            paging: {\n                enabled: false\n            },\n            selection: {\n                mode: 'single'\n            },\n            columns: !!this.gridColumns ? this.gridColumns : this.dataFields,\n            editing: {\n                allowUpdating: true,\n                mode: 'cell',\n                startEditAction: 'dblClick',\n            },\n            onCellClick: function (e) {\n                if (e.row && e.row.isSelected) {\n                    _this.gridInstance.editCell(e.rowIndex, e.columnIndex);\n                }\n            },\n            onCellPrepared: this.customizeCell,\n            onEditingStart: function (e) { return e.cancel = _this.enableEditItem && !_this.enableEditItem(_this.selectedValue, e); },\n            onSelectionChanged: function (e) { return _this._updateActionsState(); },\n            onContentReady: function (e) { return _this._updateActionsState(); },\n            onEditorPreparing: function (e) { return _this.customizeInlineEditor && _this.customizeInlineEditor(e); },\n        };\n        return dataGridOptions;\n    };\n    Object.defineProperty(InlineEditCollectionEditorViewModel.prototype, \"selectedValue\", {\n        get: function () {\n            var selectedKey = this.gridInstance && this.gridInstance.getSelectedRowKeys()[0];\n            return this.dataSourceMapper.getObjectByKey(selectedKey);\n        },\n        enumerable: false,\n        configurable: true\n    });\n    InlineEditCollectionEditorViewModel.prototype.dispose = function () {\n        this.dataSourceSubscription && this.dataSourceSubscription.dispose();\n    };\n    InlineEditCollectionEditorViewModel.prototype._addNewItemRow = function () {\n        var _this = this;\n        var insertedObject;\n        if (this.gridInstance.hasEditData())\n            this.gridInstance.saveEditData();\n        this.gridInstance.beginUpdate();\n        var newObject = this.createNewItemHandler();\n        this.gridInstance\n            .getDataSource()\n            .store()\n            .insert(this.dataFields\n            .reduce(function (acc, field) {\n            acc[field] = newObject[field];\n            return acc;\n        }, {}))\n            .then(function (obj) { return insertedObject = obj; });\n        this.gridInstance.endUpdate();\n        this.gridInstance.refresh().then(function () {\n            setTimeout(function () {\n                var rowKey = _this.dataSourceMapper.getKeyByObject(insertedObject);\n                if (rowKey) {\n                    var rowIndex = _this.gridInstance.getRowIndexByKey(rowKey);\n                    _this.gridInstance.focus(_this.gridInstance.getCellElement(rowIndex, 0));\n                    _this.gridInstance.editCell(rowIndex, 0);\n                }\n            }, 1);\n        });\n    };\n    InlineEditCollectionEditorViewModel.prototype._moveSelectedGridRow = function (direction) {\n        var selectedValue = this.selectedValue;\n        if (!selectedValue)\n            return;\n        this.gridInstance.beginUpdate();\n        var index = this.dataSource().indexOf(selectedValue);\n        this.dataSource.splice(index, 1);\n        this.dataSource.splice(direction === 'up' ? index - 1 : index + 1, 0, selectedValue);\n        this.gridInstance.endUpdate();\n    };\n    InlineEditCollectionEditorViewModel.prototype._updateActionsState = function () {\n        this.addEnabled(!!this.enableAddItem ? this.enableAddItem(this.selectedValue) : true);\n        this.removeEnabled(!!this.enableRemoveItem ? this.enableRemoveItem(this.selectedValue) : !!this.selectedValue);\n        var selectedRowIndex = this.dataSource.indexOf(this.selectedValue);\n        this.upEnabled(this.selectedValue && selectedRowIndex > 0);\n        this.downEnabled(this.selectedValue && selectedRowIndex < this.gridInstance.getDataSource().totalCount() - 1);\n    };\n    return InlineEditCollectionEditorViewModel;\n}());\nexports.InlineEditCollectionEditorViewModel = InlineEditCollectionEditorViewModel;\n"]},"metadata":{},"sourceType":"script"}