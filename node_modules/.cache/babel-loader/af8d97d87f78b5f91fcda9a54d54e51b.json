{"ast":null,"code":"/**\r\n * DevExtreme (esm/ui/html_editor/modules/tableContextMenu.js)\r\n * Version: 22.1.3\r\n * Build date: Mon Jun 13 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport Quill from \"devextreme-quill\";\nimport $ from \"../../../core/renderer\";\nimport BaseModule from \"./base\";\nimport eventsEngine from \"../../../events/core/events_engine\";\nimport { addNamespace } from \"../../../events/utils/index\";\nimport ContextMenu from \"../../context_menu\";\nimport localizationMessage from \"../../../localization/message\";\nimport { getTableFormats } from \"../utils/table_helper\";\nimport { getFormatHandlers, getDefaultClickHandler, ICON_MAP } from \"../utils/toolbar_helper\";\nimport { each } from \"../../../core/utils/iterator\";\nimport { isString, isObject } from \"../../../core/utils/type\";\nimport { titleize, camelize } from \"../../../core/utils/inflector\";\nimport { extend } from \"../../../core/utils/extend\";\nvar MODULE_NAMESPACE = \"dxHtmlEditorTableContextMenu\";\nvar CONTEXT_MENU_EVENT = addNamespace(\"dxcontextmenu\", MODULE_NAMESPACE);\nvar TableContextMenuModule = BaseModule;\n\nvar localize = name => localizationMessage.format(\"dxHtmlEditor-\".concat(camelize(name)));\n\nif (Quill) {\n  TableContextMenuModule = class extends BaseModule {\n    constructor(quill, options) {\n      super(quill, options);\n      this.enabled = !!options.enabled;\n      this._quillContainer = this.editorInstance._getQuillContainer();\n      this.addCleanCallback(this.prepareCleanCallback());\n      this._formatHandlers = getFormatHandlers(this);\n      this._tableFormats = getTableFormats(quill);\n\n      if (this.enabled) {\n        this._enableContextMenu(options.items);\n      }\n    }\n\n    _enableContextMenu(items) {\n      var _this$_contextMenu;\n\n      null === (_this$_contextMenu = this._contextMenu) || void 0 === _this$_contextMenu ? void 0 : _this$_contextMenu.dispose();\n      this._contextMenu = this._createContextMenu(items);\n\n      this._attachEvents();\n    }\n\n    _attachEvents() {\n      eventsEngine.on(this.editorInstance._getContent(), CONTEXT_MENU_EVENT, this._prepareContextMenuHandler());\n    }\n\n    _detachEvents() {\n      eventsEngine.off(this.editorInstance._getContent(), CONTEXT_MENU_EVENT);\n    }\n\n    _createContextMenu(items) {\n      var $container = $(\"<div>\").appendTo(this.editorInstance.$element());\n\n      var menuConfig = this._getMenuConfig(items);\n\n      return this.editorInstance._createComponent($container, ContextMenu, menuConfig);\n    }\n\n    showPropertiesForm() {\n      var type = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : \"cell\";\n      var $element = $(this._targetElement).closest(\"cell\" === type ? \"th, td\" : \"table\");\n\n      this._contextMenu.hide();\n\n      this._formatHandlers[\"\".concat(type, \"Properties\")]($element);\n\n      this._targetElement = null;\n    }\n\n    _isAcceptableItem(widget, acceptableWidgetName) {\n      return !widget || widget === acceptableWidgetName;\n    }\n\n    _handleObjectItem(item) {\n      if (item.name && this._isAcceptableItem(item.widget, \"dxButton\")) {\n        var defaultButtonItemConfig = this._prepareMenuItemConfig(item.name);\n\n        var buttonItemConfig = extend(true, defaultButtonItemConfig, item);\n        return buttonItemConfig;\n      } else if (item.items) {\n        item.items = this._prepareMenuItems(item.items);\n        return item;\n      } else {\n        return item;\n      }\n    }\n\n    _prepareMenuItemConfig(name) {\n      var _ICON_MAP$name, _this$_formatHandlers;\n\n      var iconName = null !== (_ICON_MAP$name = ICON_MAP[name]) && void 0 !== _ICON_MAP$name ? _ICON_MAP$name : name;\n      var buttonText = titleize(name);\n      return {\n        text: localize(buttonText),\n        icon: iconName.toLowerCase(),\n        onClick: null !== (_this$_formatHandlers = this._formatHandlers[name]) && void 0 !== _this$_formatHandlers ? _this$_formatHandlers : getDefaultClickHandler(this, name)\n      };\n    }\n\n    _prepareMenuItems(items) {\n      var resultItems = [];\n      each(items, (_, item) => {\n        var newItem;\n\n        if (isObject(item)) {\n          newItem = this._handleObjectItem(item);\n        } else if (isString(item)) {\n          newItem = this._prepareMenuItemConfig(item);\n        }\n\n        if (newItem) {\n          resultItems.push(newItem);\n        }\n      });\n      return resultItems;\n    }\n\n    _getMenuConfig(items) {\n      var defaultItems = [{\n        text: localize(\"insert\"),\n        items: [\"insertHeaderRow\", \"insertRowAbove\", \"insertRowBelow\", extend(this._prepareMenuItemConfig(\"insertColumnLeft\"), {\n          beginGroup: true\n        }), \"insertColumnRight\"]\n      }, {\n        text: localize(\"delete\"),\n        items: [\"deleteColumn\", \"deleteRow\", \"deleteTable\"]\n      }, extend(this._prepareMenuItemConfig(\"cellProperties\"), {\n        onClick: e => {\n          this.showPropertiesForm(\"cell\");\n        }\n      }), extend(this._prepareMenuItemConfig(\"tableProperties\"), {\n        onClick: e => {\n          this.showPropertiesForm(\"table\");\n        }\n      })];\n\n      var customItems = this._prepareMenuItems(null !== items && void 0 !== items && items.length ? items : defaultItems);\n\n      return {\n        target: this._quillContainer,\n        showEvent: null,\n        hideOnParentScroll: false,\n        items: customItems\n      };\n    }\n\n    _prepareContextMenuHandler() {\n      return event => {\n        if (this._isTableTarget(event.target)) {\n          this._targetElement = event.target;\n\n          this._setContextMenuPosition(event);\n\n          this._contextMenu.show();\n\n          event.preventDefault();\n        }\n      };\n    }\n\n    _setContextMenuPosition(event) {\n      var startPosition = this._quillContainer.get(0).getBoundingClientRect();\n\n      this._contextMenu.option({\n        position: {\n          my: \"left top\",\n          at: \"left top\",\n          collision: \"fit fit\",\n          offset: {\n            x: event.clientX - startPosition.left,\n            y: event.clientY - startPosition.top\n          }\n        }\n      });\n    }\n\n    _isTableTarget(targetElement) {\n      return !!$(targetElement).closest(\".dx-htmleditor-content td, .dx-htmleditor-content th\").length;\n    }\n\n    clean() {\n      this._detachEvents();\n    }\n\n    option(option, value) {\n      if (\"tableContextMenu\" === option) {\n        this.handleOptionChangeValue(value);\n        return;\n      }\n\n      if (\"enabled\" === option) {\n        this.enabled = value;\n        value ? this._enableContextMenu() : this.clean();\n      } else if (\"items\" === option) {\n        var _this$_contextMenu2;\n\n        null === (_this$_contextMenu2 = this._contextMenu) || void 0 === _this$_contextMenu2 ? void 0 : _this$_contextMenu2.dispose();\n        this._contextMenu = this._createContextMenu(value);\n      }\n    }\n\n    prepareCleanCallback() {\n      return () => {\n        this.clean();\n      };\n    }\n\n  };\n}\n\nexport default TableContextMenuModule;","map":{"version":3,"sources":["/Users/krunalpatel/Downloads/React-Firebase-Auth-master 3/node_modules/devextreme/esm/ui/html_editor/modules/tableContextMenu.js"],"names":["Quill","$","BaseModule","eventsEngine","addNamespace","ContextMenu","localizationMessage","getTableFormats","getFormatHandlers","getDefaultClickHandler","ICON_MAP","each","isString","isObject","titleize","camelize","extend","MODULE_NAMESPACE","CONTEXT_MENU_EVENT","TableContextMenuModule","localize","name","format","concat","constructor","quill","options","enabled","_quillContainer","editorInstance","_getQuillContainer","addCleanCallback","prepareCleanCallback","_formatHandlers","_tableFormats","_enableContextMenu","items","_this$_contextMenu","_contextMenu","dispose","_createContextMenu","_attachEvents","on","_getContent","_prepareContextMenuHandler","_detachEvents","off","$container","appendTo","$element","menuConfig","_getMenuConfig","_createComponent","showPropertiesForm","type","arguments","length","_targetElement","closest","hide","_isAcceptableItem","widget","acceptableWidgetName","_handleObjectItem","item","defaultButtonItemConfig","_prepareMenuItemConfig","buttonItemConfig","_prepareMenuItems","_ICON_MAP$name","_this$_formatHandlers","iconName","buttonText","text","icon","toLowerCase","onClick","resultItems","_","newItem","push","defaultItems","beginGroup","e","customItems","target","showEvent","hideOnParentScroll","event","_isTableTarget","_setContextMenuPosition","show","preventDefault","startPosition","get","getBoundingClientRect","option","position","my","at","collision","offset","x","clientX","left","y","clientY","top","targetElement","clean","value","handleOptionChangeValue","_this$_contextMenu2"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (esm/ui/html_editor/modules/tableContextMenu.js)\r\n * Version: 22.1.3\r\n * Build date: Mon Jun 13 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport Quill from \"devextreme-quill\";\r\nimport $ from \"../../../core/renderer\";\r\nimport BaseModule from \"./base\";\r\nimport eventsEngine from \"../../../events/core/events_engine\";\r\nimport {\r\n    addNamespace\r\n} from \"../../../events/utils/index\";\r\nimport ContextMenu from \"../../context_menu\";\r\nimport localizationMessage from \"../../../localization/message\";\r\nimport {\r\n    getTableFormats\r\n} from \"../utils/table_helper\";\r\nimport {\r\n    getFormatHandlers,\r\n    getDefaultClickHandler,\r\n    ICON_MAP\r\n} from \"../utils/toolbar_helper\";\r\nimport {\r\n    each\r\n} from \"../../../core/utils/iterator\";\r\nimport {\r\n    isString,\r\n    isObject\r\n} from \"../../../core/utils/type\";\r\nimport {\r\n    titleize,\r\n    camelize\r\n} from \"../../../core/utils/inflector\";\r\nimport {\r\n    extend\r\n} from \"../../../core/utils/extend\";\r\nvar MODULE_NAMESPACE = \"dxHtmlEditorTableContextMenu\";\r\nvar CONTEXT_MENU_EVENT = addNamespace(\"dxcontextmenu\", MODULE_NAMESPACE);\r\nvar TableContextMenuModule = BaseModule;\r\nvar localize = name => localizationMessage.format(\"dxHtmlEditor-\".concat(camelize(name)));\r\nif (Quill) {\r\n    TableContextMenuModule = class extends BaseModule {\r\n        constructor(quill, options) {\r\n            super(quill, options);\r\n            this.enabled = !!options.enabled;\r\n            this._quillContainer = this.editorInstance._getQuillContainer();\r\n            this.addCleanCallback(this.prepareCleanCallback());\r\n            this._formatHandlers = getFormatHandlers(this);\r\n            this._tableFormats = getTableFormats(quill);\r\n            if (this.enabled) {\r\n                this._enableContextMenu(options.items)\r\n            }\r\n        }\r\n        _enableContextMenu(items) {\r\n            var _this$_contextMenu;\r\n            null === (_this$_contextMenu = this._contextMenu) || void 0 === _this$_contextMenu ? void 0 : _this$_contextMenu.dispose();\r\n            this._contextMenu = this._createContextMenu(items);\r\n            this._attachEvents()\r\n        }\r\n        _attachEvents() {\r\n            eventsEngine.on(this.editorInstance._getContent(), CONTEXT_MENU_EVENT, this._prepareContextMenuHandler())\r\n        }\r\n        _detachEvents() {\r\n            eventsEngine.off(this.editorInstance._getContent(), CONTEXT_MENU_EVENT)\r\n        }\r\n        _createContextMenu(items) {\r\n            var $container = $(\"<div>\").appendTo(this.editorInstance.$element());\r\n            var menuConfig = this._getMenuConfig(items);\r\n            return this.editorInstance._createComponent($container, ContextMenu, menuConfig)\r\n        }\r\n        showPropertiesForm() {\r\n            var type = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : \"cell\";\r\n            var $element = $(this._targetElement).closest(\"cell\" === type ? \"th, td\" : \"table\");\r\n            this._contextMenu.hide();\r\n            this._formatHandlers[\"\".concat(type, \"Properties\")]($element);\r\n            this._targetElement = null\r\n        }\r\n        _isAcceptableItem(widget, acceptableWidgetName) {\r\n            return !widget || widget === acceptableWidgetName\r\n        }\r\n        _handleObjectItem(item) {\r\n            if (item.name && this._isAcceptableItem(item.widget, \"dxButton\")) {\r\n                var defaultButtonItemConfig = this._prepareMenuItemConfig(item.name);\r\n                var buttonItemConfig = extend(true, defaultButtonItemConfig, item);\r\n                return buttonItemConfig\r\n            } else if (item.items) {\r\n                item.items = this._prepareMenuItems(item.items);\r\n                return item\r\n            } else {\r\n                return item\r\n            }\r\n        }\r\n        _prepareMenuItemConfig(name) {\r\n            var _ICON_MAP$name, _this$_formatHandlers;\r\n            var iconName = null !== (_ICON_MAP$name = ICON_MAP[name]) && void 0 !== _ICON_MAP$name ? _ICON_MAP$name : name;\r\n            var buttonText = titleize(name);\r\n            return {\r\n                text: localize(buttonText),\r\n                icon: iconName.toLowerCase(),\r\n                onClick: null !== (_this$_formatHandlers = this._formatHandlers[name]) && void 0 !== _this$_formatHandlers ? _this$_formatHandlers : getDefaultClickHandler(this, name)\r\n            }\r\n        }\r\n        _prepareMenuItems(items) {\r\n            var resultItems = [];\r\n            each(items, (_, item) => {\r\n                var newItem;\r\n                if (isObject(item)) {\r\n                    newItem = this._handleObjectItem(item)\r\n                } else if (isString(item)) {\r\n                    newItem = this._prepareMenuItemConfig(item)\r\n                }\r\n                if (newItem) {\r\n                    resultItems.push(newItem)\r\n                }\r\n            });\r\n            return resultItems\r\n        }\r\n        _getMenuConfig(items) {\r\n            var defaultItems = [{\r\n                text: localize(\"insert\"),\r\n                items: [\"insertHeaderRow\", \"insertRowAbove\", \"insertRowBelow\", extend(this._prepareMenuItemConfig(\"insertColumnLeft\"), {\r\n                    beginGroup: true\r\n                }), \"insertColumnRight\"]\r\n            }, {\r\n                text: localize(\"delete\"),\r\n                items: [\"deleteColumn\", \"deleteRow\", \"deleteTable\"]\r\n            }, extend(this._prepareMenuItemConfig(\"cellProperties\"), {\r\n                onClick: e => {\r\n                    this.showPropertiesForm(\"cell\")\r\n                }\r\n            }), extend(this._prepareMenuItemConfig(\"tableProperties\"), {\r\n                onClick: e => {\r\n                    this.showPropertiesForm(\"table\")\r\n                }\r\n            })];\r\n            var customItems = this._prepareMenuItems(null !== items && void 0 !== items && items.length ? items : defaultItems);\r\n            return {\r\n                target: this._quillContainer,\r\n                showEvent: null,\r\n                hideOnParentScroll: false,\r\n                items: customItems\r\n            }\r\n        }\r\n        _prepareContextMenuHandler() {\r\n            return event => {\r\n                if (this._isTableTarget(event.target)) {\r\n                    this._targetElement = event.target;\r\n                    this._setContextMenuPosition(event);\r\n                    this._contextMenu.show();\r\n                    event.preventDefault()\r\n                }\r\n            }\r\n        }\r\n        _setContextMenuPosition(event) {\r\n            var startPosition = this._quillContainer.get(0).getBoundingClientRect();\r\n            this._contextMenu.option({\r\n                position: {\r\n                    my: \"left top\",\r\n                    at: \"left top\",\r\n                    collision: \"fit fit\",\r\n                    offset: {\r\n                        x: event.clientX - startPosition.left,\r\n                        y: event.clientY - startPosition.top\r\n                    }\r\n                }\r\n            })\r\n        }\r\n        _isTableTarget(targetElement) {\r\n            return !!$(targetElement).closest(\".dx-htmleditor-content td, .dx-htmleditor-content th\").length\r\n        }\r\n        clean() {\r\n            this._detachEvents()\r\n        }\r\n        option(option, value) {\r\n            if (\"tableContextMenu\" === option) {\r\n                this.handleOptionChangeValue(value);\r\n                return\r\n            }\r\n            if (\"enabled\" === option) {\r\n                this.enabled = value;\r\n                value ? this._enableContextMenu() : this.clean()\r\n            } else if (\"items\" === option) {\r\n                var _this$_contextMenu2;\r\n                null === (_this$_contextMenu2 = this._contextMenu) || void 0 === _this$_contextMenu2 ? void 0 : _this$_contextMenu2.dispose();\r\n                this._contextMenu = this._createContextMenu(value)\r\n            }\r\n        }\r\n        prepareCleanCallback() {\r\n            return () => {\r\n                this.clean()\r\n            }\r\n        }\r\n    }\r\n}\r\nexport default TableContextMenuModule;\r\n"]},"metadata":{},"sourceType":"module"}