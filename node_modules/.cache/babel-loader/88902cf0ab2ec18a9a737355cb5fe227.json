{"ast":null,"code":"/**\n* DevExpress Analytics (query-builder\\wizard\\pages\\multiQueryWizard\\masterDetailRelationshipsPageBase.js)\n* Version:  22.1.3\n* Build date: Jun 14, 2022\n* Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\n* License: https://www.devexpress.com/Support/EULAs/universal.xml\n*/\n\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.MasterDetailRelationshipsPageBase = void 0;\n\nvar ko = require(\"knockout\");\n\nvar $ = require(\"jquery\");\n\nvar resultSet_1 = require(\"../../../dataSource/resultSet\");\n\nvar _utils_1 = require(\"../../internal/_utils\");\n\nvar _masterDetailEditor_1 = require(\"../../../widgets/masterdetaileditor/_masterDetailEditor\");\n\nvar _infoMessageHelpers_1 = require(\"../../../../core/utils/_infoMessageHelpers\");\n\nvar wizardPageBase_1 = require(\"../wizardPageBase\");\n\nvar MasterDetailRelationshipsPageBase = function (_super) {\n  __extends(MasterDetailRelationshipsPageBase, _super);\n\n  function MasterDetailRelationshipsPageBase(_getResultSchema) {\n    var _this = _super.call(this) || this;\n\n    _this._getResultSchema = _getResultSchema;\n    _this._relations = ko.observableArray([]);\n    _this._customResetOptions = $.noop;\n    _this._relationsEditor = ko.observable(null);\n\n    var callback = function () {\n      return _this._onChange();\n    };\n\n    _this._disposables.push(_utils_1.subscribeArray(_this._relations, function (relation) {\n      var _a;\n\n      (_a = relation._disposables).push.apply(_a, _utils_1.subscribeProperties([relation.detailQuery, relation.name, relation.masterQuery], callback));\n\n      relation._disposables.push(_utils_1.subscribeArray(relation.keyColumns, function (column) {\n        var _a;\n\n        (_a = relation._disposables).push.apply(_a, _utils_1.subscribeProperties([column.detailColumn, column.masterColumn], callback));\n      }, callback));\n    }, callback));\n\n    return _this;\n  }\n\n  MasterDetailRelationshipsPageBase.prototype._getResultSet = function (dataSource) {\n    var deferred = $.Deferred();\n\n    if (dataSource.resultSet) {\n      deferred.resolve(dataSource.resultSet);\n    } else {\n      this._getResultSchema(dataSource).done(function (result) {\n        deferred.resolve(new resultSet_1.ResultSet(JSON.parse(result.resultSchemaJSON)));\n      }).fail(function (result) {\n        deferred.reject(result);\n      });\n    }\n\n    return deferred.promise();\n  };\n\n  MasterDetailRelationshipsPageBase.prototype._dataSource = function () {\n    return null;\n  };\n\n  MasterDetailRelationshipsPageBase.prototype._restoreDataSource = function (state) {};\n\n  MasterDetailRelationshipsPageBase.prototype._updateRelations = function () {\n    var _this = this;\n\n    var relations = this._relations();\n\n    relations.forEach(function (relation, index) {\n      var detailTable = _this._resultSet.tables().filter(function (table) {\n        return table.tableName() === relation.detailQuery();\n      })[0];\n\n      var masterTable = _this._resultSet.tables().filter(function (table) {\n        return table.tableName() === relation.masterQuery();\n      })[0];\n\n      if (!detailTable || !masterTable) {\n        relations.splice(index, 1);\n        return;\n      }\n\n      var keyColumns = relation.keyColumns();\n      keyColumns.forEach(function (keyColumn, index) {\n        if (detailTable.columns().every(function (x) {\n          return x.name() !== keyColumn.detailColumn();\n        }) || masterTable.columns().every(function (x) {\n          return x.name() !== keyColumn.masterColumn();\n        })) keyColumns.splice(index, 1);\n      });\n      if (keyColumns.length === 0) relations.splice(index, 1);\n    });\n\n    this._relations.valueHasMutated();\n  };\n\n  MasterDetailRelationshipsPageBase.prototype.canNext = function () {\n    return false;\n  };\n\n  MasterDetailRelationshipsPageBase.prototype.canFinish = function () {\n    return this._relations().every(function (relation) {\n      return relation.keyColumns().every(function (keyColumn) {\n        return !!keyColumn.detailColumn() && !!keyColumn.masterColumn();\n      });\n    });\n  };\n\n  MasterDetailRelationshipsPageBase.prototype.initialize = function (state) {\n    var _this = this;\n\n    this.relationsSubscription && this.relationsSubscription.dispose();\n\n    this._restoreDataSource(state);\n\n    this._disposables.push(this.relationsSubscription = this._relations.subscribe(function (changes) {\n      var isRelationsChanged = changes.some(function (change) {\n        return !change['moved'] && change['moved'] !== 0;\n      });\n\n      if (isRelationsChanged) {\n        _this._customResetOptions();\n      }\n    }, null, 'arrayChange'));\n\n    return this._getResultSet(this._dataSource()).done(function (result) {\n      _this._resultSet = result;\n\n      _this._updateRelations();\n\n      _this._relationsEditor(new _masterDetailEditor_1.MasterDetailEditor(_this._relations, _this._resultSet, $.noop));\n    }).fail(function (result) {\n      if (_infoMessageHelpers_1.getErrorMessage(result)) _infoMessageHelpers_1.ShowMessage(_infoMessageHelpers_1.getErrorMessage(result));\n    });\n  };\n\n  MasterDetailRelationshipsPageBase.prototype.dispose = function () {\n    _super.prototype.dispose.call(this);\n\n    this.disposeObservableArray(this._relations);\n  };\n\n  return MasterDetailRelationshipsPageBase;\n}(wizardPageBase_1.WizardPageBase);\n\nexports.MasterDetailRelationshipsPageBase = MasterDetailRelationshipsPageBase;","map":{"version":3,"sources":["/Users/krunalpatel/Downloads/React-Firebase-Auth-master 3/node_modules/@devexpress/analytics-core/query-builder/wizard/pages/multiQueryWizard/masterDetailRelationshipsPageBase.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","TypeError","String","__","constructor","create","defineProperty","exports","value","MasterDetailRelationshipsPageBase","ko","require","$","resultSet_1","_utils_1","_masterDetailEditor_1","_infoMessageHelpers_1","wizardPageBase_1","_super","_getResultSchema","_this","_relations","observableArray","_customResetOptions","noop","_relationsEditor","observable","callback","_onChange","_disposables","push","subscribeArray","relation","_a","apply","subscribeProperties","detailQuery","name","masterQuery","keyColumns","column","detailColumn","masterColumn","_getResultSet","dataSource","deferred","Deferred","resultSet","resolve","done","result","ResultSet","JSON","parse","resultSchemaJSON","fail","reject","promise","_dataSource","_restoreDataSource","state","_updateRelations","relations","forEach","index","detailTable","_resultSet","tables","filter","table","tableName","masterTable","splice","keyColumn","columns","every","x","length","valueHasMutated","canNext","canFinish","initialize","relationsSubscription","dispose","subscribe","changes","isRelationsChanged","some","change","MasterDetailEditor","getErrorMessage","ShowMessage","disposeObservableArray","WizardPageBase"],"mappings":"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","sourcesContent":["/**\n* DevExpress Analytics (query-builder\\wizard\\pages\\multiQueryWizard\\masterDetailRelationshipsPageBase.js)\n* Version:  22.1.3\n* Build date: Jun 14, 2022\n* Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\n* License: https://www.devexpress.com/Support/EULAs/universal.xml\n*/\n\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.MasterDetailRelationshipsPageBase = void 0;\nvar ko = require(\"knockout\");\nvar $ = require(\"jquery\");\nvar resultSet_1 = require(\"../../../dataSource/resultSet\");\nvar _utils_1 = require(\"../../internal/_utils\");\nvar _masterDetailEditor_1 = require(\"../../../widgets/masterdetaileditor/_masterDetailEditor\");\nvar _infoMessageHelpers_1 = require(\"../../../../core/utils/_infoMessageHelpers\");\nvar wizardPageBase_1 = require(\"../wizardPageBase\");\nvar MasterDetailRelationshipsPageBase = (function (_super) {\n    __extends(MasterDetailRelationshipsPageBase, _super);\n    function MasterDetailRelationshipsPageBase(_getResultSchema) {\n        var _this = _super.call(this) || this;\n        _this._getResultSchema = _getResultSchema;\n        _this._relations = ko.observableArray([]);\n        _this._customResetOptions = $.noop;\n        _this._relationsEditor = ko.observable(null);\n        var callback = function () { return _this._onChange(); };\n        _this._disposables.push(_utils_1.subscribeArray(_this._relations, function (relation) {\n            var _a;\n            (_a = relation._disposables).push.apply(_a, _utils_1.subscribeProperties([relation.detailQuery, relation.name, relation.masterQuery], callback));\n            relation._disposables.push(_utils_1.subscribeArray(relation.keyColumns, function (column) {\n                var _a;\n                (_a = relation._disposables).push.apply(_a, _utils_1.subscribeProperties([column.detailColumn, column.masterColumn], callback));\n            }, callback));\n        }, callback));\n        return _this;\n    }\n    MasterDetailRelationshipsPageBase.prototype._getResultSet = function (dataSource) {\n        var deferred = $.Deferred();\n        if (dataSource.resultSet) {\n            deferred.resolve((dataSource.resultSet));\n        }\n        else {\n            this._getResultSchema(dataSource).done((function (result) {\n                deferred.resolve(new resultSet_1.ResultSet(JSON.parse(result.resultSchemaJSON)));\n            })).fail(function (result) {\n                deferred.reject(result);\n            });\n        }\n        return deferred.promise();\n    };\n    MasterDetailRelationshipsPageBase.prototype._dataSource = function () {\n        return null;\n    };\n    MasterDetailRelationshipsPageBase.prototype._restoreDataSource = function (state) {\n    };\n    MasterDetailRelationshipsPageBase.prototype._updateRelations = function () {\n        var _this = this;\n        var relations = this._relations();\n        relations.forEach(function (relation, index) {\n            var detailTable = _this._resultSet.tables().filter(function (table) { return table.tableName() === relation.detailQuery(); })[0];\n            var masterTable = _this._resultSet.tables().filter(function (table) { return table.tableName() === relation.masterQuery(); })[0];\n            if (!detailTable || !masterTable) {\n                relations.splice(index, 1);\n                return;\n            }\n            var keyColumns = relation.keyColumns();\n            keyColumns.forEach(function (keyColumn, index) {\n                if (detailTable.columns().every(function (x) { return x.name() !== keyColumn.detailColumn(); }) ||\n                    masterTable.columns().every(function (x) { return x.name() !== keyColumn.masterColumn(); }))\n                    keyColumns.splice(index, 1);\n            });\n            if (keyColumns.length === 0)\n                relations.splice(index, 1);\n        });\n        this._relations.valueHasMutated();\n    };\n    MasterDetailRelationshipsPageBase.prototype.canNext = function () {\n        return false;\n    };\n    MasterDetailRelationshipsPageBase.prototype.canFinish = function () {\n        return this._relations().every(function (relation) { return relation.keyColumns()\n            .every(function (keyColumn) { return !!keyColumn.detailColumn() && !!keyColumn.masterColumn(); }); });\n    };\n    MasterDetailRelationshipsPageBase.prototype.initialize = function (state) {\n        var _this = this;\n        this.relationsSubscription && this.relationsSubscription.dispose();\n        this._restoreDataSource(state);\n        this._disposables.push(this.relationsSubscription = this._relations.subscribe(function (changes) {\n            var isRelationsChanged = changes.some(function (change) {\n                return !change['moved'] && change['moved'] !== 0;\n            });\n            if (isRelationsChanged) {\n                _this._customResetOptions();\n            }\n        }, null, 'arrayChange'));\n        return this._getResultSet(this._dataSource())\n            .done(function (result) {\n            _this._resultSet = result;\n            _this._updateRelations();\n            _this._relationsEditor(new _masterDetailEditor_1.MasterDetailEditor(_this._relations, _this._resultSet, $.noop));\n        })\n            .fail(function (result) {\n            if (_infoMessageHelpers_1.getErrorMessage(result))\n                _infoMessageHelpers_1.ShowMessage(_infoMessageHelpers_1.getErrorMessage(result));\n        });\n    };\n    MasterDetailRelationshipsPageBase.prototype.dispose = function () {\n        _super.prototype.dispose.call(this);\n        this.disposeObservableArray(this._relations);\n    };\n    return MasterDetailRelationshipsPageBase;\n}(wizardPageBase_1.WizardPageBase));\nexports.MasterDetailRelationshipsPageBase = MasterDetailRelationshipsPageBase;\n"]},"metadata":{},"sourceType":"script"}