{"ast":null,"code":"/**\r\n* DevExpress Dashboard (_dashboard-update-hub.js)\r\n* Version:  22.1.3\r\n* Build date: Jun 13, 2022\r\n* Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n* License: https://www.devexpress.com/Support/EULAs/universal.xml\r\n*/\n\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.DashboardUpdateHub = void 0;\n\nvar _default_1 = require(\"../../data/localization/_default\");\n\nvar _jquery_helpers_1 = require(\"../../data/_jquery-helpers\");\n\nvar _utils_1 = require(\"../../data/_utils\");\n\nvar model_1 = require(\"../../model\");\n\nvar disposable_object_1 = require(\"../../model/disposable-object\");\n\nvar data_dashboard_item_1 = require(\"../../model/items/data-dashboard-item\");\n\nvar filter_element_item_base_1 = require(\"../../model/items/filter-items/filter-element-item-base\");\n\nvar range_filter_item_1 = require(\"../../model/items/range-filter/range-filter-item\");\n\nvar _pane_content_holder_1 = require(\"../../model/items/_pane-content-holder\");\n\nvar _base_metadata_1 = require(\"../../model/metadata/_base-metadata\");\n\nvar notificator_1 = require(\"../notification-controller/notificator\");\n\nvar _dashboard_event_1 = require(\"./_dashboard-event\");\n\nvar _item_change_subscriber_1 = require(\"./_item-change-subscriber\");\n\nvar DashboardUpdateHub = function (_super) {\n  __extends(DashboardUpdateHub, _super);\n\n  function DashboardUpdateHub(_dashboard, _dataRequestOptions, _callBacks, _requestVisibleItemsProvider) {\n    var _this = _super.call(this) || this;\n\n    _this._dashboard = _dashboard;\n    _this._dataRequestOptions = _dataRequestOptions;\n    _this._callBacks = _callBacks;\n    _this._requestVisibleItemsProvider = _requestVisibleItemsProvider;\n    _this._timer = 0;\n    _this._requestQueue = [];\n\n    _this.initializeItem = function (item) {\n      if (item instanceof data_dashboard_item_1.DataDashboardItem && !item._useNeutralFilterMode()) {\n        item._beforeMasterFilterSetByUserInteraction = function () {\n          if (!_this._isUpdating() && !_this._suspendItem) {\n            _this._suspendItem = item;\n          }\n        };\n\n        item._afterMasterFilterSetByUserInteraction = function () {\n          if (!_this._isUpdating() && _this._suspendItem === item) {\n            _this._suspendItem = null;\n          }\n        };\n\n        item._drillDownChangedByUserInteraction = function () {\n          if (_this._suspendItem === item) {\n            _this._suspendItem = null;\n          }\n        };\n      }\n\n      item._getContentCategories().forEach(function (category) {\n        return _this._itemChanged(item, category);\n      });\n    };\n\n    _this.dataSourcePropertyChanged = new _dashboard_event_1.DashboardEvent();\n    _this.dashboardItemPropertyChanged = new _dashboard_event_1.DashboardEvent();\n    var itemSubscription = {\n      itemAdded: _this.initializeItem,\n      itemDeleted: function (item) {\n        if (item instanceof data_dashboard_item_1.DataDashboardItem) {\n          item._beforeMasterFilterSetByUserInteraction = null;\n        }\n      },\n      itemChanged: function (item, category) {\n        if (item instanceof data_dashboard_item_1.DataDashboardItem && category !== _base_metadata_1.PropertyCategory.ViewModel) {\n          item._limitDataState.reset();\n\n          if (item instanceof model_1.GridItem) item._processClientFilterStateChanged(null);\n        }\n\n        _this._itemChanged(item, category);\n\n        _this.dashboardItemPropertyChanged.fire({\n          item: item,\n          category: category\n        });\n      }\n    };\n\n    _this.toDispose(new _item_change_subscriber_1.ItemsChangeSubscriber(_this._dashboard.items, itemSubscription));\n\n    _this.toDispose(new _item_change_subscriber_1.ItemsChangeSubscriber(_this._dashboard.groups, itemSubscription));\n\n    _this.toDispose(new _item_change_subscriber_1.ItemsChangeSubscriber(_this._dashboard._tabPages, itemSubscription));\n\n    _this.toDispose(new _item_change_subscriber_1.DataSourcesSubscriber(_this._dashboard.dataSources, function (args) {\n      var affectedItems = _this._dashboard._dataDashboardItems().filter(function (item) {\n        return item.dataSource() === args.dataSource.componentName();\n      });\n\n      if (args.queryName) {\n        affectedItems = affectedItems.filter(function (item) {\n          return item.dataMember() == args.queryName;\n        });\n      }\n\n      if (args.fieldName) {\n        affectedItems = affectedItems.filter(function (item) {\n          return !!item.dataItems().filter(function (dataItem) {\n            return dataItem.dataMember() == args.fieldName;\n          })[0];\n        });\n      }\n\n      affectedItems.forEach(function (item) {\n        return _this._itemChanged(item, _base_metadata_1.PropertyCategory.Data);\n      });\n\n      _this.dataSourcePropertyChanged.fire(args);\n    }));\n\n    _this.toDispose(_this._dashboard.currencyCultureName.subscribe(function (_) {\n      _this.reloadAllItems(_base_metadata_1.PropertyCategory.Data);\n    }));\n\n    _this.toDispose(_this._dashboard._queryParameters.subscribe(function (_) {\n      _this.reloadAllItems(_base_metadata_1.PropertyCategory.ClientState);\n    }));\n\n    _this.toDispose(new _item_change_subscriber_1.ColorSchemeSubscriber(_dashboard.colorScheme, function () {\n      _this.reloadGlobalColoredItems(_base_metadata_1.PropertyCategory.Data);\n    }));\n\n    if (_this._dataRequestOptions.itemDataRequestMode === 'BatchRequests') {\n      var itemsToRequest = {};\n\n      var performBatchRequest = _utils_1.debounce(function () {\n        var itemsToRequestCopy = __assign({}, itemsToRequest);\n\n        itemsToRequest = {};\n\n        _this._callBacks.getBatchItemData(Object.keys(itemsToRequestCopy).map(function (itemName) {\n          return itemsToRequestCopy[itemName].itemModel;\n        })).done(function (result) {\n          Object.keys(result).forEach(function (itemName) {\n            return itemsToRequestCopy[itemName].deferred.resolve(result[itemName]);\n          });\n        }).fail(function (result) {\n          Object.keys(itemsToRequestCopy).forEach(function (itemName) {\n            return itemsToRequestCopy[itemName].deferred.reject(result);\n          });\n        });\n      }, 1);\n\n      _this._getItemData = function (item) {\n        var def = _jquery_helpers_1.createJQueryDeferred();\n\n        itemsToRequest[item.componentName()] = {\n          itemModel: item,\n          deferred: def\n        };\n        performBatchRequest();\n        return def.promise();\n      };\n    } else {\n      _this._getItemData = function (item) {\n        return _this._callBacks.getItemData(item);\n      };\n    }\n\n    return _this;\n  }\n\n  DashboardUpdateHub.prototype._isUpdating = function () {\n    return !!this._requestQueue.length;\n  };\n\n  DashboardUpdateHub.prototype._dequeueRequest = function (queueItem) {\n    var _this = this;\n\n    var itemIndex = this._requestQueue.indexOf(queueItem);\n\n    if (itemIndex !== -1) {\n      this._requestQueue.splice(itemIndex, 1);\n\n      if (_pane_content_holder_1.getCategoryContentName(queueItem.category) === 'data') {\n        this.itemEndUpdate && this.itemEndUpdate(queueItem.item.componentName());\n      }\n\n      if (this._requestQueue.filter(function (item) {\n        return _this.visibleItemsFilter(item);\n      }).length === 0) {\n        this.dashboardEndUpdate && this.dashboardEndUpdate();\n        this._suspendItem = null;\n      }\n    }\n  };\n\n  DashboardUpdateHub.prototype._enqueueRequest = function (item, category) {\n    var _this = this;\n\n    var compatibleCategories = item._paneContentHolder.getCompatibleCategories(category);\n\n    if (!this._requestQueue.some(function (queueItem) {\n      return queueItem.item === item && compatibleCategories.indexOf(queueItem.category) !== -1;\n    })) {\n      this._requestQueue.push({\n        item: item,\n        category: category\n      });\n\n      if (this._requestQueue.filter(function (item) {\n        return _this.visibleItemsFilter(item);\n      }).length === 1) {\n        this.dashboardBeginUpdate && this.dashboardBeginUpdate();\n      }\n\n      if (_pane_content_holder_1.getCategoryContentName(category) === 'data') {\n        this.itemBeginUpdate && this.itemBeginUpdate(item.componentName());\n      }\n    }\n  };\n\n  DashboardUpdateHub.prototype._getDataRequestPriority = function (dashboardItem) {\n    if (dashboardItem instanceof filter_element_item_base_1.FilterElementItemBase || dashboardItem instanceof range_filter_item_1.RangeFilterItem) {\n      return 2;\n    } else if (dashboardItem instanceof data_dashboard_item_1.DataDashboardItem && dashboardItem._masterFilterMode() === 'Single') {\n      return 1;\n    }\n\n    return 0;\n  };\n\n  DashboardUpdateHub.prototype._getRequestLockingMasterFilterItems = function (dashboardItem) {\n    if (dashboardItem instanceof data_dashboard_item_1.DataDashboardItem) {\n      return dashboardItem._masterFilterItems().filter(function (masterItem) {\n        if (masterItem instanceof range_filter_item_1.RangeFilterItem || masterItem._isSingleMasterFilter()) {\n          return true;\n        } else {\n          return !masterItem._useNeutralFilterMode() && masterItem instanceof filter_element_item_base_1.FilterElementItemBase;\n        }\n      });\n    }\n\n    return [];\n  };\n\n  DashboardUpdateHub.prototype.visibleItemsFilter = function (queueItem) {\n    var _this = this;\n\n    if (this._dataRequestOptions.itemDataLoadingMode === 'OnDemand' && this._visibleItemsProvider && this._visibleItemsProvider.visibleItems().indexOf(queueItem.item) === -1) {\n      if (queueItem.item instanceof data_dashboard_item_1.DataDashboardItem) {\n        return this._visibleItemsProvider.visibleItems().some(function (visibleItem) {\n          return _this._getRequestLockingMasterFilterItems(visibleItem).indexOf(queueItem.item) !== -1;\n        });\n      } else {\n        return false;\n      }\n    }\n\n    return true;\n  };\n\n  DashboardUpdateHub.prototype._resolveItems = function () {\n    var _this = this;\n\n    this._requestQueue.filter(function (queueItem) {\n      return !queueItem.item._paneContentHolder.isWaitingForContent(queueItem.category);\n    }).sort(function (a, b) {\n      if (_this._visibleItemsProvider) {\n        var aNumber = _this._visibleItemsProvider.visibleItems().indexOf(a.item) !== -1 ? 1 : 0;\n        var bNumber = _this._visibleItemsProvider.visibleItems().indexOf(b.item) !== -1 ? 1 : 0;\n        return bNumber - aNumber;\n      } else {\n        return 0;\n      }\n    }).filter(function (queueItem) {\n      return _this.visibleItemsFilter(queueItem);\n    }).filter(function (queueItem) {\n      if (queueItem.item instanceof data_dashboard_item_1.DataDashboardItem && queueItem.item.dataItems().length > 0) {\n        return _this._getRequestLockingMasterFilterItems(queueItem.item).filter(function (masterItem) {\n          var circularDependencyIndex = _this._getRequestLockingMasterFilterItems(masterItem).indexOf(queueItem.item);\n\n          if (circularDependencyIndex > -1) {\n            var itemPriority = _this._getDataRequestPriority(queueItem.item);\n\n            var masterItemPriority = _this._getDataRequestPriority(masterItem);\n\n            if (itemPriority === masterItemPriority) {\n              return _this._dashboard.items().indexOf(queueItem.item) > _this._dashboard.items().indexOf(masterItem);\n            } else {\n              return itemPriority < masterItemPriority;\n            }\n          }\n\n          return true;\n        }).every(function (dependence) {\n          return _this._requestQueue.filter(function (queueItem) {\n            return queueItem.item === dependence;\n          }).length === 0;\n        });\n      }\n\n      return true;\n    }).forEach(function (queueItem) {\n      if (_this._dashboard.findItem(queueItem.item.componentName())) {\n        var category = queueItem.category;\n\n        queueItem.item._paneContentHolder.beginRequest(category);\n\n        if (queueItem.item._paneContentHolder.needRequestContentFromServer(category)) {\n          _this._performServerRequest(queueItem.item, queueItem.category).done(function (result) {\n            queueItem.item._paneContentHolder.endRequest({\n              response: result,\n              category: category\n            });\n\n            if (queueItem.item._paneContentHolder.isValid(category)) {\n              _this._dequeueRequest(queueItem);\n            }\n\n            _this._resolveItems();\n\n            return result;\n          }).fail(function (result) {\n            var errorTitle = _default_1.getLocalizationById('DashboardWebStringId.Errors.AttemptToLoadData');\n\n            var errorDetail = notificator_1.NotificationController._getDetailedErrorMessage(result);\n\n            queueItem.item._errorState({\n              title: errorTitle,\n              detail: errorDetail\n            });\n\n            queueItem.item._paneContentHolder.endRequest({\n              response: {},\n              category: category\n            });\n\n            _this._dequeueRequest(queueItem);\n\n            _this._resolveItems();\n          });\n        } else {\n          queueItem.item._paneContentHolder.endRequest({\n            response: {},\n            category: category\n          });\n\n          _this._dequeueRequest(queueItem);\n        }\n      } else {\n        _this._dequeueRequest(queueItem);\n      }\n    });\n  };\n\n  DashboardUpdateHub.prototype._processItemChanged = function (dashboardItem, changeCategory) {\n    if (dashboardItem instanceof model_1.MapItem && changeCategory === _base_metadata_1.PropertyCategory.Map && dashboardItem._paneContentHolder.valid()) {\n      dashboardItem._isGeometryChangedCallback();\n    }\n\n    dashboardItem._paneContentHolder.itemChanged(changeCategory);\n\n    dashboardItem._errorState(null);\n\n    if (dashboardItem instanceof data_dashboard_item_1.DataDashboardItem) {\n      if (changeCategory === _base_metadata_1.PropertyCategory.Data || changeCategory === _base_metadata_1.PropertyCategory.Interactivity) {\n        dashboardItem._dataManager(null);\n\n        dashboardItem._clearInteractivityState();\n      }\n    }\n  };\n\n  DashboardUpdateHub.prototype._itemChanged = function (dashboardItem, changeCategory) {\n    var _this = this;\n\n    if (changeCategory === _base_metadata_1.PropertyCategory.ClientState && this._suspendItem === dashboardItem) {\n      return;\n    }\n\n    this._processItemChanged(dashboardItem, changeCategory);\n\n    this._enqueueRequest(dashboardItem, changeCategory);\n\n    if (dashboardItem instanceof data_dashboard_item_1.DataDashboardItem) {\n      if (dashboardItem._isGloballyColored && changeCategory === _base_metadata_1.PropertyCategory.Data || changeCategory === _base_metadata_1.PropertyCategory.Coloring) {\n        this._dashboard._dataDashboardItems().filter(function (item) {\n          return item._isGloballyColored;\n        }).forEach(function (item) {\n          _this._processItemChanged(dashboardItem, _base_metadata_1.PropertyCategory.Data);\n\n          _this._enqueueRequest(item, _base_metadata_1.PropertyCategory.Data);\n        });\n      }\n    }\n\n    this._resolveItemsDeffered();\n  };\n\n  DashboardUpdateHub.prototype._resolveItemsDeffered = function () {\n    var _this = this;\n\n    clearTimeout(this._timer);\n    this._timer = window.setTimeout(function () {\n      _this._resolveItems();\n    }, 10);\n  };\n\n  DashboardUpdateHub.prototype._performServerRequest = function (item, category) {\n    var contentName = _pane_content_holder_1.getCategoryContentName(category);\n\n    switch (contentName) {\n      case 'data':\n        return this._getItemData(item);\n\n      case 'map':\n        return this._callBacks.getMapShapeFile(item);\n\n      default:\n        throw new Error();\n    }\n  };\n\n  DashboardUpdateHub.prototype.refreshItems = function (itemsNames) {\n    var _this = this;\n\n    this._dashboard._dataDashboardItems().filter(function (item) {\n      return itemsNames.indexOf(item.componentName()) !== -1;\n    }).forEach(function (item) {\n      _this._itemChanged(item, _base_metadata_1.PropertyCategory.ClientState);\n    });\n  };\n\n  DashboardUpdateHub.prototype.reloadAllItems = function (caterory) {\n    var _this = this;\n\n    this._dashboard._dataDashboardItems().forEach(function (item) {\n      _this._itemChanged(item, caterory);\n    });\n  };\n\n  DashboardUpdateHub.prototype.reloadGlobalColoredItems = function (caterory) {\n    var _this = this;\n\n    this._dashboard._dataDashboardItems().filter(function (item) {\n      return item.coloringOptions && item.coloringOptions.useGlobalColors();\n    }).forEach(function (item) {\n      _this._itemChanged(item, caterory);\n    });\n  };\n\n  DashboardUpdateHub.prototype.initialize = function () {\n    var _this = this;\n\n    if (this._requestVisibleItemsProvider) {\n      this._visibleItemsProvider = this._requestVisibleItemsProvider();\n    }\n\n    if (this._visibleItemsProvider) {\n      this.toDispose(this._visibleItemsProvider.visibleItems.subscribe(function (_) {\n        return _this._resolveItemsDeffered();\n      }));\n    }\n\n    this._dashboard.items().forEach(this.initializeItem);\n\n    this._dashboard.groups().forEach(this.initializeItem);\n\n    this._dashboard._tabPages().forEach(this.initializeItem);\n  };\n\n  DashboardUpdateHub.prototype.dispose = function () {\n    clearTimeout(this._timer);\n    this._timer = null;\n\n    this._requestQueue.splice(0, this._requestQueue.length);\n\n    _super.prototype.dispose.call(this);\n  };\n\n  return DashboardUpdateHub;\n}(disposable_object_1.DisposableObject);\n\nexports.DashboardUpdateHub = DashboardUpdateHub;","map":{"version":3,"sources":["/Users/krunalpatel/Downloads/React-Firebase-Auth-master 3/node_modules/devexpress-dashboard/common/dashboard-update-hub/_dashboard-update-hub.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","TypeError","String","__","constructor","create","__assign","assign","t","s","i","n","arguments","length","apply","defineProperty","exports","value","DashboardUpdateHub","_default_1","require","_jquery_helpers_1","_utils_1","model_1","disposable_object_1","data_dashboard_item_1","filter_element_item_base_1","range_filter_item_1","_pane_content_holder_1","_base_metadata_1","notificator_1","_dashboard_event_1","_item_change_subscriber_1","_super","_dashboard","_dataRequestOptions","_callBacks","_requestVisibleItemsProvider","_this","_timer","_requestQueue","initializeItem","item","DataDashboardItem","_useNeutralFilterMode","_beforeMasterFilterSetByUserInteraction","_isUpdating","_suspendItem","_afterMasterFilterSetByUserInteraction","_drillDownChangedByUserInteraction","_getContentCategories","forEach","category","_itemChanged","dataSourcePropertyChanged","DashboardEvent","dashboardItemPropertyChanged","itemSubscription","itemAdded","itemDeleted","itemChanged","PropertyCategory","ViewModel","_limitDataState","reset","GridItem","_processClientFilterStateChanged","fire","toDispose","ItemsChangeSubscriber","items","groups","_tabPages","DataSourcesSubscriber","dataSources","args","affectedItems","_dataDashboardItems","filter","dataSource","componentName","queryName","dataMember","fieldName","dataItems","dataItem","Data","currencyCultureName","subscribe","_","reloadAllItems","_queryParameters","ClientState","ColorSchemeSubscriber","colorScheme","reloadGlobalColoredItems","itemDataRequestMode","itemsToRequest","performBatchRequest","debounce","itemsToRequestCopy","getBatchItemData","keys","map","itemName","itemModel","done","result","deferred","resolve","fail","reject","_getItemData","def","createJQueryDeferred","promise","getItemData","_dequeueRequest","queueItem","itemIndex","indexOf","splice","getCategoryContentName","itemEndUpdate","visibleItemsFilter","dashboardEndUpdate","_enqueueRequest","compatibleCategories","_paneContentHolder","getCompatibleCategories","some","push","dashboardBeginUpdate","itemBeginUpdate","_getDataRequestPriority","dashboardItem","FilterElementItemBase","RangeFilterItem","_masterFilterMode","_getRequestLockingMasterFilterItems","_masterFilterItems","masterItem","_isSingleMasterFilter","itemDataLoadingMode","_visibleItemsProvider","visibleItems","visibleItem","_resolveItems","isWaitingForContent","sort","a","aNumber","bNumber","circularDependencyIndex","itemPriority","masterItemPriority","every","dependence","findItem","beginRequest","needRequestContentFromServer","_performServerRequest","endRequest","response","isValid","errorTitle","getLocalizationById","errorDetail","NotificationController","_getDetailedErrorMessage","_errorState","title","detail","_processItemChanged","changeCategory","MapItem","Map","valid","_isGeometryChangedCallback","Interactivity","_dataManager","_clearInteractivityState","_isGloballyColored","Coloring","_resolveItemsDeffered","clearTimeout","window","setTimeout","contentName","getMapShapeFile","Error","refreshItems","itemsNames","caterory","coloringOptions","useGlobalColors","initialize","dispose","DisposableObject"],"mappings":"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","sourcesContent":["/**\r\n* DevExpress Dashboard (_dashboard-update-hub.js)\r\n* Version:  22.1.3\r\n* Build date: Jun 13, 2022\r\n* Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n* License: https://www.devexpress.com/Support/EULAs/universal.xml\r\n*/\r\n\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.DashboardUpdateHub = void 0;\nvar _default_1 = require(\"../../data/localization/_default\");\nvar _jquery_helpers_1 = require(\"../../data/_jquery-helpers\");\nvar _utils_1 = require(\"../../data/_utils\");\nvar model_1 = require(\"../../model\");\nvar disposable_object_1 = require(\"../../model/disposable-object\");\nvar data_dashboard_item_1 = require(\"../../model/items/data-dashboard-item\");\nvar filter_element_item_base_1 = require(\"../../model/items/filter-items/filter-element-item-base\");\nvar range_filter_item_1 = require(\"../../model/items/range-filter/range-filter-item\");\nvar _pane_content_holder_1 = require(\"../../model/items/_pane-content-holder\");\nvar _base_metadata_1 = require(\"../../model/metadata/_base-metadata\");\nvar notificator_1 = require(\"../notification-controller/notificator\");\nvar _dashboard_event_1 = require(\"./_dashboard-event\");\nvar _item_change_subscriber_1 = require(\"./_item-change-subscriber\");\nvar DashboardUpdateHub = (function (_super) {\n    __extends(DashboardUpdateHub, _super);\n    function DashboardUpdateHub(_dashboard, _dataRequestOptions, _callBacks, _requestVisibleItemsProvider) {\n        var _this = _super.call(this) || this;\n        _this._dashboard = _dashboard;\n        _this._dataRequestOptions = _dataRequestOptions;\n        _this._callBacks = _callBacks;\n        _this._requestVisibleItemsProvider = _requestVisibleItemsProvider;\n        _this._timer = 0;\n        _this._requestQueue = [];\n        _this.initializeItem = function (item) {\n            if (item instanceof data_dashboard_item_1.DataDashboardItem && !item._useNeutralFilterMode()) {\n                item._beforeMasterFilterSetByUserInteraction = function () {\n                    if (!_this._isUpdating() && !_this._suspendItem) {\n                        _this._suspendItem = item;\n                    }\n                };\n                item._afterMasterFilterSetByUserInteraction = function () {\n                    if (!_this._isUpdating() && _this._suspendItem === item) {\n                        _this._suspendItem = null;\n                    }\n                };\n                item._drillDownChangedByUserInteraction = function () {\n                    if (_this._suspendItem === item) {\n                        _this._suspendItem = null;\n                    }\n                };\n            }\n            item._getContentCategories().forEach(function (category) { return _this._itemChanged(item, category); });\n        };\n        _this.dataSourcePropertyChanged = new _dashboard_event_1.DashboardEvent();\n        _this.dashboardItemPropertyChanged = new _dashboard_event_1.DashboardEvent();\n        var itemSubscription = {\n            itemAdded: _this.initializeItem,\n            itemDeleted: function (item) {\n                if (item instanceof data_dashboard_item_1.DataDashboardItem) {\n                    item._beforeMasterFilterSetByUserInteraction = null;\n                }\n            },\n            itemChanged: function (item, category) {\n                if (item instanceof data_dashboard_item_1.DataDashboardItem && category !== _base_metadata_1.PropertyCategory.ViewModel) {\n                    item._limitDataState.reset();\n                    if (item instanceof model_1.GridItem)\n                        item._processClientFilterStateChanged(null);\n                }\n                _this._itemChanged(item, category);\n                _this.dashboardItemPropertyChanged.fire({ item: item, category: category });\n            }\n        };\n        _this.toDispose(new _item_change_subscriber_1.ItemsChangeSubscriber(_this._dashboard.items, itemSubscription));\n        _this.toDispose(new _item_change_subscriber_1.ItemsChangeSubscriber(_this._dashboard.groups, itemSubscription));\n        _this.toDispose(new _item_change_subscriber_1.ItemsChangeSubscriber(_this._dashboard._tabPages, itemSubscription));\n        _this.toDispose(new _item_change_subscriber_1.DataSourcesSubscriber(_this._dashboard.dataSources, function (args) {\n            var affectedItems = _this._dashboard._dataDashboardItems().filter(function (item) { return item.dataSource() === args.dataSource.componentName(); });\n            if (args.queryName) {\n                affectedItems = affectedItems.filter(function (item) { return item.dataMember() == args.queryName; });\n            }\n            if (args.fieldName) {\n                affectedItems = affectedItems.filter(function (item) { return !!item.dataItems().filter(function (dataItem) { return dataItem.dataMember() == args.fieldName; })[0]; });\n            }\n            affectedItems.forEach(function (item) { return _this._itemChanged(item, _base_metadata_1.PropertyCategory.Data); });\n            _this.dataSourcePropertyChanged.fire(args);\n        }));\n        _this.toDispose(_this._dashboard.currencyCultureName.subscribe(function (_) {\n            _this.reloadAllItems(_base_metadata_1.PropertyCategory.Data);\n        }));\n        _this.toDispose(_this._dashboard._queryParameters.subscribe(function (_) {\n            _this.reloadAllItems(_base_metadata_1.PropertyCategory.ClientState);\n        }));\n        _this.toDispose(new _item_change_subscriber_1.ColorSchemeSubscriber(_dashboard.colorScheme, function () {\n            _this.reloadGlobalColoredItems(_base_metadata_1.PropertyCategory.Data);\n        }));\n        if (_this._dataRequestOptions.itemDataRequestMode === 'BatchRequests') {\n            var itemsToRequest = {};\n            var performBatchRequest = _utils_1.debounce(function () {\n                var itemsToRequestCopy = __assign({}, itemsToRequest);\n                itemsToRequest = {};\n                _this._callBacks.getBatchItemData(Object.keys(itemsToRequestCopy).map(function (itemName) { return itemsToRequestCopy[itemName].itemModel; }))\n                    .done(function (result) {\n                    Object.keys(result).forEach(function (itemName) { return itemsToRequestCopy[itemName].deferred.resolve(result[itemName]); });\n                })\n                    .fail(function (result) {\n                    Object.keys(itemsToRequestCopy).forEach(function (itemName) { return itemsToRequestCopy[itemName].deferred.reject(result); });\n                });\n            }, 1);\n            _this._getItemData = function (item) {\n                var def = _jquery_helpers_1.createJQueryDeferred();\n                itemsToRequest[item.componentName()] = {\n                    itemModel: item,\n                    deferred: def\n                };\n                performBatchRequest();\n                return def.promise();\n            };\n        }\n        else {\n            _this._getItemData = function (item) { return _this._callBacks.getItemData(item); };\n        }\n        return _this;\n    }\n    DashboardUpdateHub.prototype._isUpdating = function () {\n        return !!this._requestQueue.length;\n    };\n    DashboardUpdateHub.prototype._dequeueRequest = function (queueItem) {\n        var _this = this;\n        var itemIndex = this._requestQueue.indexOf(queueItem);\n        if (itemIndex !== -1) {\n            this._requestQueue.splice(itemIndex, 1);\n            if (_pane_content_holder_1.getCategoryContentName(queueItem.category) === 'data') {\n                this.itemEndUpdate && this.itemEndUpdate(queueItem.item.componentName());\n            }\n            if (this._requestQueue.filter(function (item) { return _this.visibleItemsFilter(item); }).length === 0) {\n                this.dashboardEndUpdate && this.dashboardEndUpdate();\n                this._suspendItem = null;\n            }\n        }\n    };\n    DashboardUpdateHub.prototype._enqueueRequest = function (item, category) {\n        var _this = this;\n        var compatibleCategories = item._paneContentHolder.getCompatibleCategories(category);\n        if (!this._requestQueue.some(function (queueItem) { return queueItem.item === item && compatibleCategories.indexOf(queueItem.category) !== -1; })) {\n            this._requestQueue.push({ item: item, category: category });\n            if (this._requestQueue.filter(function (item) { return _this.visibleItemsFilter(item); }).length === 1) {\n                this.dashboardBeginUpdate && this.dashboardBeginUpdate();\n            }\n            if (_pane_content_holder_1.getCategoryContentName(category) === 'data') {\n                this.itemBeginUpdate && this.itemBeginUpdate(item.componentName());\n            }\n        }\n    };\n    DashboardUpdateHub.prototype._getDataRequestPriority = function (dashboardItem) {\n        if (dashboardItem instanceof filter_element_item_base_1.FilterElementItemBase || dashboardItem instanceof range_filter_item_1.RangeFilterItem) {\n            return 2;\n        }\n        else if (dashboardItem instanceof data_dashboard_item_1.DataDashboardItem && dashboardItem._masterFilterMode() === 'Single') {\n            return 1;\n        }\n        return 0;\n    };\n    DashboardUpdateHub.prototype._getRequestLockingMasterFilterItems = function (dashboardItem) {\n        if (dashboardItem instanceof data_dashboard_item_1.DataDashboardItem) {\n            return dashboardItem._masterFilterItems()\n                .filter(function (masterItem) {\n                if (masterItem instanceof range_filter_item_1.RangeFilterItem || masterItem._isSingleMasterFilter()) {\n                    return true;\n                }\n                else {\n                    return !masterItem._useNeutralFilterMode() && masterItem instanceof filter_element_item_base_1.FilterElementItemBase;\n                }\n            });\n        }\n        return [];\n    };\n    DashboardUpdateHub.prototype.visibleItemsFilter = function (queueItem) {\n        var _this = this;\n        if (this._dataRequestOptions.itemDataLoadingMode === 'OnDemand' && this._visibleItemsProvider && this._visibleItemsProvider.visibleItems().indexOf(queueItem.item) === -1) {\n            if (queueItem.item instanceof data_dashboard_item_1.DataDashboardItem) {\n                return this._visibleItemsProvider.visibleItems().some(function (visibleItem) {\n                    return _this._getRequestLockingMasterFilterItems(visibleItem).indexOf(queueItem.item) !== -1;\n                });\n            }\n            else {\n                return false;\n            }\n        }\n        return true;\n    };\n    DashboardUpdateHub.prototype._resolveItems = function () {\n        var _this = this;\n        this._requestQueue\n            .filter(function (queueItem) { return !queueItem.item._paneContentHolder.isWaitingForContent(queueItem.category); })\n            .sort(function (a, b) {\n            if (_this._visibleItemsProvider) {\n                var aNumber = _this._visibleItemsProvider.visibleItems().indexOf(a.item) !== -1 ? 1 : 0;\n                var bNumber = _this._visibleItemsProvider.visibleItems().indexOf(b.item) !== -1 ? 1 : 0;\n                return bNumber - aNumber;\n            }\n            else {\n                return 0;\n            }\n        })\n            .filter(function (queueItem) { return _this.visibleItemsFilter(queueItem); })\n            .filter(function (queueItem) {\n            if (queueItem.item instanceof data_dashboard_item_1.DataDashboardItem && queueItem.item.dataItems().length > 0) {\n                return _this._getRequestLockingMasterFilterItems(queueItem.item)\n                    .filter(function (masterItem) {\n                    var circularDependencyIndex = _this._getRequestLockingMasterFilterItems(masterItem)\n                        .indexOf(queueItem.item);\n                    if (circularDependencyIndex > -1) {\n                        var itemPriority = _this._getDataRequestPriority(queueItem.item);\n                        var masterItemPriority = _this._getDataRequestPriority(masterItem);\n                        if (itemPriority === masterItemPriority) {\n                            return _this._dashboard.items().indexOf(queueItem.item) > _this._dashboard.items().indexOf(masterItem);\n                        }\n                        else {\n                            return itemPriority < masterItemPriority;\n                        }\n                    }\n                    return true;\n                })\n                    .every(function (dependence) {\n                    return _this._requestQueue.filter(function (queueItem) { return queueItem.item === dependence; }).length === 0;\n                });\n            }\n            return true;\n        })\n            .forEach(function (queueItem) {\n            if (_this._dashboard.findItem(queueItem.item.componentName())) {\n                var category = queueItem.category;\n                queueItem.item._paneContentHolder.beginRequest(category);\n                if (queueItem.item._paneContentHolder.needRequestContentFromServer(category)) {\n                    _this._performServerRequest(queueItem.item, queueItem.category).done(function (result) {\n                        queueItem.item._paneContentHolder.endRequest({ response: result, category: category });\n                        if (queueItem.item._paneContentHolder.isValid(category)) {\n                            _this._dequeueRequest(queueItem);\n                        }\n                        _this._resolveItems();\n                        return result;\n                    }).fail(function (result) {\n                        var errorTitle = _default_1.getLocalizationById('DashboardWebStringId.Errors.AttemptToLoadData');\n                        var errorDetail = notificator_1.NotificationController._getDetailedErrorMessage(result);\n                        queueItem.item._errorState({ title: errorTitle, detail: errorDetail });\n                        queueItem.item._paneContentHolder.endRequest({ response: {}, category: category });\n                        _this._dequeueRequest(queueItem);\n                        _this._resolveItems();\n                    });\n                }\n                else {\n                    queueItem.item._paneContentHolder.endRequest({ response: {}, category: category });\n                    _this._dequeueRequest(queueItem);\n                }\n            }\n            else {\n                _this._dequeueRequest(queueItem);\n            }\n        });\n    };\n    DashboardUpdateHub.prototype._processItemChanged = function (dashboardItem, changeCategory) {\n        if (dashboardItem instanceof model_1.MapItem && changeCategory === _base_metadata_1.PropertyCategory.Map && dashboardItem._paneContentHolder.valid()) {\n            dashboardItem._isGeometryChangedCallback();\n        }\n        dashboardItem._paneContentHolder.itemChanged(changeCategory);\n        dashboardItem._errorState(null);\n        if (dashboardItem instanceof data_dashboard_item_1.DataDashboardItem) {\n            if (changeCategory === _base_metadata_1.PropertyCategory.Data || changeCategory === _base_metadata_1.PropertyCategory.Interactivity) {\n                dashboardItem._dataManager(null);\n                dashboardItem._clearInteractivityState();\n            }\n        }\n    };\n    DashboardUpdateHub.prototype._itemChanged = function (dashboardItem, changeCategory) {\n        var _this = this;\n        if (changeCategory === _base_metadata_1.PropertyCategory.ClientState && this._suspendItem === dashboardItem) {\n            return;\n        }\n        this._processItemChanged(dashboardItem, changeCategory);\n        this._enqueueRequest(dashboardItem, changeCategory);\n        if (dashboardItem instanceof data_dashboard_item_1.DataDashboardItem) {\n            if ((dashboardItem._isGloballyColored && changeCategory === _base_metadata_1.PropertyCategory.Data) || changeCategory === _base_metadata_1.PropertyCategory.Coloring) {\n                this._dashboard._dataDashboardItems()\n                    .filter(function (item) { return item._isGloballyColored; })\n                    .forEach(function (item) {\n                    _this._processItemChanged(dashboardItem, _base_metadata_1.PropertyCategory.Data);\n                    _this._enqueueRequest(item, _base_metadata_1.PropertyCategory.Data);\n                });\n            }\n        }\n        this._resolveItemsDeffered();\n    };\n    DashboardUpdateHub.prototype._resolveItemsDeffered = function () {\n        var _this = this;\n        clearTimeout(this._timer);\n        this._timer = window.setTimeout(function () {\n            _this._resolveItems();\n        }, 10);\n    };\n    DashboardUpdateHub.prototype._performServerRequest = function (item, category) {\n        var contentName = _pane_content_holder_1.getCategoryContentName(category);\n        switch (contentName) {\n            case 'data':\n                return this._getItemData(item);\n            case 'map':\n                return this._callBacks.getMapShapeFile(item);\n            default:\n                throw new Error();\n        }\n    };\n    DashboardUpdateHub.prototype.refreshItems = function (itemsNames) {\n        var _this = this;\n        this._dashboard._dataDashboardItems()\n            .filter(function (item) { return itemsNames.indexOf(item.componentName()) !== -1; })\n            .forEach(function (item) { _this._itemChanged(item, _base_metadata_1.PropertyCategory.ClientState); });\n    };\n    DashboardUpdateHub.prototype.reloadAllItems = function (caterory) {\n        var _this = this;\n        this._dashboard._dataDashboardItems().forEach(function (item) { _this._itemChanged(item, caterory); });\n    };\n    DashboardUpdateHub.prototype.reloadGlobalColoredItems = function (caterory) {\n        var _this = this;\n        this._dashboard._dataDashboardItems().filter(function (item) { return item.coloringOptions && item.coloringOptions.useGlobalColors(); }).forEach(function (item) { _this._itemChanged(item, caterory); });\n    };\n    DashboardUpdateHub.prototype.initialize = function () {\n        var _this = this;\n        if (this._requestVisibleItemsProvider) {\n            this._visibleItemsProvider = this._requestVisibleItemsProvider();\n        }\n        if (this._visibleItemsProvider) {\n            this.toDispose(this._visibleItemsProvider.visibleItems.subscribe(function (_) { return _this._resolveItemsDeffered(); }));\n        }\n        this._dashboard.items().forEach(this.initializeItem);\n        this._dashboard.groups().forEach(this.initializeItem);\n        this._dashboard._tabPages().forEach(this.initializeItem);\n    };\n    DashboardUpdateHub.prototype.dispose = function () {\n        clearTimeout(this._timer);\n        this._timer = null;\n        this._requestQueue.splice(0, this._requestQueue.length);\n        _super.prototype.dispose.call(this);\n    };\n    return DashboardUpdateHub;\n}(disposable_object_1.DisposableObject));\nexports.DashboardUpdateHub = DashboardUpdateHub;\n"]},"metadata":{},"sourceType":"script"}