{"ast":null,"code":"/**\r\n* DevExpress Dashboard (_data-item-container-collection-surface.js)\r\n* Version:  22.1.3\r\n* Build date: Jun 13, 2022\r\n* Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n* License: https://www.devexpress.com/Support/EULAs/universal.xml\r\n*/\n\"use strict\";\n\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.DataItemContainerCollectionSurface = void 0;\n\nvar ko = require(\"knockout\");\n\nvar _jquery_helpers_1 = require(\"../../../data/_jquery-helpers\");\n\nvar data_item_1 = require(\"../../../model/data-item/data-item\");\n\nvar dimension_1 = require(\"../../../model/data-item/dimension\");\n\nvar _data_field_1 = require(\"../../../model/data-sources/_data-field\");\n\nvar _undo_engine_helper_1 = require(\"../../../model/internal/_undo-engine-helper\");\n\nvar _binding_model_1 = require(\"../../../model/items/_binding-model\");\n\nvar _display_name_provider_1 = require(\"../../_display-name-provider\");\n\nvar _data_item_container_seed_1 = require(\"../binding-details/_data-item-container-seed\");\n\nvar _data_item_container_surface_1 = require(\"../binding-details/_data-item-container-surface\");\n\nvar DataItemContainerCollectionSurface = function () {\n  function DataItemContainerCollectionSurface(itemSurface, holder, sectionInfo, warning) {\n    var _this = this;\n\n    this.itemSurface = itemSurface;\n    this.holder = holder;\n    this.sectionInfo = sectionInfo;\n    this.warning = warning;\n    this._disposables = [];\n    this.supportGroups = true;\n\n    this.addDataItemContainerClick = function () {\n      var dataItemContainer = new _data_item_container_seed_1.DataItemContainerSeed(_this.itemSurface.dashboardItem, _this.sectionInfo.bindingProperty.dataItemType, _this.sectionInfo.bindingProperty.fieldConstraint);\n\n      _this.selectContainerSample(dataItemContainer);\n    };\n\n    this.selectContainerSample = function (dataItemContainer) {\n      _this.newContainerSample(dataItemContainer);\n\n      var newContainerSurface = new _data_item_container_surface_1.DataItemContainerSurface(dataItemContainer, _this.sectionInfo.detailsPropertiesComposer, _this.itemSurface, _this.removeDataItem);\n      newContainerSurface.dataFieldChoosed.add(function (dataField) {\n        _this._chooseDataField(dataField, newContainerSurface);\n      });\n\n      _this._disposables.push(newContainerSurface.containerType.subscribe(function (containerType) {\n        var newContainer = _this.sectionInfo.bindingProperty.creator(containerType);\n\n        _this.selectContainerSample(newContainer);\n      }));\n\n      _this.itemSurface.propertiesController.mainModel({\n        data: newContainerSurface,\n        containingCollection: _this.items\n      });\n    };\n\n    this.removeDataItem = function (container) {\n      _this._removeDataItem(container);\n    };\n\n    this.dataItemDisplayNameProvider = function (dataItem) {\n      return _display_name_provider_1.getDataItemDisplayName(_this.itemSurface._dataSourceBrowser, _this.itemSurface.dashboardItem, dataItem);\n    };\n\n    this.getDisplayName = function (object) {\n      return _display_name_provider_1.getDataItemContainerDisplayName(_this.itemSurface._dataSourceBrowser, _this.itemSurface.dashboardItem, object);\n    };\n\n    this.selectDataItemContainer = function (container) {\n      var surface = new _data_item_container_surface_1.DataItemContainerSurface(container, _this.sectionInfo.detailsPropertiesComposer, _this.itemSurface, _this.removeDataItem);\n      surface.dataFieldChoosed.add(function (dataField, link) {\n        if (link) {\n          var newContainer = _this.sectionInfo.bindingProperty.creator('', dataField);\n\n          var binding = newContainer._getBindingModel()[0];\n\n          newContainer[binding.propertyName].uniqueName(link.uniqueName());\n\n          var prevContainers = _this.items().filter(function (item) {\n            var bindingProperty = item[binding.propertyName];\n\n            if (!!bindingProperty) {\n              return bindingProperty.dataItem().groupIndex && bindingProperty.dataItem().groupIndex() === link.dataItem().groupIndex();\n            }\n\n            return false;\n          });\n\n          _this.items.splice(_this.items().indexOf(prevContainers[prevContainers.length - 1]) + 1, 0, newContainer);\n        }\n      });\n\n      _this._disposables.push(surface.containerType.subscribe(function (containerType) {\n        _this._processChangeContainerType(containerType, container, surface);\n      }));\n\n      _this.itemSurface.propertiesController.mainModel({\n        data: surface,\n        containingCollection: _this.items\n      });\n    };\n\n    this.newContainerSample = ko.observable();\n    this.template = 'dx-dashboard-data-item-container-collection';\n    this.groups = ko.computed(function () {\n      var result = [],\n          position = 0;\n\n      _this.items().forEach(function (dataItemContainer) {\n        var dataItem = dataItemContainer[dataItemContainer._getBindingModel()[0].propertyName].dataItem();\n\n        if (dataItem instanceof dimension_1.Dimension && _data_field_1.IsOlapHierarchyField(dataItem)) {\n          var dimension = dataItem;\n          var group = result.filter(function (group) {\n            return group.groupIndex === dimension.groupIndex();\n          })[0];\n\n          if (!group) {\n            group = {\n              groupIndex: dimension.groupIndex(),\n              items: [],\n              position: position++\n            };\n            result.push(group);\n          }\n\n          group.items.push(dataItemContainer);\n        } else {\n          result.push({\n            groupIndex: undefined,\n            items: [dataItemContainer],\n            position: position++\n          });\n        }\n      });\n\n      return result;\n    });\n\n    this._disposables.push(this.groups);\n  }\n\n  Object.defineProperty(DataItemContainerCollectionSurface.prototype, \"items\", {\n    get: function () {\n      return this.holder[this.sectionInfo.bindingProperty.propertyName];\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  DataItemContainerCollectionSurface.prototype._chooseDataField = function (dataField, newContainerSurface) {\n    var containerModel = [newContainerSurface.model()];\n\n    if (containerModel[0] instanceof _data_item_container_seed_1.DataItemContainerSeed) {\n      containerModel = containerModel[0].grow(this.itemSurface.dashboardItem, this.sectionInfo.bindingProperty, dataField);\n    }\n\n    this.items.push.apply(this.items, containerModel);\n    this.newContainerSample(undefined);\n    this.selectDataItemContainer(containerModel[0]);\n  };\n\n  DataItemContainerCollectionSurface.prototype._removeDataItem = function (container) {\n    var _this = this;\n\n    this.groups().forEach(function (group) {\n      if (!!group.items.filter(function (item) {\n        return item === container;\n      })[0]) {\n        group.items.forEach(function (item) {\n          _this.items.remove(item);\n\n          item._getBindingModel().forEach(function (binding) {\n            var dataItem = item[binding.propertyName].dataItem();\n\n            if (!!dataItem) {\n              _this.itemSurface.dashboardItem._removeDataItem(dataItem, true);\n            }\n          });\n        });\n      }\n    });\n  };\n\n  DataItemContainerCollectionSurface.prototype._processChangeContainer = function (newContainer, transfers, container, surface) {\n    var _this = this;\n\n    var position = this.items().indexOf(surface.model());\n    transfers.forEach(function (transfer) {\n      var link = newContainer[transfer.newBinding.propertyName];\n\n      _this.itemSurface.dashboardItem._updateDataItem(transfer.dataItem, transfer.newBinding, transfer.dataField, link._specifics.acceptableShapingType);\n\n      link.uniqueName(transfer.dataItem.uniqueName());\n\n      _this.items.splice(position, 1, newContainer);\n\n      link.dataItem().grabFrom(transfer.dataItem);\n    });\n    this.selectDataItemContainer(newContainer);\n  };\n\n  DataItemContainerCollectionSurface.prototype.getCompatibleTransfers = function (container, newContainer) {\n    var _this = this;\n\n    if (_binding_model_1._areTheSameBindingProviders(container, newContainer)) {\n      return newContainer._getBindingModel().map(function (binding) {\n        var filledBinding = container._getBindingModel().filter(function (b) {\n          return b.propertyName === binding.propertyName;\n        })[0];\n\n        if (!filledBinding) return;\n\n        if (!container[filledBinding.propertyName].uniqueName()) {\n          return;\n        }\n\n        var dataItem = container[filledBinding.propertyName].dataItem();\n        var transferInfo = {\n          filledBinding: filledBinding,\n          dataItem: dataItem,\n          newBinding: binding,\n          dataField: null,\n          promise: _this.itemSurface._dataSourceBrowser.findDataField(_this.itemSurface.dashboardItem.dataSource(), _this.itemSurface.dashboardItem.dataMember(), dataItem.dataMember())\n        };\n        transferInfo.promise.done(function (field) {\n          transferInfo.dataField = field;\n        });\n        return transferInfo;\n      }).filter(function (t) {\n        return !!t;\n      });\n    }\n\n    return [];\n  };\n\n  DataItemContainerCollectionSurface.prototype._processChangeContainerType = function (containerType, container, surface) {\n    var _this = this;\n\n    var newContainer = this.sectionInfo.bindingProperty.creator(containerType);\n\n    if (!!newContainer.grabFrom) {\n      newContainer.grabFrom(container);\n    }\n\n    var transfers = this.getCompatibleTransfers(container, newContainer);\n\n    if (transfers.length === 0) {\n      var filledBinding = container._getBindingModel().filter(function (b) {\n        return !!container[b.propertyName].uniqueName();\n      })[0];\n\n      var dataItem = container[filledBinding.propertyName].dataItem();\n\n      var binding = newContainer._getBindingModel()[0];\n\n      var transferInfo_1 = {\n        filledBinding: filledBinding,\n        dataItem: dataItem,\n        newBinding: binding,\n        dataField: null,\n        promise: this.itemSurface._dataSourceBrowser.findDataField(this.itemSurface.dashboardItem.dataSource(), this.itemSurface.dashboardItem.dataMember(), dataItem.dataMember())\n      };\n      transferInfo_1.promise.done(function (field) {\n        transferInfo_1.dataField = field;\n      });\n      transfers.push(transferInfo_1);\n    }\n\n    _jquery_helpers_1.jqueryWhenArray(transfers.map(function (t) {\n      return t.promise;\n    })).done(function () {\n      return _this._processChangeContainer(newContainer, transfers, container, surface);\n    });\n  };\n\n  DataItemContainerCollectionSurface.prototype.relocateItem = function (item, placeholderIndex) {\n    var _this = this;\n\n    var dataItem;\n\n    if (item instanceof data_item_1.DataItemLink) {\n      dataItem = item.dataItem();\n    } else if (item['_getBindingModel']) {\n      this.items.splice(placeholderIndex, 0, item);\n      return;\n    }\n\n    this.itemSurface._dataSourceBrowser.findDataField(this.itemSurface.dashboardItem.dataSource(), this.itemSurface.dashboardItem.dataMember(), dataItem.dataMember()).done(function (dataField) {\n      var newContainer = _this.sectionInfo.bindingProperty.creator(undefined, dataField, dataItem);\n\n      var binding = newContainer._getBindingModel()[0];\n\n      var link = newContainer[binding.propertyName];\n\n      _this.itemSurface.dashboardItem._updateDataItem(dataItem, binding, dataField, link._specifics.acceptableShapingType);\n\n      link.uniqueName(dataItem.uniqueName());\n      link.dataItem().grabFrom(dataItem);\n\n      _this.items.splice(placeholderIndex, 0, newContainer);\n    });\n  };\n\n  DataItemContainerCollectionSurface.prototype.isOlap = function () {\n    var filledLink = this.items().reduce(function (links, container) {\n      return links.concat(container._getBindingModel().map(function (bm) {\n        return container[bm.propertyName];\n      }));\n    }, []).filter(function (dil) {\n      return dil.dataItem();\n    })[0];\n    return _data_field_1.DataField.isOlap(filledLink.dataItem().dataMember());\n  };\n\n  DataItemContainerCollectionSurface.prototype.errorFactory = function (container) {\n    var _this = this;\n\n    var errorState = ko.observable(false);\n    var fieldPromises = [];\n\n    container._getBindingModel().filter(function (binding) {\n      return container[binding.propertyName].dataItem();\n    }).forEach(function (binding) {\n      fieldPromises.push(_this.itemSurface._dataSourceBrowser.findDataField(_this.itemSurface.dashboardItem.dataSource(), _this.itemSurface.dashboardItem.dataMember(), container[binding.propertyName].dataItem().dataMember()));\n    });\n\n    var isCorruptedDataField = function (field) {\n      return !field || field.isCorruptedCalcField && field.isCorruptedCalcField();\n    };\n\n    _jquery_helpers_1.jqueryWhenArray(fieldPromises).done(function () {\n      var fields = [];\n\n      for (var _i = 0; _i < arguments.length; _i++) {\n        fields[_i] = arguments[_i];\n      }\n\n      errorState(fields.filter(function (f) {\n        return isCorruptedDataField(f);\n      }).length > 0);\n    });\n\n    return errorState;\n  };\n\n  DataItemContainerCollectionSurface.prototype.dispose = function () {\n    this._disposables.forEach(function (d) {\n      d.dispose();\n    });\n  };\n\n  __decorate([_undo_engine_helper_1.wrapWithUndoRedo], DataItemContainerCollectionSurface.prototype, \"_chooseDataField\", null);\n\n  __decorate([_undo_engine_helper_1.wrapWithUndoRedo], DataItemContainerCollectionSurface.prototype, \"_removeDataItem\", null);\n\n  __decorate([_undo_engine_helper_1.wrapWithUndoRedo], DataItemContainerCollectionSurface.prototype, \"_processChangeContainer\", null);\n\n  __decorate([_undo_engine_helper_1.wrapWithUndoRedo], DataItemContainerCollectionSurface.prototype, \"relocateItem\", null);\n\n  return DataItemContainerCollectionSurface;\n}();\n\nexports.DataItemContainerCollectionSurface = DataItemContainerCollectionSurface;","map":{"version":3,"sources":["/Users/krunalpatel/Downloads/React-Firebase-Auth-master 3/node_modules/devexpress-dashboard/designer/items/sections/_data-item-container-collection-surface.js"],"names":["__decorate","decorators","target","key","desc","c","arguments","length","r","Object","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","exports","value","DataItemContainerCollectionSurface","ko","require","_jquery_helpers_1","data_item_1","dimension_1","_data_field_1","_undo_engine_helper_1","_binding_model_1","_display_name_provider_1","_data_item_container_seed_1","_data_item_container_surface_1","itemSurface","holder","sectionInfo","warning","_this","_disposables","supportGroups","addDataItemContainerClick","dataItemContainer","DataItemContainerSeed","dashboardItem","bindingProperty","dataItemType","fieldConstraint","selectContainerSample","newContainerSample","newContainerSurface","DataItemContainerSurface","detailsPropertiesComposer","removeDataItem","dataFieldChoosed","add","dataField","_chooseDataField","push","containerType","subscribe","newContainer","creator","propertiesController","mainModel","data","containingCollection","items","container","_removeDataItem","dataItemDisplayNameProvider","dataItem","getDataItemDisplayName","_dataSourceBrowser","getDisplayName","object","getDataItemContainerDisplayName","selectDataItemContainer","surface","link","binding","_getBindingModel","propertyName","uniqueName","prevContainers","filter","item","groupIndex","splice","indexOf","_processChangeContainerType","observable","template","groups","computed","result","position","forEach","Dimension","IsOlapHierarchyField","dimension","group","undefined","prototype","get","enumerable","configurable","containerModel","model","grow","apply","remove","_processChangeContainer","transfers","transfer","newBinding","_updateDataItem","_specifics","acceptableShapingType","grabFrom","getCompatibleTransfers","_areTheSameBindingProviders","map","filledBinding","b","transferInfo","promise","findDataField","dataSource","dataMember","done","field","t","transferInfo_1","jqueryWhenArray","relocateItem","placeholderIndex","DataItemLink","isOlap","filledLink","reduce","links","concat","bm","dil","DataField","errorFactory","errorState","fieldPromises","isCorruptedDataField","isCorruptedCalcField","fields","_i","f","dispose","wrapWithUndoRedo"],"mappings":"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","sourcesContent":["/**\r\n* DevExpress Dashboard (_data-item-container-collection-surface.js)\r\n* Version:  22.1.3\r\n* Build date: Jun 13, 2022\r\n* Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n* License: https://www.devexpress.com/Support/EULAs/universal.xml\r\n*/\r\n\"use strict\";\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.DataItemContainerCollectionSurface = void 0;\nvar ko = require(\"knockout\");\nvar _jquery_helpers_1 = require(\"../../../data/_jquery-helpers\");\nvar data_item_1 = require(\"../../../model/data-item/data-item\");\nvar dimension_1 = require(\"../../../model/data-item/dimension\");\nvar _data_field_1 = require(\"../../../model/data-sources/_data-field\");\nvar _undo_engine_helper_1 = require(\"../../../model/internal/_undo-engine-helper\");\nvar _binding_model_1 = require(\"../../../model/items/_binding-model\");\nvar _display_name_provider_1 = require(\"../../_display-name-provider\");\nvar _data_item_container_seed_1 = require(\"../binding-details/_data-item-container-seed\");\nvar _data_item_container_surface_1 = require(\"../binding-details/_data-item-container-surface\");\nvar DataItemContainerCollectionSurface = (function () {\n    function DataItemContainerCollectionSurface(itemSurface, holder, sectionInfo, warning) {\n        var _this = this;\n        this.itemSurface = itemSurface;\n        this.holder = holder;\n        this.sectionInfo = sectionInfo;\n        this.warning = warning;\n        this._disposables = [];\n        this.supportGroups = true;\n        this.addDataItemContainerClick = function () {\n            var dataItemContainer = new _data_item_container_seed_1.DataItemContainerSeed(_this.itemSurface.dashboardItem, _this.sectionInfo.bindingProperty.dataItemType, _this.sectionInfo.bindingProperty.fieldConstraint);\n            _this.selectContainerSample(dataItemContainer);\n        };\n        this.selectContainerSample = function (dataItemContainer) {\n            _this.newContainerSample(dataItemContainer);\n            var newContainerSurface = new _data_item_container_surface_1.DataItemContainerSurface(dataItemContainer, _this.sectionInfo.detailsPropertiesComposer, _this.itemSurface, _this.removeDataItem);\n            newContainerSurface.dataFieldChoosed.add(function (dataField) {\n                _this._chooseDataField(dataField, newContainerSurface);\n            });\n            _this._disposables.push(newContainerSurface.containerType.subscribe(function (containerType) {\n                var newContainer = _this.sectionInfo.bindingProperty.creator(containerType);\n                _this.selectContainerSample(newContainer);\n            }));\n            _this.itemSurface.propertiesController.mainModel({\n                data: newContainerSurface,\n                containingCollection: _this.items\n            });\n        };\n        this.removeDataItem = function (container) {\n            _this._removeDataItem(container);\n        };\n        this.dataItemDisplayNameProvider = function (dataItem) {\n            return _display_name_provider_1.getDataItemDisplayName(_this.itemSurface._dataSourceBrowser, _this.itemSurface.dashboardItem, dataItem);\n        };\n        this.getDisplayName = function (object) {\n            return _display_name_provider_1.getDataItemContainerDisplayName(_this.itemSurface._dataSourceBrowser, _this.itemSurface.dashboardItem, object);\n        };\n        this.selectDataItemContainer = function (container) {\n            var surface = new _data_item_container_surface_1.DataItemContainerSurface(container, _this.sectionInfo.detailsPropertiesComposer, _this.itemSurface, _this.removeDataItem);\n            surface.dataFieldChoosed.add(function (dataField, link) {\n                if (link) {\n                    var newContainer = _this.sectionInfo.bindingProperty.creator('', dataField);\n                    var binding = newContainer._getBindingModel()[0];\n                    newContainer[binding.propertyName].uniqueName(link.uniqueName());\n                    var prevContainers = _this.items().filter(function (item) {\n                        var bindingProperty = item[binding.propertyName];\n                        if (!!bindingProperty) {\n                            return bindingProperty.dataItem().groupIndex && bindingProperty.dataItem().groupIndex() === link.dataItem().groupIndex();\n                        }\n                        return false;\n                    });\n                    _this.items.splice(_this.items().indexOf(prevContainers[prevContainers.length - 1]) + 1, 0, newContainer);\n                }\n            });\n            _this._disposables.push(surface.containerType.subscribe(function (containerType) {\n                _this._processChangeContainerType(containerType, container, surface);\n            }));\n            _this.itemSurface.propertiesController.mainModel({\n                data: surface,\n                containingCollection: _this.items\n            });\n        };\n        this.newContainerSample = ko.observable();\n        this.template = 'dx-dashboard-data-item-container-collection';\n        this.groups = ko.computed(function () {\n            var result = [], position = 0;\n            _this.items().forEach(function (dataItemContainer) {\n                var dataItem = dataItemContainer[dataItemContainer._getBindingModel()[0].propertyName].dataItem();\n                if (dataItem instanceof dimension_1.Dimension && _data_field_1.IsOlapHierarchyField(dataItem)) {\n                    var dimension = dataItem;\n                    var group = result.filter(function (group) { return group.groupIndex === dimension.groupIndex(); })[0];\n                    if (!group) {\n                        group = {\n                            groupIndex: dimension.groupIndex(),\n                            items: [],\n                            position: position++\n                        };\n                        result.push(group);\n                    }\n                    group.items.push(dataItemContainer);\n                }\n                else {\n                    result.push({\n                        groupIndex: undefined,\n                        items: [dataItemContainer],\n                        position: position++\n                    });\n                }\n            });\n            return result;\n        });\n        this._disposables.push(this.groups);\n    }\n    Object.defineProperty(DataItemContainerCollectionSurface.prototype, \"items\", {\n        get: function () {\n            return this.holder[this.sectionInfo.bindingProperty.propertyName];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    DataItemContainerCollectionSurface.prototype._chooseDataField = function (dataField, newContainerSurface) {\n        var containerModel = [newContainerSurface.model()];\n        if (containerModel[0] instanceof _data_item_container_seed_1.DataItemContainerSeed) {\n            containerModel = containerModel[0].grow(this.itemSurface.dashboardItem, this.sectionInfo.bindingProperty, dataField);\n        }\n        this.items.push.apply(this.items, containerModel);\n        this.newContainerSample(undefined);\n        this.selectDataItemContainer(containerModel[0]);\n    };\n    DataItemContainerCollectionSurface.prototype._removeDataItem = function (container) {\n        var _this = this;\n        this.groups().forEach(function (group) {\n            if (!!group.items.filter(function (item) { return item === container; })[0]) {\n                group.items.forEach(function (item) {\n                    _this.items.remove(item);\n                    item._getBindingModel().forEach(function (binding) {\n                        var dataItem = item[binding.propertyName].dataItem();\n                        if (!!dataItem) {\n                            _this.itemSurface.dashboardItem._removeDataItem(dataItem, true);\n                        }\n                    });\n                });\n            }\n        });\n    };\n    DataItemContainerCollectionSurface.prototype._processChangeContainer = function (newContainer, transfers, container, surface) {\n        var _this = this;\n        var position = this.items().indexOf(surface.model());\n        transfers.forEach(function (transfer) {\n            var link = newContainer[transfer.newBinding.propertyName];\n            _this.itemSurface.dashboardItem._updateDataItem(transfer.dataItem, transfer.newBinding, transfer.dataField, link._specifics.acceptableShapingType);\n            link.uniqueName(transfer.dataItem.uniqueName());\n            _this.items.splice(position, 1, newContainer);\n            link.dataItem().grabFrom(transfer.dataItem);\n        });\n        this.selectDataItemContainer(newContainer);\n    };\n    DataItemContainerCollectionSurface.prototype.getCompatibleTransfers = function (container, newContainer) {\n        var _this = this;\n        if (_binding_model_1._areTheSameBindingProviders(container, newContainer)) {\n            return newContainer\n                ._getBindingModel()\n                .map(function (binding) {\n                var filledBinding = container._getBindingModel().filter(function (b) { return b.propertyName === binding.propertyName; })[0];\n                if (!filledBinding)\n                    return;\n                if (!container[filledBinding.propertyName].uniqueName()) {\n                    return;\n                }\n                var dataItem = container[filledBinding.propertyName].dataItem();\n                var transferInfo = {\n                    filledBinding: filledBinding,\n                    dataItem: dataItem,\n                    newBinding: binding,\n                    dataField: null,\n                    promise: _this.itemSurface._dataSourceBrowser.findDataField(_this.itemSurface.dashboardItem.dataSource(), _this.itemSurface.dashboardItem.dataMember(), dataItem.dataMember())\n                };\n                transferInfo.promise.done(function (field) {\n                    transferInfo.dataField = field;\n                });\n                return transferInfo;\n            })\n                .filter(function (t) { return !!t; });\n        }\n        return [];\n    };\n    DataItemContainerCollectionSurface.prototype._processChangeContainerType = function (containerType, container, surface) {\n        var _this = this;\n        var newContainer = this.sectionInfo.bindingProperty.creator(containerType);\n        if (!!newContainer.grabFrom) {\n            newContainer.grabFrom(container);\n        }\n        var transfers = this.getCompatibleTransfers(container, newContainer);\n        if (transfers.length === 0) {\n            var filledBinding = container._getBindingModel().filter(function (b) { return !!container[b.propertyName].uniqueName(); })[0];\n            var dataItem = container[filledBinding.propertyName].dataItem();\n            var binding = newContainer._getBindingModel()[0];\n            var transferInfo_1 = {\n                filledBinding: filledBinding,\n                dataItem: dataItem,\n                newBinding: binding,\n                dataField: null,\n                promise: this.itemSurface._dataSourceBrowser.findDataField(this.itemSurface.dashboardItem.dataSource(), this.itemSurface.dashboardItem.dataMember(), dataItem.dataMember())\n            };\n            transferInfo_1.promise.done(function (field) {\n                transferInfo_1.dataField = field;\n            });\n            transfers.push(transferInfo_1);\n        }\n        _jquery_helpers_1.jqueryWhenArray(transfers.map(function (t) { return t.promise; })).done(function () { return _this._processChangeContainer(newContainer, transfers, container, surface); });\n    };\n    DataItemContainerCollectionSurface.prototype.relocateItem = function (item, placeholderIndex) {\n        var _this = this;\n        var dataItem;\n        if (item instanceof data_item_1.DataItemLink) {\n            dataItem = item.dataItem();\n        }\n        else if (item['_getBindingModel']) {\n            this.items.splice(placeholderIndex, 0, item);\n            return;\n        }\n        this.itemSurface\n            ._dataSourceBrowser.findDataField(this.itemSurface.dashboardItem.dataSource(), this.itemSurface.dashboardItem.dataMember(), dataItem.dataMember())\n            .done(function (dataField) {\n            var newContainer = _this.sectionInfo.bindingProperty.creator(undefined, dataField, dataItem);\n            var binding = newContainer._getBindingModel()[0];\n            var link = newContainer[binding.propertyName];\n            _this.itemSurface.dashboardItem._updateDataItem(dataItem, binding, dataField, link._specifics.acceptableShapingType);\n            link.uniqueName(dataItem.uniqueName());\n            link.dataItem().grabFrom(dataItem);\n            _this.items.splice(placeholderIndex, 0, newContainer);\n        });\n    };\n    DataItemContainerCollectionSurface.prototype.isOlap = function () {\n        var filledLink = this\n            .items()\n            .reduce(function (links, container) { return links.concat(container._getBindingModel().map(function (bm) { return container[bm.propertyName]; })); }, [])\n            .filter(function (dil) { return dil.dataItem(); })[0];\n        return _data_field_1.DataField.isOlap(filledLink.dataItem().dataMember());\n    };\n    DataItemContainerCollectionSurface.prototype.errorFactory = function (container) {\n        var _this = this;\n        var errorState = ko.observable(false);\n        var fieldPromises = [];\n        container\n            ._getBindingModel()\n            .filter(function (binding) { return container[binding.propertyName].dataItem(); })\n            .forEach(function (binding) {\n            fieldPromises.push(_this.itemSurface._dataSourceBrowser.findDataField(_this.itemSurface.dashboardItem.dataSource(), _this.itemSurface.dashboardItem.dataMember(), container[binding.propertyName].dataItem().dataMember()));\n        });\n        var isCorruptedDataField = function (field) { return !field || field.isCorruptedCalcField && field.isCorruptedCalcField(); };\n        _jquery_helpers_1.jqueryWhenArray(fieldPromises).done(function () {\n            var fields = [];\n            for (var _i = 0; _i < arguments.length; _i++) {\n                fields[_i] = arguments[_i];\n            }\n            errorState(fields.filter(function (f) { return isCorruptedDataField(f); }).length > 0);\n        });\n        return errorState;\n    };\n    DataItemContainerCollectionSurface.prototype.dispose = function () {\n        this._disposables.forEach(function (d) {\n            d.dispose();\n        });\n    };\n    __decorate([\n        _undo_engine_helper_1.wrapWithUndoRedo\n    ], DataItemContainerCollectionSurface.prototype, \"_chooseDataField\", null);\n    __decorate([\n        _undo_engine_helper_1.wrapWithUndoRedo\n    ], DataItemContainerCollectionSurface.prototype, \"_removeDataItem\", null);\n    __decorate([\n        _undo_engine_helper_1.wrapWithUndoRedo\n    ], DataItemContainerCollectionSurface.prototype, \"_processChangeContainer\", null);\n    __decorate([\n        _undo_engine_helper_1.wrapWithUndoRedo\n    ], DataItemContainerCollectionSurface.prototype, \"relocateItem\", null);\n    return DataItemContainerCollectionSurface;\n}());\nexports.DataItemContainerCollectionSurface = DataItemContainerCollectionSurface;\n"]},"metadata":{},"sourceType":"script"}