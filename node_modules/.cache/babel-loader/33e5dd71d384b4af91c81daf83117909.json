{"ast":null,"code":"/**\n* DevExpress Analytics (undo-engine\\undoengine.js)\n* Version:  22.1.3\n* Build date: Jun 14, 2022\n* Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\n* License: https://www.devexpress.com/Support/EULAs/universal.xml\n*/\n\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.UndoEngine = exports._LatestChangeSet = void 0;\n\nvar ko = require(\"knockout\");\n\nvar utils_1 = require(\"../serializer/utils\");\n\nvar _utils_1 = require(\"./_utils\");\n\nvar _LatestChangeSet = function () {\n  function _LatestChangeSet(changes, position) {\n    this.changes = changes;\n    this.position = position;\n  }\n\n  _LatestChangeSet.Empty = function () {\n    return new _LatestChangeSet(null, null);\n  };\n\n  _LatestChangeSet.prototype.equal = function (changeSet) {\n    return this.changes === changeSet.changes && this.position === changeSet.position;\n  };\n\n  return _LatestChangeSet;\n}();\n\nexports._LatestChangeSet = _LatestChangeSet;\nvar activeEngines = [];\n\nvar UndoEngine = function (_super) {\n  __extends(UndoEngine, _super);\n\n  function UndoEngine(target, _ignoredProperties, _getInfoMethodName, _alwaysSubscribeProperties) {\n    if (_ignoredProperties === void 0) {\n      _ignoredProperties = ['surface'];\n    }\n\n    if (_alwaysSubscribeProperties === void 0) {\n      _alwaysSubscribeProperties = [];\n    }\n\n    var _this = _super.call(this) || this;\n\n    _this._ignoredProperties = _ignoredProperties;\n    _this._getInfoMethodName = _getInfoMethodName;\n    _this._alwaysSubscribeProperties = _alwaysSubscribeProperties;\n    _this._groupObservers = [];\n    _this._groupPosition = -1;\n    _this._observers = [];\n    _this._subscriptions = [];\n    _this._visited = [];\n    _this._position = ko.observable(-1);\n    _this._lockedPosition = ko.observable(-1);\n    _this._inUndoRedo = false;\n    _this._currentEngineName = UndoEngine._disposeUndoEngineSubscriptionsName + _utils_1.guid();\n    _this.redoEnabled = ko.observable(false);\n    _this.undoEnabled = ko.observable(false);\n    _this.isIngroup = -1;\n    _this.isDirty = ko.computed({\n      read: function () {\n        return _this._position() !== _this._lockedPosition();\n      },\n      write: function (value) {\n        value ? _this._lockedPosition('forcibly marked as dirty') : _this._lockedPosition(_this._position());\n      }\n    });\n    activeEngines.push(_this._currentEngineName);\n    _this._model = ko.unwrap(target);\n\n    if (_this._getInfoMethodName) {\n      if (ko.isSubscribable(target)) {\n        _this._targetSubscription = _this.subscribeProperty(target, true);\n      } else {\n        _this._createDisposeFunction(target);\n      }\n    } else {\n      var innerSubscriptions = _this.subscribe(_this._model);\n\n      if (ko.isSubscribable(target)) {\n        var prevVal = target();\n        _this._targetSubscription = target.subscribe(function (newTargetValue) {\n          _this._removePropertiesSubscriptions();\n\n          if (!_this._inUndoRedo) {\n            _this.properyChanged({\n              observable: target,\n              propertyChanged: {\n                oldVal: prevVal,\n                val: newTargetValue\n              }\n            });\n\n            prevVal = newTargetValue;\n          }\n\n          _this._cleanSubscribtions(innerSubscriptions);\n\n          _this._model = newTargetValue;\n          innerSubscriptions = _this.subscribe(_this._model);\n        });\n      }\n    }\n\n    _this._disposables.push(_this.isDirty);\n\n    return _this;\n  }\n\n  UndoEngine.tryGetUndoEngine = function (object) {\n    var undo = null;\n    activeEngines.some(function (x) {\n      undo = object[x] && object[x].instance;\n      return !!undo;\n    });\n    return undo;\n  };\n\n  Object.defineProperty(UndoEngine.prototype, \"_modelReady\", {\n    get: function () {\n      return _utils_1.checkModelReady(this._model);\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  UndoEngine.prototype._disposeObserver = function (record) {\n    var _this = this;\n\n    if (record.propertyChanged) {\n      var value = record.propertyChanged.val;\n\n      if (value && !value[this._currentEngineName]) {\n        value.dispose && value.dispose();\n      }\n    } else if (record.arrayChanges) {\n      record.arrayChanges.forEach(function (change) {\n        if (change.status === 'added') {\n          var value = change.value;\n          if (value && !value[_this._currentEngineName]) value.dispose && value.dispose();\n        }\n      });\n    }\n  };\n\n  UndoEngine.prototype.properyChanged = function (undoRecord) {\n    var _this = this;\n\n    if (this._inUndoRedo) {\n      return;\n    }\n\n    var currentPosition = this._position() + 1;\n\n    if (currentPosition < this._observers.length) {\n      var removedItems = this._observers.splice(currentPosition, this._observers.length);\n\n      removedItems.forEach(function (changeSet) {\n        if (Array.isArray(changeSet)) {\n          changeSet.reverse().forEach(function (item) {\n            return _this._disposeObserver(item);\n          });\n        } else {\n          _this._disposeObserver(changeSet);\n        }\n      });\n    }\n\n    this._observers.push(undoRecord);\n\n    this._position(currentPosition);\n\n    this.undoEnabled(true);\n    this.redoEnabled(false);\n  };\n\n  UndoEngine.prototype.visitProperties = function (target, info) {\n    var subscribtions = [];\n\n    if (target && info) {\n      for (var i = 0; i < info.length; i++) {\n        var alwaysSubscribeProperty = this._alwaysSubscribeProperties.some(function (x) {\n          return x === info[i].propertyName;\n        });\n\n        if (info[i].modelName || info[i].editor || info[i].info || alwaysSubscribeProperty) {\n          var realPropertyName = alwaysSubscribeProperty ? info[i].propertyName : this.validatePropertyName(target, info[i].propertyName);\n\n          if (realPropertyName) {\n            if (!ko.isComputed(target[realPropertyName])) {\n              if (!ko.isObservable(target[realPropertyName])) {\n                subscribtions.push.apply([], this._createDisposeFunction(target[realPropertyName], info[i].info));\n              } else {\n                subscribtions.push(this.subscribeProperty(target[realPropertyName], !info[i].link));\n              }\n            }\n          }\n        }\n      }\n    }\n\n    return subscribtions;\n  };\n\n  UndoEngine.prototype.undoChangeSet = function (changeSet) {\n    if (changeSet.propertyChanged) {\n      changeSet.observable(changeSet.propertyChanged.oldVal);\n    } else {\n      var array = changeSet.observable();\n\n      for (var i = 0; i < changeSet.arrayChanges.length; i++) {\n        if (changeSet.arrayChanges[i].status === 'added') {\n          array.splice(array.indexOf(changeSet.arrayChanges[i].value), 1);\n        }\n      }\n\n      for (var i = 0; i < changeSet.arrayChanges.length; i++) {\n        if (changeSet.arrayChanges[i].status === 'deleted') {\n          array.splice(changeSet.arrayChanges[i].index, 0, changeSet.arrayChanges[i].value);\n        }\n      }\n\n      if (ko.isObservable(changeSet.observable)) {\n        changeSet.observable.valueHasMutated();\n      }\n    }\n  };\n\n  UndoEngine.prototype.redoChangeSet = function (changeSet) {\n    if (changeSet.propertyChanged) {\n      changeSet.observable(changeSet.propertyChanged.val);\n    } else {\n      var array = changeSet.observable();\n\n      for (var i = 0; i < changeSet.arrayChanges.length; i++) {\n        if (changeSet.arrayChanges[i].status === 'deleted') {\n          array.splice(array.indexOf(changeSet.arrayChanges[i].value), 1);\n        }\n      }\n\n      for (var i = 0; i < changeSet.arrayChanges.length; i++) {\n        if (changeSet.arrayChanges[i].status === 'added') {\n          array.splice(changeSet.arrayChanges[i].index, 0, changeSet.arrayChanges[i].value);\n        }\n      }\n\n      if (ko.isObservable(changeSet.observable)) {\n        changeSet.observable.valueHasMutated();\n      }\n    }\n  };\n\n  UndoEngine.prototype._disposeChilds = function (target, info) {\n    if (target && info) {\n      for (var i = 0; i < info.length; i++) {\n        if (info[i].modelName || info[i].editor || info[i].info) {\n          var propertyName = info[i].propertyName;\n\n          if (propertyName.indexOf('_') !== 0) {\n            var realPropertyName = propertyName;\n\n            if (ko.isWritableObservable(target['_' + propertyName])) {\n              realPropertyName = '_' + realPropertyName;\n            }\n\n            if (!ko.isComputed(target[realPropertyName])) {\n              var val = ko.unwrap(target[realPropertyName]);\n\n              if (!!val && typeof val === 'object') {\n                if (!info[i].link) {\n                  this._callDisposeFunction(val);\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  };\n\n  UndoEngine.prototype._createDisposeFunction = function (val, info) {\n    var _this = this;\n\n    var subscriptions = [];\n\n    if (val && typeof val === 'object') {\n      var objectInfo = info || val[this._getInfoMethodName] && val[this._getInfoMethodName]();\n\n      if (!!objectInfo) {\n        if (val[this._currentEngineName]) {\n          val[this._currentEngineName].inc++;\n        } else {\n          val[this._currentEngineName] = {\n            inc: 1,\n            instance: this\n          };\n          subscriptions = this.subscribe(val, objectInfo);\n\n          val[this._currentEngineName]['func'] = function () {\n            val[_this._currentEngineName].inc--;\n\n            _this._disposeChilds(val, objectInfo);\n\n            if (val[_this._currentEngineName].inc === 0) {\n              _this._cleanSubscribtions(subscriptions);\n\n              delete val[_this._currentEngineName];\n            }\n          };\n        }\n      }\n    }\n\n    return subscriptions;\n  };\n\n  UndoEngine.prototype._callDisposeFunction = function (val) {\n    if (val) {\n      if (Array.isArray(val)) {\n        for (var i = 0; i < val.length; i++) {\n          val[i][this._currentEngineName] && val[i][this._currentEngineName].func();\n        }\n      } else {\n        val[this._currentEngineName] && val[this._currentEngineName].func();\n      }\n    }\n  };\n\n  UndoEngine.prototype._cleanSubscribtions = function (subscribtionArray) {\n    if (subscribtionArray) {\n      if (subscribtionArray.length) {\n        for (var i = 0; i < subscribtionArray.length; i++) {\n          this._cleanSubscribtions(subscribtionArray[i]);\n        }\n      } else {\n        subscribtionArray.dispose && subscribtionArray.dispose();\n      }\n    }\n  };\n\n  UndoEngine.prototype.validatePropertyName = function (target, propertyName) {\n    if ((!this._ignoredProperties || this._ignoredProperties && this._ignoredProperties.every(function (x) {\n      return x !== propertyName;\n    })) && propertyName[0] !== '_') {\n      if (ko.isWritableObservable(target['_' + propertyName])) {\n        return '_' + propertyName;\n      }\n\n      return propertyName;\n    }\n\n    return null;\n  };\n\n  UndoEngine.prototype.subscribeProperty = function (property, subscribeChilds) {\n    var _this = this;\n\n    if (ko.isObservable(property)) {\n      var prevVal = property();\n\n      if (Array.isArray(prevVal)) {\n        for (var i = 0; i < property().length; i++) {\n          this._createDisposeFunction(property()[i]);\n        }\n\n        return property.subscribe(function (args) {\n          if (_this._modelReady) {\n            var addedItems = args.filter(function (x) {\n              return x.status === 'added';\n            });\n            var removedItems = args.filter(function (x) {\n              return x.status === 'deleted';\n            });\n\n            for (var i = 0; i < removedItems.length; i++) {\n              _this._callDisposeFunction(removedItems[i].value);\n            }\n\n            for (var i = 0; i < addedItems.length; i++) {\n              _this._createDisposeFunction(addedItems[i].value);\n            }\n\n            _this.properyChanged({\n              observable: property,\n              arrayChanges: args\n            });\n          }\n        }, null, 'arrayChange');\n      } else {\n        if (ko.isWritableObservable(property)) {\n          if (subscribeChilds) {\n            this._createDisposeFunction(property());\n          }\n\n          return property.subscribe(function (val) {\n            if (_this._modelReady) {\n              if (subscribeChilds) {\n                _this._callDisposeFunction(prevVal);\n              }\n\n              _this.properyChanged({\n                observable: property,\n                propertyChanged: {\n                  oldVal: prevVal,\n                  val: val\n                }\n              });\n\n              prevVal = val;\n\n              if (subscribeChilds) {\n                _this._createDisposeFunction(val);\n              }\n            }\n          });\n        }\n      }\n    }\n  };\n\n  UndoEngine.prototype.subscribeProperties = function (properties) {\n    var _this = this;\n\n    properties.forEach(function (property) {\n      if (ko.isObservable(property)) {\n        var prevVal = property();\n\n        if (property['push']) {\n          _this._subscriptions.push(property.subscribe(function (args) {\n            if (_this._modelReady) {\n              if (!_this._inUndoRedo) {\n                _this.properyChanged({\n                  observable: property,\n                  arrayChanges: args\n                });\n\n                _this.subscribe(args.map(function (item) {\n                  return item.value;\n                }));\n              }\n            }\n          }, null, 'arrayChange'));\n        } else {\n          if (ko.isWritableObservable(property)) {\n            _this._subscriptions.push(property.subscribe(function (val) {\n              if (_this._modelReady) {\n                _this.properyChanged({\n                  observable: property,\n                  propertyChanged: {\n                    oldVal: prevVal,\n                    val: val\n                  }\n                });\n\n                prevVal = property();\n              }\n            }));\n          }\n        }\n      }\n    });\n  };\n\n  UndoEngine.prototype.subscribe = function (target, info) {\n    var _this = this;\n\n    if (this._getInfoMethodName) {\n      return this.visitProperties(target, info || target && target[this._getInfoMethodName] && target[this._getInfoMethodName]());\n    } else {\n      _utils_1.propertiesVisitor(target, function (properties) {\n        _this.subscribeProperties(properties);\n      }, this._visited, this._ignoredProperties);\n    }\n  };\n\n  UndoEngine.prototype.getCurrentChangeSet = function () {\n    return new _LatestChangeSet(this._observers[this._position()], this._position());\n  };\n\n  UndoEngine.prototype._removePropertiesSubscriptions = function () {\n    this._subscriptions.forEach(function (subscription) {\n      return subscription.dispose();\n    });\n\n    this._subscriptions = [];\n    this._visited = [];\n  };\n\n  UndoEngine.prototype.dispose = function () {\n    var _this = this;\n\n    _super.prototype.dispose.call(this);\n\n    this.removeTargetSubscription();\n    var position = 0;\n    activeEngines.some(function (x, index) {\n      if (x === _this._currentEngineName) {\n        position = index;\n        return true;\n      }\n\n      return false;\n    });\n    activeEngines.splice(position, 1);\n  };\n\n  UndoEngine.prototype.removeTargetSubscription = function () {\n    this._targetSubscription && this._targetSubscription.dispose();\n    this.reset();\n  };\n\n  UndoEngine.prototype.undoAll = function () {\n    if (this.undoEnabled()) {\n      this.undo();\n      this.undoAll();\n    }\n  };\n\n  UndoEngine.prototype.reset = function () {\n    this._removePropertiesSubscriptions();\n\n    this.clearHistory();\n  };\n\n  UndoEngine.prototype.clearHistory = function () {\n    this._groupObservers = [];\n    this._observers = [];\n    this.redoEnabled(false);\n    this.undoEnabled(false);\n    this._inUndoRedo = false;\n    this._groupPosition = -1;\n\n    this._position(-1);\n\n    this._lockedPosition(this._position());\n  };\n\n  UndoEngine.prototype.undo = function (removeNode) {\n    var _this = this;\n\n    if (removeNode === void 0) {\n      removeNode = false;\n    }\n\n    try {\n      this._inUndoRedo = true;\n\n      if (this.undoEnabled()) {\n        var changeSet = this._observers[this._position()];\n\n        if (changeSet) {\n          if (Array.isArray(changeSet)) {\n            changeSet.reverse().forEach(function (item) {\n              return _this.undoChangeSet(item);\n            });\n          } else {\n            this.undoChangeSet(changeSet);\n          }\n\n          if (removeNode) {\n            this._observers.splice(this._position(), 1);\n          }\n\n          this._position(this._position() - 1);\n\n          this.undoEnabled(this._observers.length !== 0 && this._position() >= 0);\n          this.redoEnabled(this._position() < this._observers.length - 1);\n        }\n      }\n    } finally {\n      this._inUndoRedo = false;\n    }\n  };\n\n  UndoEngine.prototype.redo = function () {\n    var _this = this;\n\n    try {\n      this._inUndoRedo = true;\n\n      if (this.redoEnabled()) {\n        var changeSet = this._observers[this._position() + 1];\n\n        if (changeSet) {\n          if (Array.isArray(changeSet)) {\n            changeSet.reverse().forEach(function (item) {\n              return _this.redoChangeSet(item);\n            });\n          } else {\n            this.redoChangeSet(changeSet);\n          }\n\n          this._position(this._position() + 1);\n\n          this.undoEnabled(this._observers.length !== 0 && this._position() >= 0);\n          this.redoEnabled(this._position() + 1 < this._observers.length);\n        }\n      }\n    } finally {\n      this._inUndoRedo = false;\n    }\n  };\n\n  UndoEngine.prototype._hasSessionChanges = function () {\n    return this.isIngroup === 0 && this._observers.length > 0;\n  };\n\n  UndoEngine.prototype.start = function () {\n    this.isIngroup++;\n    if (this.isIngroup !== 0) return;\n    this._groupObservers = this._observers;\n    this._observers = [];\n    this._groupPosition = this._position();\n\n    this._position(-1);\n\n    this._lockedPosition(this._position());\n  };\n\n  UndoEngine.prototype.end = function () {\n    var _this = this;\n\n    this.isIngroup--;\n\n    if (this.isIngroup !== -1) {\n      return;\n    }\n\n    if (this._observers.length > 0) {\n      this._position(this._groupPosition + 1);\n\n      var removedItems = this._groupObservers.splice(this._position(), this._groupObservers.length - this._position(), this._observers);\n\n      removedItems.forEach(function (changeSet) {\n        if (Array.isArray(changeSet)) {\n          changeSet.reverse().forEach(function (item) {\n            return _this._disposeObserver(item);\n          });\n        } else {\n          _this._disposeObserver(changeSet);\n        }\n      });\n    } else {\n      this._position(this._groupPosition);\n    }\n\n    this._observers = this._groupObservers;\n  };\n\n  UndoEngine._disposeUndoEngineSubscriptionsName = '___dispose___UndoEngine___Subscriptions___';\n  return UndoEngine;\n}(utils_1.Disposable);\n\nexports.UndoEngine = UndoEngine;","map":{"version":3,"sources":["/Users/krunalpatel/Downloads/React-Firebase-Auth-master 3/node_modules/@devexpress/analytics-core/undo-engine/undoengine.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","TypeError","String","__","constructor","create","defineProperty","exports","value","UndoEngine","_LatestChangeSet","ko","require","utils_1","_utils_1","changes","position","Empty","equal","changeSet","activeEngines","_super","target","_ignoredProperties","_getInfoMethodName","_alwaysSubscribeProperties","_this","_groupObservers","_groupPosition","_observers","_subscriptions","_visited","_position","observable","_lockedPosition","_inUndoRedo","_currentEngineName","_disposeUndoEngineSubscriptionsName","guid","redoEnabled","undoEnabled","isIngroup","isDirty","computed","read","write","push","_model","unwrap","isSubscribable","_targetSubscription","subscribeProperty","_createDisposeFunction","innerSubscriptions","subscribe","prevVal","newTargetValue","_removePropertiesSubscriptions","properyChanged","propertyChanged","oldVal","val","_cleanSubscribtions","_disposables","tryGetUndoEngine","object","undo","some","x","instance","get","checkModelReady","enumerable","configurable","_disposeObserver","record","dispose","arrayChanges","forEach","change","status","undoRecord","currentPosition","length","removedItems","splice","isArray","reverse","item","visitProperties","info","subscribtions","i","alwaysSubscribeProperty","propertyName","modelName","editor","realPropertyName","validatePropertyName","isComputed","isObservable","apply","link","undoChangeSet","array","indexOf","index","valueHasMutated","redoChangeSet","_disposeChilds","isWritableObservable","_callDisposeFunction","subscriptions","objectInfo","inc","func","subscribtionArray","every","property","subscribeChilds","args","_modelReady","addedItems","filter","subscribeProperties","properties","map","propertiesVisitor","getCurrentChangeSet","subscription","removeTargetSubscription","reset","undoAll","clearHistory","removeNode","redo","_hasSessionChanges","start","end","Disposable"],"mappings":"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","sourcesContent":["/**\n* DevExpress Analytics (undo-engine\\undoengine.js)\n* Version:  22.1.3\n* Build date: Jun 14, 2022\n* Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\n* License: https://www.devexpress.com/Support/EULAs/universal.xml\n*/\n\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.UndoEngine = exports._LatestChangeSet = void 0;\nvar ko = require(\"knockout\");\nvar utils_1 = require(\"../serializer/utils\");\nvar _utils_1 = require(\"./_utils\");\nvar _LatestChangeSet = (function () {\n    function _LatestChangeSet(changes, position) {\n        this.changes = changes;\n        this.position = position;\n    }\n    _LatestChangeSet.Empty = function () {\n        return new _LatestChangeSet(null, null);\n    };\n    _LatestChangeSet.prototype.equal = function (changeSet) {\n        return this.changes === changeSet.changes && this.position === changeSet.position;\n    };\n    return _LatestChangeSet;\n}());\nexports._LatestChangeSet = _LatestChangeSet;\nvar activeEngines = [];\nvar UndoEngine = (function (_super) {\n    __extends(UndoEngine, _super);\n    function UndoEngine(target, _ignoredProperties, _getInfoMethodName, _alwaysSubscribeProperties) {\n        if (_ignoredProperties === void 0) { _ignoredProperties = ['surface']; }\n        if (_alwaysSubscribeProperties === void 0) { _alwaysSubscribeProperties = []; }\n        var _this = _super.call(this) || this;\n        _this._ignoredProperties = _ignoredProperties;\n        _this._getInfoMethodName = _getInfoMethodName;\n        _this._alwaysSubscribeProperties = _alwaysSubscribeProperties;\n        _this._groupObservers = [];\n        _this._groupPosition = -1;\n        _this._observers = [];\n        _this._subscriptions = [];\n        _this._visited = [];\n        _this._position = ko.observable(-1);\n        _this._lockedPosition = ko.observable(-1);\n        _this._inUndoRedo = false;\n        _this._currentEngineName = UndoEngine._disposeUndoEngineSubscriptionsName + _utils_1.guid();\n        _this.redoEnabled = ko.observable(false);\n        _this.undoEnabled = ko.observable(false);\n        _this.isIngroup = -1;\n        _this.isDirty = ko.computed({\n            read: function () { return _this._position() !== _this._lockedPosition(); },\n            write: function (value) { value ? _this._lockedPosition('forcibly marked as dirty') : _this._lockedPosition(_this._position()); }\n        });\n        activeEngines.push(_this._currentEngineName);\n        _this._model = ko.unwrap(target);\n        if (_this._getInfoMethodName) {\n            if (ko.isSubscribable(target)) {\n                _this._targetSubscription = _this.subscribeProperty(target, true);\n            }\n            else {\n                _this._createDisposeFunction(target);\n            }\n        }\n        else {\n            var innerSubscriptions = _this.subscribe(_this._model);\n            if (ko.isSubscribable(target)) {\n                var prevVal = target();\n                _this._targetSubscription = target.subscribe(function (newTargetValue) {\n                    _this._removePropertiesSubscriptions();\n                    if (!_this._inUndoRedo) {\n                        _this.properyChanged({\n                            observable: target,\n                            propertyChanged: { oldVal: prevVal, val: newTargetValue }\n                        });\n                        prevVal = newTargetValue;\n                    }\n                    _this._cleanSubscribtions(innerSubscriptions);\n                    _this._model = newTargetValue;\n                    innerSubscriptions = _this.subscribe(_this._model);\n                });\n            }\n        }\n        _this._disposables.push(_this.isDirty);\n        return _this;\n    }\n    UndoEngine.tryGetUndoEngine = function (object) {\n        var undo = null;\n        activeEngines.some(function (x) {\n            undo = object[x] && object[x].instance;\n            return !!undo;\n        });\n        return undo;\n    };\n    Object.defineProperty(UndoEngine.prototype, \"_modelReady\", {\n        get: function () {\n            return _utils_1.checkModelReady(this._model);\n        },\n        enumerable: false,\n        configurable: true\n    });\n    UndoEngine.prototype._disposeObserver = function (record) {\n        var _this = this;\n        if (record.propertyChanged) {\n            var value = record.propertyChanged.val;\n            if (value && !value[this._currentEngineName]) {\n                value.dispose && value.dispose();\n            }\n        }\n        else if (record.arrayChanges) {\n            record.arrayChanges.forEach(function (change) {\n                if (change.status === 'added') {\n                    var value = change.value;\n                    if (value && !value[_this._currentEngineName])\n                        value.dispose && value.dispose();\n                }\n            });\n        }\n    };\n    UndoEngine.prototype.properyChanged = function (undoRecord) {\n        var _this = this;\n        if (this._inUndoRedo) {\n            return;\n        }\n        var currentPosition = this._position() + 1;\n        if (currentPosition < this._observers.length) {\n            var removedItems = this._observers.splice(currentPosition, this._observers.length);\n            removedItems.forEach(function (changeSet) {\n                if (Array.isArray(changeSet)) {\n                    changeSet.reverse().forEach(function (item) { return _this._disposeObserver(item); });\n                }\n                else {\n                    _this._disposeObserver(changeSet);\n                }\n            });\n        }\n        this._observers.push(undoRecord);\n        this._position(currentPosition);\n        this.undoEnabled(true);\n        this.redoEnabled(false);\n    };\n    UndoEngine.prototype.visitProperties = function (target, info) {\n        var subscribtions = [];\n        if (target && info) {\n            for (var i = 0; i < info.length; i++) {\n                var alwaysSubscribeProperty = this._alwaysSubscribeProperties.some(function (x) { return x === info[i].propertyName; });\n                if (info[i].modelName || info[i].editor || info[i].info || alwaysSubscribeProperty) {\n                    var realPropertyName = alwaysSubscribeProperty ? info[i].propertyName : this.validatePropertyName(target, info[i].propertyName);\n                    if (realPropertyName) {\n                        if (!ko.isComputed(target[realPropertyName])) {\n                            if (!ko.isObservable(target[realPropertyName])) {\n                                subscribtions.push.apply([], this._createDisposeFunction(target[realPropertyName], info[i].info));\n                            }\n                            else {\n                                subscribtions.push(this.subscribeProperty(target[realPropertyName], !info[i].link));\n                            }\n                        }\n                    }\n                }\n            }\n        }\n        return subscribtions;\n    };\n    UndoEngine.prototype.undoChangeSet = function (changeSet) {\n        if (changeSet.propertyChanged) {\n            changeSet.observable(changeSet.propertyChanged.oldVal);\n        }\n        else {\n            var array = changeSet.observable();\n            for (var i = 0; i < changeSet.arrayChanges.length; i++) {\n                if (changeSet.arrayChanges[i].status === 'added') {\n                    array.splice(array.indexOf(changeSet.arrayChanges[i].value), 1);\n                }\n            }\n            for (var i = 0; i < changeSet.arrayChanges.length; i++) {\n                if (changeSet.arrayChanges[i].status === 'deleted') {\n                    array.splice(changeSet.arrayChanges[i].index, 0, changeSet.arrayChanges[i].value);\n                }\n            }\n            if (ko.isObservable(changeSet.observable)) {\n                changeSet.observable.valueHasMutated();\n            }\n        }\n    };\n    UndoEngine.prototype.redoChangeSet = function (changeSet) {\n        if (changeSet.propertyChanged) {\n            changeSet.observable(changeSet.propertyChanged.val);\n        }\n        else {\n            var array = changeSet.observable();\n            for (var i = 0; i < changeSet.arrayChanges.length; i++) {\n                if (changeSet.arrayChanges[i].status === 'deleted') {\n                    array.splice(array.indexOf(changeSet.arrayChanges[i].value), 1);\n                }\n            }\n            for (var i = 0; i < changeSet.arrayChanges.length; i++) {\n                if (changeSet.arrayChanges[i].status === 'added') {\n                    array.splice(changeSet.arrayChanges[i].index, 0, changeSet.arrayChanges[i].value);\n                }\n            }\n            if (ko.isObservable(changeSet.observable)) {\n                changeSet.observable.valueHasMutated();\n            }\n        }\n    };\n    UndoEngine.prototype._disposeChilds = function (target, info) {\n        if (target && info) {\n            for (var i = 0; i < info.length; i++) {\n                if (info[i].modelName || info[i].editor || info[i].info) {\n                    var propertyName = info[i].propertyName;\n                    if (propertyName.indexOf('_') !== 0) {\n                        var realPropertyName = propertyName;\n                        if (ko.isWritableObservable(target['_' + propertyName])) {\n                            realPropertyName = '_' + realPropertyName;\n                        }\n                        if (!ko.isComputed(target[realPropertyName])) {\n                            var val = ko.unwrap(target[realPropertyName]);\n                            if (!!val && typeof val === 'object') {\n                                if (!info[i].link) {\n                                    this._callDisposeFunction(val);\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    };\n    UndoEngine.prototype._createDisposeFunction = function (val, info) {\n        var _this = this;\n        var subscriptions = [];\n        if (val && typeof val === 'object') {\n            var objectInfo = info || (val[this._getInfoMethodName] && val[this._getInfoMethodName]());\n            if (!!objectInfo) {\n                if (val[this._currentEngineName]) {\n                    val[this._currentEngineName].inc++;\n                }\n                else {\n                    val[this._currentEngineName] = { inc: 1, instance: this };\n                    subscriptions = this.subscribe(val, objectInfo);\n                    val[this._currentEngineName]['func'] = function () {\n                        val[_this._currentEngineName].inc--;\n                        _this._disposeChilds(val, objectInfo);\n                        if (val[_this._currentEngineName].inc === 0) {\n                            _this._cleanSubscribtions(subscriptions);\n                            delete val[_this._currentEngineName];\n                        }\n                    };\n                }\n            }\n        }\n        return subscriptions;\n    };\n    UndoEngine.prototype._callDisposeFunction = function (val) {\n        if (val) {\n            if (Array.isArray(val)) {\n                for (var i = 0; i < val.length; i++) {\n                    val[i][this._currentEngineName] && val[i][this._currentEngineName].func();\n                }\n            }\n            else {\n                val[this._currentEngineName] && val[this._currentEngineName].func();\n            }\n        }\n    };\n    UndoEngine.prototype._cleanSubscribtions = function (subscribtionArray) {\n        if (subscribtionArray) {\n            if (subscribtionArray.length) {\n                for (var i = 0; i < subscribtionArray.length; i++) {\n                    this._cleanSubscribtions(subscribtionArray[i]);\n                }\n            }\n            else {\n                subscribtionArray.dispose && subscribtionArray.dispose();\n            }\n        }\n    };\n    UndoEngine.prototype.validatePropertyName = function (target, propertyName) {\n        if ((!this._ignoredProperties || (this._ignoredProperties && this._ignoredProperties.every(function (x) { return x !== propertyName; }))) && propertyName[0] !== '_') {\n            if (ko.isWritableObservable(target['_' + propertyName])) {\n                return '_' + propertyName;\n            }\n            return propertyName;\n        }\n        return null;\n    };\n    UndoEngine.prototype.subscribeProperty = function (property, subscribeChilds) {\n        var _this = this;\n        if (ko.isObservable(property)) {\n            var prevVal = property();\n            if (Array.isArray(prevVal)) {\n                for (var i = 0; i < property().length; i++) {\n                    this._createDisposeFunction(property()[i]);\n                }\n                return property.subscribe(function (args) {\n                    if (_this._modelReady) {\n                        var addedItems = args.filter(function (x) { return x.status === 'added'; });\n                        var removedItems = args.filter(function (x) { return x.status === 'deleted'; });\n                        for (var i = 0; i < removedItems.length; i++) {\n                            _this._callDisposeFunction(removedItems[i].value);\n                        }\n                        for (var i = 0; i < addedItems.length; i++) {\n                            _this._createDisposeFunction(addedItems[i].value);\n                        }\n                        _this.properyChanged({ observable: property, arrayChanges: args });\n                    }\n                }, null, 'arrayChange');\n            }\n            else {\n                if (ko.isWritableObservable(property)) {\n                    if (subscribeChilds) {\n                        this._createDisposeFunction(property());\n                    }\n                    return property.subscribe(function (val) {\n                        if (_this._modelReady) {\n                            if (subscribeChilds) {\n                                _this._callDisposeFunction(prevVal);\n                            }\n                            _this.properyChanged({\n                                observable: property, propertyChanged: { oldVal: prevVal, val: val }\n                            });\n                            prevVal = val;\n                            if (subscribeChilds) {\n                                _this._createDisposeFunction(val);\n                            }\n                        }\n                    });\n                }\n            }\n        }\n    };\n    UndoEngine.prototype.subscribeProperties = function (properties) {\n        var _this = this;\n        properties.forEach(function (property) {\n            if (ko.isObservable(property)) {\n                var prevVal = property();\n                if (property['push']) {\n                    _this._subscriptions.push(property.subscribe(function (args) {\n                        if (_this._modelReady) {\n                            if (!_this._inUndoRedo) {\n                                _this.properyChanged({ observable: property, arrayChanges: args });\n                                _this.subscribe(args.map(function (item) { return item.value; }));\n                            }\n                        }\n                    }, null, 'arrayChange'));\n                }\n                else {\n                    if (ko.isWritableObservable(property)) {\n                        _this._subscriptions.push(property.subscribe(function (val) {\n                            if (_this._modelReady) {\n                                _this.properyChanged({\n                                    observable: property, propertyChanged: { oldVal: prevVal, val: val }\n                                });\n                                prevVal = property();\n                            }\n                        }));\n                    }\n                }\n            }\n        });\n    };\n    UndoEngine.prototype.subscribe = function (target, info) {\n        var _this = this;\n        if (this._getInfoMethodName) {\n            return this.visitProperties(target, info || (target && target[this._getInfoMethodName] && target[this._getInfoMethodName]()));\n        }\n        else {\n            _utils_1.propertiesVisitor(target, function (properties) { _this.subscribeProperties(properties); }, this._visited, this._ignoredProperties);\n        }\n    };\n    UndoEngine.prototype.getCurrentChangeSet = function () {\n        return new _LatestChangeSet(this._observers[this._position()], this._position());\n    };\n    UndoEngine.prototype._removePropertiesSubscriptions = function () {\n        this._subscriptions.forEach(function (subscription) { return subscription.dispose(); });\n        this._subscriptions = [];\n        this._visited = [];\n    };\n    UndoEngine.prototype.dispose = function () {\n        var _this = this;\n        _super.prototype.dispose.call(this);\n        this.removeTargetSubscription();\n        var position = 0;\n        activeEngines.some(function (x, index) {\n            if (x === _this._currentEngineName) {\n                position = index;\n                return true;\n            }\n            return false;\n        });\n        activeEngines.splice(position, 1);\n    };\n    UndoEngine.prototype.removeTargetSubscription = function () {\n        this._targetSubscription && this._targetSubscription.dispose();\n        this.reset();\n    };\n    UndoEngine.prototype.undoAll = function () {\n        if (this.undoEnabled()) {\n            this.undo();\n            this.undoAll();\n        }\n    };\n    UndoEngine.prototype.reset = function () {\n        this._removePropertiesSubscriptions();\n        this.clearHistory();\n    };\n    UndoEngine.prototype.clearHistory = function () {\n        this._groupObservers = [];\n        this._observers = [];\n        this.redoEnabled(false);\n        this.undoEnabled(false);\n        this._inUndoRedo = false;\n        this._groupPosition = -1;\n        this._position(-1);\n        this._lockedPosition(this._position());\n    };\n    UndoEngine.prototype.undo = function (removeNode) {\n        var _this = this;\n        if (removeNode === void 0) { removeNode = false; }\n        try {\n            this._inUndoRedo = true;\n            if (this.undoEnabled()) {\n                var changeSet = this._observers[this._position()];\n                if (changeSet) {\n                    if (Array.isArray(changeSet)) {\n                        changeSet.reverse().forEach(function (item) { return _this.undoChangeSet(item); });\n                    }\n                    else {\n                        this.undoChangeSet(changeSet);\n                    }\n                    if (removeNode) {\n                        this._observers.splice(this._position(), 1);\n                    }\n                    this._position(this._position() - 1);\n                    this.undoEnabled(this._observers.length !== 0 && this._position() >= 0);\n                    this.redoEnabled(this._position() < this._observers.length - 1);\n                }\n            }\n        }\n        finally {\n            this._inUndoRedo = false;\n        }\n    };\n    UndoEngine.prototype.redo = function () {\n        var _this = this;\n        try {\n            this._inUndoRedo = true;\n            if (this.redoEnabled()) {\n                var changeSet = this._observers[this._position() + 1];\n                if (changeSet) {\n                    if (Array.isArray(changeSet)) {\n                        changeSet.reverse().forEach(function (item) { return _this.redoChangeSet(item); });\n                    }\n                    else {\n                        this.redoChangeSet(changeSet);\n                    }\n                    this._position(this._position() + 1);\n                    this.undoEnabled(this._observers.length !== 0 && this._position() >= 0);\n                    this.redoEnabled(this._position() + 1 < this._observers.length);\n                }\n            }\n        }\n        finally {\n            this._inUndoRedo = false;\n        }\n    };\n    UndoEngine.prototype._hasSessionChanges = function () {\n        return this.isIngroup === 0 && this._observers.length > 0;\n    };\n    UndoEngine.prototype.start = function () {\n        this.isIngroup++;\n        if (this.isIngroup !== 0)\n            return;\n        this._groupObservers = this._observers;\n        this._observers = [];\n        this._groupPosition = this._position();\n        this._position(-1);\n        this._lockedPosition(this._position());\n    };\n    UndoEngine.prototype.end = function () {\n        var _this = this;\n        this.isIngroup--;\n        if (this.isIngroup !== -1) {\n            return;\n        }\n        if (this._observers.length > 0) {\n            this._position(this._groupPosition + 1);\n            var removedItems = this._groupObservers.splice(this._position(), this._groupObservers.length - this._position(), this._observers);\n            removedItems.forEach(function (changeSet) {\n                if (Array.isArray(changeSet)) {\n                    changeSet.reverse().forEach(function (item) { return _this._disposeObserver(item); });\n                }\n                else {\n                    _this._disposeObserver(changeSet);\n                }\n            });\n        }\n        else {\n            this._position(this._groupPosition);\n        }\n        this._observers = this._groupObservers;\n    };\n    UndoEngine._disposeUndoEngineSubscriptionsName = '___dispose___UndoEngine___Subscriptions___';\n    return UndoEngine;\n}(utils_1.Disposable));\nexports.UndoEngine = UndoEngine;\n"]},"metadata":{},"sourceType":"script"}