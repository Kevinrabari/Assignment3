{"ast":null,"code":"/**\r\n * DevExtreme (esm/ui/tag_box.js)\r\n * Version: 22.1.3\r\n * Build date: Mon Jun 13 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport { getOuterWidth, getHeight } from \"../core/utils/size\";\nimport $ from \"../core/renderer\";\nimport devices from \"../core/devices\";\nimport { data as elementData } from \"../core/element_data\";\nimport eventsEngine from \"../events/core/events_engine\";\nimport registerComponent from \"../core/component_registrator\";\nimport { noop, ensureDefined, equalByValue } from \"../core/utils/common\";\nimport { SelectionFilterCreator as FilterCreator } from \"../core/utils/selection_filter\";\nimport { Deferred, when } from \"../core/utils/deferred\";\nimport { createTextElementHiddenCopy } from \"../core/utils/dom\";\nimport { getPublicElement } from \"../core/element\";\nimport { isDefined, isObject, isString } from \"../core/utils/type\";\nimport { hasWindow } from \"../core/utils/window\";\nimport { extend } from \"../core/utils/extend\";\nimport { each } from \"../core/utils/iterator\";\nimport messageLocalization from \"../localization/message\";\nimport { addNamespace, isCommandKeyPressed, normalizeKeyName } from \"../events/utils/index\";\nimport { name as clickEvent } from \"../events/click\";\nimport caret from \"./text_box/utils.caret\";\nimport { normalizeLoadResult } from \"../data/data_source/utils\";\nimport SelectBox from \"./select_box\";\nimport { BindableTemplate } from \"../core/templates/bindable_template\";\nimport { allowScroll } from \"./text_box/utils.scroll\";\nimport errors from \"./widget/ui.errors\";\nvar TAGBOX_TAG_DATA_KEY = \"dxTagData\";\nvar TAGBOX_CLASS = \"dx-tagbox\";\nvar TAGBOX_TAG_CONTAINER_CLASS = \"dx-tag-container\";\nvar TAGBOX_TAG_CLASS = \"dx-tag\";\nvar TAGBOX_MULTI_TAG_CLASS = \"dx-tagbox-multi-tag\";\nvar TAGBOX_CUSTOM_TAG_CLASS = \"dx-tag-custom\";\nvar TAGBOX_TAG_REMOVE_BUTTON_CLASS = \"dx-tag-remove-button\";\nvar TAGBOX_ONLY_SELECT_CLASS = \"dx-tagbox-only-select\";\nvar TAGBOX_SINGLE_LINE_CLASS = \"dx-tagbox-single-line\";\nvar TAGBOX_POPUP_WRAPPER_CLASS = \"dx-tagbox-popup-wrapper\";\nvar TAGBOX_TAG_CONTENT_CLASS = \"dx-tag-content\";\nvar TAGBOX_DEFAULT_FIELD_TEMPLATE_CLASS = \"dx-tagbox-default-template\";\nvar TAGBOX_CUSTOM_FIELD_TEMPLATE_CLASS = \"dx-tagbox-custom-template\";\nvar TEXTEDITOR_INPUT_CONTAINER_CLASS = \"dx-texteditor-input-container\";\nvar TAGBOX_MOUSE_WHEEL_DELTA_MULTIPLIER = -.3;\nvar TagBox = SelectBox.inherit({\n  _supportedKeys: function () {\n    var parent = this.callBase();\n\n    var sendToList = options => this._list._keyboardHandler(options);\n\n    var rtlEnabled = this.option(\"rtlEnabled\");\n    return extend({}, parent, {\n      backspace: function (e) {\n        if (!this._isCaretAtTheStart()) {\n          return;\n        }\n\n        this._processKeyboardEvent(e);\n\n        this._isTagRemoved = true;\n\n        var $tagToDelete = this._$focusedTag || this._tagElements().last();\n\n        if (this._$focusedTag) {\n          this._moveTagFocus(\"prev\", true);\n        }\n\n        if (0 === $tagToDelete.length) {\n          return;\n        }\n\n        this._preserveFocusedTag = true;\n\n        this._removeTagElement($tagToDelete);\n\n        delete this._preserveFocusedTag;\n      },\n      upArrow: (e, opts) => e.altKey || !this._list ? parent.upArrow.call(this, e) : sendToList(opts),\n      downArrow: (e, opts) => e.altKey || !this._list ? parent.downArrow.call(this, e) : sendToList(opts),\n      del: function (e) {\n        if (!this._$focusedTag || !this._isCaretAtTheStart()) {\n          return;\n        }\n\n        this._processKeyboardEvent(e);\n\n        this._isTagRemoved = true;\n        var $tagToDelete = this._$focusedTag;\n\n        this._moveTagFocus(\"next\", true);\n\n        this._preserveFocusedTag = true;\n\n        this._removeTagElement($tagToDelete);\n\n        delete this._preserveFocusedTag;\n      },\n      enter: function (e, options) {\n        var isListItemFocused = this._list && null !== this._list.option(\"focusedElement\");\n\n        var isCustomItem = this.option(\"acceptCustomValue\") && !isListItemFocused;\n\n        if (isCustomItem) {\n          e.preventDefault();\n          \"\" !== this._searchValue() && this._customItemAddedHandler(e);\n          return;\n        }\n\n        if (this.option(\"opened\")) {\n          this._saveValueChangeEvent(e);\n\n          sendToList(options);\n          e.preventDefault();\n        }\n      },\n      space: function (e, options) {\n        var isOpened = this.option(\"opened\");\n\n        var isInputActive = this._shouldRenderSearchEvent();\n\n        if (isOpened && !isInputActive) {\n          this._saveValueChangeEvent(e);\n\n          sendToList(options);\n          e.preventDefault();\n        }\n      },\n      leftArrow: function (e) {\n        if (!this._isCaretAtTheStart() || this._isEmpty() || this._isEditable() && rtlEnabled && !this._$focusedTag) {\n          return;\n        }\n\n        e.preventDefault();\n        var direction = rtlEnabled ? \"next\" : \"prev\";\n\n        this._moveTagFocus(direction);\n\n        !this.option(\"multiline\") && this._scrollContainer(direction);\n      },\n      rightArrow: function (e) {\n        if (!this._isCaretAtTheStart() || this._isEmpty() || this._isEditable() && !rtlEnabled && !this._$focusedTag) {\n          return;\n        }\n\n        e.preventDefault();\n        var direction = rtlEnabled ? \"prev\" : \"next\";\n\n        this._moveTagFocus(direction);\n\n        !this.option(\"multiline\") && this._scrollContainer(direction);\n      }\n    });\n  },\n  _processKeyboardEvent: function (e) {\n    e.preventDefault();\n    e.stopPropagation();\n\n    this._saveValueChangeEvent(e);\n  },\n  _isEmpty: function () {\n    return 0 === this._getValue().length;\n  },\n  _updateTagsContainer: function ($element) {\n    this._$tagsContainer = $element.addClass(TAGBOX_TAG_CONTAINER_CLASS);\n  },\n  _allowSelectItemByTab: function () {\n    return false;\n  },\n  _isCaretAtTheStart: function () {\n    var position = caret(this._input());\n    return 0 === position.start && 0 === position.end;\n  },\n  _moveTagFocus: function (direction, clearOnBoundary) {\n    if (!this._$focusedTag) {\n      var tagElements = this._tagElements();\n\n      this._$focusedTag = \"next\" === direction ? tagElements.first() : tagElements.last();\n\n      this._toggleFocusClass(true, this._$focusedTag);\n\n      return;\n    }\n\n    var $nextFocusedTag = this._$focusedTag[direction](\".\".concat(TAGBOX_TAG_CLASS));\n\n    if ($nextFocusedTag.length > 0) {\n      this._replaceFocusedTag($nextFocusedTag);\n    } else if (clearOnBoundary || \"next\" === direction && this._isEditable()) {\n      this._clearTagFocus();\n    }\n  },\n  _replaceFocusedTag: function ($nextFocusedTag) {\n    this._toggleFocusClass(false, this._$focusedTag);\n\n    this._$focusedTag = $nextFocusedTag;\n\n    this._toggleFocusClass(true, this._$focusedTag);\n  },\n  _clearTagFocus: function () {\n    if (!this._$focusedTag) {\n      return;\n    }\n\n    this._toggleFocusClass(false, this._$focusedTag);\n\n    delete this._$focusedTag;\n  },\n  _focusClassTarget: function ($element) {\n    if ($element && $element.length && $element[0] !== this._focusTarget()[0]) {\n      return $element;\n    }\n\n    return this.callBase();\n  },\n  _getLabelContainer: function () {\n    return this._$tagsContainer;\n  },\n  _scrollContainer: function (direction) {\n    if (this.option(\"multiline\") || !hasWindow()) {\n      return;\n    }\n\n    if (!this._$tagsContainer) {\n      return;\n    }\n\n    var scrollPosition = this._getScrollPosition(direction);\n\n    this._$tagsContainer.scrollLeft(scrollPosition);\n  },\n  _getScrollPosition: function (direction) {\n    if (\"start\" === direction || \"end\" === direction) {\n      return this._getBorderPosition(direction);\n    }\n\n    return this._$focusedTag ? this._getFocusedTagPosition(direction) : this._getBorderPosition(\"end\");\n  },\n  _getBorderPosition: function (direction) {\n    var rtlEnabled = this.option(\"rtlEnabled\");\n    var isScrollLeft = \"end\" === direction ^ rtlEnabled;\n    var scrollSign = rtlEnabled ? -1 : 1;\n    return isScrollLeft ^ !rtlEnabled ? 0 : scrollSign * (this._$tagsContainer.get(0).scrollWidth - getOuterWidth(this._$tagsContainer));\n  },\n  _getFocusedTagPosition: function (direction) {\n    var rtlEnabled = this.option(\"rtlEnabled\");\n    var isScrollLeft = \"next\" === direction ^ rtlEnabled;\n\n    var {\n      left: scrollOffset\n    } = this._$focusedTag.position();\n\n    var scrollLeft = this._$tagsContainer.scrollLeft();\n\n    if (isScrollLeft) {\n      scrollOffset += getOuterWidth(this._$focusedTag, true) - getOuterWidth(this._$tagsContainer);\n    }\n\n    if (isScrollLeft ^ scrollOffset < 0) {\n      scrollLeft += scrollOffset;\n    }\n\n    return scrollLeft;\n  },\n  _setNextValue: noop,\n  _getDefaultOptions: function () {\n    return extend(this.callBase(), {\n      value: [],\n      showDropDownButton: false,\n      maxFilterQueryLength: 1500,\n      tagTemplate: \"tag\",\n      selectAllText: messageLocalization.format(\"dxList-selectAll\"),\n      hideSelectedItems: false,\n      selectedItems: [],\n      selectAllMode: \"page\",\n      onSelectAllValueChanged: null,\n      maxDisplayedTags: void 0,\n      showMultiTagOnly: true,\n      onMultiTagPreparing: null,\n      multiline: true,\n      useSubmitBehavior: true\n    });\n  },\n  _init: function () {\n    this.callBase();\n    this._selectedItems = [];\n\n    this._initSelectAllValueChangedAction();\n  },\n  _initActions: function () {\n    this.callBase();\n\n    this._initMultiTagPreparingAction();\n  },\n  _initMultiTagPreparingAction: function () {\n    this._multiTagPreparingAction = this._createActionByOption(\"onMultiTagPreparing\", {\n      beforeExecute: function (e) {\n        this._multiTagPreparingHandler(e.args[0]);\n      }.bind(this),\n      excludeValidators: [\"disabled\", \"readOnly\"]\n    });\n  },\n  _multiTagPreparingHandler: function (args) {\n    var {\n      length: selectedCount\n    } = this._getValue();\n\n    if (!this.option(\"showMultiTagOnly\")) {\n      args.text = messageLocalization.getFormatter(\"dxTagBox-moreSelected\")(selectedCount - this.option(\"maxDisplayedTags\") + 1);\n    } else {\n      args.text = messageLocalization.getFormatter(\"dxTagBox-selected\")(selectedCount);\n    }\n  },\n  _initDynamicTemplates: function () {\n    this.callBase();\n\n    this._templateManager.addDefaultTemplates({\n      tag: new BindableTemplate(($container, data) => {\n        var _data$text;\n\n        var $tagContent = $(\"<div>\").addClass(TAGBOX_TAG_CONTENT_CLASS);\n        $(\"<span>\").text(null !== (_data$text = data.text) && void 0 !== _data$text ? _data$text : data).appendTo($tagContent);\n        $(\"<div>\").addClass(TAGBOX_TAG_REMOVE_BUTTON_CLASS).appendTo($tagContent);\n        $container.append($tagContent);\n      }, [\"text\"], this.option(\"integrationOptions.watchMethod\"), {\n        text: this._displayGetter\n      })\n    });\n  },\n  _toggleSubmitElement: function (enabled) {\n    if (enabled) {\n      this._renderSubmitElement();\n\n      this._setSubmitValue();\n    } else {\n      this._$submitElement && this._$submitElement.remove();\n      delete this._$submitElement;\n    }\n  },\n  _renderSubmitElement: function () {\n    if (!this.option(\"useSubmitBehavior\")) {\n      return;\n    }\n\n    this._$submitElement = $(\"<select>\").attr(\"multiple\", \"multiple\").css(\"display\", \"none\").appendTo(this.$element());\n  },\n  _setSubmitValue: function () {\n    if (!this.option(\"useSubmitBehavior\")) {\n      return;\n    }\n\n    var value = this._getValue();\n\n    var $options = [];\n\n    for (var i = 0, n = value.length; i < n; i++) {\n      var useDisplayText = this._shouldUseDisplayValue(value[i]);\n\n      $options.push($(\"<option>\").val(useDisplayText ? this._displayGetter(value[i]) : value[i]).attr(\"selected\", \"selected\"));\n    }\n\n    this._getSubmitElement().empty().append($options);\n  },\n  _initMarkup: function () {\n    this._tagElementsCache = $();\n    var isSingleLineMode = !this.option(\"multiline\");\n    this.$element().addClass(TAGBOX_CLASS).toggleClass(TAGBOX_ONLY_SELECT_CLASS, !(this.option(\"searchEnabled\") || this.option(\"acceptCustomValue\"))).toggleClass(TAGBOX_SINGLE_LINE_CLASS, isSingleLineMode);\n\n    this._initTagTemplate();\n\n    this.callBase();\n  },\n  _render: function () {\n    this.callBase();\n\n    this._renderTagRemoveAction();\n\n    this._renderSingleLineScroll();\n\n    this._scrollContainer(\"start\");\n  },\n  _initTagTemplate: function () {\n    this._tagTemplate = this._getTemplateByOption(\"tagTemplate\");\n  },\n  _renderField: function () {\n    var isDefaultFieldTemplate = !isDefined(this.option(\"fieldTemplate\"));\n    this.$element().toggleClass(TAGBOX_DEFAULT_FIELD_TEMPLATE_CLASS, isDefaultFieldTemplate).toggleClass(TAGBOX_CUSTOM_FIELD_TEMPLATE_CLASS, !isDefaultFieldTemplate);\n    this.callBase();\n  },\n  _renderTagRemoveAction: function () {\n    var tagRemoveAction = this._createAction(this._removeTagHandler.bind(this));\n\n    var eventName = addNamespace(clickEvent, \"dxTagBoxTagRemove\");\n    eventsEngine.off(this._$tagsContainer, eventName);\n    eventsEngine.on(this._$tagsContainer, eventName, \".\".concat(TAGBOX_TAG_REMOVE_BUTTON_CLASS), event => {\n      tagRemoveAction({\n        event: event\n      });\n    });\n  },\n  _renderSingleLineScroll: function () {\n    var mouseWheelEvent = addNamespace(\"dxmousewheel\", this.NAME);\n    var $element = this.$element();\n    var isMultiline = this.option(\"multiline\");\n    eventsEngine.off($element, mouseWheelEvent);\n\n    if (\"desktop\" !== devices.real().deviceType) {\n      this._$tagsContainer && this._$tagsContainer.css(\"overflowX\", isMultiline ? \"\" : \"auto\");\n      return;\n    }\n\n    if (isMultiline) {\n      return;\n    }\n\n    eventsEngine.on($element, mouseWheelEvent, this._tagContainerMouseWheelHandler.bind(this));\n  },\n  _tagContainerMouseWheelHandler: function (e) {\n    var scrollLeft = this._$tagsContainer.scrollLeft();\n\n    var delta = e.delta * TAGBOX_MOUSE_WHEEL_DELTA_MULTIPLIER;\n\n    if (!isCommandKeyPressed(e) && allowScroll(this._$tagsContainer, delta, true)) {\n      this._$tagsContainer.scrollLeft(scrollLeft + delta);\n\n      return false;\n    }\n  },\n  _renderEvents: function () {\n    this.callBase();\n\n    var input = this._input();\n\n    var namespace = addNamespace(\"keydown\", this.NAME);\n    eventsEngine.on(input, namespace, e => {\n      var keyName = normalizeKeyName(e);\n\n      if (!this._isControlKey(keyName) && this._isEditable()) {\n        this._clearTagFocus();\n      }\n    });\n  },\n  _popupWrapperClass: function () {\n    return this.callBase() + \" \" + TAGBOX_POPUP_WRAPPER_CLASS;\n  },\n  _renderInput: function () {\n    this.callBase();\n\n    this._renderPreventBlurOnInputClick();\n  },\n  _renderPreventBlurOnInputClick: function () {\n    var eventName = addNamespace(\"mousedown\", \"dxTagBox\");\n    eventsEngine.off(this._inputWrapper(), eventName);\n    eventsEngine.on(this._inputWrapper(), eventName, e => {\n      if (e.target !== this._input()[0]) {\n        e.preventDefault();\n      }\n    });\n  },\n  _renderInputValueImpl: function () {\n    return this._renderMultiSelect();\n  },\n  _loadInputValue: function () {\n    return when();\n  },\n  _clearTextValue: function () {\n    this._input().val(\"\");\n\n    this._toggleEmptinessEventHandler();\n\n    this.option(\"text\", \"\");\n  },\n  _focusInHandler: function (e) {\n    if (!this._preventNestedFocusEvent(e)) {\n      this._scrollContainer(\"end\");\n    }\n\n    this.callBase(e);\n  },\n  _renderInputValue: function () {\n    this.option(\"displayValue\", this._searchValue());\n    return this.callBase();\n  },\n  _restoreInputText: function (saveEditingValue) {\n    if (!saveEditingValue) {\n      this._clearTextValue();\n    }\n  },\n  _focusOutHandler: function (e) {\n    if (!this._preventNestedFocusEvent(e)) {\n      this._clearTagFocus();\n\n      this._scrollContainer(\"start\");\n    }\n\n    this.callBase(e);\n  },\n  _getFirstPopupElement: function () {\n    return this.option(\"showSelectionControls\") ? this._list.$element() : this.callBase();\n  },\n  _initSelectAllValueChangedAction: function () {\n    this._selectAllValueChangeAction = this._createActionByOption(\"onSelectAllValueChanged\");\n  },\n  _renderList: function () {\n    this.callBase();\n\n    this._setListDataSourceFilter();\n\n    if (this.option(\"showSelectionControls\")) {\n      this._list.registerKeyHandler(\"tab\", e => this._popupElementTabHandler(e));\n\n      this._list.registerKeyHandler(\"escape\", e => this._popupElementEscHandler(e));\n    }\n  },\n  _canListHaveFocus: function () {\n    return \"useButtons\" === this.option(\"applyValueMode\");\n  },\n  _listConfig: function () {\n    var selectionMode = this.option(\"showSelectionControls\") ? \"all\" : \"multiple\";\n    return extend(this.callBase(), {\n      selectionMode: selectionMode,\n      selectAllText: this.option(\"selectAllText\"),\n      onSelectAllValueChanged: _ref => {\n        var {\n          value: value\n        } = _ref;\n\n        this._selectAllValueChangeAction({\n          value: value\n        });\n      },\n      selectAllMode: this.option(\"selectAllMode\"),\n      selectedItems: this._selectedItems,\n      onFocusedItemChanged: null\n    });\n  },\n  _renderMultiSelect: function () {\n    var d = new Deferred();\n\n    this._updateTagsContainer(this._$textEditorInputContainer);\n\n    this._renderInputSize();\n\n    this._renderTags().done(() => {\n      this._popup && this._popup.refreshPosition();\n      d.resolve();\n    }).fail(d.reject);\n\n    return d.promise();\n  },\n  _listItemClickHandler: function (e) {\n    !this.option(\"showSelectionControls\") && this._clearTextValue();\n\n    if (\"useButtons\" === this.option(\"applyValueMode\")) {\n      return;\n    }\n\n    this.callBase(e);\n\n    this._saveValueChangeEvent(void 0);\n  },\n  _shouldClearFilter: function () {\n    var shouldClearFilter = this.callBase();\n    var showSelectionControls = this.option(\"showSelectionControls\");\n    return !showSelectionControls && shouldClearFilter;\n  },\n  _renderInputSize: function () {\n    var $input = this._input();\n\n    var value = $input.val();\n    var isEmptyInput = isString(value) && value;\n    var width = \"\";\n    var size = \"\";\n    var canTypeText = this.option(\"searchEnabled\") || this.option(\"acceptCustomValue\");\n\n    if (isEmptyInput && canTypeText) {\n      var $calculationElement = createTextElementHiddenCopy($input, value, {\n        includePaddings: true\n      });\n      $calculationElement.insertAfter($input);\n      width = getOuterWidth($calculationElement) + 5;\n      $calculationElement.remove();\n    } else if (!value) {\n      size = 1;\n    }\n\n    $input.css(\"width\", width);\n    $input.attr(\"size\", size);\n  },\n  _renderInputSubstitution: function () {\n    this.callBase();\n\n    this._updateWidgetHeight();\n  },\n  _getValue: function () {\n    return this.option(\"value\") || [];\n  },\n  _multiTagRequired: function () {\n    var values = this._getValue();\n\n    var maxDisplayedTags = this.option(\"maxDisplayedTags\");\n    return isDefined(maxDisplayedTags) && values.length > maxDisplayedTags;\n  },\n  _renderMultiTag: function ($input) {\n    var $tag = $(\"<div>\").addClass(TAGBOX_TAG_CLASS).addClass(TAGBOX_MULTI_TAG_CLASS);\n    var args = {\n      multiTagElement: getPublicElement($tag),\n      selectedItems: this.option(\"selectedItems\")\n    };\n\n    this._multiTagPreparingAction(args);\n\n    if (args.cancel) {\n      return false;\n    }\n\n    $tag.data(TAGBOX_TAG_DATA_KEY, args.text);\n    $tag.insertBefore($input);\n\n    this._tagTemplate.render({\n      model: args.text,\n      container: getPublicElement($tag)\n    });\n\n    return $tag;\n  },\n  _getFilter: function (creator) {\n    var dataSourceFilter = this._dataSource.filter();\n\n    var filterExpr = creator.getCombinedFilter(this.option(\"valueExpr\"), dataSourceFilter);\n    var filterQueryLength = encodeURI(JSON.stringify(filterExpr)).length;\n    var maxFilterQueryLength = this.option(\"maxFilterQueryLength\");\n\n    if (filterQueryLength <= maxFilterQueryLength) {\n      return filterExpr;\n    }\n\n    errors.log(\"W1019\", maxFilterQueryLength);\n  },\n  _getFilteredItems: function (values) {\n    var _this$_loadFilteredIt, _this$_list, _this$_list$getDataSo;\n\n    null === (_this$_loadFilteredIt = this._loadFilteredItemsPromise) || void 0 === _this$_loadFilteredIt ? void 0 : _this$_loadFilteredIt.reject();\n    var creator = new FilterCreator(values);\n    var listSelectedItems = null === (_this$_list = this._list) || void 0 === _this$_list ? void 0 : _this$_list.option(\"selectedItems\");\n    var isListItemsLoaded = !!listSelectedItems && (null === (_this$_list$getDataSo = this._list.getDataSource()) || void 0 === _this$_list$getDataSo ? void 0 : _this$_list$getDataSo.isLoaded());\n    var selectedItems = listSelectedItems || this.option(\"selectedItems\");\n    var clientFilterFunction = creator.getLocalFilter(this._valueGetter);\n    var filteredItems = selectedItems.filter(clientFilterFunction);\n    var selectedItemsAlreadyLoaded = filteredItems.length === values.length;\n    var d = new Deferred();\n    var dataSource = this._dataSource;\n\n    if (!dataSource) {\n      return d.resolve([]).promise();\n    } else if ((!this._isDataSourceChanged || isListItemsLoaded) && selectedItemsAlreadyLoaded) {\n      return d.resolve(filteredItems).promise();\n    } else {\n      var {\n        customQueryParams: customQueryParams,\n        expand: expand,\n        select: select\n      } = dataSource.loadOptions();\n\n      var filter = this._getFilter(creator);\n\n      dataSource.store().load({\n        filter: filter,\n        customQueryParams: customQueryParams,\n        expand: expand,\n        select: select\n      }).done((data, extra) => {\n        this._isDataSourceChanged = false;\n\n        if (this._disposed) {\n          d.reject();\n          return;\n        }\n\n        var {\n          data: items\n        } = normalizeLoadResult(data, extra);\n\n        var mappedItems = dataSource._applyMapFunction(items);\n\n        d.resolve(mappedItems.filter(clientFilterFunction));\n      }).fail(d.reject);\n      this._loadFilteredItemsPromise = d;\n      return d.promise();\n    }\n  },\n  _createTagsData: function (values, filteredItems) {\n    var items = [];\n    var cache = {};\n\n    var isValueExprSpecified = \"this\" === this._valueGetterExpr();\n\n    var filteredValues = {};\n    filteredItems.forEach(filteredItem => {\n      var filteredItemValue = isValueExprSpecified ? JSON.stringify(filteredItem) : this._valueGetter(filteredItem);\n      filteredValues[filteredItemValue] = filteredItem;\n    });\n    var loadItemPromises = [];\n    values.forEach((value, index) => {\n      var currentItem = filteredValues[isValueExprSpecified ? JSON.stringify(value) : value];\n\n      if (isValueExprSpecified && !isDefined(currentItem)) {\n        loadItemPromises.push(this._loadItem(value, cache).always(item => {\n          var newItem = this._createTagData(items, item, value, index);\n\n          items.splice(index, 0, newItem);\n        }));\n      } else {\n        var newItem = this._createTagData(items, currentItem, value, index);\n\n        items.splice(index, 0, newItem);\n      }\n    });\n    var d = new Deferred();\n    when.apply(this, loadItemPromises).always(function () {\n      d.resolve(items);\n    });\n    return d.promise();\n  },\n  _createTagData: function (items, item, value, valueIndex) {\n    if (isDefined(item)) {\n      this._selectedItems.push(item);\n\n      return item;\n    } else {\n      var selectedItem = this.option(\"selectedItem\");\n      var customItem = this._valueGetter(selectedItem) === value ? selectedItem : value;\n      return customItem;\n    }\n  },\n  _isGroupedData: function () {\n    var _this$_dataSource;\n\n    return this.option(\"grouped\") && !(null !== (_this$_dataSource = this._dataSource) && void 0 !== _this$_dataSource && _this$_dataSource.group());\n  },\n  _getItemsByValues: function (values) {\n    var resultItems = [];\n    values.forEach(function (value) {\n      var item = this._getItemFromPlain(value);\n\n      if (isDefined(item)) {\n        resultItems.push(item);\n      }\n    }.bind(this));\n    return resultItems;\n  },\n  _getFilteredGroupedItems: function (values) {\n    var selectedItems = new Deferred();\n\n    if (!this._dataSource) {\n      return selectedItems.promise();\n    }\n\n    if (this._filteredGroupedItemsLoadPromise) {\n      this._dataSource.cancel(this._filteredGroupedItemsLoadPromise.operationId);\n    }\n\n    if (!this._dataSource.items().length) {\n      this._filteredGroupedItemsLoadPromise = this._dataSource.load().done(() => {\n        selectedItems.resolve(this._getItemsByValues(values));\n      }).fail(() => {\n        selectedItems.resolve([]);\n      }).always(() => {\n        this._filteredGroupedItemsLoadPromise = void 0;\n      });\n    } else {\n      selectedItems.resolve(this._getItemsByValues(values));\n    }\n\n    return selectedItems.promise();\n  },\n  _loadTagsData: function () {\n    var values = this._getValue();\n\n    var tagData = new Deferred();\n    this._selectedItems = [];\n    var filteredItemsPromise = this._isGroupedData() ? this._getFilteredGroupedItems(values) : this._getFilteredItems(values);\n    filteredItemsPromise.done(filteredItems => {\n      var items = this._createTagsData(values, filteredItems);\n\n      items.always(function (data) {\n        tagData.resolve(data);\n      });\n    }).fail(tagData.reject.bind(this));\n    return tagData.promise();\n  },\n  _renderTags: function () {\n    var d = new Deferred();\n    var isPlainDataUsed = false;\n\n    if (this._shouldGetItemsFromPlain(this._valuesToUpdate)) {\n      this._selectedItems = this._getItemsFromPlain(this._valuesToUpdate);\n\n      if (this._selectedItems.length === this._valuesToUpdate.length) {\n        this._renderTagsImpl(this._selectedItems);\n\n        isPlainDataUsed = true;\n        d.resolve();\n      }\n    }\n\n    if (!isPlainDataUsed) {\n      this._loadTagsData().done(items => {\n        if (this._disposed) {\n          d.reject();\n          return;\n        }\n\n        this._renderTagsImpl(items);\n\n        d.resolve();\n      }).fail(d.reject);\n    }\n\n    return d.promise();\n  },\n  _renderTagsImpl: function (items) {\n    this._renderTagsCore(items);\n\n    this._renderEmptyState();\n\n    if (!this._preserveFocusedTag) {\n      this._clearTagFocus();\n    }\n  },\n  _shouldGetItemsFromPlain: function (values) {\n    return values && this._dataSource.isLoaded() && values.length <= this._getPlainItems().length;\n  },\n  _getItemsFromPlain: function (values) {\n    var selectedItems = this._getSelectedItemsFromList(values);\n\n    var needFilterPlainItems = 0 === selectedItems.length && values.length > 0 || selectedItems.length < values.length;\n\n    if (needFilterPlainItems) {\n      var plainItems = this._getPlainItems();\n\n      selectedItems = this._filterSelectedItems(plainItems, values);\n    }\n\n    return selectedItems;\n  },\n  _getSelectedItemsFromList: function (values) {\n    var _this$_list2;\n\n    var listSelectedItems = null === (_this$_list2 = this._list) || void 0 === _this$_list2 ? void 0 : _this$_list2.option(\"selectedItems\");\n    var selectedItems = [];\n\n    if (values.length === (null === listSelectedItems || void 0 === listSelectedItems ? void 0 : listSelectedItems.length)) {\n      selectedItems = this._filterSelectedItems(listSelectedItems, values);\n    }\n\n    return selectedItems;\n  },\n  _filterSelectedItems: function (plainItems, values) {\n    var selectedItems = plainItems.filter(dataItem => {\n      var currentValue;\n\n      for (var i = 0; i < values.length; i++) {\n        currentValue = values[i];\n\n        if (isObject(currentValue)) {\n          if (this._isValueEquals(dataItem, currentValue)) {\n            return true;\n          }\n        } else if (this._isValueEquals(this._valueGetter(dataItem), currentValue)) {\n          return true;\n        }\n      }\n\n      return false;\n    }, this);\n    return selectedItems;\n  },\n  _integrateInput: function () {\n    this._isInputReady.resolve();\n\n    this.callBase();\n\n    this._updateTagsContainer($(\".\".concat(TEXTEDITOR_INPUT_CONTAINER_CLASS)));\n\n    this._renderTagRemoveAction();\n  },\n  _renderTagsCore: function (items) {\n    var _this$_isInputReady;\n\n    null === (_this$_isInputReady = this._isInputReady) || void 0 === _this$_isInputReady ? void 0 : _this$_isInputReady.reject();\n    this._isInputReady = new Deferred();\n\n    this._renderField();\n\n    this.option(\"selectedItems\", this._selectedItems.slice());\n\n    this._cleanTags();\n\n    if (this._input().length > 0) {\n      this._isInputReady.resolve();\n    }\n\n    when(this._isInputReady).done(() => {\n      this._renderTagsElements(items);\n    });\n  },\n\n  _renderTagsElements(items) {\n    var $multiTag = this._multiTagRequired() && this._renderMultiTag(this._input());\n\n    var showMultiTagOnly = this.option(\"showMultiTagOnly\");\n    var maxDisplayedTags = this.option(\"maxDisplayedTags\");\n    items.forEach((item, index) => {\n      if ($multiTag && showMultiTagOnly || $multiTag && !showMultiTagOnly && index - maxDisplayedTags >= -1) {\n        return false;\n      }\n\n      this._renderTag(item, $multiTag || this._input());\n    });\n\n    if (this._isFocused()) {\n      this._scrollContainer(\"end\");\n    }\n\n    this._refreshTagElements();\n  },\n\n  _cleanTags: function () {\n    if (this._multiTagRequired()) {\n      this._tagElements().remove();\n    } else {\n      var $tags = this._tagElements();\n\n      var values = this._getValue();\n\n      each($tags, function (_, tag) {\n        var $tag = $(tag);\n        var tagData = $tag.data(TAGBOX_TAG_DATA_KEY);\n\n        if (!(null !== values && void 0 !== values && values.includes(tagData))) {\n          $tag.remove();\n        }\n      });\n    }\n  },\n  _renderEmptyState: function () {\n    var isEmpty = !(this._getValue().length || this._selectedItems.length || this._searchValue());\n\n    this._toggleEmptiness(isEmpty);\n\n    this._renderDisplayText();\n  },\n  _renderDisplayText: function () {\n    this._renderInputSize();\n  },\n  _refreshTagElements: function () {\n    this._tagElementsCache = this.$element().find(\".\".concat(TAGBOX_TAG_CLASS));\n  },\n  _tagElements: function () {\n    return this._tagElementsCache;\n  },\n  _applyTagTemplate: function (item, $tag) {\n    this._tagTemplate.render({\n      model: item,\n      container: getPublicElement($tag)\n    });\n  },\n  _renderTag: function (item, $input) {\n    var value = this._valueGetter(item);\n\n    if (!isDefined(value)) {\n      return;\n    }\n\n    var $tag = this._getTag(value);\n\n    var displayValue = this._displayGetter(item);\n\n    var itemModel = this._getItemModel(item, displayValue);\n\n    if ($tag) {\n      if (isDefined(displayValue)) {\n        $tag.empty();\n\n        this._applyTagTemplate(itemModel, $tag);\n      }\n\n      $tag.removeClass(TAGBOX_CUSTOM_TAG_CLASS);\n    } else {\n      $tag = this._createTag(value, $input);\n\n      if (isDefined(item)) {\n        this._applyTagTemplate(itemModel, $tag);\n      } else {\n        $tag.addClass(TAGBOX_CUSTOM_TAG_CLASS);\n\n        this._applyTagTemplate(value, $tag);\n      }\n    }\n  },\n  _getItemModel: function (item, displayValue) {\n    if (isObject(item) && isDefined(displayValue)) {\n      return item;\n    } else {\n      return ensureDefined(displayValue, \"\");\n    }\n  },\n  _getTag: function (value) {\n    var $tags = this._tagElements();\n\n    var tagsLength = $tags.length;\n    var result = false;\n\n    for (var i = 0; i < tagsLength; i++) {\n      var $tag = $tags[i];\n      var tagData = elementData($tag, TAGBOX_TAG_DATA_KEY);\n\n      if (value === tagData || equalByValue(value, tagData)) {\n        result = $($tag);\n        break;\n      }\n    }\n\n    return result;\n  },\n  _createTag: function (value, $input) {\n    return $(\"<div>\").addClass(TAGBOX_TAG_CLASS).data(TAGBOX_TAG_DATA_KEY, value).insertBefore($input);\n  },\n  _toggleEmptinessEventHandler: function () {\n    this._toggleEmptiness(!this._getValue().length && !this._searchValue().length);\n  },\n  _customItemAddedHandler: function (e) {\n    this.callBase(e);\n\n    this._clearTextValue();\n  },\n  _removeTagHandler: function (args) {\n    var e = args.event;\n    e.stopPropagation();\n\n    this._saveValueChangeEvent(e);\n\n    var $tag = $(e.target).closest(\".\".concat(TAGBOX_TAG_CLASS));\n\n    this._removeTagElement($tag);\n  },\n  _removeTagElement: function ($tag) {\n    if ($tag.hasClass(TAGBOX_MULTI_TAG_CLASS)) {\n      if (!this.option(\"showMultiTagOnly\")) {\n        this.option(\"value\", this._getValue().slice(0, this.option(\"maxDisplayedTags\")));\n      } else {\n        this.reset();\n      }\n\n      return;\n    }\n\n    var itemValue = $tag.data(TAGBOX_TAG_DATA_KEY);\n\n    this._removeTagWithUpdate(itemValue);\n\n    this._refreshTagElements();\n  },\n  _updateField: noop,\n  _removeTagWithUpdate: function (itemValue) {\n    var value = this._getValue().slice();\n\n    this._removeTag(value, itemValue);\n\n    this.option(\"value\", value);\n\n    if (0 === value.length) {\n      this._clearTagFocus();\n    }\n  },\n  _getCurrentValue: function () {\n    return this._lastValue();\n  },\n  _selectionChangeHandler: function (e) {\n    if (\"useButtons\" === this.option(\"applyValueMode\")) {\n      return;\n    }\n\n    var value = this._getValue().slice();\n\n    each(e.removedItems || [], (_, removedItem) => {\n      this._removeTag(value, this._valueGetter(removedItem));\n    });\n    each(e.addedItems || [], (_, addedItem) => {\n      this._addTag(value, this._valueGetter(addedItem));\n    });\n\n    this._updateWidgetHeight();\n\n    if (!equalByValue(this._list.option(\"selectedItemKeys\"), this.option(\"value\"))) {\n      var listSelectionChangeEvent = this._list._getSelectionChangeEvent();\n\n      listSelectionChangeEvent && this._saveValueChangeEvent(listSelectionChangeEvent);\n      this.option(\"value\", value);\n    }\n\n    this._list._saveSelectionChangeEvent(void 0);\n  },\n  _removeTag: function (value, item) {\n    var index = this._valueIndex(item, value);\n\n    if (index >= 0) {\n      value.splice(index, 1);\n    }\n  },\n  _addTag: function (value, item) {\n    var index = this._valueIndex(item);\n\n    if (index < 0) {\n      value.push(item);\n    }\n  },\n  _fieldRenderData: function () {\n    return this._selectedItems.slice();\n  },\n  _completeSelection: function (value) {\n    if (!this.option(\"showSelectionControls\")) {\n      this._setValue(value);\n    }\n  },\n  _setValue: function (value) {\n    if (null === value) {\n      return;\n    }\n\n    var useButtons = \"useButtons\" === this.option(\"applyValueMode\");\n\n    var valueIndex = this._valueIndex(value);\n\n    var values = (useButtons ? this._list.option(\"selectedItemKeys\") : this._getValue()).slice();\n\n    if (valueIndex >= 0) {\n      values.splice(valueIndex, 1);\n    } else {\n      values.push(value);\n    }\n\n    if (\"useButtons\" === this.option(\"applyValueMode\")) {\n      this._list.option(\"selectedItemKeys\", values);\n    } else {\n      this.option(\"value\", values);\n    }\n  },\n  _isSelectedValue: function (value, cache) {\n    return this._valueIndex(value, null, cache) > -1;\n  },\n  _valueIndex: function (value, values, cache) {\n    var result = -1;\n\n    if (cache && \"object\" !== typeof value) {\n      if (!cache.indexByValues) {\n        cache.indexByValues = {};\n        values = values || this._getValue();\n        values.forEach(function (value, index) {\n          cache.indexByValues[value] = index;\n        });\n      }\n\n      if (value in cache.indexByValues) {\n        return cache.indexByValues[value];\n      }\n    }\n\n    values = values || this._getValue();\n    each(values, (index, selectedValue) => {\n      if (this._isValueEquals(value, selectedValue)) {\n        result = index;\n        return false;\n      }\n    });\n    return result;\n  },\n  _lastValue: function () {\n    var values = this._getValue();\n\n    var lastValue = values[values.length - 1];\n    return null !== lastValue && void 0 !== lastValue ? lastValue : null;\n  },\n  _valueChangeEventHandler: noop,\n  _shouldRenderSearchEvent: function () {\n    return this.option(\"searchEnabled\") || this.option(\"acceptCustomValue\");\n  },\n  _searchHandler: function (e) {\n    if (this.option(\"searchEnabled\") && !!e && !this._isTagRemoved) {\n      this.callBase(arguments);\n\n      this._setListDataSourceFilter();\n    }\n\n    this._updateWidgetHeight();\n\n    delete this._isTagRemoved;\n  },\n  _updateWidgetHeight: function () {\n    var element = this.$element();\n    var originalHeight = getHeight(element);\n\n    this._renderInputSize();\n\n    var currentHeight = getHeight(element);\n\n    if (this._popup && this.option(\"opened\") && this._isEditable() && currentHeight !== originalHeight) {\n      this._popup.repaint();\n    }\n  },\n  _refreshSelected: function () {\n    var _this$_list3;\n\n    (null === (_this$_list3 = this._list) || void 0 === _this$_list3 ? void 0 : _this$_list3.getDataSource()) && this._list.option(\"selectedItems\", this._selectedItems);\n  },\n  _resetListDataSourceFilter: function () {\n    var dataSource = this._getDataSource();\n\n    if (!dataSource) {\n      return;\n    }\n\n    delete this._userFilter;\n    dataSource.filter(null);\n    dataSource.reload();\n  },\n  _setListDataSourceFilter: function () {\n    if (!this.option(\"hideSelectedItems\") || !this._list) {\n      return;\n    }\n\n    var dataSource = this._getDataSource();\n\n    if (!dataSource) {\n      return;\n    }\n\n    var valueGetterExpr = this._valueGetterExpr();\n\n    if (isString(valueGetterExpr) && \"this\" !== valueGetterExpr) {\n      var filter = this._dataSourceFilterExpr();\n\n      if (void 0 === this._userFilter) {\n        this._userFilter = dataSource.filter() || null;\n      }\n\n      this._userFilter && filter.push(this._userFilter);\n      filter.length ? dataSource.filter(filter) : dataSource.filter(null);\n    } else {\n      dataSource.filter(this._dataSourceFilterFunction.bind(this));\n    }\n\n    dataSource.load();\n  },\n  _dataSourceFilterExpr: function () {\n    var filter = [];\n    each(this._getValue(), (index, value) => {\n      filter.push([\"!\", [this._valueGetterExpr(), value]]);\n    });\n    return filter;\n  },\n  _dataSourceFilterFunction: function (itemData) {\n    var itemValue = this._valueGetter(itemData);\n\n    var result = true;\n    each(this._getValue(), (index, value) => {\n      if (this._isValueEquals(value, itemValue)) {\n        result = false;\n        return false;\n      }\n    });\n    return result;\n  },\n  _dataSourceChangedHandler: function () {\n    this._isDataSourceChanged = true;\n    this.callBase.apply(this, arguments);\n  },\n  _applyButtonHandler: function (args) {\n    this._saveValueChangeEvent(args.event);\n\n    this.option(\"value\", this._getSortedListValues());\n\n    this._clearTextValue();\n\n    this.callBase();\n\n    this._cancelSearchIfNeed();\n  },\n  _getSortedListValues: function () {\n    var listValues = this._getListValues();\n\n    var currentValue = this.option(\"value\") || [];\n    var existedItems = listValues.length ? currentValue.filter(item => -1 !== listValues.indexOf(item)) : [];\n    var newItems = existedItems.length ? listValues.filter(item => -1 === currentValue.indexOf(item)) : listValues;\n    return existedItems.concat(newItems);\n  },\n  _getListValues: function () {\n    if (!this._list) {\n      return [];\n    }\n\n    var selectedItems = this._getPlainItems(this._list.option(\"selectedItems\"));\n\n    var result = [];\n    each(selectedItems, (index, item) => {\n      result[index] = this._valueGetter(item);\n    });\n    return result;\n  },\n  _setListDataSource: function () {\n    var currentValue = this._getValue();\n\n    this.callBase();\n\n    if (currentValue !== this.option(\"value\")) {\n      this.option(\"value\", currentValue);\n    }\n\n    this._refreshSelected();\n  },\n  _renderOpenedState: function () {\n    this.callBase();\n\n    if (\"useButtons\" === this.option(\"applyValueMode\") && !this.option(\"opened\")) {\n      this._refreshSelected();\n    }\n  },\n  reset: function () {\n    this._restoreInputText();\n\n    var defaultValue = this._getDefaultOptions().value;\n\n    var currentValue = this.option(\"value\");\n\n    if (defaultValue && 0 === defaultValue.length && currentValue && defaultValue.length === currentValue.length) {\n      return;\n    }\n\n    this.callBase();\n  },\n  _clean: function () {\n    this.callBase();\n    delete this._defaultTagTemplate;\n    delete this._valuesToUpdate;\n    delete this._tagTemplate;\n  },\n  _removeDuplicates: function (from, what) {\n    var result = [];\n    each(from, (_, value) => {\n      var filteredItems = what.filter(item => this._valueGetter(value) === this._valueGetter(item));\n\n      if (!filteredItems.length) {\n        result.push(value);\n      }\n    });\n    return result;\n  },\n  _optionChanged: function (args) {\n    switch (args.name) {\n      case \"onSelectAllValueChanged\":\n        this._initSelectAllValueChangedAction();\n\n        break;\n\n      case \"onMultiTagPreparing\":\n        this._initMultiTagPreparingAction();\n\n        this._renderTags();\n\n        break;\n\n      case \"hideSelectedItems\":\n        if (args.value) {\n          this._setListDataSourceFilter();\n        } else {\n          this._resetListDataSourceFilter();\n        }\n\n        break;\n\n      case \"useSubmitBehavior\":\n        this._toggleSubmitElement(args.value);\n\n        break;\n\n      case \"displayExpr\":\n        this.callBase(args);\n\n        this._initTemplates();\n\n        this._invalidate();\n\n        break;\n\n      case \"tagTemplate\":\n        this._initTagTemplate();\n\n        this._invalidate();\n\n        break;\n\n      case \"selectAllText\":\n        this._setListOption(\"selectAllText\", this.option(\"selectAllText\"));\n\n        break;\n\n      case \"readOnly\":\n      case \"disabled\":\n        this.callBase(args);\n        !args.value && this._refreshEvents();\n        break;\n\n      case \"value\":\n        this._valuesToUpdate = null === args || void 0 === args ? void 0 : args.value;\n        this.callBase(args);\n        this._valuesToUpdate = void 0;\n\n        this._setListDataSourceFilter();\n\n        break;\n\n      case \"maxDisplayedTags\":\n      case \"showMultiTagOnly\":\n        this._renderTags();\n\n        break;\n\n      case \"selectAllMode\":\n        this._setListOption(args.name, args.value);\n\n        break;\n\n      case \"selectedItem\":\n        break;\n\n      case \"selectedItems\":\n        this._selectionChangedAction({\n          addedItems: this._removeDuplicates(args.value, args.previousValue),\n          removedItems: this._removeDuplicates(args.previousValue, args.value)\n        });\n\n        break;\n\n      case \"multiline\":\n        this.$element().toggleClass(TAGBOX_SINGLE_LINE_CLASS, !args.value);\n\n        this._renderSingleLineScroll();\n\n        break;\n\n      case \"maxFilterQueryLength\":\n        break;\n\n      default:\n        this.callBase(args);\n    }\n  },\n  _getActualSearchValue: function () {\n    return this.callBase() || this._searchValue();\n  },\n  _popupHidingHandler: function () {\n    this.callBase();\n\n    this._clearFilter();\n  }\n});\nregisterComponent(\"dxTagBox\", TagBox);\nexport default TagBox;","map":{"version":3,"sources":["/Users/krunalpatel/Downloads/React-Firebase-Auth-master 3/node_modules/devextreme/esm/ui/tag_box.js"],"names":["getOuterWidth","getHeight","$","devices","data","elementData","eventsEngine","registerComponent","noop","ensureDefined","equalByValue","SelectionFilterCreator","FilterCreator","Deferred","when","createTextElementHiddenCopy","getPublicElement","isDefined","isObject","isString","hasWindow","extend","each","messageLocalization","addNamespace","isCommandKeyPressed","normalizeKeyName","name","clickEvent","caret","normalizeLoadResult","SelectBox","BindableTemplate","allowScroll","errors","TAGBOX_TAG_DATA_KEY","TAGBOX_CLASS","TAGBOX_TAG_CONTAINER_CLASS","TAGBOX_TAG_CLASS","TAGBOX_MULTI_TAG_CLASS","TAGBOX_CUSTOM_TAG_CLASS","TAGBOX_TAG_REMOVE_BUTTON_CLASS","TAGBOX_ONLY_SELECT_CLASS","TAGBOX_SINGLE_LINE_CLASS","TAGBOX_POPUP_WRAPPER_CLASS","TAGBOX_TAG_CONTENT_CLASS","TAGBOX_DEFAULT_FIELD_TEMPLATE_CLASS","TAGBOX_CUSTOM_FIELD_TEMPLATE_CLASS","TEXTEDITOR_INPUT_CONTAINER_CLASS","TAGBOX_MOUSE_WHEEL_DELTA_MULTIPLIER","TagBox","inherit","_supportedKeys","parent","callBase","sendToList","options","_list","_keyboardHandler","rtlEnabled","option","backspace","e","_isCaretAtTheStart","_processKeyboardEvent","_isTagRemoved","$tagToDelete","_$focusedTag","_tagElements","last","_moveTagFocus","length","_preserveFocusedTag","_removeTagElement","upArrow","opts","altKey","call","downArrow","del","enter","isListItemFocused","isCustomItem","preventDefault","_searchValue","_customItemAddedHandler","_saveValueChangeEvent","space","isOpened","isInputActive","_shouldRenderSearchEvent","leftArrow","_isEmpty","_isEditable","direction","_scrollContainer","rightArrow","stopPropagation","_getValue","_updateTagsContainer","$element","_$tagsContainer","addClass","_allowSelectItemByTab","position","_input","start","end","clearOnBoundary","tagElements","first","_toggleFocusClass","$nextFocusedTag","concat","_replaceFocusedTag","_clearTagFocus","_focusClassTarget","_focusTarget","_getLabelContainer","scrollPosition","_getScrollPosition","scrollLeft","_getBorderPosition","_getFocusedTagPosition","isScrollLeft","scrollSign","get","scrollWidth","left","scrollOffset","_setNextValue","_getDefaultOptions","value","showDropDownButton","maxFilterQueryLength","tagTemplate","selectAllText","format","hideSelectedItems","selectedItems","selectAllMode","onSelectAllValueChanged","maxDisplayedTags","showMultiTagOnly","onMultiTagPreparing","multiline","useSubmitBehavior","_init","_selectedItems","_initSelectAllValueChangedAction","_initActions","_initMultiTagPreparingAction","_multiTagPreparingAction","_createActionByOption","beforeExecute","_multiTagPreparingHandler","args","bind","excludeValidators","selectedCount","text","getFormatter","_initDynamicTemplates","_templateManager","addDefaultTemplates","tag","$container","_data$text","$tagContent","appendTo","append","_displayGetter","_toggleSubmitElement","enabled","_renderSubmitElement","_setSubmitValue","_$submitElement","remove","attr","css","$options","i","n","useDisplayText","_shouldUseDisplayValue","push","val","_getSubmitElement","empty","_initMarkup","_tagElementsCache","isSingleLineMode","toggleClass","_initTagTemplate","_render","_renderTagRemoveAction","_renderSingleLineScroll","_tagTemplate","_getTemplateByOption","_renderField","isDefaultFieldTemplate","tagRemoveAction","_createAction","_removeTagHandler","eventName","off","on","event","mouseWheelEvent","NAME","isMultiline","real","deviceType","_tagContainerMouseWheelHandler","delta","_renderEvents","input","namespace","keyName","_isControlKey","_popupWrapperClass","_renderInput","_renderPreventBlurOnInputClick","_inputWrapper","target","_renderInputValueImpl","_renderMultiSelect","_loadInputValue","_clearTextValue","_toggleEmptinessEventHandler","_focusInHandler","_preventNestedFocusEvent","_renderInputValue","_restoreInputText","saveEditingValue","_focusOutHandler","_getFirstPopupElement","_selectAllValueChangeAction","_renderList","_setListDataSourceFilter","registerKeyHandler","_popupElementTabHandler","_popupElementEscHandler","_canListHaveFocus","_listConfig","selectionMode","_ref","onFocusedItemChanged","d","_$textEditorInputContainer","_renderInputSize","_renderTags","done","_popup","refreshPosition","resolve","fail","reject","promise","_listItemClickHandler","_shouldClearFilter","shouldClearFilter","showSelectionControls","$input","isEmptyInput","width","size","canTypeText","$calculationElement","includePaddings","insertAfter","_renderInputSubstitution","_updateWidgetHeight","_multiTagRequired","values","_renderMultiTag","$tag","multiTagElement","cancel","insertBefore","render","model","container","_getFilter","creator","dataSourceFilter","_dataSource","filter","filterExpr","getCombinedFilter","filterQueryLength","encodeURI","JSON","stringify","log","_getFilteredItems","_this$_loadFilteredIt","_this$_list","_this$_list$getDataSo","_loadFilteredItemsPromise","listSelectedItems","isListItemsLoaded","getDataSource","isLoaded","clientFilterFunction","getLocalFilter","_valueGetter","filteredItems","selectedItemsAlreadyLoaded","dataSource","_isDataSourceChanged","customQueryParams","expand","select","loadOptions","store","load","extra","_disposed","items","mappedItems","_applyMapFunction","_createTagsData","cache","isValueExprSpecified","_valueGetterExpr","filteredValues","forEach","filteredItem","filteredItemValue","loadItemPromises","index","currentItem","_loadItem","always","item","newItem","_createTagData","splice","apply","valueIndex","selectedItem","customItem","_isGroupedData","_this$_dataSource","group","_getItemsByValues","resultItems","_getItemFromPlain","_getFilteredGroupedItems","_filteredGroupedItemsLoadPromise","operationId","_loadTagsData","tagData","filteredItemsPromise","isPlainDataUsed","_shouldGetItemsFromPlain","_valuesToUpdate","_getItemsFromPlain","_renderTagsImpl","_renderTagsCore","_renderEmptyState","_getPlainItems","_getSelectedItemsFromList","needFilterPlainItems","plainItems","_filterSelectedItems","_this$_list2","dataItem","currentValue","_isValueEquals","_integrateInput","_isInputReady","_this$_isInputReady","slice","_cleanTags","_renderTagsElements","$multiTag","_renderTag","_isFocused","_refreshTagElements","$tags","_","includes","isEmpty","_toggleEmptiness","_renderDisplayText","find","_applyTagTemplate","_getTag","displayValue","itemModel","_getItemModel","removeClass","_createTag","tagsLength","result","closest","hasClass","reset","itemValue","_removeTagWithUpdate","_updateField","_removeTag","_getCurrentValue","_lastValue","_selectionChangeHandler","removedItems","removedItem","addedItems","addedItem","_addTag","listSelectionChangeEvent","_getSelectionChangeEvent","_saveSelectionChangeEvent","_valueIndex","_fieldRenderData","_completeSelection","_setValue","useButtons","_isSelectedValue","indexByValues","selectedValue","lastValue","_valueChangeEventHandler","_searchHandler","arguments","element","originalHeight","currentHeight","repaint","_refreshSelected","_this$_list3","_resetListDataSourceFilter","_getDataSource","_userFilter","reload","valueGetterExpr","_dataSourceFilterExpr","_dataSourceFilterFunction","itemData","_dataSourceChangedHandler","_applyButtonHandler","_getSortedListValues","_cancelSearchIfNeed","listValues","_getListValues","existedItems","indexOf","newItems","_setListDataSource","_renderOpenedState","defaultValue","_clean","_defaultTagTemplate","_removeDuplicates","from","what","_optionChanged","_initTemplates","_invalidate","_setListOption","_refreshEvents","_selectionChangedAction","previousValue","_getActualSearchValue","_popupHidingHandler","_clearFilter"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (esm/ui/tag_box.js)\r\n * Version: 22.1.3\r\n * Build date: Mon Jun 13 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport {\r\n    getOuterWidth,\r\n    getHeight\r\n} from \"../core/utils/size\";\r\nimport $ from \"../core/renderer\";\r\nimport devices from \"../core/devices\";\r\nimport {\r\n    data as elementData\r\n} from \"../core/element_data\";\r\nimport eventsEngine from \"../events/core/events_engine\";\r\nimport registerComponent from \"../core/component_registrator\";\r\nimport {\r\n    noop,\r\n    ensureDefined,\r\n    equalByValue\r\n} from \"../core/utils/common\";\r\nimport {\r\n    SelectionFilterCreator as FilterCreator\r\n} from \"../core/utils/selection_filter\";\r\nimport {\r\n    Deferred,\r\n    when\r\n} from \"../core/utils/deferred\";\r\nimport {\r\n    createTextElementHiddenCopy\r\n} from \"../core/utils/dom\";\r\nimport {\r\n    getPublicElement\r\n} from \"../core/element\";\r\nimport {\r\n    isDefined,\r\n    isObject,\r\n    isString\r\n} from \"../core/utils/type\";\r\nimport {\r\n    hasWindow\r\n} from \"../core/utils/window\";\r\nimport {\r\n    extend\r\n} from \"../core/utils/extend\";\r\nimport {\r\n    each\r\n} from \"../core/utils/iterator\";\r\nimport messageLocalization from \"../localization/message\";\r\nimport {\r\n    addNamespace,\r\n    isCommandKeyPressed,\r\n    normalizeKeyName\r\n} from \"../events/utils/index\";\r\nimport {\r\n    name as clickEvent\r\n} from \"../events/click\";\r\nimport caret from \"./text_box/utils.caret\";\r\nimport {\r\n    normalizeLoadResult\r\n} from \"../data/data_source/utils\";\r\nimport SelectBox from \"./select_box\";\r\nimport {\r\n    BindableTemplate\r\n} from \"../core/templates/bindable_template\";\r\nimport {\r\n    allowScroll\r\n} from \"./text_box/utils.scroll\";\r\nimport errors from \"./widget/ui.errors\";\r\nvar TAGBOX_TAG_DATA_KEY = \"dxTagData\";\r\nvar TAGBOX_CLASS = \"dx-tagbox\";\r\nvar TAGBOX_TAG_CONTAINER_CLASS = \"dx-tag-container\";\r\nvar TAGBOX_TAG_CLASS = \"dx-tag\";\r\nvar TAGBOX_MULTI_TAG_CLASS = \"dx-tagbox-multi-tag\";\r\nvar TAGBOX_CUSTOM_TAG_CLASS = \"dx-tag-custom\";\r\nvar TAGBOX_TAG_REMOVE_BUTTON_CLASS = \"dx-tag-remove-button\";\r\nvar TAGBOX_ONLY_SELECT_CLASS = \"dx-tagbox-only-select\";\r\nvar TAGBOX_SINGLE_LINE_CLASS = \"dx-tagbox-single-line\";\r\nvar TAGBOX_POPUP_WRAPPER_CLASS = \"dx-tagbox-popup-wrapper\";\r\nvar TAGBOX_TAG_CONTENT_CLASS = \"dx-tag-content\";\r\nvar TAGBOX_DEFAULT_FIELD_TEMPLATE_CLASS = \"dx-tagbox-default-template\";\r\nvar TAGBOX_CUSTOM_FIELD_TEMPLATE_CLASS = \"dx-tagbox-custom-template\";\r\nvar TEXTEDITOR_INPUT_CONTAINER_CLASS = \"dx-texteditor-input-container\";\r\nvar TAGBOX_MOUSE_WHEEL_DELTA_MULTIPLIER = -.3;\r\nvar TagBox = SelectBox.inherit({\r\n    _supportedKeys: function() {\r\n        var parent = this.callBase();\r\n        var sendToList = options => this._list._keyboardHandler(options);\r\n        var rtlEnabled = this.option(\"rtlEnabled\");\r\n        return extend({}, parent, {\r\n            backspace: function(e) {\r\n                if (!this._isCaretAtTheStart()) {\r\n                    return\r\n                }\r\n                this._processKeyboardEvent(e);\r\n                this._isTagRemoved = true;\r\n                var $tagToDelete = this._$focusedTag || this._tagElements().last();\r\n                if (this._$focusedTag) {\r\n                    this._moveTagFocus(\"prev\", true)\r\n                }\r\n                if (0 === $tagToDelete.length) {\r\n                    return\r\n                }\r\n                this._preserveFocusedTag = true;\r\n                this._removeTagElement($tagToDelete);\r\n                delete this._preserveFocusedTag\r\n            },\r\n            upArrow: (e, opts) => e.altKey || !this._list ? parent.upArrow.call(this, e) : sendToList(opts),\r\n            downArrow: (e, opts) => e.altKey || !this._list ? parent.downArrow.call(this, e) : sendToList(opts),\r\n            del: function(e) {\r\n                if (!this._$focusedTag || !this._isCaretAtTheStart()) {\r\n                    return\r\n                }\r\n                this._processKeyboardEvent(e);\r\n                this._isTagRemoved = true;\r\n                var $tagToDelete = this._$focusedTag;\r\n                this._moveTagFocus(\"next\", true);\r\n                this._preserveFocusedTag = true;\r\n                this._removeTagElement($tagToDelete);\r\n                delete this._preserveFocusedTag\r\n            },\r\n            enter: function(e, options) {\r\n                var isListItemFocused = this._list && null !== this._list.option(\"focusedElement\");\r\n                var isCustomItem = this.option(\"acceptCustomValue\") && !isListItemFocused;\r\n                if (isCustomItem) {\r\n                    e.preventDefault();\r\n                    \"\" !== this._searchValue() && this._customItemAddedHandler(e);\r\n                    return\r\n                }\r\n                if (this.option(\"opened\")) {\r\n                    this._saveValueChangeEvent(e);\r\n                    sendToList(options);\r\n                    e.preventDefault()\r\n                }\r\n            },\r\n            space: function(e, options) {\r\n                var isOpened = this.option(\"opened\");\r\n                var isInputActive = this._shouldRenderSearchEvent();\r\n                if (isOpened && !isInputActive) {\r\n                    this._saveValueChangeEvent(e);\r\n                    sendToList(options);\r\n                    e.preventDefault()\r\n                }\r\n            },\r\n            leftArrow: function(e) {\r\n                if (!this._isCaretAtTheStart() || this._isEmpty() || this._isEditable() && rtlEnabled && !this._$focusedTag) {\r\n                    return\r\n                }\r\n                e.preventDefault();\r\n                var direction = rtlEnabled ? \"next\" : \"prev\";\r\n                this._moveTagFocus(direction);\r\n                !this.option(\"multiline\") && this._scrollContainer(direction)\r\n            },\r\n            rightArrow: function(e) {\r\n                if (!this._isCaretAtTheStart() || this._isEmpty() || this._isEditable() && !rtlEnabled && !this._$focusedTag) {\r\n                    return\r\n                }\r\n                e.preventDefault();\r\n                var direction = rtlEnabled ? \"prev\" : \"next\";\r\n                this._moveTagFocus(direction);\r\n                !this.option(\"multiline\") && this._scrollContainer(direction)\r\n            }\r\n        })\r\n    },\r\n    _processKeyboardEvent: function(e) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        this._saveValueChangeEvent(e)\r\n    },\r\n    _isEmpty: function() {\r\n        return 0 === this._getValue().length\r\n    },\r\n    _updateTagsContainer: function($element) {\r\n        this._$tagsContainer = $element.addClass(TAGBOX_TAG_CONTAINER_CLASS)\r\n    },\r\n    _allowSelectItemByTab: function() {\r\n        return false\r\n    },\r\n    _isCaretAtTheStart: function() {\r\n        var position = caret(this._input());\r\n        return 0 === position.start && 0 === position.end\r\n    },\r\n    _moveTagFocus: function(direction, clearOnBoundary) {\r\n        if (!this._$focusedTag) {\r\n            var tagElements = this._tagElements();\r\n            this._$focusedTag = \"next\" === direction ? tagElements.first() : tagElements.last();\r\n            this._toggleFocusClass(true, this._$focusedTag);\r\n            return\r\n        }\r\n        var $nextFocusedTag = this._$focusedTag[direction](\".\".concat(TAGBOX_TAG_CLASS));\r\n        if ($nextFocusedTag.length > 0) {\r\n            this._replaceFocusedTag($nextFocusedTag)\r\n        } else if (clearOnBoundary || \"next\" === direction && this._isEditable()) {\r\n            this._clearTagFocus()\r\n        }\r\n    },\r\n    _replaceFocusedTag: function($nextFocusedTag) {\r\n        this._toggleFocusClass(false, this._$focusedTag);\r\n        this._$focusedTag = $nextFocusedTag;\r\n        this._toggleFocusClass(true, this._$focusedTag)\r\n    },\r\n    _clearTagFocus: function() {\r\n        if (!this._$focusedTag) {\r\n            return\r\n        }\r\n        this._toggleFocusClass(false, this._$focusedTag);\r\n        delete this._$focusedTag\r\n    },\r\n    _focusClassTarget: function($element) {\r\n        if ($element && $element.length && $element[0] !== this._focusTarget()[0]) {\r\n            return $element\r\n        }\r\n        return this.callBase()\r\n    },\r\n    _getLabelContainer: function() {\r\n        return this._$tagsContainer\r\n    },\r\n    _scrollContainer: function(direction) {\r\n        if (this.option(\"multiline\") || !hasWindow()) {\r\n            return\r\n        }\r\n        if (!this._$tagsContainer) {\r\n            return\r\n        }\r\n        var scrollPosition = this._getScrollPosition(direction);\r\n        this._$tagsContainer.scrollLeft(scrollPosition)\r\n    },\r\n    _getScrollPosition: function(direction) {\r\n        if (\"start\" === direction || \"end\" === direction) {\r\n            return this._getBorderPosition(direction)\r\n        }\r\n        return this._$focusedTag ? this._getFocusedTagPosition(direction) : this._getBorderPosition(\"end\")\r\n    },\r\n    _getBorderPosition: function(direction) {\r\n        var rtlEnabled = this.option(\"rtlEnabled\");\r\n        var isScrollLeft = \"end\" === direction ^ rtlEnabled;\r\n        var scrollSign = rtlEnabled ? -1 : 1;\r\n        return isScrollLeft ^ !rtlEnabled ? 0 : scrollSign * (this._$tagsContainer.get(0).scrollWidth - getOuterWidth(this._$tagsContainer))\r\n    },\r\n    _getFocusedTagPosition: function(direction) {\r\n        var rtlEnabled = this.option(\"rtlEnabled\");\r\n        var isScrollLeft = \"next\" === direction ^ rtlEnabled;\r\n        var {\r\n            left: scrollOffset\r\n        } = this._$focusedTag.position();\r\n        var scrollLeft = this._$tagsContainer.scrollLeft();\r\n        if (isScrollLeft) {\r\n            scrollOffset += getOuterWidth(this._$focusedTag, true) - getOuterWidth(this._$tagsContainer)\r\n        }\r\n        if (isScrollLeft ^ scrollOffset < 0) {\r\n            scrollLeft += scrollOffset\r\n        }\r\n        return scrollLeft\r\n    },\r\n    _setNextValue: noop,\r\n    _getDefaultOptions: function() {\r\n        return extend(this.callBase(), {\r\n            value: [],\r\n            showDropDownButton: false,\r\n            maxFilterQueryLength: 1500,\r\n            tagTemplate: \"tag\",\r\n            selectAllText: messageLocalization.format(\"dxList-selectAll\"),\r\n            hideSelectedItems: false,\r\n            selectedItems: [],\r\n            selectAllMode: \"page\",\r\n            onSelectAllValueChanged: null,\r\n            maxDisplayedTags: void 0,\r\n            showMultiTagOnly: true,\r\n            onMultiTagPreparing: null,\r\n            multiline: true,\r\n            useSubmitBehavior: true\r\n        })\r\n    },\r\n    _init: function() {\r\n        this.callBase();\r\n        this._selectedItems = [];\r\n        this._initSelectAllValueChangedAction()\r\n    },\r\n    _initActions: function() {\r\n        this.callBase();\r\n        this._initMultiTagPreparingAction()\r\n    },\r\n    _initMultiTagPreparingAction: function() {\r\n        this._multiTagPreparingAction = this._createActionByOption(\"onMultiTagPreparing\", {\r\n            beforeExecute: function(e) {\r\n                this._multiTagPreparingHandler(e.args[0])\r\n            }.bind(this),\r\n            excludeValidators: [\"disabled\", \"readOnly\"]\r\n        })\r\n    },\r\n    _multiTagPreparingHandler: function(args) {\r\n        var {\r\n            length: selectedCount\r\n        } = this._getValue();\r\n        if (!this.option(\"showMultiTagOnly\")) {\r\n            args.text = messageLocalization.getFormatter(\"dxTagBox-moreSelected\")(selectedCount - this.option(\"maxDisplayedTags\") + 1)\r\n        } else {\r\n            args.text = messageLocalization.getFormatter(\"dxTagBox-selected\")(selectedCount)\r\n        }\r\n    },\r\n    _initDynamicTemplates: function() {\r\n        this.callBase();\r\n        this._templateManager.addDefaultTemplates({\r\n            tag: new BindableTemplate(($container, data) => {\r\n                var _data$text;\r\n                var $tagContent = $(\"<div>\").addClass(TAGBOX_TAG_CONTENT_CLASS);\r\n                $(\"<span>\").text(null !== (_data$text = data.text) && void 0 !== _data$text ? _data$text : data).appendTo($tagContent);\r\n                $(\"<div>\").addClass(TAGBOX_TAG_REMOVE_BUTTON_CLASS).appendTo($tagContent);\r\n                $container.append($tagContent)\r\n            }, [\"text\"], this.option(\"integrationOptions.watchMethod\"), {\r\n                text: this._displayGetter\r\n            })\r\n        })\r\n    },\r\n    _toggleSubmitElement: function(enabled) {\r\n        if (enabled) {\r\n            this._renderSubmitElement();\r\n            this._setSubmitValue()\r\n        } else {\r\n            this._$submitElement && this._$submitElement.remove();\r\n            delete this._$submitElement\r\n        }\r\n    },\r\n    _renderSubmitElement: function() {\r\n        if (!this.option(\"useSubmitBehavior\")) {\r\n            return\r\n        }\r\n        this._$submitElement = $(\"<select>\").attr(\"multiple\", \"multiple\").css(\"display\", \"none\").appendTo(this.$element())\r\n    },\r\n    _setSubmitValue: function() {\r\n        if (!this.option(\"useSubmitBehavior\")) {\r\n            return\r\n        }\r\n        var value = this._getValue();\r\n        var $options = [];\r\n        for (var i = 0, n = value.length; i < n; i++) {\r\n            var useDisplayText = this._shouldUseDisplayValue(value[i]);\r\n            $options.push($(\"<option>\").val(useDisplayText ? this._displayGetter(value[i]) : value[i]).attr(\"selected\", \"selected\"))\r\n        }\r\n        this._getSubmitElement().empty().append($options)\r\n    },\r\n    _initMarkup: function() {\r\n        this._tagElementsCache = $();\r\n        var isSingleLineMode = !this.option(\"multiline\");\r\n        this.$element().addClass(TAGBOX_CLASS).toggleClass(TAGBOX_ONLY_SELECT_CLASS, !(this.option(\"searchEnabled\") || this.option(\"acceptCustomValue\"))).toggleClass(TAGBOX_SINGLE_LINE_CLASS, isSingleLineMode);\r\n        this._initTagTemplate();\r\n        this.callBase()\r\n    },\r\n    _render: function() {\r\n        this.callBase();\r\n        this._renderTagRemoveAction();\r\n        this._renderSingleLineScroll();\r\n        this._scrollContainer(\"start\")\r\n    },\r\n    _initTagTemplate: function() {\r\n        this._tagTemplate = this._getTemplateByOption(\"tagTemplate\")\r\n    },\r\n    _renderField: function() {\r\n        var isDefaultFieldTemplate = !isDefined(this.option(\"fieldTemplate\"));\r\n        this.$element().toggleClass(TAGBOX_DEFAULT_FIELD_TEMPLATE_CLASS, isDefaultFieldTemplate).toggleClass(TAGBOX_CUSTOM_FIELD_TEMPLATE_CLASS, !isDefaultFieldTemplate);\r\n        this.callBase()\r\n    },\r\n    _renderTagRemoveAction: function() {\r\n        var tagRemoveAction = this._createAction(this._removeTagHandler.bind(this));\r\n        var eventName = addNamespace(clickEvent, \"dxTagBoxTagRemove\");\r\n        eventsEngine.off(this._$tagsContainer, eventName);\r\n        eventsEngine.on(this._$tagsContainer, eventName, \".\".concat(TAGBOX_TAG_REMOVE_BUTTON_CLASS), event => {\r\n            tagRemoveAction({\r\n                event: event\r\n            })\r\n        })\r\n    },\r\n    _renderSingleLineScroll: function() {\r\n        var mouseWheelEvent = addNamespace(\"dxmousewheel\", this.NAME);\r\n        var $element = this.$element();\r\n        var isMultiline = this.option(\"multiline\");\r\n        eventsEngine.off($element, mouseWheelEvent);\r\n        if (\"desktop\" !== devices.real().deviceType) {\r\n            this._$tagsContainer && this._$tagsContainer.css(\"overflowX\", isMultiline ? \"\" : \"auto\");\r\n            return\r\n        }\r\n        if (isMultiline) {\r\n            return\r\n        }\r\n        eventsEngine.on($element, mouseWheelEvent, this._tagContainerMouseWheelHandler.bind(this))\r\n    },\r\n    _tagContainerMouseWheelHandler: function(e) {\r\n        var scrollLeft = this._$tagsContainer.scrollLeft();\r\n        var delta = e.delta * TAGBOX_MOUSE_WHEEL_DELTA_MULTIPLIER;\r\n        if (!isCommandKeyPressed(e) && allowScroll(this._$tagsContainer, delta, true)) {\r\n            this._$tagsContainer.scrollLeft(scrollLeft + delta);\r\n            return false\r\n        }\r\n    },\r\n    _renderEvents: function() {\r\n        this.callBase();\r\n        var input = this._input();\r\n        var namespace = addNamespace(\"keydown\", this.NAME);\r\n        eventsEngine.on(input, namespace, e => {\r\n            var keyName = normalizeKeyName(e);\r\n            if (!this._isControlKey(keyName) && this._isEditable()) {\r\n                this._clearTagFocus()\r\n            }\r\n        })\r\n    },\r\n    _popupWrapperClass: function() {\r\n        return this.callBase() + \" \" + TAGBOX_POPUP_WRAPPER_CLASS\r\n    },\r\n    _renderInput: function() {\r\n        this.callBase();\r\n        this._renderPreventBlurOnInputClick()\r\n    },\r\n    _renderPreventBlurOnInputClick: function() {\r\n        var eventName = addNamespace(\"mousedown\", \"dxTagBox\");\r\n        eventsEngine.off(this._inputWrapper(), eventName);\r\n        eventsEngine.on(this._inputWrapper(), eventName, e => {\r\n            if (e.target !== this._input()[0]) {\r\n                e.preventDefault()\r\n            }\r\n        })\r\n    },\r\n    _renderInputValueImpl: function() {\r\n        return this._renderMultiSelect()\r\n    },\r\n    _loadInputValue: function() {\r\n        return when()\r\n    },\r\n    _clearTextValue: function() {\r\n        this._input().val(\"\");\r\n        this._toggleEmptinessEventHandler();\r\n        this.option(\"text\", \"\")\r\n    },\r\n    _focusInHandler: function(e) {\r\n        if (!this._preventNestedFocusEvent(e)) {\r\n            this._scrollContainer(\"end\")\r\n        }\r\n        this.callBase(e)\r\n    },\r\n    _renderInputValue: function() {\r\n        this.option(\"displayValue\", this._searchValue());\r\n        return this.callBase()\r\n    },\r\n    _restoreInputText: function(saveEditingValue) {\r\n        if (!saveEditingValue) {\r\n            this._clearTextValue()\r\n        }\r\n    },\r\n    _focusOutHandler: function(e) {\r\n        if (!this._preventNestedFocusEvent(e)) {\r\n            this._clearTagFocus();\r\n            this._scrollContainer(\"start\")\r\n        }\r\n        this.callBase(e)\r\n    },\r\n    _getFirstPopupElement: function() {\r\n        return this.option(\"showSelectionControls\") ? this._list.$element() : this.callBase()\r\n    },\r\n    _initSelectAllValueChangedAction: function() {\r\n        this._selectAllValueChangeAction = this._createActionByOption(\"onSelectAllValueChanged\")\r\n    },\r\n    _renderList: function() {\r\n        this.callBase();\r\n        this._setListDataSourceFilter();\r\n        if (this.option(\"showSelectionControls\")) {\r\n            this._list.registerKeyHandler(\"tab\", e => this._popupElementTabHandler(e));\r\n            this._list.registerKeyHandler(\"escape\", e => this._popupElementEscHandler(e))\r\n        }\r\n    },\r\n    _canListHaveFocus: function() {\r\n        return \"useButtons\" === this.option(\"applyValueMode\")\r\n    },\r\n    _listConfig: function() {\r\n        var selectionMode = this.option(\"showSelectionControls\") ? \"all\" : \"multiple\";\r\n        return extend(this.callBase(), {\r\n            selectionMode: selectionMode,\r\n            selectAllText: this.option(\"selectAllText\"),\r\n            onSelectAllValueChanged: _ref => {\r\n                var {\r\n                    value: value\r\n                } = _ref;\r\n                this._selectAllValueChangeAction({\r\n                    value: value\r\n                })\r\n            },\r\n            selectAllMode: this.option(\"selectAllMode\"),\r\n            selectedItems: this._selectedItems,\r\n            onFocusedItemChanged: null\r\n        })\r\n    },\r\n    _renderMultiSelect: function() {\r\n        var d = new Deferred;\r\n        this._updateTagsContainer(this._$textEditorInputContainer);\r\n        this._renderInputSize();\r\n        this._renderTags().done(() => {\r\n            this._popup && this._popup.refreshPosition();\r\n            d.resolve()\r\n        }).fail(d.reject);\r\n        return d.promise()\r\n    },\r\n    _listItemClickHandler: function(e) {\r\n        !this.option(\"showSelectionControls\") && this._clearTextValue();\r\n        if (\"useButtons\" === this.option(\"applyValueMode\")) {\r\n            return\r\n        }\r\n        this.callBase(e);\r\n        this._saveValueChangeEvent(void 0)\r\n    },\r\n    _shouldClearFilter: function() {\r\n        var shouldClearFilter = this.callBase();\r\n        var showSelectionControls = this.option(\"showSelectionControls\");\r\n        return !showSelectionControls && shouldClearFilter\r\n    },\r\n    _renderInputSize: function() {\r\n        var $input = this._input();\r\n        var value = $input.val();\r\n        var isEmptyInput = isString(value) && value;\r\n        var width = \"\";\r\n        var size = \"\";\r\n        var canTypeText = this.option(\"searchEnabled\") || this.option(\"acceptCustomValue\");\r\n        if (isEmptyInput && canTypeText) {\r\n            var $calculationElement = createTextElementHiddenCopy($input, value, {\r\n                includePaddings: true\r\n            });\r\n            $calculationElement.insertAfter($input);\r\n            width = getOuterWidth($calculationElement) + 5;\r\n            $calculationElement.remove()\r\n        } else if (!value) {\r\n            size = 1\r\n        }\r\n        $input.css(\"width\", width);\r\n        $input.attr(\"size\", size)\r\n    },\r\n    _renderInputSubstitution: function() {\r\n        this.callBase();\r\n        this._updateWidgetHeight()\r\n    },\r\n    _getValue: function() {\r\n        return this.option(\"value\") || []\r\n    },\r\n    _multiTagRequired: function() {\r\n        var values = this._getValue();\r\n        var maxDisplayedTags = this.option(\"maxDisplayedTags\");\r\n        return isDefined(maxDisplayedTags) && values.length > maxDisplayedTags\r\n    },\r\n    _renderMultiTag: function($input) {\r\n        var $tag = $(\"<div>\").addClass(TAGBOX_TAG_CLASS).addClass(TAGBOX_MULTI_TAG_CLASS);\r\n        var args = {\r\n            multiTagElement: getPublicElement($tag),\r\n            selectedItems: this.option(\"selectedItems\")\r\n        };\r\n        this._multiTagPreparingAction(args);\r\n        if (args.cancel) {\r\n            return false\r\n        }\r\n        $tag.data(TAGBOX_TAG_DATA_KEY, args.text);\r\n        $tag.insertBefore($input);\r\n        this._tagTemplate.render({\r\n            model: args.text,\r\n            container: getPublicElement($tag)\r\n        });\r\n        return $tag\r\n    },\r\n    _getFilter: function(creator) {\r\n        var dataSourceFilter = this._dataSource.filter();\r\n        var filterExpr = creator.getCombinedFilter(this.option(\"valueExpr\"), dataSourceFilter);\r\n        var filterQueryLength = encodeURI(JSON.stringify(filterExpr)).length;\r\n        var maxFilterQueryLength = this.option(\"maxFilterQueryLength\");\r\n        if (filterQueryLength <= maxFilterQueryLength) {\r\n            return filterExpr\r\n        }\r\n        errors.log(\"W1019\", maxFilterQueryLength)\r\n    },\r\n    _getFilteredItems: function(values) {\r\n        var _this$_loadFilteredIt, _this$_list, _this$_list$getDataSo;\r\n        null === (_this$_loadFilteredIt = this._loadFilteredItemsPromise) || void 0 === _this$_loadFilteredIt ? void 0 : _this$_loadFilteredIt.reject();\r\n        var creator = new FilterCreator(values);\r\n        var listSelectedItems = null === (_this$_list = this._list) || void 0 === _this$_list ? void 0 : _this$_list.option(\"selectedItems\");\r\n        var isListItemsLoaded = !!listSelectedItems && (null === (_this$_list$getDataSo = this._list.getDataSource()) || void 0 === _this$_list$getDataSo ? void 0 : _this$_list$getDataSo.isLoaded());\r\n        var selectedItems = listSelectedItems || this.option(\"selectedItems\");\r\n        var clientFilterFunction = creator.getLocalFilter(this._valueGetter);\r\n        var filteredItems = selectedItems.filter(clientFilterFunction);\r\n        var selectedItemsAlreadyLoaded = filteredItems.length === values.length;\r\n        var d = new Deferred;\r\n        var dataSource = this._dataSource;\r\n        if (!dataSource) {\r\n            return d.resolve([]).promise()\r\n        } else if ((!this._isDataSourceChanged || isListItemsLoaded) && selectedItemsAlreadyLoaded) {\r\n            return d.resolve(filteredItems).promise()\r\n        } else {\r\n            var {\r\n                customQueryParams: customQueryParams,\r\n                expand: expand,\r\n                select: select\r\n            } = dataSource.loadOptions();\r\n            var filter = this._getFilter(creator);\r\n            dataSource.store().load({\r\n                filter: filter,\r\n                customQueryParams: customQueryParams,\r\n                expand: expand,\r\n                select: select\r\n            }).done((data, extra) => {\r\n                this._isDataSourceChanged = false;\r\n                if (this._disposed) {\r\n                    d.reject();\r\n                    return\r\n                }\r\n                var {\r\n                    data: items\r\n                } = normalizeLoadResult(data, extra);\r\n                var mappedItems = dataSource._applyMapFunction(items);\r\n                d.resolve(mappedItems.filter(clientFilterFunction))\r\n            }).fail(d.reject);\r\n            this._loadFilteredItemsPromise = d;\r\n            return d.promise()\r\n        }\r\n    },\r\n    _createTagsData: function(values, filteredItems) {\r\n        var items = [];\r\n        var cache = {};\r\n        var isValueExprSpecified = \"this\" === this._valueGetterExpr();\r\n        var filteredValues = {};\r\n        filteredItems.forEach(filteredItem => {\r\n            var filteredItemValue = isValueExprSpecified ? JSON.stringify(filteredItem) : this._valueGetter(filteredItem);\r\n            filteredValues[filteredItemValue] = filteredItem\r\n        });\r\n        var loadItemPromises = [];\r\n        values.forEach((value, index) => {\r\n            var currentItem = filteredValues[isValueExprSpecified ? JSON.stringify(value) : value];\r\n            if (isValueExprSpecified && !isDefined(currentItem)) {\r\n                loadItemPromises.push(this._loadItem(value, cache).always(item => {\r\n                    var newItem = this._createTagData(items, item, value, index);\r\n                    items.splice(index, 0, newItem)\r\n                }))\r\n            } else {\r\n                var newItem = this._createTagData(items, currentItem, value, index);\r\n                items.splice(index, 0, newItem)\r\n            }\r\n        });\r\n        var d = new Deferred;\r\n        when.apply(this, loadItemPromises).always((function() {\r\n            d.resolve(items)\r\n        }));\r\n        return d.promise()\r\n    },\r\n    _createTagData: function(items, item, value, valueIndex) {\r\n        if (isDefined(item)) {\r\n            this._selectedItems.push(item);\r\n            return item\r\n        } else {\r\n            var selectedItem = this.option(\"selectedItem\");\r\n            var customItem = this._valueGetter(selectedItem) === value ? selectedItem : value;\r\n            return customItem\r\n        }\r\n    },\r\n    _isGroupedData: function() {\r\n        var _this$_dataSource;\r\n        return this.option(\"grouped\") && !(null !== (_this$_dataSource = this._dataSource) && void 0 !== _this$_dataSource && _this$_dataSource.group())\r\n    },\r\n    _getItemsByValues: function(values) {\r\n        var resultItems = [];\r\n        values.forEach(function(value) {\r\n            var item = this._getItemFromPlain(value);\r\n            if (isDefined(item)) {\r\n                resultItems.push(item)\r\n            }\r\n        }.bind(this));\r\n        return resultItems\r\n    },\r\n    _getFilteredGroupedItems: function(values) {\r\n        var selectedItems = new Deferred;\r\n        if (!this._dataSource) {\r\n            return selectedItems.promise()\r\n        }\r\n        if (this._filteredGroupedItemsLoadPromise) {\r\n            this._dataSource.cancel(this._filteredGroupedItemsLoadPromise.operationId)\r\n        }\r\n        if (!this._dataSource.items().length) {\r\n            this._filteredGroupedItemsLoadPromise = this._dataSource.load().done(() => {\r\n                selectedItems.resolve(this._getItemsByValues(values))\r\n            }).fail(() => {\r\n                selectedItems.resolve([])\r\n            }).always(() => {\r\n                this._filteredGroupedItemsLoadPromise = void 0\r\n            })\r\n        } else {\r\n            selectedItems.resolve(this._getItemsByValues(values))\r\n        }\r\n        return selectedItems.promise()\r\n    },\r\n    _loadTagsData: function() {\r\n        var values = this._getValue();\r\n        var tagData = new Deferred;\r\n        this._selectedItems = [];\r\n        var filteredItemsPromise = this._isGroupedData() ? this._getFilteredGroupedItems(values) : this._getFilteredItems(values);\r\n        filteredItemsPromise.done(filteredItems => {\r\n            var items = this._createTagsData(values, filteredItems);\r\n            items.always((function(data) {\r\n                tagData.resolve(data)\r\n            }))\r\n        }).fail(tagData.reject.bind(this));\r\n        return tagData.promise()\r\n    },\r\n    _renderTags: function() {\r\n        var d = new Deferred;\r\n        var isPlainDataUsed = false;\r\n        if (this._shouldGetItemsFromPlain(this._valuesToUpdate)) {\r\n            this._selectedItems = this._getItemsFromPlain(this._valuesToUpdate);\r\n            if (this._selectedItems.length === this._valuesToUpdate.length) {\r\n                this._renderTagsImpl(this._selectedItems);\r\n                isPlainDataUsed = true;\r\n                d.resolve()\r\n            }\r\n        }\r\n        if (!isPlainDataUsed) {\r\n            this._loadTagsData().done(items => {\r\n                if (this._disposed) {\r\n                    d.reject();\r\n                    return\r\n                }\r\n                this._renderTagsImpl(items);\r\n                d.resolve()\r\n            }).fail(d.reject)\r\n        }\r\n        return d.promise()\r\n    },\r\n    _renderTagsImpl: function(items) {\r\n        this._renderTagsCore(items);\r\n        this._renderEmptyState();\r\n        if (!this._preserveFocusedTag) {\r\n            this._clearTagFocus()\r\n        }\r\n    },\r\n    _shouldGetItemsFromPlain: function(values) {\r\n        return values && this._dataSource.isLoaded() && values.length <= this._getPlainItems().length\r\n    },\r\n    _getItemsFromPlain: function(values) {\r\n        var selectedItems = this._getSelectedItemsFromList(values);\r\n        var needFilterPlainItems = 0 === selectedItems.length && values.length > 0 || selectedItems.length < values.length;\r\n        if (needFilterPlainItems) {\r\n            var plainItems = this._getPlainItems();\r\n            selectedItems = this._filterSelectedItems(plainItems, values)\r\n        }\r\n        return selectedItems\r\n    },\r\n    _getSelectedItemsFromList: function(values) {\r\n        var _this$_list2;\r\n        var listSelectedItems = null === (_this$_list2 = this._list) || void 0 === _this$_list2 ? void 0 : _this$_list2.option(\"selectedItems\");\r\n        var selectedItems = [];\r\n        if (values.length === (null === listSelectedItems || void 0 === listSelectedItems ? void 0 : listSelectedItems.length)) {\r\n            selectedItems = this._filterSelectedItems(listSelectedItems, values)\r\n        }\r\n        return selectedItems\r\n    },\r\n    _filterSelectedItems: function(plainItems, values) {\r\n        var selectedItems = plainItems.filter(dataItem => {\r\n            var currentValue;\r\n            for (var i = 0; i < values.length; i++) {\r\n                currentValue = values[i];\r\n                if (isObject(currentValue)) {\r\n                    if (this._isValueEquals(dataItem, currentValue)) {\r\n                        return true\r\n                    }\r\n                } else if (this._isValueEquals(this._valueGetter(dataItem), currentValue)) {\r\n                    return true\r\n                }\r\n            }\r\n            return false\r\n        }, this);\r\n        return selectedItems\r\n    },\r\n    _integrateInput: function() {\r\n        this._isInputReady.resolve();\r\n        this.callBase();\r\n        this._updateTagsContainer($(\".\".concat(TEXTEDITOR_INPUT_CONTAINER_CLASS)));\r\n        this._renderTagRemoveAction()\r\n    },\r\n    _renderTagsCore: function(items) {\r\n        var _this$_isInputReady;\r\n        null === (_this$_isInputReady = this._isInputReady) || void 0 === _this$_isInputReady ? void 0 : _this$_isInputReady.reject();\r\n        this._isInputReady = new Deferred;\r\n        this._renderField();\r\n        this.option(\"selectedItems\", this._selectedItems.slice());\r\n        this._cleanTags();\r\n        if (this._input().length > 0) {\r\n            this._isInputReady.resolve()\r\n        }\r\n        when(this._isInputReady).done(() => {\r\n            this._renderTagsElements(items)\r\n        })\r\n    },\r\n    _renderTagsElements(items) {\r\n        var $multiTag = this._multiTagRequired() && this._renderMultiTag(this._input());\r\n        var showMultiTagOnly = this.option(\"showMultiTagOnly\");\r\n        var maxDisplayedTags = this.option(\"maxDisplayedTags\");\r\n        items.forEach((item, index) => {\r\n            if ($multiTag && showMultiTagOnly || $multiTag && !showMultiTagOnly && index - maxDisplayedTags >= -1) {\r\n                return false\r\n            }\r\n            this._renderTag(item, $multiTag || this._input())\r\n        });\r\n        if (this._isFocused()) {\r\n            this._scrollContainer(\"end\")\r\n        }\r\n        this._refreshTagElements()\r\n    },\r\n    _cleanTags: function() {\r\n        if (this._multiTagRequired()) {\r\n            this._tagElements().remove()\r\n        } else {\r\n            var $tags = this._tagElements();\r\n            var values = this._getValue();\r\n            each($tags, (function(_, tag) {\r\n                var $tag = $(tag);\r\n                var tagData = $tag.data(TAGBOX_TAG_DATA_KEY);\r\n                if (!(null !== values && void 0 !== values && values.includes(tagData))) {\r\n                    $tag.remove()\r\n                }\r\n            }))\r\n        }\r\n    },\r\n    _renderEmptyState: function() {\r\n        var isEmpty = !(this._getValue().length || this._selectedItems.length || this._searchValue());\r\n        this._toggleEmptiness(isEmpty);\r\n        this._renderDisplayText()\r\n    },\r\n    _renderDisplayText: function() {\r\n        this._renderInputSize()\r\n    },\r\n    _refreshTagElements: function() {\r\n        this._tagElementsCache = this.$element().find(\".\".concat(TAGBOX_TAG_CLASS))\r\n    },\r\n    _tagElements: function() {\r\n        return this._tagElementsCache\r\n    },\r\n    _applyTagTemplate: function(item, $tag) {\r\n        this._tagTemplate.render({\r\n            model: item,\r\n            container: getPublicElement($tag)\r\n        })\r\n    },\r\n    _renderTag: function(item, $input) {\r\n        var value = this._valueGetter(item);\r\n        if (!isDefined(value)) {\r\n            return\r\n        }\r\n        var $tag = this._getTag(value);\r\n        var displayValue = this._displayGetter(item);\r\n        var itemModel = this._getItemModel(item, displayValue);\r\n        if ($tag) {\r\n            if (isDefined(displayValue)) {\r\n                $tag.empty();\r\n                this._applyTagTemplate(itemModel, $tag)\r\n            }\r\n            $tag.removeClass(TAGBOX_CUSTOM_TAG_CLASS)\r\n        } else {\r\n            $tag = this._createTag(value, $input);\r\n            if (isDefined(item)) {\r\n                this._applyTagTemplate(itemModel, $tag)\r\n            } else {\r\n                $tag.addClass(TAGBOX_CUSTOM_TAG_CLASS);\r\n                this._applyTagTemplate(value, $tag)\r\n            }\r\n        }\r\n    },\r\n    _getItemModel: function(item, displayValue) {\r\n        if (isObject(item) && isDefined(displayValue)) {\r\n            return item\r\n        } else {\r\n            return ensureDefined(displayValue, \"\")\r\n        }\r\n    },\r\n    _getTag: function(value) {\r\n        var $tags = this._tagElements();\r\n        var tagsLength = $tags.length;\r\n        var result = false;\r\n        for (var i = 0; i < tagsLength; i++) {\r\n            var $tag = $tags[i];\r\n            var tagData = elementData($tag, TAGBOX_TAG_DATA_KEY);\r\n            if (value === tagData || equalByValue(value, tagData)) {\r\n                result = $($tag);\r\n                break\r\n            }\r\n        }\r\n        return result\r\n    },\r\n    _createTag: function(value, $input) {\r\n        return $(\"<div>\").addClass(TAGBOX_TAG_CLASS).data(TAGBOX_TAG_DATA_KEY, value).insertBefore($input)\r\n    },\r\n    _toggleEmptinessEventHandler: function() {\r\n        this._toggleEmptiness(!this._getValue().length && !this._searchValue().length)\r\n    },\r\n    _customItemAddedHandler: function(e) {\r\n        this.callBase(e);\r\n        this._clearTextValue()\r\n    },\r\n    _removeTagHandler: function(args) {\r\n        var e = args.event;\r\n        e.stopPropagation();\r\n        this._saveValueChangeEvent(e);\r\n        var $tag = $(e.target).closest(\".\".concat(TAGBOX_TAG_CLASS));\r\n        this._removeTagElement($tag)\r\n    },\r\n    _removeTagElement: function($tag) {\r\n        if ($tag.hasClass(TAGBOX_MULTI_TAG_CLASS)) {\r\n            if (!this.option(\"showMultiTagOnly\")) {\r\n                this.option(\"value\", this._getValue().slice(0, this.option(\"maxDisplayedTags\")))\r\n            } else {\r\n                this.reset()\r\n            }\r\n            return\r\n        }\r\n        var itemValue = $tag.data(TAGBOX_TAG_DATA_KEY);\r\n        this._removeTagWithUpdate(itemValue);\r\n        this._refreshTagElements()\r\n    },\r\n    _updateField: noop,\r\n    _removeTagWithUpdate: function(itemValue) {\r\n        var value = this._getValue().slice();\r\n        this._removeTag(value, itemValue);\r\n        this.option(\"value\", value);\r\n        if (0 === value.length) {\r\n            this._clearTagFocus()\r\n        }\r\n    },\r\n    _getCurrentValue: function() {\r\n        return this._lastValue()\r\n    },\r\n    _selectionChangeHandler: function(e) {\r\n        if (\"useButtons\" === this.option(\"applyValueMode\")) {\r\n            return\r\n        }\r\n        var value = this._getValue().slice();\r\n        each(e.removedItems || [], (_, removedItem) => {\r\n            this._removeTag(value, this._valueGetter(removedItem))\r\n        });\r\n        each(e.addedItems || [], (_, addedItem) => {\r\n            this._addTag(value, this._valueGetter(addedItem))\r\n        });\r\n        this._updateWidgetHeight();\r\n        if (!equalByValue(this._list.option(\"selectedItemKeys\"), this.option(\"value\"))) {\r\n            var listSelectionChangeEvent = this._list._getSelectionChangeEvent();\r\n            listSelectionChangeEvent && this._saveValueChangeEvent(listSelectionChangeEvent);\r\n            this.option(\"value\", value)\r\n        }\r\n        this._list._saveSelectionChangeEvent(void 0)\r\n    },\r\n    _removeTag: function(value, item) {\r\n        var index = this._valueIndex(item, value);\r\n        if (index >= 0) {\r\n            value.splice(index, 1)\r\n        }\r\n    },\r\n    _addTag: function(value, item) {\r\n        var index = this._valueIndex(item);\r\n        if (index < 0) {\r\n            value.push(item)\r\n        }\r\n    },\r\n    _fieldRenderData: function() {\r\n        return this._selectedItems.slice()\r\n    },\r\n    _completeSelection: function(value) {\r\n        if (!this.option(\"showSelectionControls\")) {\r\n            this._setValue(value)\r\n        }\r\n    },\r\n    _setValue: function(value) {\r\n        if (null === value) {\r\n            return\r\n        }\r\n        var useButtons = \"useButtons\" === this.option(\"applyValueMode\");\r\n        var valueIndex = this._valueIndex(value);\r\n        var values = (useButtons ? this._list.option(\"selectedItemKeys\") : this._getValue()).slice();\r\n        if (valueIndex >= 0) {\r\n            values.splice(valueIndex, 1)\r\n        } else {\r\n            values.push(value)\r\n        }\r\n        if (\"useButtons\" === this.option(\"applyValueMode\")) {\r\n            this._list.option(\"selectedItemKeys\", values)\r\n        } else {\r\n            this.option(\"value\", values)\r\n        }\r\n    },\r\n    _isSelectedValue: function(value, cache) {\r\n        return this._valueIndex(value, null, cache) > -1\r\n    },\r\n    _valueIndex: function(value, values, cache) {\r\n        var result = -1;\r\n        if (cache && \"object\" !== typeof value) {\r\n            if (!cache.indexByValues) {\r\n                cache.indexByValues = {};\r\n                values = values || this._getValue();\r\n                values.forEach((function(value, index) {\r\n                    cache.indexByValues[value] = index\r\n                }))\r\n            }\r\n            if (value in cache.indexByValues) {\r\n                return cache.indexByValues[value]\r\n            }\r\n        }\r\n        values = values || this._getValue();\r\n        each(values, (index, selectedValue) => {\r\n            if (this._isValueEquals(value, selectedValue)) {\r\n                result = index;\r\n                return false\r\n            }\r\n        });\r\n        return result\r\n    },\r\n    _lastValue: function() {\r\n        var values = this._getValue();\r\n        var lastValue = values[values.length - 1];\r\n        return null !== lastValue && void 0 !== lastValue ? lastValue : null\r\n    },\r\n    _valueChangeEventHandler: noop,\r\n    _shouldRenderSearchEvent: function() {\r\n        return this.option(\"searchEnabled\") || this.option(\"acceptCustomValue\")\r\n    },\r\n    _searchHandler: function(e) {\r\n        if (this.option(\"searchEnabled\") && !!e && !this._isTagRemoved) {\r\n            this.callBase(arguments);\r\n            this._setListDataSourceFilter()\r\n        }\r\n        this._updateWidgetHeight();\r\n        delete this._isTagRemoved\r\n    },\r\n    _updateWidgetHeight: function() {\r\n        var element = this.$element();\r\n        var originalHeight = getHeight(element);\r\n        this._renderInputSize();\r\n        var currentHeight = getHeight(element);\r\n        if (this._popup && this.option(\"opened\") && this._isEditable() && currentHeight !== originalHeight) {\r\n            this._popup.repaint()\r\n        }\r\n    },\r\n    _refreshSelected: function() {\r\n        var _this$_list3;\r\n        (null === (_this$_list3 = this._list) || void 0 === _this$_list3 ? void 0 : _this$_list3.getDataSource()) && this._list.option(\"selectedItems\", this._selectedItems)\r\n    },\r\n    _resetListDataSourceFilter: function() {\r\n        var dataSource = this._getDataSource();\r\n        if (!dataSource) {\r\n            return\r\n        }\r\n        delete this._userFilter;\r\n        dataSource.filter(null);\r\n        dataSource.reload()\r\n    },\r\n    _setListDataSourceFilter: function() {\r\n        if (!this.option(\"hideSelectedItems\") || !this._list) {\r\n            return\r\n        }\r\n        var dataSource = this._getDataSource();\r\n        if (!dataSource) {\r\n            return\r\n        }\r\n        var valueGetterExpr = this._valueGetterExpr();\r\n        if (isString(valueGetterExpr) && \"this\" !== valueGetterExpr) {\r\n            var filter = this._dataSourceFilterExpr();\r\n            if (void 0 === this._userFilter) {\r\n                this._userFilter = dataSource.filter() || null\r\n            }\r\n            this._userFilter && filter.push(this._userFilter);\r\n            filter.length ? dataSource.filter(filter) : dataSource.filter(null)\r\n        } else {\r\n            dataSource.filter(this._dataSourceFilterFunction.bind(this))\r\n        }\r\n        dataSource.load()\r\n    },\r\n    _dataSourceFilterExpr: function() {\r\n        var filter = [];\r\n        each(this._getValue(), (index, value) => {\r\n            filter.push([\"!\", [this._valueGetterExpr(), value]])\r\n        });\r\n        return filter\r\n    },\r\n    _dataSourceFilterFunction: function(itemData) {\r\n        var itemValue = this._valueGetter(itemData);\r\n        var result = true;\r\n        each(this._getValue(), (index, value) => {\r\n            if (this._isValueEquals(value, itemValue)) {\r\n                result = false;\r\n                return false\r\n            }\r\n        });\r\n        return result\r\n    },\r\n    _dataSourceChangedHandler: function() {\r\n        this._isDataSourceChanged = true;\r\n        this.callBase.apply(this, arguments)\r\n    },\r\n    _applyButtonHandler: function(args) {\r\n        this._saveValueChangeEvent(args.event);\r\n        this.option(\"value\", this._getSortedListValues());\r\n        this._clearTextValue();\r\n        this.callBase();\r\n        this._cancelSearchIfNeed()\r\n    },\r\n    _getSortedListValues: function() {\r\n        var listValues = this._getListValues();\r\n        var currentValue = this.option(\"value\") || [];\r\n        var existedItems = listValues.length ? currentValue.filter(item => -1 !== listValues.indexOf(item)) : [];\r\n        var newItems = existedItems.length ? listValues.filter(item => -1 === currentValue.indexOf(item)) : listValues;\r\n        return existedItems.concat(newItems)\r\n    },\r\n    _getListValues: function() {\r\n        if (!this._list) {\r\n            return []\r\n        }\r\n        var selectedItems = this._getPlainItems(this._list.option(\"selectedItems\"));\r\n        var result = [];\r\n        each(selectedItems, (index, item) => {\r\n            result[index] = this._valueGetter(item)\r\n        });\r\n        return result\r\n    },\r\n    _setListDataSource: function() {\r\n        var currentValue = this._getValue();\r\n        this.callBase();\r\n        if (currentValue !== this.option(\"value\")) {\r\n            this.option(\"value\", currentValue)\r\n        }\r\n        this._refreshSelected()\r\n    },\r\n    _renderOpenedState: function() {\r\n        this.callBase();\r\n        if (\"useButtons\" === this.option(\"applyValueMode\") && !this.option(\"opened\")) {\r\n            this._refreshSelected()\r\n        }\r\n    },\r\n    reset: function() {\r\n        this._restoreInputText();\r\n        var defaultValue = this._getDefaultOptions().value;\r\n        var currentValue = this.option(\"value\");\r\n        if (defaultValue && 0 === defaultValue.length && currentValue && defaultValue.length === currentValue.length) {\r\n            return\r\n        }\r\n        this.callBase()\r\n    },\r\n    _clean: function() {\r\n        this.callBase();\r\n        delete this._defaultTagTemplate;\r\n        delete this._valuesToUpdate;\r\n        delete this._tagTemplate\r\n    },\r\n    _removeDuplicates: function(from, what) {\r\n        var result = [];\r\n        each(from, (_, value) => {\r\n            var filteredItems = what.filter(item => this._valueGetter(value) === this._valueGetter(item));\r\n            if (!filteredItems.length) {\r\n                result.push(value)\r\n            }\r\n        });\r\n        return result\r\n    },\r\n    _optionChanged: function(args) {\r\n        switch (args.name) {\r\n            case \"onSelectAllValueChanged\":\r\n                this._initSelectAllValueChangedAction();\r\n                break;\r\n            case \"onMultiTagPreparing\":\r\n                this._initMultiTagPreparingAction();\r\n                this._renderTags();\r\n                break;\r\n            case \"hideSelectedItems\":\r\n                if (args.value) {\r\n                    this._setListDataSourceFilter()\r\n                } else {\r\n                    this._resetListDataSourceFilter()\r\n                }\r\n                break;\r\n            case \"useSubmitBehavior\":\r\n                this._toggleSubmitElement(args.value);\r\n                break;\r\n            case \"displayExpr\":\r\n                this.callBase(args);\r\n                this._initTemplates();\r\n                this._invalidate();\r\n                break;\r\n            case \"tagTemplate\":\r\n                this._initTagTemplate();\r\n                this._invalidate();\r\n                break;\r\n            case \"selectAllText\":\r\n                this._setListOption(\"selectAllText\", this.option(\"selectAllText\"));\r\n                break;\r\n            case \"readOnly\":\r\n            case \"disabled\":\r\n                this.callBase(args);\r\n                !args.value && this._refreshEvents();\r\n                break;\r\n            case \"value\":\r\n                this._valuesToUpdate = null === args || void 0 === args ? void 0 : args.value;\r\n                this.callBase(args);\r\n                this._valuesToUpdate = void 0;\r\n                this._setListDataSourceFilter();\r\n                break;\r\n            case \"maxDisplayedTags\":\r\n            case \"showMultiTagOnly\":\r\n                this._renderTags();\r\n                break;\r\n            case \"selectAllMode\":\r\n                this._setListOption(args.name, args.value);\r\n                break;\r\n            case \"selectedItem\":\r\n                break;\r\n            case \"selectedItems\":\r\n                this._selectionChangedAction({\r\n                    addedItems: this._removeDuplicates(args.value, args.previousValue),\r\n                    removedItems: this._removeDuplicates(args.previousValue, args.value)\r\n                });\r\n                break;\r\n            case \"multiline\":\r\n                this.$element().toggleClass(TAGBOX_SINGLE_LINE_CLASS, !args.value);\r\n                this._renderSingleLineScroll();\r\n                break;\r\n            case \"maxFilterQueryLength\":\r\n                break;\r\n            default:\r\n                this.callBase(args)\r\n        }\r\n    },\r\n    _getActualSearchValue: function() {\r\n        return this.callBase() || this._searchValue()\r\n    },\r\n    _popupHidingHandler: function() {\r\n        this.callBase();\r\n        this._clearFilter()\r\n    }\r\n});\r\nregisterComponent(\"dxTagBox\", TagBox);\r\nexport default TagBox;\r\n"]},"metadata":{},"sourceType":"module"}