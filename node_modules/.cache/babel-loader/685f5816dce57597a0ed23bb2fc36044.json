{"ast":null,"code":"/**\r\n * DevExtreme (esm/ui/html_editor/modules/mentions.js)\r\n * Version: 22.1.3\r\n * Build date: Mon Jun 13 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport $ from \"../../../core/renderer\";\nimport Quill from \"devextreme-quill\";\nimport { compileGetter } from \"../../../core/utils/data\";\nimport { isString } from \"../../../core/utils/type\";\nimport { extend } from \"../../../core/utils/extend\";\nimport { getPublicElement } from \"../../../core/element\";\nimport eventsEngine from \"../../../events/core/events_engine\";\nimport BaseModule from \"./base\";\nimport PopupModule from \"./popup\";\nimport Mention from \"../formats/mention\";\nvar MentionModule = BaseModule;\n\nif (Quill) {\n  var USER_ACTION = \"user\";\n  var DEFAULT_MARKER = \"@\";\n  var KEYS = {\n    ARROW_UP: \"upArrow\",\n    ARROW_DOWN: \"downArrow\",\n    ARROW_LEFT: \"leftArrow\",\n    ARROW_RIGHT: \"rightArrow\",\n    ENTER: \"enter\",\n    ESCAPE: \"escape\",\n    SPACE: \"space\",\n    PAGE_UP: \"pageUp\",\n    PAGE_DOWN: \"pageDown\",\n    END: \"end\",\n    HOME: \"home\"\n  };\n  var NAVIGATION_KEYS = [KEYS.ARROW_LEFT, KEYS.ARROW_RIGHT, KEYS.PAGE_UP, KEYS.PAGE_DOWN, KEYS.END, KEYS.HOME];\n  var ALLOWED_PREFIX_CHARS = [\" \", \"\\n\"];\n  var DISABLED_STATE_CLASS = \"dx-state-disabled\";\n  Quill.register({\n    \"formats/mention\": Mention\n  }, true);\n  MentionModule = class extends PopupModule {\n    _getDefaultOptions() {\n      var baseConfig = super._getDefaultOptions();\n\n      return extend(baseConfig, {\n        itemTemplate: \"item\",\n        valueExpr: \"this\",\n        displayExpr: \"this\",\n        template: null,\n        searchExpr: null,\n        searchTimeout: 500,\n        minSearchLength: 0\n      });\n    }\n\n    constructor(quill, options) {\n      super(quill, options);\n      this._mentions = {};\n      options.mentions.forEach(item => {\n        var marker = item.marker;\n\n        if (!marker) {\n          item.marker = marker = DEFAULT_MARKER;\n        }\n\n        var template = item.template;\n\n        if (template) {\n          var preparedTemplate = this.editorInstance._getTemplate(template);\n\n          preparedTemplate && Mention.addTemplate(marker, preparedTemplate);\n        }\n\n        this._mentions[marker] = extend({}, this._getDefaultOptions(), item);\n      });\n\n      this._attachKeyboardHandlers();\n\n      this.addCleanCallback(this.clean.bind(this));\n      this.quill.on(\"text-change\", this.onTextChange.bind(this));\n    }\n\n    _attachKeyboardHandlers() {\n      this.quill.keyboard.addBinding({\n        key: KEYS.ARROW_UP\n      }, this._moveToItem.bind(this, \"prev\"));\n      this.quill.keyboard.addBinding({\n        key: KEYS.ARROW_DOWN\n      }, this._moveToItem.bind(this, \"next\"));\n      this.quill.keyboard.addBinding({\n        key: [KEYS.ENTER, KEYS.SPACE]\n      }, this._selectItemHandler.bind(this));\n      var enterBindings = this.quill.keyboard.bindings[KEYS.ENTER];\n      enterBindings.unshift(enterBindings.pop());\n      this.quill.keyboard.addBinding({\n        key: KEYS.ESCAPE\n      }, this._escapeKeyHandler.bind(this));\n      this.quill.keyboard.addBinding({\n        key: [KEYS.ARROW_LEFT, KEYS.ARROW_RIGHT],\n        shiftKey: true\n      }, this._ignoreKeyHandler.bind(this));\n      this.quill.keyboard.addBinding({\n        key: NAVIGATION_KEYS\n      }, this._ignoreKeyHandler.bind(this));\n    }\n\n    _moveToItem(direction) {\n      var dataSource = this._list.getDataSource();\n\n      if (this._isMentionActive && !dataSource.isLoading()) {\n        var $focusedItem = $(this._list.option(\"focusedElement\"));\n        var defaultItemPosition = \"next\" === direction ? \"first\" : \"last\";\n        var $nextItem = $focusedItem[direction]();\n        $nextItem = $nextItem.length ? $nextItem : this._activeListItems[defaultItemPosition]();\n\n        this._list.option(\"focusedElement\", getPublicElement($nextItem));\n\n        this._list.scrollToItem($nextItem);\n      }\n\n      return !this._isMentionActive;\n    }\n\n    _ignoreKeyHandler() {\n      return !this._isMentionActive;\n    }\n\n    _fitIntoRange(value, start, end) {\n      if (value > end) {\n        return start;\n      }\n\n      if (value < start) {\n        return end;\n      }\n\n      return value;\n    }\n\n    _selectItemHandler() {\n      if (this._isMentionActive) {\n        this._list.option(\"items\").length ? this._list.selectItem(this._list.option(\"focusedElement\")) : this._popup.hide();\n      }\n\n      return !this._isMentionActive;\n    }\n\n    _escapeKeyHandler() {\n      if (this._isMentionActive) {\n        this._popup.hide();\n      }\n\n      return !this._isMentionActive;\n    }\n\n    renderList($container, options) {\n      this.compileGetters(this.options);\n      super.renderList($container, options);\n    }\n\n    compileGetters(_ref) {\n      var {\n        displayExpr: displayExpr,\n        valueExpr: valueExpr\n      } = _ref;\n      this._valueGetter = compileGetter(displayExpr);\n      this._idGetter = compileGetter(valueExpr);\n    }\n\n    _getListConfig(options) {\n      var baseConfig = super._getListConfig(options);\n\n      return extend(baseConfig, {\n        itemTemplate: this.options.itemTemplate,\n        onContentReady: () => {\n          if (this._hasSearch) {\n            this._popup.repaint();\n\n            this._focusFirstElement();\n\n            this._hasSearch = false;\n          }\n        }\n      });\n    }\n\n    insertEmbedContent() {\n      var markerLength = this._activeMentionConfig.marker.length;\n      var textLength = markerLength + this._searchValue.length;\n      var caretPosition = this.getPosition();\n\n      var selectedItem = this._list.option(\"selectedItem\");\n\n      var value = {\n        value: this._valueGetter(selectedItem),\n        id: this._idGetter(selectedItem),\n        marker: this._activeMentionConfig.marker\n      };\n      var Delta = Quill.import(\"delta\");\n      var startIndex = Math.max(0, caretPosition - markerLength);\n      var retainCorrection = \"\\n\" === this._getCharByIndex(startIndex) ? 1 : 0;\n      startIndex += retainCorrection;\n      var newDelta = new Delta().retain(startIndex).delete(textLength).insert({\n        mention: value\n      }).insert(\" \");\n      this.quill.updateContents(newDelta);\n      this.quill.setSelection(startIndex + 2);\n    }\n\n    _getLastInsertOperation(ops) {\n      var lastOperation = ops[ops.length - 1];\n      var isLastOperationInsert = (\"insert\" in lastOperation);\n\n      if (isLastOperationInsert) {\n        return lastOperation;\n      }\n\n      var isLastOperationDelete = (\"delete\" in lastOperation);\n\n      if (isLastOperationDelete && ops.length >= 2) {\n        var penultOperation = ops[ops.length - 2];\n        var isPenultOperationInsert = (\"insert\" in penultOperation);\n        var isSelectionReplacing = isLastOperationDelete && isPenultOperationInsert;\n\n        if (isSelectionReplacing) {\n          return penultOperation;\n        }\n      }\n\n      return null;\n    }\n\n    onTextChange(newDelta, oldDelta, source) {\n      if (source === USER_ACTION) {\n        var lastOperation = newDelta.ops[newDelta.ops.length - 1];\n\n        if (this._isMentionActive && this._isPopupVisible) {\n          this._processSearchValue(lastOperation) && this._filterList(this._searchValue);\n        } else {\n          var {\n            ops: ops\n          } = newDelta;\n\n          var lastInsertOperation = this._getLastInsertOperation(ops);\n\n          if (lastInsertOperation) {\n            this.checkMentionRequest(lastInsertOperation, ops);\n          }\n        }\n      }\n    }\n\n    get _isPopupVisible() {\n      var _this$_popup;\n\n      return null === (_this$_popup = this._popup) || void 0 === _this$_popup ? void 0 : _this$_popup.option(\"visible\");\n    }\n\n    _processSearchValue(operation) {\n      var isInsertOperation = (\"insert\" in operation);\n\n      if (isInsertOperation) {\n        this._searchValue += operation.insert;\n      } else if (!this._searchValue.length || operation.delete > 1) {\n        this._popup.hide();\n\n        return false;\n      } else {\n        this._searchValue = this._searchValue.slice(0, -1);\n      }\n\n      return true;\n    }\n\n    checkMentionRequest(_ref2, ops) {\n      var {\n        insert: insert\n      } = _ref2;\n      var caret = this.quill.getSelection();\n\n      if (!insert || !isString(insert) || !caret || this._isMarkerPartOfText(ops[0].retain)) {\n        return;\n      }\n\n      this._activeMentionConfig = this._mentions[insert];\n\n      if (this._activeMentionConfig) {\n        this._updateList(this._activeMentionConfig);\n\n        this.savePosition(caret.index);\n\n        this._popup.option(\"position\", this._popupPosition);\n\n        this._searchValue = \"\";\n\n        this._popup.show();\n      }\n    }\n\n    _isMarkerPartOfText(retain) {\n      if (!retain || -1 !== ALLOWED_PREFIX_CHARS.indexOf(this._getCharByIndex(retain - 1))) {\n        return false;\n      }\n\n      return true;\n    }\n\n    _getCharByIndex(index) {\n      return this.quill.getContents(index, 1).ops[0].insert;\n    }\n\n    _updateList(_ref3) {\n      var {\n        dataSource: dataSource,\n        displayExpr: displayExpr,\n        valueExpr: valueExpr,\n        itemTemplate: itemTemplate,\n        searchExpr: searchExpr\n      } = _ref3;\n      this.compileGetters({\n        displayExpr: displayExpr,\n        valueExpr: valueExpr\n      });\n\n      this._list.unselectAll();\n\n      this._list.option({\n        dataSource: dataSource,\n        displayExpr: displayExpr,\n        itemTemplate: itemTemplate,\n        searchExpr: searchExpr\n      });\n    }\n\n    _filterList(searchValue) {\n      if (!this._isMinSearchLengthExceeded(searchValue)) {\n        this._resetFilter();\n\n        return;\n      }\n\n      var searchTimeout = this._activeMentionConfig.searchTimeout;\n\n      if (searchTimeout) {\n        clearTimeout(this._searchTimer);\n        this._searchTimer = setTimeout(() => {\n          this._search(searchValue);\n        }, searchTimeout);\n      } else {\n        this._search(searchValue);\n      }\n    }\n\n    _isMinSearchLengthExceeded(searchValue) {\n      return searchValue.length >= this._activeMentionConfig.minSearchLength;\n    }\n\n    _resetFilter() {\n      clearTimeout(this._searchTimer);\n\n      this._search(null);\n    }\n\n    _search(searchValue) {\n      this._hasSearch = true;\n\n      this._list.option(\"searchValue\", searchValue);\n    }\n\n    _focusFirstElement() {\n      if (!this._list) {\n        return;\n      }\n\n      var $firstItem = this._activeListItems.first();\n\n      this._list.option(\"focusedElement\", getPublicElement($firstItem));\n\n      this._list.scrollToItem($firstItem);\n    }\n\n    get _popupPosition() {\n      var position = this.getPosition();\n      var {\n        left: mentionLeft,\n        top: mentionTop,\n        height: mentionHeight\n      } = this.quill.getBounds(position ? position - 1 : position);\n      var {\n        left: leftOffset,\n        top: topOffset\n      } = $(this.quill.root).offset();\n      var positionEvent = eventsEngine.Event(\"positionEvent\", {\n        pageX: leftOffset + mentionLeft,\n        pageY: topOffset + mentionTop\n      });\n      return {\n        of: positionEvent,\n        offset: {\n          v: mentionHeight\n        },\n        my: \"top left\",\n        at: \"top left\",\n        collision: {\n          y: \"flip\",\n          x: \"flipfit\"\n        }\n      };\n    }\n\n    _getPopupConfig() {\n      return extend(super._getPopupConfig(), {\n        hideOnParentScroll: false,\n        onShown: () => {\n          this._isMentionActive = true;\n          this._hasSearch = false;\n\n          this._focusFirstElement();\n        },\n        onHidden: () => {\n          this._list.unselectAll();\n\n          this._list.option(\"focusedElement\", null);\n\n          this._isMentionActive = false;\n\n          this._search(null);\n        },\n        focusStateEnabled: false\n      });\n    }\n\n    get _activeListItems() {\n      return this._list.itemElements().filter(\":not(.\".concat(DISABLED_STATE_CLASS, \")\"));\n    }\n\n    clean() {\n      Object.keys(this._mentions).forEach(marker => {\n        if (this._mentions[marker].template) {\n          Mention.removeTemplate(marker);\n        }\n      });\n    }\n\n  };\n}\n\nexport default MentionModule;","map":{"version":3,"sources":["/Users/krunalpatel/Downloads/React-Firebase-Auth-master 3/node_modules/devextreme/esm/ui/html_editor/modules/mentions.js"],"names":["$","Quill","compileGetter","isString","extend","getPublicElement","eventsEngine","BaseModule","PopupModule","Mention","MentionModule","USER_ACTION","DEFAULT_MARKER","KEYS","ARROW_UP","ARROW_DOWN","ARROW_LEFT","ARROW_RIGHT","ENTER","ESCAPE","SPACE","PAGE_UP","PAGE_DOWN","END","HOME","NAVIGATION_KEYS","ALLOWED_PREFIX_CHARS","DISABLED_STATE_CLASS","register","_getDefaultOptions","baseConfig","itemTemplate","valueExpr","displayExpr","template","searchExpr","searchTimeout","minSearchLength","constructor","quill","options","_mentions","mentions","forEach","item","marker","preparedTemplate","editorInstance","_getTemplate","addTemplate","_attachKeyboardHandlers","addCleanCallback","clean","bind","on","onTextChange","keyboard","addBinding","key","_moveToItem","_selectItemHandler","enterBindings","bindings","unshift","pop","_escapeKeyHandler","shiftKey","_ignoreKeyHandler","direction","dataSource","_list","getDataSource","_isMentionActive","isLoading","$focusedItem","option","defaultItemPosition","$nextItem","length","_activeListItems","scrollToItem","_fitIntoRange","value","start","end","selectItem","_popup","hide","renderList","$container","compileGetters","_ref","_valueGetter","_idGetter","_getListConfig","onContentReady","_hasSearch","repaint","_focusFirstElement","insertEmbedContent","markerLength","_activeMentionConfig","textLength","_searchValue","caretPosition","getPosition","selectedItem","id","Delta","import","startIndex","Math","max","retainCorrection","_getCharByIndex","newDelta","retain","delete","insert","mention","updateContents","setSelection","_getLastInsertOperation","ops","lastOperation","isLastOperationInsert","isLastOperationDelete","penultOperation","isPenultOperationInsert","isSelectionReplacing","oldDelta","source","_isPopupVisible","_processSearchValue","_filterList","lastInsertOperation","checkMentionRequest","_this$_popup","operation","isInsertOperation","slice","_ref2","caret","getSelection","_isMarkerPartOfText","_updateList","savePosition","index","_popupPosition","show","indexOf","getContents","_ref3","unselectAll","searchValue","_isMinSearchLengthExceeded","_resetFilter","clearTimeout","_searchTimer","setTimeout","_search","$firstItem","first","position","left","mentionLeft","top","mentionTop","height","mentionHeight","getBounds","leftOffset","topOffset","root","offset","positionEvent","Event","pageX","pageY","of","v","my","at","collision","y","x","_getPopupConfig","hideOnParentScroll","onShown","onHidden","focusStateEnabled","itemElements","filter","concat","Object","keys","removeTemplate"],"mappings":"AAAA;;;;;;;;AAQA,OAAOA,CAAP,MAAc,wBAAd;AACA,OAAOC,KAAP,MAAkB,kBAAlB;AACA,SACIC,aADJ,QAEO,0BAFP;AAGA,SACIC,QADJ,QAEO,0BAFP;AAGA,SACIC,MADJ,QAEO,4BAFP;AAGA,SACIC,gBADJ,QAEO,uBAFP;AAGA,OAAOC,YAAP,MAAyB,oCAAzB;AACA,OAAOC,UAAP,MAAuB,QAAvB;AACA,OAAOC,WAAP,MAAwB,SAAxB;AACA,OAAOC,OAAP,MAAoB,oBAApB;AACA,IAAIC,aAAa,GAAGH,UAApB;;AACA,IAAIN,KAAJ,EAAW;AACP,MAAIU,WAAW,GAAG,MAAlB;AACA,MAAIC,cAAc,GAAG,GAArB;AACA,MAAIC,IAAI,GAAG;AACPC,IAAAA,QAAQ,EAAE,SADH;AAEPC,IAAAA,UAAU,EAAE,WAFL;AAGPC,IAAAA,UAAU,EAAE,WAHL;AAIPC,IAAAA,WAAW,EAAE,YAJN;AAKPC,IAAAA,KAAK,EAAE,OALA;AAMPC,IAAAA,MAAM,EAAE,QAND;AAOPC,IAAAA,KAAK,EAAE,OAPA;AAQPC,IAAAA,OAAO,EAAE,QARF;AASPC,IAAAA,SAAS,EAAE,UATJ;AAUPC,IAAAA,GAAG,EAAE,KAVE;AAWPC,IAAAA,IAAI,EAAE;AAXC,GAAX;AAaA,MAAIC,eAAe,GAAG,CAACZ,IAAI,CAACG,UAAN,EAAkBH,IAAI,CAACI,WAAvB,EAAoCJ,IAAI,CAACQ,OAAzC,EAAkDR,IAAI,CAACS,SAAvD,EAAkET,IAAI,CAACU,GAAvE,EAA4EV,IAAI,CAACW,IAAjF,CAAtB;AACA,MAAIE,oBAAoB,GAAG,CAAC,GAAD,EAAM,IAAN,CAA3B;AACA,MAAIC,oBAAoB,GAAG,mBAA3B;AACA1B,EAAAA,KAAK,CAAC2B,QAAN,CAAe;AACX,uBAAmBnB;AADR,GAAf,EAEG,IAFH;AAGAC,EAAAA,aAAa,GAAG,cAAcF,WAAd,CAA0B;AACtCqB,IAAAA,kBAAkB,GAAG;AACjB,UAAIC,UAAU,GAAG,MAAMD,kBAAN,EAAjB;;AACA,aAAOzB,MAAM,CAAC0B,UAAD,EAAa;AACtBC,QAAAA,YAAY,EAAE,MADQ;AAEtBC,QAAAA,SAAS,EAAE,MAFW;AAGtBC,QAAAA,WAAW,EAAE,MAHS;AAItBC,QAAAA,QAAQ,EAAE,IAJY;AAKtBC,QAAAA,UAAU,EAAE,IALU;AAMtBC,QAAAA,aAAa,EAAE,GANO;AAOtBC,QAAAA,eAAe,EAAE;AAPK,OAAb,CAAb;AASH;;AACDC,IAAAA,WAAW,CAACC,KAAD,EAAQC,OAAR,EAAiB;AACxB,YAAMD,KAAN,EAAaC,OAAb;AACA,WAAKC,SAAL,GAAiB,EAAjB;AACAD,MAAAA,OAAO,CAACE,QAAR,CAAiBC,OAAjB,CAAyBC,IAAI,IAAI;AAC7B,YAAIC,MAAM,GAAGD,IAAI,CAACC,MAAlB;;AACA,YAAI,CAACA,MAAL,EAAa;AACTD,UAAAA,IAAI,CAACC,MAAL,GAAcA,MAAM,GAAGjC,cAAvB;AACH;;AACD,YAAIsB,QAAQ,GAAGU,IAAI,CAACV,QAApB;;AACA,YAAIA,QAAJ,EAAc;AACV,cAAIY,gBAAgB,GAAG,KAAKC,cAAL,CAAoBC,YAApB,CAAiCd,QAAjC,CAAvB;;AACAY,UAAAA,gBAAgB,IAAIrC,OAAO,CAACwC,WAAR,CAAoBJ,MAApB,EAA4BC,gBAA5B,CAApB;AACH;;AACD,aAAKL,SAAL,CAAeI,MAAf,IAAyBzC,MAAM,CAAC,EAAD,EAAK,KAAKyB,kBAAL,EAAL,EAAgCe,IAAhC,CAA/B;AACH,OAXD;;AAYA,WAAKM,uBAAL;;AACA,WAAKC,gBAAL,CAAsB,KAAKC,KAAL,CAAWC,IAAX,CAAgB,IAAhB,CAAtB;AACA,WAAKd,KAAL,CAAWe,EAAX,CAAc,aAAd,EAA6B,KAAKC,YAAL,CAAkBF,IAAlB,CAAuB,IAAvB,CAA7B;AACH;;AACDH,IAAAA,uBAAuB,GAAG;AACtB,WAAKX,KAAL,CAAWiB,QAAX,CAAoBC,UAApB,CAA+B;AAC3BC,QAAAA,GAAG,EAAE7C,IAAI,CAACC;AADiB,OAA/B,EAEG,KAAK6C,WAAL,CAAiBN,IAAjB,CAAsB,IAAtB,EAA4B,MAA5B,CAFH;AAGA,WAAKd,KAAL,CAAWiB,QAAX,CAAoBC,UAApB,CAA+B;AAC3BC,QAAAA,GAAG,EAAE7C,IAAI,CAACE;AADiB,OAA/B,EAEG,KAAK4C,WAAL,CAAiBN,IAAjB,CAAsB,IAAtB,EAA4B,MAA5B,CAFH;AAGA,WAAKd,KAAL,CAAWiB,QAAX,CAAoBC,UAApB,CAA+B;AAC3BC,QAAAA,GAAG,EAAE,CAAC7C,IAAI,CAACK,KAAN,EAAaL,IAAI,CAACO,KAAlB;AADsB,OAA/B,EAEG,KAAKwC,kBAAL,CAAwBP,IAAxB,CAA6B,IAA7B,CAFH;AAGA,UAAIQ,aAAa,GAAG,KAAKtB,KAAL,CAAWiB,QAAX,CAAoBM,QAApB,CAA6BjD,IAAI,CAACK,KAAlC,CAApB;AACA2C,MAAAA,aAAa,CAACE,OAAd,CAAsBF,aAAa,CAACG,GAAd,EAAtB;AACA,WAAKzB,KAAL,CAAWiB,QAAX,CAAoBC,UAApB,CAA+B;AAC3BC,QAAAA,GAAG,EAAE7C,IAAI,CAACM;AADiB,OAA/B,EAEG,KAAK8C,iBAAL,CAAuBZ,IAAvB,CAA4B,IAA5B,CAFH;AAGA,WAAKd,KAAL,CAAWiB,QAAX,CAAoBC,UAApB,CAA+B;AAC3BC,QAAAA,GAAG,EAAE,CAAC7C,IAAI,CAACG,UAAN,EAAkBH,IAAI,CAACI,WAAvB,CADsB;AAE3BiD,QAAAA,QAAQ,EAAE;AAFiB,OAA/B,EAGG,KAAKC,iBAAL,CAAuBd,IAAvB,CAA4B,IAA5B,CAHH;AAIA,WAAKd,KAAL,CAAWiB,QAAX,CAAoBC,UAApB,CAA+B;AAC3BC,QAAAA,GAAG,EAAEjC;AADsB,OAA/B,EAEG,KAAK0C,iBAAL,CAAuBd,IAAvB,CAA4B,IAA5B,CAFH;AAGH;;AACDM,IAAAA,WAAW,CAACS,SAAD,EAAY;AACnB,UAAIC,UAAU,GAAG,KAAKC,KAAL,CAAWC,aAAX,EAAjB;;AACA,UAAI,KAAKC,gBAAL,IAAyB,CAACH,UAAU,CAACI,SAAX,EAA9B,EAAsD;AAClD,YAAIC,YAAY,GAAG1E,CAAC,CAAC,KAAKsE,KAAL,CAAWK,MAAX,CAAkB,gBAAlB,CAAD,CAApB;AACA,YAAIC,mBAAmB,GAAG,WAAWR,SAAX,GAAuB,OAAvB,GAAiC,MAA3D;AACA,YAAIS,SAAS,GAAGH,YAAY,CAACN,SAAD,CAAZ,EAAhB;AACAS,QAAAA,SAAS,GAAGA,SAAS,CAACC,MAAV,GAAmBD,SAAnB,GAA+B,KAAKE,gBAAL,CAAsBH,mBAAtB,GAA3C;;AACA,aAAKN,KAAL,CAAWK,MAAX,CAAkB,gBAAlB,EAAoCtE,gBAAgB,CAACwE,SAAD,CAApD;;AACA,aAAKP,KAAL,CAAWU,YAAX,CAAwBH,SAAxB;AACH;;AACD,aAAO,CAAC,KAAKL,gBAAb;AACH;;AACDL,IAAAA,iBAAiB,GAAG;AAChB,aAAO,CAAC,KAAKK,gBAAb;AACH;;AACDS,IAAAA,aAAa,CAACC,KAAD,EAAQC,KAAR,EAAeC,GAAf,EAAoB;AAC7B,UAAIF,KAAK,GAAGE,GAAZ,EAAiB;AACb,eAAOD,KAAP;AACH;;AACD,UAAID,KAAK,GAAGC,KAAZ,EAAmB;AACf,eAAOC,GAAP;AACH;;AACD,aAAOF,KAAP;AACH;;AACDtB,IAAAA,kBAAkB,GAAG;AACjB,UAAI,KAAKY,gBAAT,EAA2B;AACvB,aAAKF,KAAL,CAAWK,MAAX,CAAkB,OAAlB,EAA2BG,MAA3B,GAAoC,KAAKR,KAAL,CAAWe,UAAX,CAAsB,KAAKf,KAAL,CAAWK,MAAX,CAAkB,gBAAlB,CAAtB,CAApC,GAAiG,KAAKW,MAAL,CAAYC,IAAZ,EAAjG;AACH;;AACD,aAAO,CAAC,KAAKf,gBAAb;AACH;;AACDP,IAAAA,iBAAiB,GAAG;AAChB,UAAI,KAAKO,gBAAT,EAA2B;AACvB,aAAKc,MAAL,CAAYC,IAAZ;AACH;;AACD,aAAO,CAAC,KAAKf,gBAAb;AACH;;AACDgB,IAAAA,UAAU,CAACC,UAAD,EAAajD,OAAb,EAAsB;AAC5B,WAAKkD,cAAL,CAAoB,KAAKlD,OAAzB;AACA,YAAMgD,UAAN,CAAiBC,UAAjB,EAA6BjD,OAA7B;AACH;;AACDkD,IAAAA,cAAc,CAACC,IAAD,EAAO;AACjB,UAAI;AACA1D,QAAAA,WAAW,EAAEA,WADb;AAEAD,QAAAA,SAAS,EAAEA;AAFX,UAGA2D,IAHJ;AAIA,WAAKC,YAAL,GAAoB1F,aAAa,CAAC+B,WAAD,CAAjC;AACA,WAAK4D,SAAL,GAAiB3F,aAAa,CAAC8B,SAAD,CAA9B;AACH;;AACD8D,IAAAA,cAAc,CAACtD,OAAD,EAAU;AACpB,UAAIV,UAAU,GAAG,MAAMgE,cAAN,CAAqBtD,OAArB,CAAjB;;AACA,aAAOpC,MAAM,CAAC0B,UAAD,EAAa;AACtBC,QAAAA,YAAY,EAAE,KAAKS,OAAL,CAAaT,YADL;AAEtBgE,QAAAA,cAAc,EAAE,MAAM;AAClB,cAAI,KAAKC,UAAT,EAAqB;AACjB,iBAAKV,MAAL,CAAYW,OAAZ;;AACA,iBAAKC,kBAAL;;AACA,iBAAKF,UAAL,GAAkB,KAAlB;AACH;AACJ;AARqB,OAAb,CAAb;AAUH;;AACDG,IAAAA,kBAAkB,GAAG;AACjB,UAAIC,YAAY,GAAG,KAAKC,oBAAL,CAA0BxD,MAA1B,CAAiCiC,MAApD;AACA,UAAIwB,UAAU,GAAGF,YAAY,GAAG,KAAKG,YAAL,CAAkBzB,MAAlD;AACA,UAAI0B,aAAa,GAAG,KAAKC,WAAL,EAApB;;AACA,UAAIC,YAAY,GAAG,KAAKpC,KAAL,CAAWK,MAAX,CAAkB,cAAlB,CAAnB;;AACA,UAAIO,KAAK,GAAG;AACRA,QAAAA,KAAK,EAAE,KAAKU,YAAL,CAAkBc,YAAlB,CADC;AAERC,QAAAA,EAAE,EAAE,KAAKd,SAAL,CAAea,YAAf,CAFI;AAGR7D,QAAAA,MAAM,EAAE,KAAKwD,oBAAL,CAA0BxD;AAH1B,OAAZ;AAKA,UAAI+D,KAAK,GAAG3G,KAAK,CAAC4G,MAAN,CAAa,OAAb,CAAZ;AACA,UAAIC,UAAU,GAAGC,IAAI,CAACC,GAAL,CAAS,CAAT,EAAYR,aAAa,GAAGJ,YAA5B,CAAjB;AACA,UAAIa,gBAAgB,GAAG,SAAS,KAAKC,eAAL,CAAqBJ,UAArB,CAAT,GAA4C,CAA5C,GAAgD,CAAvE;AACAA,MAAAA,UAAU,IAAIG,gBAAd;AACA,UAAIE,QAAQ,GAAI,IAAIP,KAAJ,EAAD,CAAYQ,MAAZ,CAAmBN,UAAnB,EAA+BO,MAA/B,CAAsCf,UAAtC,EAAkDgB,MAAlD,CAAyD;AACpEC,QAAAA,OAAO,EAAErC;AAD2D,OAAzD,EAEZoC,MAFY,CAEL,GAFK,CAAf;AAGA,WAAK/E,KAAL,CAAWiF,cAAX,CAA0BL,QAA1B;AACA,WAAK5E,KAAL,CAAWkF,YAAX,CAAwBX,UAAU,GAAG,CAArC;AACH;;AACDY,IAAAA,uBAAuB,CAACC,GAAD,EAAM;AACzB,UAAIC,aAAa,GAAGD,GAAG,CAACA,GAAG,CAAC7C,MAAJ,GAAa,CAAd,CAAvB;AACA,UAAI+C,qBAAqB,IAAG,YAAYD,aAAf,CAAzB;;AACA,UAAIC,qBAAJ,EAA2B;AACvB,eAAOD,aAAP;AACH;;AACD,UAAIE,qBAAqB,IAAG,YAAYF,aAAf,CAAzB;;AACA,UAAIE,qBAAqB,IAAIH,GAAG,CAAC7C,MAAJ,IAAc,CAA3C,EAA8C;AAC1C,YAAIiD,eAAe,GAAGJ,GAAG,CAACA,GAAG,CAAC7C,MAAJ,GAAa,CAAd,CAAzB;AACA,YAAIkD,uBAAuB,IAAG,YAAYD,eAAf,CAA3B;AACA,YAAIE,oBAAoB,GAAGH,qBAAqB,IAAIE,uBAApD;;AACA,YAAIC,oBAAJ,EAA0B;AACtB,iBAAOF,eAAP;AACH;AACJ;;AACD,aAAO,IAAP;AACH;;AACDxE,IAAAA,YAAY,CAAC4D,QAAD,EAAWe,QAAX,EAAqBC,MAArB,EAA6B;AACrC,UAAIA,MAAM,KAAKxH,WAAf,EAA4B;AACxB,YAAIiH,aAAa,GAAGT,QAAQ,CAACQ,GAAT,CAAaR,QAAQ,CAACQ,GAAT,CAAa7C,MAAb,GAAsB,CAAnC,CAApB;;AACA,YAAI,KAAKN,gBAAL,IAAyB,KAAK4D,eAAlC,EAAmD;AAC/C,eAAKC,mBAAL,CAAyBT,aAAzB,KAA2C,KAAKU,WAAL,CAAiB,KAAK/B,YAAtB,CAA3C;AACH,SAFD,MAEO;AACH,cAAI;AACAoB,YAAAA,GAAG,EAAEA;AADL,cAEAR,QAFJ;;AAGA,cAAIoB,mBAAmB,GAAG,KAAKb,uBAAL,CAA6BC,GAA7B,CAA1B;;AACA,cAAIY,mBAAJ,EAAyB;AACrB,iBAAKC,mBAAL,CAAyBD,mBAAzB,EAA8CZ,GAA9C;AACH;AACJ;AACJ;AACJ;;AACD,QAAIS,eAAJ,GAAsB;AAClB,UAAIK,YAAJ;;AACA,aAAO,UAAUA,YAAY,GAAG,KAAKnD,MAA9B,KAAyC,KAAK,CAAL,KAAWmD,YAApD,GAAmE,KAAK,CAAxE,GAA4EA,YAAY,CAAC9D,MAAb,CAAoB,SAApB,CAAnF;AACH;;AACD0D,IAAAA,mBAAmB,CAACK,SAAD,EAAY;AAC3B,UAAIC,iBAAiB,IAAG,YAAYD,SAAf,CAArB;;AACA,UAAIC,iBAAJ,EAAuB;AACnB,aAAKpC,YAAL,IAAqBmC,SAAS,CAACpB,MAA/B;AACH,OAFD,MAEO,IAAI,CAAC,KAAKf,YAAL,CAAkBzB,MAAnB,IAA6B4D,SAAS,CAACrB,MAAV,GAAmB,CAApD,EAAuD;AAC1D,aAAK/B,MAAL,CAAYC,IAAZ;;AACA,eAAO,KAAP;AACH,OAHM,MAGA;AACH,aAAKgB,YAAL,GAAoB,KAAKA,YAAL,CAAkBqC,KAAlB,CAAwB,CAAxB,EAA2B,CAAC,CAA5B,CAApB;AACH;;AACD,aAAO,IAAP;AACH;;AACDJ,IAAAA,mBAAmB,CAACK,KAAD,EAAQlB,GAAR,EAAa;AAC5B,UAAI;AACAL,QAAAA,MAAM,EAAEA;AADR,UAEAuB,KAFJ;AAGA,UAAIC,KAAK,GAAG,KAAKvG,KAAL,CAAWwG,YAAX,EAAZ;;AACA,UAAI,CAACzB,MAAD,IAAW,CAACnH,QAAQ,CAACmH,MAAD,CAApB,IAAgC,CAACwB,KAAjC,IAA0C,KAAKE,mBAAL,CAAyBrB,GAAG,CAAC,CAAD,CAAH,CAAOP,MAAhC,CAA9C,EAAuF;AACnF;AACH;;AACD,WAAKf,oBAAL,GAA4B,KAAK5D,SAAL,CAAe6E,MAAf,CAA5B;;AACA,UAAI,KAAKjB,oBAAT,EAA+B;AAC3B,aAAK4C,WAAL,CAAiB,KAAK5C,oBAAtB;;AACA,aAAK6C,YAAL,CAAkBJ,KAAK,CAACK,KAAxB;;AACA,aAAK7D,MAAL,CAAYX,MAAZ,CAAmB,UAAnB,EAA+B,KAAKyE,cAApC;;AACA,aAAK7C,YAAL,GAAoB,EAApB;;AACA,aAAKjB,MAAL,CAAY+D,IAAZ;AACH;AACJ;;AACDL,IAAAA,mBAAmB,CAAC5B,MAAD,EAAS;AACxB,UAAI,CAACA,MAAD,IAAW,CAAC,CAAD,KAAO1F,oBAAoB,CAAC4H,OAArB,CAA6B,KAAKpC,eAAL,CAAqBE,MAAM,GAAG,CAA9B,CAA7B,CAAtB,EAAsF;AAClF,eAAO,KAAP;AACH;;AACD,aAAO,IAAP;AACH;;AACDF,IAAAA,eAAe,CAACiC,KAAD,EAAQ;AACnB,aAAO,KAAK5G,KAAL,CAAWgH,WAAX,CAAuBJ,KAAvB,EAA8B,CAA9B,EAAiCxB,GAAjC,CAAqC,CAArC,EAAwCL,MAA/C;AACH;;AACD2B,IAAAA,WAAW,CAACO,KAAD,EAAQ;AACf,UAAI;AACAnF,QAAAA,UAAU,EAAEA,UADZ;AAEApC,QAAAA,WAAW,EAAEA,WAFb;AAGAD,QAAAA,SAAS,EAAEA,SAHX;AAIAD,QAAAA,YAAY,EAAEA,YAJd;AAKAI,QAAAA,UAAU,EAAEA;AALZ,UAMAqH,KANJ;AAOA,WAAK9D,cAAL,CAAoB;AAChBzD,QAAAA,WAAW,EAAEA,WADG;AAEhBD,QAAAA,SAAS,EAAEA;AAFK,OAApB;;AAIA,WAAKsC,KAAL,CAAWmF,WAAX;;AACA,WAAKnF,KAAL,CAAWK,MAAX,CAAkB;AACdN,QAAAA,UAAU,EAAEA,UADE;AAEdpC,QAAAA,WAAW,EAAEA,WAFC;AAGdF,QAAAA,YAAY,EAAEA,YAHA;AAIdI,QAAAA,UAAU,EAAEA;AAJE,OAAlB;AAMH;;AACDmG,IAAAA,WAAW,CAACoB,WAAD,EAAc;AACrB,UAAI,CAAC,KAAKC,0BAAL,CAAgCD,WAAhC,CAAL,EAAmD;AAC/C,aAAKE,YAAL;;AACA;AACH;;AACD,UAAIxH,aAAa,GAAG,KAAKiE,oBAAL,CAA0BjE,aAA9C;;AACA,UAAIA,aAAJ,EAAmB;AACfyH,QAAAA,YAAY,CAAC,KAAKC,YAAN,CAAZ;AACA,aAAKA,YAAL,GAAoBC,UAAU,CAAC,MAAM;AACjC,eAAKC,OAAL,CAAaN,WAAb;AACH,SAF6B,EAE3BtH,aAF2B,CAA9B;AAGH,OALD,MAKO;AACH,aAAK4H,OAAL,CAAaN,WAAb;AACH;AACJ;;AACDC,IAAAA,0BAA0B,CAACD,WAAD,EAAc;AACpC,aAAOA,WAAW,CAAC5E,MAAZ,IAAsB,KAAKuB,oBAAL,CAA0BhE,eAAvD;AACH;;AACDuH,IAAAA,YAAY,GAAG;AACXC,MAAAA,YAAY,CAAC,KAAKC,YAAN,CAAZ;;AACA,WAAKE,OAAL,CAAa,IAAb;AACH;;AACDA,IAAAA,OAAO,CAACN,WAAD,EAAc;AACjB,WAAK1D,UAAL,GAAkB,IAAlB;;AACA,WAAK1B,KAAL,CAAWK,MAAX,CAAkB,aAAlB,EAAiC+E,WAAjC;AACH;;AACDxD,IAAAA,kBAAkB,GAAG;AACjB,UAAI,CAAC,KAAK5B,KAAV,EAAiB;AACb;AACH;;AACD,UAAI2F,UAAU,GAAG,KAAKlF,gBAAL,CAAsBmF,KAAtB,EAAjB;;AACA,WAAK5F,KAAL,CAAWK,MAAX,CAAkB,gBAAlB,EAAoCtE,gBAAgB,CAAC4J,UAAD,CAApD;;AACA,WAAK3F,KAAL,CAAWU,YAAX,CAAwBiF,UAAxB;AACH;;AACD,QAAIb,cAAJ,GAAqB;AACjB,UAAIe,QAAQ,GAAG,KAAK1D,WAAL,EAAf;AACA,UAAI;AACA2D,QAAAA,IAAI,EAAEC,WADN;AAEAC,QAAAA,GAAG,EAAEC,UAFL;AAGAC,QAAAA,MAAM,EAAEC;AAHR,UAIA,KAAKlI,KAAL,CAAWmI,SAAX,CAAqBP,QAAQ,GAAGA,QAAQ,GAAG,CAAd,GAAkBA,QAA/C,CAJJ;AAKA,UAAI;AACAC,QAAAA,IAAI,EAAEO,UADN;AAEAL,QAAAA,GAAG,EAAEM;AAFL,UAGA5K,CAAC,CAAC,KAAKuC,KAAL,CAAWsI,IAAZ,CAAD,CAAmBC,MAAnB,EAHJ;AAIA,UAAIC,aAAa,GAAGzK,YAAY,CAAC0K,KAAb,CAAmB,eAAnB,EAAoC;AACpDC,QAAAA,KAAK,EAAEN,UAAU,GAAGN,WADgC;AAEpDa,QAAAA,KAAK,EAAEN,SAAS,GAAGL;AAFiC,OAApC,CAApB;AAIA,aAAO;AACHY,QAAAA,EAAE,EAAEJ,aADD;AAEHD,QAAAA,MAAM,EAAE;AACJM,UAAAA,CAAC,EAAEX;AADC,SAFL;AAKHY,QAAAA,EAAE,EAAE,UALD;AAMHC,QAAAA,EAAE,EAAE,UAND;AAOHC,QAAAA,SAAS,EAAE;AACPC,UAAAA,CAAC,EAAE,MADI;AAEPC,UAAAA,CAAC,EAAE;AAFI;AAPR,OAAP;AAYH;;AACDC,IAAAA,eAAe,GAAG;AACd,aAAOtL,MAAM,CAAC,MAAMsL,eAAN,EAAD,EAA0B;AACnCC,QAAAA,kBAAkB,EAAE,KADe;AAEnCC,QAAAA,OAAO,EAAE,MAAM;AACX,eAAKpH,gBAAL,GAAwB,IAAxB;AACA,eAAKwB,UAAL,GAAkB,KAAlB;;AACA,eAAKE,kBAAL;AACH,SANkC;AAOnC2F,QAAAA,QAAQ,EAAE,MAAM;AACZ,eAAKvH,KAAL,CAAWmF,WAAX;;AACA,eAAKnF,KAAL,CAAWK,MAAX,CAAkB,gBAAlB,EAAoC,IAApC;;AACA,eAAKH,gBAAL,GAAwB,KAAxB;;AACA,eAAKwF,OAAL,CAAa,IAAb;AACH,SAZkC;AAanC8B,QAAAA,iBAAiB,EAAE;AAbgB,OAA1B,CAAb;AAeH;;AACD,QAAI/G,gBAAJ,GAAuB;AACnB,aAAO,KAAKT,KAAL,CAAWyH,YAAX,GAA0BC,MAA1B,CAAiC,SAASC,MAAT,CAAgBtK,oBAAhB,EAAsC,GAAtC,CAAjC,CAAP;AACH;;AACDyB,IAAAA,KAAK,GAAG;AACJ8I,MAAAA,MAAM,CAACC,IAAP,CAAY,KAAK1J,SAAjB,EAA4BE,OAA5B,CAAoCE,MAAM,IAAI;AAC1C,YAAI,KAAKJ,SAAL,CAAeI,MAAf,EAAuBX,QAA3B,EAAqC;AACjCzB,UAAAA,OAAO,CAAC2L,cAAR,CAAuBvJ,MAAvB;AACH;AACJ,OAJD;AAKH;;AA/TqC,GAA1C;AAiUH;;AACD,eAAenC,aAAf","sourcesContent":["/**\r\n * DevExtreme (esm/ui/html_editor/modules/mentions.js)\r\n * Version: 22.1.3\r\n * Build date: Mon Jun 13 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport $ from \"../../../core/renderer\";\r\nimport Quill from \"devextreme-quill\";\r\nimport {\r\n    compileGetter\r\n} from \"../../../core/utils/data\";\r\nimport {\r\n    isString\r\n} from \"../../../core/utils/type\";\r\nimport {\r\n    extend\r\n} from \"../../../core/utils/extend\";\r\nimport {\r\n    getPublicElement\r\n} from \"../../../core/element\";\r\nimport eventsEngine from \"../../../events/core/events_engine\";\r\nimport BaseModule from \"./base\";\r\nimport PopupModule from \"./popup\";\r\nimport Mention from \"../formats/mention\";\r\nvar MentionModule = BaseModule;\r\nif (Quill) {\r\n    var USER_ACTION = \"user\";\r\n    var DEFAULT_MARKER = \"@\";\r\n    var KEYS = {\r\n        ARROW_UP: \"upArrow\",\r\n        ARROW_DOWN: \"downArrow\",\r\n        ARROW_LEFT: \"leftArrow\",\r\n        ARROW_RIGHT: \"rightArrow\",\r\n        ENTER: \"enter\",\r\n        ESCAPE: \"escape\",\r\n        SPACE: \"space\",\r\n        PAGE_UP: \"pageUp\",\r\n        PAGE_DOWN: \"pageDown\",\r\n        END: \"end\",\r\n        HOME: \"home\"\r\n    };\r\n    var NAVIGATION_KEYS = [KEYS.ARROW_LEFT, KEYS.ARROW_RIGHT, KEYS.PAGE_UP, KEYS.PAGE_DOWN, KEYS.END, KEYS.HOME];\r\n    var ALLOWED_PREFIX_CHARS = [\" \", \"\\n\"];\r\n    var DISABLED_STATE_CLASS = \"dx-state-disabled\";\r\n    Quill.register({\r\n        \"formats/mention\": Mention\r\n    }, true);\r\n    MentionModule = class extends PopupModule {\r\n        _getDefaultOptions() {\r\n            var baseConfig = super._getDefaultOptions();\r\n            return extend(baseConfig, {\r\n                itemTemplate: \"item\",\r\n                valueExpr: \"this\",\r\n                displayExpr: \"this\",\r\n                template: null,\r\n                searchExpr: null,\r\n                searchTimeout: 500,\r\n                minSearchLength: 0\r\n            })\r\n        }\r\n        constructor(quill, options) {\r\n            super(quill, options);\r\n            this._mentions = {};\r\n            options.mentions.forEach(item => {\r\n                var marker = item.marker;\r\n                if (!marker) {\r\n                    item.marker = marker = DEFAULT_MARKER\r\n                }\r\n                var template = item.template;\r\n                if (template) {\r\n                    var preparedTemplate = this.editorInstance._getTemplate(template);\r\n                    preparedTemplate && Mention.addTemplate(marker, preparedTemplate)\r\n                }\r\n                this._mentions[marker] = extend({}, this._getDefaultOptions(), item)\r\n            });\r\n            this._attachKeyboardHandlers();\r\n            this.addCleanCallback(this.clean.bind(this));\r\n            this.quill.on(\"text-change\", this.onTextChange.bind(this))\r\n        }\r\n        _attachKeyboardHandlers() {\r\n            this.quill.keyboard.addBinding({\r\n                key: KEYS.ARROW_UP\r\n            }, this._moveToItem.bind(this, \"prev\"));\r\n            this.quill.keyboard.addBinding({\r\n                key: KEYS.ARROW_DOWN\r\n            }, this._moveToItem.bind(this, \"next\"));\r\n            this.quill.keyboard.addBinding({\r\n                key: [KEYS.ENTER, KEYS.SPACE]\r\n            }, this._selectItemHandler.bind(this));\r\n            var enterBindings = this.quill.keyboard.bindings[KEYS.ENTER];\r\n            enterBindings.unshift(enterBindings.pop());\r\n            this.quill.keyboard.addBinding({\r\n                key: KEYS.ESCAPE\r\n            }, this._escapeKeyHandler.bind(this));\r\n            this.quill.keyboard.addBinding({\r\n                key: [KEYS.ARROW_LEFT, KEYS.ARROW_RIGHT],\r\n                shiftKey: true\r\n            }, this._ignoreKeyHandler.bind(this));\r\n            this.quill.keyboard.addBinding({\r\n                key: NAVIGATION_KEYS\r\n            }, this._ignoreKeyHandler.bind(this))\r\n        }\r\n        _moveToItem(direction) {\r\n            var dataSource = this._list.getDataSource();\r\n            if (this._isMentionActive && !dataSource.isLoading()) {\r\n                var $focusedItem = $(this._list.option(\"focusedElement\"));\r\n                var defaultItemPosition = \"next\" === direction ? \"first\" : \"last\";\r\n                var $nextItem = $focusedItem[direction]();\r\n                $nextItem = $nextItem.length ? $nextItem : this._activeListItems[defaultItemPosition]();\r\n                this._list.option(\"focusedElement\", getPublicElement($nextItem));\r\n                this._list.scrollToItem($nextItem)\r\n            }\r\n            return !this._isMentionActive\r\n        }\r\n        _ignoreKeyHandler() {\r\n            return !this._isMentionActive\r\n        }\r\n        _fitIntoRange(value, start, end) {\r\n            if (value > end) {\r\n                return start\r\n            }\r\n            if (value < start) {\r\n                return end\r\n            }\r\n            return value\r\n        }\r\n        _selectItemHandler() {\r\n            if (this._isMentionActive) {\r\n                this._list.option(\"items\").length ? this._list.selectItem(this._list.option(\"focusedElement\")) : this._popup.hide()\r\n            }\r\n            return !this._isMentionActive\r\n        }\r\n        _escapeKeyHandler() {\r\n            if (this._isMentionActive) {\r\n                this._popup.hide()\r\n            }\r\n            return !this._isMentionActive\r\n        }\r\n        renderList($container, options) {\r\n            this.compileGetters(this.options);\r\n            super.renderList($container, options)\r\n        }\r\n        compileGetters(_ref) {\r\n            var {\r\n                displayExpr: displayExpr,\r\n                valueExpr: valueExpr\r\n            } = _ref;\r\n            this._valueGetter = compileGetter(displayExpr);\r\n            this._idGetter = compileGetter(valueExpr)\r\n        }\r\n        _getListConfig(options) {\r\n            var baseConfig = super._getListConfig(options);\r\n            return extend(baseConfig, {\r\n                itemTemplate: this.options.itemTemplate,\r\n                onContentReady: () => {\r\n                    if (this._hasSearch) {\r\n                        this._popup.repaint();\r\n                        this._focusFirstElement();\r\n                        this._hasSearch = false\r\n                    }\r\n                }\r\n            })\r\n        }\r\n        insertEmbedContent() {\r\n            var markerLength = this._activeMentionConfig.marker.length;\r\n            var textLength = markerLength + this._searchValue.length;\r\n            var caretPosition = this.getPosition();\r\n            var selectedItem = this._list.option(\"selectedItem\");\r\n            var value = {\r\n                value: this._valueGetter(selectedItem),\r\n                id: this._idGetter(selectedItem),\r\n                marker: this._activeMentionConfig.marker\r\n            };\r\n            var Delta = Quill.import(\"delta\");\r\n            var startIndex = Math.max(0, caretPosition - markerLength);\r\n            var retainCorrection = \"\\n\" === this._getCharByIndex(startIndex) ? 1 : 0;\r\n            startIndex += retainCorrection;\r\n            var newDelta = (new Delta).retain(startIndex).delete(textLength).insert({\r\n                mention: value\r\n            }).insert(\" \");\r\n            this.quill.updateContents(newDelta);\r\n            this.quill.setSelection(startIndex + 2)\r\n        }\r\n        _getLastInsertOperation(ops) {\r\n            var lastOperation = ops[ops.length - 1];\r\n            var isLastOperationInsert = \"insert\" in lastOperation;\r\n            if (isLastOperationInsert) {\r\n                return lastOperation\r\n            }\r\n            var isLastOperationDelete = \"delete\" in lastOperation;\r\n            if (isLastOperationDelete && ops.length >= 2) {\r\n                var penultOperation = ops[ops.length - 2];\r\n                var isPenultOperationInsert = \"insert\" in penultOperation;\r\n                var isSelectionReplacing = isLastOperationDelete && isPenultOperationInsert;\r\n                if (isSelectionReplacing) {\r\n                    return penultOperation\r\n                }\r\n            }\r\n            return null\r\n        }\r\n        onTextChange(newDelta, oldDelta, source) {\r\n            if (source === USER_ACTION) {\r\n                var lastOperation = newDelta.ops[newDelta.ops.length - 1];\r\n                if (this._isMentionActive && this._isPopupVisible) {\r\n                    this._processSearchValue(lastOperation) && this._filterList(this._searchValue)\r\n                } else {\r\n                    var {\r\n                        ops: ops\r\n                    } = newDelta;\r\n                    var lastInsertOperation = this._getLastInsertOperation(ops);\r\n                    if (lastInsertOperation) {\r\n                        this.checkMentionRequest(lastInsertOperation, ops)\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        get _isPopupVisible() {\r\n            var _this$_popup;\r\n            return null === (_this$_popup = this._popup) || void 0 === _this$_popup ? void 0 : _this$_popup.option(\"visible\")\r\n        }\r\n        _processSearchValue(operation) {\r\n            var isInsertOperation = \"insert\" in operation;\r\n            if (isInsertOperation) {\r\n                this._searchValue += operation.insert\r\n            } else if (!this._searchValue.length || operation.delete > 1) {\r\n                this._popup.hide();\r\n                return false\r\n            } else {\r\n                this._searchValue = this._searchValue.slice(0, -1)\r\n            }\r\n            return true\r\n        }\r\n        checkMentionRequest(_ref2, ops) {\r\n            var {\r\n                insert: insert\r\n            } = _ref2;\r\n            var caret = this.quill.getSelection();\r\n            if (!insert || !isString(insert) || !caret || this._isMarkerPartOfText(ops[0].retain)) {\r\n                return\r\n            }\r\n            this._activeMentionConfig = this._mentions[insert];\r\n            if (this._activeMentionConfig) {\r\n                this._updateList(this._activeMentionConfig);\r\n                this.savePosition(caret.index);\r\n                this._popup.option(\"position\", this._popupPosition);\r\n                this._searchValue = \"\";\r\n                this._popup.show()\r\n            }\r\n        }\r\n        _isMarkerPartOfText(retain) {\r\n            if (!retain || -1 !== ALLOWED_PREFIX_CHARS.indexOf(this._getCharByIndex(retain - 1))) {\r\n                return false\r\n            }\r\n            return true\r\n        }\r\n        _getCharByIndex(index) {\r\n            return this.quill.getContents(index, 1).ops[0].insert\r\n        }\r\n        _updateList(_ref3) {\r\n            var {\r\n                dataSource: dataSource,\r\n                displayExpr: displayExpr,\r\n                valueExpr: valueExpr,\r\n                itemTemplate: itemTemplate,\r\n                searchExpr: searchExpr\r\n            } = _ref3;\r\n            this.compileGetters({\r\n                displayExpr: displayExpr,\r\n                valueExpr: valueExpr\r\n            });\r\n            this._list.unselectAll();\r\n            this._list.option({\r\n                dataSource: dataSource,\r\n                displayExpr: displayExpr,\r\n                itemTemplate: itemTemplate,\r\n                searchExpr: searchExpr\r\n            })\r\n        }\r\n        _filterList(searchValue) {\r\n            if (!this._isMinSearchLengthExceeded(searchValue)) {\r\n                this._resetFilter();\r\n                return\r\n            }\r\n            var searchTimeout = this._activeMentionConfig.searchTimeout;\r\n            if (searchTimeout) {\r\n                clearTimeout(this._searchTimer);\r\n                this._searchTimer = setTimeout(() => {\r\n                    this._search(searchValue)\r\n                }, searchTimeout)\r\n            } else {\r\n                this._search(searchValue)\r\n            }\r\n        }\r\n        _isMinSearchLengthExceeded(searchValue) {\r\n            return searchValue.length >= this._activeMentionConfig.minSearchLength\r\n        }\r\n        _resetFilter() {\r\n            clearTimeout(this._searchTimer);\r\n            this._search(null)\r\n        }\r\n        _search(searchValue) {\r\n            this._hasSearch = true;\r\n            this._list.option(\"searchValue\", searchValue)\r\n        }\r\n        _focusFirstElement() {\r\n            if (!this._list) {\r\n                return\r\n            }\r\n            var $firstItem = this._activeListItems.first();\r\n            this._list.option(\"focusedElement\", getPublicElement($firstItem));\r\n            this._list.scrollToItem($firstItem)\r\n        }\r\n        get _popupPosition() {\r\n            var position = this.getPosition();\r\n            var {\r\n                left: mentionLeft,\r\n                top: mentionTop,\r\n                height: mentionHeight\r\n            } = this.quill.getBounds(position ? position - 1 : position);\r\n            var {\r\n                left: leftOffset,\r\n                top: topOffset\r\n            } = $(this.quill.root).offset();\r\n            var positionEvent = eventsEngine.Event(\"positionEvent\", {\r\n                pageX: leftOffset + mentionLeft,\r\n                pageY: topOffset + mentionTop\r\n            });\r\n            return {\r\n                of: positionEvent,\r\n                offset: {\r\n                    v: mentionHeight\r\n                },\r\n                my: \"top left\",\r\n                at: \"top left\",\r\n                collision: {\r\n                    y: \"flip\",\r\n                    x: \"flipfit\"\r\n                }\r\n            }\r\n        }\r\n        _getPopupConfig() {\r\n            return extend(super._getPopupConfig(), {\r\n                hideOnParentScroll: false,\r\n                onShown: () => {\r\n                    this._isMentionActive = true;\r\n                    this._hasSearch = false;\r\n                    this._focusFirstElement()\r\n                },\r\n                onHidden: () => {\r\n                    this._list.unselectAll();\r\n                    this._list.option(\"focusedElement\", null);\r\n                    this._isMentionActive = false;\r\n                    this._search(null)\r\n                },\r\n                focusStateEnabled: false\r\n            })\r\n        }\r\n        get _activeListItems() {\r\n            return this._list.itemElements().filter(\":not(.\".concat(DISABLED_STATE_CLASS, \")\"))\r\n        }\r\n        clean() {\r\n            Object.keys(this._mentions).forEach(marker => {\r\n                if (this._mentions[marker].template) {\r\n                    Mention.removeTemplate(marker)\r\n                }\r\n            })\r\n        }\r\n    }\r\n}\r\nexport default MentionModule;\r\n"]},"metadata":{},"sourceType":"module"}