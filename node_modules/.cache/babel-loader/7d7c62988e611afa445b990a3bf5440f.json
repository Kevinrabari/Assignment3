{"ast":null,"code":"/**\n* DevExpress Analytics (query-builder\\wizard\\internal\\federationDataSource\\_federationTransformQueryBuilderPopup.js)\n* Version:  22.1.3\n* Build date: Jun 14, 2022\n* Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\n* License: https://www.devexpress.com/Support/EULAs/universal.xml\n*/\n\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.FederationTransformQueryBuilderPopup = void 0;\n\nvar ko = require(\"knockout\");\n\nvar _localization_1 = require(\"../../../../property-grid/localization/_localization\");\n\nvar pathRequest_1 = require(\"../../../../widgets/common/pathRequest\");\n\nvar _federationQueryBuilderPopupBase_1 = require(\"./_federationQueryBuilderPopupBase\");\n\nvar _utils_1 = require(\"../../../../property-grid/widgets/internal/_utils\");\n\nvar transformQuery_1 = require(\"../../../dataSource/federation/federatedQueries/transformQuery\");\n\nvar sourceQuery_1 = require(\"../../../dataSource/federation/federatedQueries/sourceQuery\");\n\nvar serializer_1 = require(\"../../../../serializer/serializer\");\n\nvar _federationTransformResultSchemaProvider_1 = require(\"./_federationTransformResultSchemaProvider\");\n\nvar _federationUnionQueryBuilderTreeListController_1 = require(\"../../../utils/_federationUnionQueryBuilderTreeListController\");\n\nvar _arrayutils_1 = require(\"../../../../core/utils/_arrayutils\");\n\nvar FederationTransformQueryBuilderPopup = function (_super) {\n  __extends(FederationTransformQueryBuilderPopup, _super);\n\n  function FederationTransformQueryBuilderPopup(onSaveCallback, dataSource, rtl) {\n    if (rtl === void 0) {\n      rtl = false;\n    }\n\n    var _this = _super.call(this, onSaveCallback, dataSource, rtl) || this;\n\n    _this.transformGridTitle = ko.observable();\n    _this.transformResultGridTitle = ko.observable();\n    _this.transformResultCollapsed = ko.observable(false);\n    _this.transformSources = ko.observable([]);\n    _this.currentPath = ko.observable();\n    _this.transformQuery = ko.observable();\n    _this.popupContentTemplate = 'dxrd-querybuilder-transform-popup-content';\n    _this.transformGrid = {\n      rtlEnabled: rtl,\n      noDataText: function () {\n        return '';\n      },\n      dataSource: _this.transformSources,\n      showRowLines: true,\n      paging: {\n        enabled: false\n      },\n      scrolling: {\n        mode: 'infinite'\n      },\n      editing: {\n        allowUpdating: true,\n        mode: 'cell'\n      },\n      height: '100%',\n      columns: [{\n        dataField: 'column',\n\n        get caption() {\n          return _localization_1.getLocalization('Column Name', 'DataAccessUIStringId.QueryBuilderColumns_ColumnName');\n        },\n\n        allowEditing: false\n      }, {\n        dataField: 'alias',\n\n        get caption() {\n          return _localization_1.getLocalization('Alias', 'DataAccessUIStringId.QueryBuilderColumns_Alias');\n        },\n\n        validationRules: [_this._aliasValidationRule]\n      }, {\n        type: 'buttons',\n\n        get caption() {\n          return _localization_1.getLocalization('Transform', 'DataAccessUIStringId.FederationDataSourceQueryBuilder_NodeType_Transform');\n        },\n\n        buttons: [{\n          template: function (element, object) {\n            var child = document.createElement('div');\n            element.append(child);\n            ko.renderTemplate('dxrd-querybuilder-transform-checkbox', object.data, {}, child, 'replaceNode');\n          }\n        }]\n      }],\n      onRowUpdating: function (event) {\n        event.oldData.alias = event.newData.alias;\n\n        _this.resultFieldListModel.valueHasMutated();\n\n        _this.transformSources.valueHasMutated();\n      }\n    };\n    var transformResultSchemaProvider = new _federationTransformResultSchemaProvider_1.TransformResultSchemaProvider(_this._dataSource.dbSchemaProvider, _this.transformSources, _this.currentPath);\n    _this.resultFieldListModel = ko.observable({\n      itemsProvider: transformResultSchemaProvider,\n      path: _this.currentPath,\n      selectedPath: ko.observable(),\n      treeListController: null\n    });\n    var treeListController = new _federationUnionQueryBuilderTreeListController_1.FederatedTransformQueryBuilderTreeListController(_this.dragDropHandler, function (item) {\n      return treeListController.isDraggable(item) && _this.addDataMember(item);\n    });\n    _this.fieldListModel = {\n      itemsProvider: _this._dataSource.dbSchemaProvider,\n      treeListController: treeListController,\n      selectedPath: _this.selectedPath,\n      pageSize: 100,\n      expandRootItems: true\n    };\n\n    _this._disposables.push(_this.currentPath.subscribe(function (path) {\n      _this.selectedPath(path);\n\n      _this.transformGridTitle(_utils_1.formatUnicorn(_localization_1.getLocalization('Transformation node root: {0}', 'DataAccessUIStringId.FederationDataSourceQueryBuilder_TransformationNodeRoot'), _this._dataSource.getQueryNameFromPath(path)));\n    }), treeListController, transformResultSchemaProvider, treeListController);\n\n    _this.transformResultGridTitle(_localization_1.getLocalization('Transformation result', 'DataAccessUIStringId.FederationDataSourceQueryBuilder_TransformationResult'));\n\n    return _this;\n  }\n\n  FederationTransformQueryBuilderPopup.prototype._updateColumns = function (columns, path) {\n    var _this = this;\n\n    this.transformSources(columns.map(function (x) {\n      var disabled = !x.isList;\n      return {\n        columns: columns,\n        column: x.displayName,\n        name: x.name,\n        key: path + '.' + x.name,\n        alias: undefined,\n        transform: {\n          value: ko.observable(disabled ? undefined : false),\n          disabled: disabled,\n          onValueChanged: function () {\n            _this.resultFieldListModel.valueHasMutated();\n          }\n        }\n      };\n    }));\n  };\n\n  FederationTransformQueryBuilderPopup.prototype._aliasValidationCallback = function (alias, data) {\n    var existedColumn = _arrayutils_1.findFirstItemMatchesCondition(this.transformSources(), function (source) {\n      return source.alias === alias;\n    });\n\n    if (existedColumn && existedColumn.key === data.key) return true;\n    return !existedColumn;\n  };\n\n  FederationTransformQueryBuilderPopup.prototype.dispose = function () {\n    _super.prototype.dispose.call(this);\n\n    this.resultFieldListModel = null;\n    this.transformGrid = null;\n  };\n\n  FederationTransformQueryBuilderPopup.prototype.addDataMember = function (item) {\n    this.currentPath(item.path);\n    this.updateColumns();\n    this.transformSources.valueHasMutated();\n  };\n\n  FederationTransformQueryBuilderPopup.prototype.updateColumns = function () {\n    var _this = this;\n\n    var path = this.currentPath();\n\n    this._dataSource.fielListProvider.getItems(new pathRequest_1.PathRequest(this.currentPath())).done(function (result) {\n      _this._updateColumns(result, path);\n    });\n  };\n\n  FederationTransformQueryBuilderPopup.prototype.canSave = function () {\n    return this.transformSources().some(function (source) {\n      return source.transform.value() || source.alias;\n    });\n  };\n\n  FederationTransformQueryBuilderPopup.prototype.save = function () {\n    var query = this.transformQuery();\n    query.root(new sourceQuery_1.SourceQuery({}, new serializer_1.ModelSerializer(), this._dataSource.getQueryNameFromPath(this.currentPath()), this.currentPath()));\n    query.transformationRules([]);\n    this.transformSources().forEach(function (source) {\n      if (source.transform.value() || source.alias) {\n        query.transformationRules.push(new transformQuery_1.FederationTransformationRule({\n          '@Name': source.name,\n          '@Alias': source.alias,\n          '@Unfold': source.transform.value(),\n          '@Flatten': source.transform.value()\n        }));\n      }\n    });\n    this.onSaveCallback(this.transformQuery());\n    this.close();\n  };\n\n  FederationTransformQueryBuilderPopup.prototype.onHiding = function () {\n    this.transformQuery(null);\n    this.transformResultCollapsed(false);\n    this.currentPath('');\n    this.transformSources([]);\n  };\n\n  FederationTransformQueryBuilderPopup.prototype.show = function (query) {\n    var _this = this;\n\n    this.transformQuery(query);\n\n    if (query.root && query.root()) {\n      var path = this._dataSource.getPathFromQueryName(query.root().sourceName());\n\n      this.currentPath(path);\n\n      this._dataSource.fielListProvider.getItems(new pathRequest_1.PathRequest(path)).done(function (result) {\n        _this._updateColumns(result, path);\n\n        query.transformationRules().forEach(function (rule) {\n          var column = _this.transformSources().filter(function (x) {\n            return x.name === rule.name();\n          })[0];\n\n          column.alias = rule.alias();\n          column.transform.value(rule.unfold());\n        });\n      });\n    }\n\n    if (!this.currentPath()) {\n      var firstDataSource = this._dataSource.dataSources()[0];\n\n      var firstDataSourceName = firstDataSource.ref || firstDataSource.id;\n\n      if (firstDataSource.isListType) {\n        this.currentPath(firstDataSourceName);\n        this.updateColumns();\n      } else {\n        this._dataSource.fielListProvider.getItems(new pathRequest_1.PathRequest(firstDataSourceName)).done(function (items) {\n          _this.currentPath(items[0] && items[0].isListType ? firstDataSourceName + '.' + items[0].name : firstDataSourceName);\n\n          _this.updateColumns();\n        });\n      }\n    }\n\n    this.popupVisible(true);\n  };\n\n  return FederationTransformQueryBuilderPopup;\n}(_federationQueryBuilderPopupBase_1.FederationQueryBuilderPopupBase);\n\nexports.FederationTransformQueryBuilderPopup = FederationTransformQueryBuilderPopup;","map":{"version":3,"sources":["/Users/krunalpatel/Downloads/React-Firebase-Auth-master 3/node_modules/@devexpress/analytics-core/query-builder/wizard/internal/federationDataSource/_federationTransformQueryBuilderPopup.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","TypeError","String","__","constructor","create","defineProperty","exports","value","FederationTransformQueryBuilderPopup","ko","require","_localization_1","pathRequest_1","_federationQueryBuilderPopupBase_1","_utils_1","transformQuery_1","sourceQuery_1","serializer_1","_federationTransformResultSchemaProvider_1","_federationUnionQueryBuilderTreeListController_1","_arrayutils_1","_super","onSaveCallback","dataSource","rtl","_this","transformGridTitle","observable","transformResultGridTitle","transformResultCollapsed","transformSources","currentPath","transformQuery","popupContentTemplate","transformGrid","rtlEnabled","noDataText","showRowLines","paging","enabled","scrolling","mode","editing","allowUpdating","height","columns","dataField","caption","getLocalization","allowEditing","validationRules","_aliasValidationRule","type","buttons","template","element","object","child","document","createElement","append","renderTemplate","data","onRowUpdating","event","oldData","alias","newData","resultFieldListModel","valueHasMutated","transformResultSchemaProvider","TransformResultSchemaProvider","_dataSource","dbSchemaProvider","itemsProvider","path","selectedPath","treeListController","FederatedTransformQueryBuilderTreeListController","dragDropHandler","item","isDraggable","addDataMember","fieldListModel","pageSize","expandRootItems","_disposables","push","subscribe","formatUnicorn","getQueryNameFromPath","_updateColumns","map","x","disabled","isList","column","displayName","name","key","undefined","transform","onValueChanged","_aliasValidationCallback","existedColumn","findFirstItemMatchesCondition","source","dispose","updateColumns","fielListProvider","getItems","PathRequest","done","result","canSave","some","save","query","root","SourceQuery","ModelSerializer","transformationRules","forEach","FederationTransformationRule","close","onHiding","show","getPathFromQueryName","sourceName","rule","filter","unfold","firstDataSource","dataSources","firstDataSourceName","ref","id","isListType","items","popupVisible","FederationQueryBuilderPopupBase"],"mappings":"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","sourcesContent":["/**\n* DevExpress Analytics (query-builder\\wizard\\internal\\federationDataSource\\_federationTransformQueryBuilderPopup.js)\n* Version:  22.1.3\n* Build date: Jun 14, 2022\n* Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\n* License: https://www.devexpress.com/Support/EULAs/universal.xml\n*/\n\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.FederationTransformQueryBuilderPopup = void 0;\nvar ko = require(\"knockout\");\nvar _localization_1 = require(\"../../../../property-grid/localization/_localization\");\nvar pathRequest_1 = require(\"../../../../widgets/common/pathRequest\");\nvar _federationQueryBuilderPopupBase_1 = require(\"./_federationQueryBuilderPopupBase\");\nvar _utils_1 = require(\"../../../../property-grid/widgets/internal/_utils\");\nvar transformQuery_1 = require(\"../../../dataSource/federation/federatedQueries/transformQuery\");\nvar sourceQuery_1 = require(\"../../../dataSource/federation/federatedQueries/sourceQuery\");\nvar serializer_1 = require(\"../../../../serializer/serializer\");\nvar _federationTransformResultSchemaProvider_1 = require(\"./_federationTransformResultSchemaProvider\");\nvar _federationUnionQueryBuilderTreeListController_1 = require(\"../../../utils/_federationUnionQueryBuilderTreeListController\");\nvar _arrayutils_1 = require(\"../../../../core/utils/_arrayutils\");\nvar FederationTransformQueryBuilderPopup = (function (_super) {\n    __extends(FederationTransformQueryBuilderPopup, _super);\n    function FederationTransformQueryBuilderPopup(onSaveCallback, dataSource, rtl) {\n        if (rtl === void 0) { rtl = false; }\n        var _this = _super.call(this, onSaveCallback, dataSource, rtl) || this;\n        _this.transformGridTitle = ko.observable();\n        _this.transformResultGridTitle = ko.observable();\n        _this.transformResultCollapsed = ko.observable(false);\n        _this.transformSources = ko.observable([]);\n        _this.currentPath = ko.observable();\n        _this.transformQuery = ko.observable();\n        _this.popupContentTemplate = 'dxrd-querybuilder-transform-popup-content';\n        _this.transformGrid = {\n            rtlEnabled: rtl,\n            noDataText: function () { return ''; },\n            dataSource: _this.transformSources,\n            showRowLines: true,\n            paging: { enabled: false },\n            scrolling: { mode: 'infinite' },\n            editing: {\n                allowUpdating: true,\n                mode: 'cell',\n            },\n            height: '100%',\n            columns: [{\n                    dataField: 'column',\n                    get caption() {\n                        return _localization_1.getLocalization('Column Name', 'DataAccessUIStringId.QueryBuilderColumns_ColumnName');\n                    },\n                    allowEditing: false\n                }, {\n                    dataField: 'alias',\n                    get caption() {\n                        return _localization_1.getLocalization('Alias', 'DataAccessUIStringId.QueryBuilderColumns_Alias');\n                    },\n                    validationRules: [_this._aliasValidationRule]\n                }, {\n                    type: 'buttons',\n                    get caption() {\n                        return _localization_1.getLocalization('Transform', 'DataAccessUIStringId.FederationDataSourceQueryBuilder_NodeType_Transform');\n                    },\n                    buttons: [{\n                            template: function (element, object) {\n                                var child = document.createElement('div');\n                                element.append(child);\n                                ko.renderTemplate('dxrd-querybuilder-transform-checkbox', object.data, {}, child, 'replaceNode');\n                            },\n                        }]\n                }\n            ],\n            onRowUpdating: function (event) {\n                event.oldData.alias = event.newData.alias;\n                _this.resultFieldListModel.valueHasMutated();\n                _this.transformSources.valueHasMutated();\n            }\n        };\n        var transformResultSchemaProvider = new _federationTransformResultSchemaProvider_1.TransformResultSchemaProvider(_this._dataSource.dbSchemaProvider, _this.transformSources, _this.currentPath);\n        _this.resultFieldListModel = ko.observable({\n            itemsProvider: transformResultSchemaProvider,\n            path: _this.currentPath,\n            selectedPath: ko.observable(),\n            treeListController: null\n        });\n        var treeListController = new _federationUnionQueryBuilderTreeListController_1.FederatedTransformQueryBuilderTreeListController(_this.dragDropHandler, function (item) { return treeListController.isDraggable(item) && _this.addDataMember(item); });\n        _this.fieldListModel = {\n            itemsProvider: _this._dataSource.dbSchemaProvider,\n            treeListController: treeListController,\n            selectedPath: _this.selectedPath,\n            pageSize: 100,\n            expandRootItems: true\n        };\n        _this._disposables.push(_this.currentPath.subscribe(function (path) {\n            _this.selectedPath(path);\n            _this.transformGridTitle(_utils_1.formatUnicorn(_localization_1.getLocalization('Transformation node root: {0}', 'DataAccessUIStringId.FederationDataSourceQueryBuilder_TransformationNodeRoot'), _this._dataSource.getQueryNameFromPath(path)));\n        }), treeListController, transformResultSchemaProvider, treeListController);\n        _this.transformResultGridTitle(_localization_1.getLocalization('Transformation result', 'DataAccessUIStringId.FederationDataSourceQueryBuilder_TransformationResult'));\n        return _this;\n    }\n    FederationTransformQueryBuilderPopup.prototype._updateColumns = function (columns, path) {\n        var _this = this;\n        this.transformSources(columns.map(function (x) {\n            var disabled = !x.isList;\n            return {\n                columns: columns,\n                column: x.displayName,\n                name: x.name,\n                key: path + '.' + x.name,\n                alias: undefined,\n                transform: {\n                    value: ko.observable(disabled ? undefined : false),\n                    disabled: disabled,\n                    onValueChanged: function () { _this.resultFieldListModel.valueHasMutated(); }\n                }\n            };\n        }));\n    };\n    FederationTransformQueryBuilderPopup.prototype._aliasValidationCallback = function (alias, data) {\n        var existedColumn = _arrayutils_1.findFirstItemMatchesCondition(this.transformSources(), function (source) { return source.alias === alias; });\n        if (existedColumn && existedColumn.key === data.key)\n            return true;\n        return !existedColumn;\n    };\n    FederationTransformQueryBuilderPopup.prototype.dispose = function () {\n        _super.prototype.dispose.call(this);\n        this.resultFieldListModel = null;\n        this.transformGrid = null;\n    };\n    FederationTransformQueryBuilderPopup.prototype.addDataMember = function (item) {\n        this.currentPath(item.path);\n        this.updateColumns();\n        this.transformSources.valueHasMutated();\n    };\n    FederationTransformQueryBuilderPopup.prototype.updateColumns = function () {\n        var _this = this;\n        var path = this.currentPath();\n        this._dataSource.fielListProvider.getItems(new pathRequest_1.PathRequest(this.currentPath())).done(function (result) {\n            _this._updateColumns(result, path);\n        });\n    };\n    FederationTransformQueryBuilderPopup.prototype.canSave = function () {\n        return this.transformSources().some(function (source) { return source.transform.value() || source.alias; });\n    };\n    FederationTransformQueryBuilderPopup.prototype.save = function () {\n        var query = this.transformQuery();\n        query.root(new sourceQuery_1.SourceQuery({}, new serializer_1.ModelSerializer(), this._dataSource.getQueryNameFromPath(this.currentPath()), this.currentPath()));\n        query.transformationRules([]);\n        this.transformSources().forEach(function (source) {\n            if (source.transform.value() || source.alias) {\n                query.transformationRules.push(new transformQuery_1.FederationTransformationRule({\n                    '@Name': source.name,\n                    '@Alias': source.alias,\n                    '@Unfold': source.transform.value(),\n                    '@Flatten': source.transform.value()\n                }));\n            }\n        });\n        this.onSaveCallback(this.transformQuery());\n        this.close();\n    };\n    FederationTransformQueryBuilderPopup.prototype.onHiding = function () {\n        this.transformQuery(null);\n        this.transformResultCollapsed(false);\n        this.currentPath('');\n        this.transformSources([]);\n    };\n    FederationTransformQueryBuilderPopup.prototype.show = function (query) {\n        var _this = this;\n        this.transformQuery(query);\n        if (query.root && query.root()) {\n            var path = this._dataSource.getPathFromQueryName(query.root().sourceName());\n            this.currentPath(path);\n            this._dataSource.fielListProvider.getItems(new pathRequest_1.PathRequest(path)).done(function (result) {\n                _this._updateColumns(result, path);\n                query.transformationRules().forEach(function (rule) {\n                    var column = _this.transformSources().filter(function (x) { return x.name === rule.name(); })[0];\n                    column.alias = rule.alias();\n                    column.transform.value(rule.unfold());\n                });\n            });\n        }\n        if (!this.currentPath()) {\n            var firstDataSource = this._dataSource.dataSources()[0];\n            var firstDataSourceName = firstDataSource.ref || firstDataSource.id;\n            if (firstDataSource.isListType) {\n                this.currentPath(firstDataSourceName);\n                this.updateColumns();\n            }\n            else {\n                this._dataSource.fielListProvider.getItems(new pathRequest_1.PathRequest(firstDataSourceName)).done(function (items) {\n                    _this.currentPath(items[0] && items[0].isListType ? firstDataSourceName + '.' + items[0].name : firstDataSourceName);\n                    _this.updateColumns();\n                });\n            }\n        }\n        this.popupVisible(true);\n    };\n    return FederationTransformQueryBuilderPopup;\n}(_federationQueryBuilderPopupBase_1.FederationQueryBuilderPopupBase));\nexports.FederationTransformQueryBuilderPopup = FederationTransformQueryBuilderPopup;\n"]},"metadata":{},"sourceType":"script"}