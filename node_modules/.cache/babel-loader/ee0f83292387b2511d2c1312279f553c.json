{"ast":null,"code":"/**\r\n* DevExpress Dashboard (_data-item-surface.js)\r\n* Version:  22.1.3\r\n* Build date: Jun 13, 2022\r\n* Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n* License: https://www.devexpress.com/Support/EULAs/universal.xml\r\n*/\n\"use strict\";\n\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.DataItemSurface = void 0;\n\nvar ko = require(\"knockout\");\n\nvar _data_source_browser_1 = require(\"../../../common/_data-source-browser\");\n\nvar _jquery_helpers_1 = require(\"../../../data/_jquery-helpers\");\n\nvar data_item_1 = require(\"../../../model/data-item/data-item\");\n\nvar measure_1 = require(\"../../../model/data-item/measure\");\n\nvar _data_field_1 = require(\"../../../model/data-sources/_data-field\");\n\nvar _undo_engine_helper_1 = require(\"../../../model/internal/_undo-engine-helper\");\n\nvar _data_item_properties_composer_1 = require(\"../properties-composers/_data-item-properties-composer\");\n\nvar DataItemSurface = function () {\n  function DataItemSurface(model, binding, container, dataSourceBrowser, propertiesController, unwrappedDataItem, fieldConstraint, extendTabsHandler) {\n    var _this = this;\n\n    this.model = model;\n    this.binding = binding;\n    this.propertiesController = propertiesController;\n    this.unwrappedDataItem = unwrappedDataItem;\n    this.fieldConstraint = fieldConstraint;\n    this.extendTabsHandler = extendTabsHandler;\n    this._disposables = [];\n    this.propertiesTabs = ko.observableArray([]);\n    this.choosenField = ko.observable();\n    this.newItemCreated = _jquery_helpers_1.createJQueryCallbacks();\n    this.itemSelected = _jquery_helpers_1.createJQueryCallbacks();\n    var composer = new _data_item_properties_composer_1.DataItemsPropertiesComposer();\n\n    var updatePropertiesTabs = function () {\n      var result = composer.composeTabs(_this.model, {\n        dataDashboardItem: container,\n        choosenField: _this.choosenField,\n        dataSourceBrowser: dataSourceBrowser,\n        unwrappedDataItem: _this.unwrappedDataItem,\n        constraint: _this.fullConstraint,\n        propertiesController: _this.propertiesController\n      });\n      _this.extendTabsHandler && _this.extendTabsHandler(result, _this.model.dataItem());\n      var promise = dataSourceBrowser.getDataFieldsArray(container.dataSource(), container.dataMember(), '', _data_source_browser_1.isNonCollectionDataField);\n      promise.done(function () {\n        var oldTabs = _this.propertiesTabs.peek();\n\n        oldTabs && oldTabs.forEach(function (tab) {\n          return tab.dispose();\n        });\n\n        _this.propertiesTabs(result);\n      });\n    };\n\n    var subscribeToFieldChanges = function () {\n      _this._disposables.push(_this.choosenField.subscribe(function (newField) {\n        if (model.dataItem() && model.dataItem().dataMember()) {\n          _this._changeExistingField(container, model, newField, updatePropertiesTabs);\n        } else {\n          _this._changeNewField(container, newField, updatePropertiesTabs);\n        }\n      }));\n\n      updatePropertiesTabs();\n    };\n\n    if (!!model.dataItem()) {\n      dataSourceBrowser.findDataField(container.dataSource(), container.dataMember(), model.dataItem().dataMember()).done(function (field) {\n        if (!!field && field !== _this.choosenField()) {\n          _this.choosenField(field);\n        }\n\n        subscribeToFieldChanges();\n      });\n    } else {\n      subscribeToFieldChanges();\n    }\n\n    this._disposables.push({\n      dispose: function () {\n        _this.newItemCreated.empty();\n      }\n    });\n  }\n\n  DataItemSurface.prototype._changeNewField = function (container, newField, additionalFunc) {\n    var _this = this;\n\n    if (this.model.itemType() !== 'Seed') {\n      if (!_data_field_1.IsOlapHierarchyField(newField)) {\n        var dataItem = container._createDataItem(newField, this.binding);\n\n        if (this.model._specifics.isAttribute && dataItem instanceof measure_1.Measure) {\n          dataItem.summaryType('Min');\n        }\n\n        this.model.uniqueName(dataItem.uniqueName());\n        this.newItemCreated.fire(this.model, newField);\n        this.itemSelected.fire(this.model, newField);\n      } else {\n        var groupIndex = newField.groupIndex();\n        newField['groupDataItems'].forEach(function (groupItem, index) {\n          var dataItem = container._createDataItem(groupItem, _this.binding);\n\n          dataItem.groupIndex(groupIndex);\n\n          if (index === 0) {\n            _this.model.uniqueName(dataItem.uniqueName());\n\n            _this.newItemCreated.fire(_this.model, groupItem);\n          } else {\n            var model = new data_item_1.DataItemLink(container);\n            model.uniqueName(dataItem.uniqueName());\n\n            _this.newItemCreated.fire(model, groupItem);\n          }\n        });\n        this.itemSelected.fire(this.model, newField['groupDataItems'][0]);\n      }\n    } else {\n      this.newItemCreated.fire(this.model, newField);\n      this.itemSelected.fire(this.model, newField);\n    }\n\n    additionalFunc();\n  };\n\n  DataItemSurface.prototype._changeExistingField = function (container, model, newField, additionalFunc) {\n    var _this = this;\n\n    if (!_data_field_1.IsOlapHierarchyField(newField)) {\n      container._updateDataItem(model.dataItem(), this.binding, newField, model._specifics.acceptableShapingType);\n    } else {\n      var groupIndex = newField.groupIndex();\n      newField['groupDataItems'].forEach(function (groupItem, index) {\n        if (index === 0) {\n          container._updateDataItem(model.dataItem(), _this.binding, groupItem, model._specifics.acceptableShapingType);\n\n          model.dataItem().groupIndex(groupIndex);\n        } else {\n          var dataItem = container._createDataItem(groupItem, _this.binding);\n\n          dataItem.groupIndex(groupIndex);\n          var dataItemLink = new data_item_1.DataItemLink(container);\n          dataItemLink.uniqueName(dataItem.uniqueName());\n\n          _this.newItemCreated.fire(dataItemLink, groupItem);\n        }\n      });\n    }\n\n    additionalFunc();\n  };\n\n  Object.defineProperty(DataItemSurface.prototype, \"commonDataItemTypeConstraint\", {\n    get: function () {\n      if (this.binding.dataItemType === 'Dimension') {\n        return function (field) {\n          return _data_field_1.DataField.ifOlapThenOnlyDimension(field) && !(field.isAggregate && field.isAggregate());\n        };\n      }\n\n      if (this.binding.dataItemType === 'Measure') {\n        return function (field) {\n          return _data_field_1.DataField.ifOlapThenOnlyMeasure(field);\n        };\n      }\n\n      return function () {\n        return true;\n      };\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(DataItemSurface.prototype, \"fullConstraint\", {\n    get: function () {\n      var _this = this;\n\n      return function (field) {\n        if (!_this.commonDataItemTypeConstraint(field)) return false;\n\n        if (field.isDataFieldNode()) {\n          return !_this.fieldConstraint || _this.fieldConstraint(field);\n        } else {\n          return true;\n        }\n      };\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  DataItemSurface.prototype.dispose = function () {\n    this._disposables.forEach(function (d) {\n      d.dispose();\n    });\n  };\n\n  __decorate([_undo_engine_helper_1.wrapWithUndoRedo], DataItemSurface.prototype, \"_changeNewField\", null);\n\n  __decorate([_undo_engine_helper_1.wrapWithUndoRedo], DataItemSurface.prototype, \"_changeExistingField\", null);\n\n  return DataItemSurface;\n}();\n\nexports.DataItemSurface = DataItemSurface;","map":{"version":3,"sources":["/Users/krunalpatel/Downloads/React-Firebase-Auth-master 3/node_modules/devexpress-dashboard/designer/items/binding-details/_data-item-surface.js"],"names":["__decorate","decorators","target","key","desc","c","arguments","length","r","Object","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","exports","value","DataItemSurface","ko","require","_data_source_browser_1","_jquery_helpers_1","data_item_1","measure_1","_data_field_1","_undo_engine_helper_1","_data_item_properties_composer_1","model","binding","container","dataSourceBrowser","propertiesController","unwrappedDataItem","fieldConstraint","extendTabsHandler","_this","_disposables","propertiesTabs","observableArray","choosenField","observable","newItemCreated","createJQueryCallbacks","itemSelected","composer","DataItemsPropertiesComposer","updatePropertiesTabs","result","composeTabs","dataDashboardItem","constraint","fullConstraint","dataItem","promise","getDataFieldsArray","dataSource","dataMember","isNonCollectionDataField","done","oldTabs","peek","forEach","tab","dispose","subscribeToFieldChanges","push","subscribe","newField","_changeExistingField","_changeNewField","findDataField","field","empty","prototype","additionalFunc","itemType","IsOlapHierarchyField","_createDataItem","_specifics","isAttribute","Measure","summaryType","uniqueName","fire","groupIndex","groupItem","index","DataItemLink","_updateDataItem","acceptableShapingType","dataItemLink","get","dataItemType","DataField","ifOlapThenOnlyDimension","isAggregate","ifOlapThenOnlyMeasure","enumerable","configurable","commonDataItemTypeConstraint","isDataFieldNode","wrapWithUndoRedo"],"mappings":"AAAA;;;;;;;AAOA;;AACA,IAAIA,UAAU,GAAI,QAAQ,KAAKA,UAAd,IAA6B,UAAUC,UAAV,EAAsBC,MAAtB,EAA8BC,GAA9B,EAAmCC,IAAnC,EAAyC;AACnF,MAAIC,CAAC,GAAGC,SAAS,CAACC,MAAlB;AAAA,MAA0BC,CAAC,GAAGH,CAAC,GAAG,CAAJ,GAAQH,MAAR,GAAiBE,IAAI,KAAK,IAAT,GAAgBA,IAAI,GAAGK,MAAM,CAACC,wBAAP,CAAgCR,MAAhC,EAAwCC,GAAxC,CAAvB,GAAsEC,IAArH;AAAA,MAA2HO,CAA3H;AACA,MAAI,OAAOC,OAAP,KAAmB,QAAnB,IAA+B,OAAOA,OAAO,CAACC,QAAf,KAA4B,UAA/D,EAA2EL,CAAC,GAAGI,OAAO,CAACC,QAAR,CAAiBZ,UAAjB,EAA6BC,MAA7B,EAAqCC,GAArC,EAA0CC,IAA1C,CAAJ,CAA3E,KACK,KAAK,IAAIU,CAAC,GAAGb,UAAU,CAACM,MAAX,GAAoB,CAAjC,EAAoCO,CAAC,IAAI,CAAzC,EAA4CA,CAAC,EAA7C,EAAiD,IAAIH,CAAC,GAAGV,UAAU,CAACa,CAAD,CAAlB,EAAuBN,CAAC,GAAG,CAACH,CAAC,GAAG,CAAJ,GAAQM,CAAC,CAACH,CAAD,CAAT,GAAeH,CAAC,GAAG,CAAJ,GAAQM,CAAC,CAACT,MAAD,EAASC,GAAT,EAAcK,CAAd,CAAT,GAA4BG,CAAC,CAACT,MAAD,EAASC,GAAT,CAA7C,KAA+DK,CAAnE;AAC7E,SAAOH,CAAC,GAAG,CAAJ,IAASG,CAAT,IAAcC,MAAM,CAACM,cAAP,CAAsBb,MAAtB,EAA8BC,GAA9B,EAAmCK,CAAnC,CAAd,EAAqDA,CAA5D;AACH,CALD;;AAMAC,MAAM,CAACM,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;AAAEC,EAAAA,KAAK,EAAE;AAAT,CAA7C;AACAD,OAAO,CAACE,eAAR,GAA0B,KAAK,CAA/B;;AACA,IAAIC,EAAE,GAAGC,OAAO,CAAC,UAAD,CAAhB;;AACA,IAAIC,sBAAsB,GAAGD,OAAO,CAAC,sCAAD,CAApC;;AACA,IAAIE,iBAAiB,GAAGF,OAAO,CAAC,+BAAD,CAA/B;;AACA,IAAIG,WAAW,GAAGH,OAAO,CAAC,oCAAD,CAAzB;;AACA,IAAII,SAAS,GAAGJ,OAAO,CAAC,kCAAD,CAAvB;;AACA,IAAIK,aAAa,GAAGL,OAAO,CAAC,yCAAD,CAA3B;;AACA,IAAIM,qBAAqB,GAAGN,OAAO,CAAC,6CAAD,CAAnC;;AACA,IAAIO,gCAAgC,GAAGP,OAAO,CAAC,wDAAD,CAA9C;;AACA,IAAIF,eAAe,GAAI,YAAY;AAC/B,WAASA,eAAT,CAAyBU,KAAzB,EAAgCC,OAAhC,EAAyCC,SAAzC,EAAoDC,iBAApD,EAAuEC,oBAAvE,EAA6FC,iBAA7F,EAAgHC,eAAhH,EAAiIC,iBAAjI,EAAoJ;AAChJ,QAAIC,KAAK,GAAG,IAAZ;;AACA,SAAKR,KAAL,GAAaA,KAAb;AACA,SAAKC,OAAL,GAAeA,OAAf;AACA,SAAKG,oBAAL,GAA4BA,oBAA5B;AACA,SAAKC,iBAAL,GAAyBA,iBAAzB;AACA,SAAKC,eAAL,GAAuBA,eAAvB;AACA,SAAKC,iBAAL,GAAyBA,iBAAzB;AACA,SAAKE,YAAL,GAAoB,EAApB;AACA,SAAKC,cAAL,GAAsBnB,EAAE,CAACoB,eAAH,CAAmB,EAAnB,CAAtB;AACA,SAAKC,YAAL,GAAoBrB,EAAE,CAACsB,UAAH,EAApB;AACA,SAAKC,cAAL,GAAsBpB,iBAAiB,CAACqB,qBAAlB,EAAtB;AACA,SAAKC,YAAL,GAAoBtB,iBAAiB,CAACqB,qBAAlB,EAApB;AACA,QAAIE,QAAQ,GAAG,IAAIlB,gCAAgC,CAACmB,2BAArC,EAAf;;AACA,QAAIC,oBAAoB,GAAG,YAAY;AACnC,UAAIC,MAAM,GAAGH,QAAQ,CAACI,WAAT,CAAqBb,KAAK,CAACR,KAA3B,EAAkC;AAC3CsB,QAAAA,iBAAiB,EAAEpB,SADwB;AAE3CU,QAAAA,YAAY,EAAEJ,KAAK,CAACI,YAFuB;AAG3CT,QAAAA,iBAAiB,EAAEA,iBAHwB;AAI3CE,QAAAA,iBAAiB,EAAEG,KAAK,CAACH,iBAJkB;AAK3CkB,QAAAA,UAAU,EAAEf,KAAK,CAACgB,cALyB;AAM3CpB,QAAAA,oBAAoB,EAAEI,KAAK,CAACJ;AANe,OAAlC,CAAb;AAQAI,MAAAA,KAAK,CAACD,iBAAN,IAA2BC,KAAK,CAACD,iBAAN,CAAwBa,MAAxB,EAAgCZ,KAAK,CAACR,KAAN,CAAYyB,QAAZ,EAAhC,CAA3B;AACA,UAAIC,OAAO,GAAGvB,iBAAiB,CAACwB,kBAAlB,CAAqCzB,SAAS,CAAC0B,UAAV,EAArC,EAA6D1B,SAAS,CAAC2B,UAAV,EAA7D,EAAqF,EAArF,EAAyFpC,sBAAsB,CAACqC,wBAAhH,CAAd;AACAJ,MAAAA,OAAO,CAACK,IAAR,CAAa,YAAY;AACrB,YAAIC,OAAO,GAAGxB,KAAK,CAACE,cAAN,CAAqBuB,IAArB,EAAd;;AACAD,QAAAA,OAAO,IAAIA,OAAO,CAACE,OAAR,CAAgB,UAAUC,GAAV,EAAe;AAAE,iBAAOA,GAAG,CAACC,OAAJ,EAAP;AAAuB,SAAxD,CAAX;;AACA5B,QAAAA,KAAK,CAACE,cAAN,CAAqBU,MAArB;AACH,OAJD;AAKH,KAhBD;;AAiBA,QAAIiB,uBAAuB,GAAG,YAAY;AACtC7B,MAAAA,KAAK,CAACC,YAAN,CAAmB6B,IAAnB,CAAwB9B,KAAK,CAACI,YAAN,CAAmB2B,SAAnB,CAA6B,UAAUC,QAAV,EAAoB;AACrE,YAAIxC,KAAK,CAACyB,QAAN,MAAoBzB,KAAK,CAACyB,QAAN,GAAiBI,UAAjB,EAAxB,EAAuD;AACnDrB,UAAAA,KAAK,CAACiC,oBAAN,CAA2BvC,SAA3B,EAAsCF,KAAtC,EAA6CwC,QAA7C,EAAuDrB,oBAAvD;AACH,SAFD,MAGK;AACDX,UAAAA,KAAK,CAACkC,eAAN,CAAsBxC,SAAtB,EAAiCsC,QAAjC,EAA2CrB,oBAA3C;AACH;AACJ,OAPuB,CAAxB;;AAQAA,MAAAA,oBAAoB;AACvB,KAVD;;AAWA,QAAI,CAAC,CAACnB,KAAK,CAACyB,QAAN,EAAN,EAAwB;AACpBtB,MAAAA,iBAAiB,CACZwC,aADL,CACmBzC,SAAS,CAAC0B,UAAV,EADnB,EAC2C1B,SAAS,CAAC2B,UAAV,EAD3C,EACmE7B,KAAK,CAACyB,QAAN,GAAiBI,UAAjB,EADnE,EAEKE,IAFL,CAEU,UAAUa,KAAV,EAAiB;AACvB,YAAI,CAAC,CAACA,KAAF,IAAWA,KAAK,KAAKpC,KAAK,CAACI,YAAN,EAAzB,EAA+C;AAC3CJ,UAAAA,KAAK,CAACI,YAAN,CAAmBgC,KAAnB;AACH;;AACDP,QAAAA,uBAAuB;AAC1B,OAPD;AAQH,KATD,MAUK;AACDA,MAAAA,uBAAuB;AAC1B;;AACD,SAAK5B,YAAL,CAAkB6B,IAAlB,CAAuB;AACnBF,MAAAA,OAAO,EAAE,YAAY;AACjB5B,QAAAA,KAAK,CAACM,cAAN,CAAqB+B,KAArB;AACH;AAHkB,KAAvB;AAKH;;AACDvD,EAAAA,eAAe,CAACwD,SAAhB,CAA0BJ,eAA1B,GAA4C,UAAUxC,SAAV,EAAqBsC,QAArB,EAA+BO,cAA/B,EAA+C;AACvF,QAAIvC,KAAK,GAAG,IAAZ;;AACA,QAAI,KAAKR,KAAL,CAAWgD,QAAX,OAA0B,MAA9B,EAAsC;AAClC,UAAI,CAACnD,aAAa,CAACoD,oBAAd,CAAmCT,QAAnC,CAAL,EAAmD;AAC/C,YAAIf,QAAQ,GAAGvB,SAAS,CAACgD,eAAV,CAA0BV,QAA1B,EAAoC,KAAKvC,OAAzC,CAAf;;AACA,YAAI,KAAKD,KAAL,CAAWmD,UAAX,CAAsBC,WAAtB,IAAqC3B,QAAQ,YAAY7B,SAAS,CAACyD,OAAvE,EAAgF;AAC5E5B,UAAAA,QAAQ,CAAC6B,WAAT,CAAqB,KAArB;AACH;;AACD,aAAKtD,KAAL,CAAWuD,UAAX,CAAsB9B,QAAQ,CAAC8B,UAAT,EAAtB;AACA,aAAKzC,cAAL,CAAoB0C,IAApB,CAAyB,KAAKxD,KAA9B,EAAqCwC,QAArC;AACA,aAAKxB,YAAL,CAAkBwC,IAAlB,CAAuB,KAAKxD,KAA5B,EAAmCwC,QAAnC;AACH,OARD,MASK;AACD,YAAIiB,UAAU,GAAGjB,QAAQ,CAACiB,UAAT,EAAjB;AACAjB,QAAAA,QAAQ,CAAC,gBAAD,CAAR,CAA2BN,OAA3B,CAAmC,UAAUwB,SAAV,EAAqBC,KAArB,EAA4B;AAC3D,cAAIlC,QAAQ,GAAGvB,SAAS,CAACgD,eAAV,CAA0BQ,SAA1B,EAAqClD,KAAK,CAACP,OAA3C,CAAf;;AACAwB,UAAAA,QAAQ,CAACgC,UAAT,CAAoBA,UAApB;;AACA,cAAIE,KAAK,KAAK,CAAd,EAAiB;AACbnD,YAAAA,KAAK,CAACR,KAAN,CAAYuD,UAAZ,CAAuB9B,QAAQ,CAAC8B,UAAT,EAAvB;;AACA/C,YAAAA,KAAK,CAACM,cAAN,CAAqB0C,IAArB,CAA0BhD,KAAK,CAACR,KAAhC,EAAuC0D,SAAvC;AACH,WAHD,MAIK;AACD,gBAAI1D,KAAK,GAAG,IAAIL,WAAW,CAACiE,YAAhB,CAA6B1D,SAA7B,CAAZ;AACAF,YAAAA,KAAK,CAACuD,UAAN,CAAiB9B,QAAQ,CAAC8B,UAAT,EAAjB;;AACA/C,YAAAA,KAAK,CAACM,cAAN,CAAqB0C,IAArB,CAA0BxD,KAA1B,EAAiC0D,SAAjC;AACH;AACJ,SAZD;AAaA,aAAK1C,YAAL,CAAkBwC,IAAlB,CAAuB,KAAKxD,KAA5B,EAAmCwC,QAAQ,CAAC,gBAAD,CAAR,CAA2B,CAA3B,CAAnC;AACH;AACJ,KA3BD,MA4BK;AACD,WAAK1B,cAAL,CAAoB0C,IAApB,CAAyB,KAAKxD,KAA9B,EAAqCwC,QAArC;AACA,WAAKxB,YAAL,CAAkBwC,IAAlB,CAAuB,KAAKxD,KAA5B,EAAmCwC,QAAnC;AACH;;AACDO,IAAAA,cAAc;AACjB,GAnCD;;AAoCAzD,EAAAA,eAAe,CAACwD,SAAhB,CAA0BL,oBAA1B,GAAiD,UAAUvC,SAAV,EAAqBF,KAArB,EAA4BwC,QAA5B,EAAsCO,cAAtC,EAAsD;AACnG,QAAIvC,KAAK,GAAG,IAAZ;;AACA,QAAI,CAACX,aAAa,CAACoD,oBAAd,CAAmCT,QAAnC,CAAL,EAAmD;AAC/CtC,MAAAA,SAAS,CAAC2D,eAAV,CAA0B7D,KAAK,CAACyB,QAAN,EAA1B,EAA4C,KAAKxB,OAAjD,EAA0DuC,QAA1D,EAAoExC,KAAK,CAACmD,UAAN,CAAiBW,qBAArF;AACH,KAFD,MAGK;AACD,UAAIL,UAAU,GAAGjB,QAAQ,CAACiB,UAAT,EAAjB;AACAjB,MAAAA,QAAQ,CAAC,gBAAD,CAAR,CAA2BN,OAA3B,CAAmC,UAAUwB,SAAV,EAAqBC,KAArB,EAA4B;AAC3D,YAAIA,KAAK,KAAK,CAAd,EAAiB;AACbzD,UAAAA,SAAS,CAAC2D,eAAV,CAA0B7D,KAAK,CAACyB,QAAN,EAA1B,EAA4CjB,KAAK,CAACP,OAAlD,EAA2DyD,SAA3D,EAAsE1D,KAAK,CAACmD,UAAN,CAAiBW,qBAAvF;;AACA9D,UAAAA,KAAK,CAACyB,QAAN,GAAiBgC,UAAjB,CAA4BA,UAA5B;AACH,SAHD,MAIK;AACD,cAAIhC,QAAQ,GAAGvB,SAAS,CAACgD,eAAV,CAA0BQ,SAA1B,EAAqClD,KAAK,CAACP,OAA3C,CAAf;;AACAwB,UAAAA,QAAQ,CAACgC,UAAT,CAAoBA,UAApB;AACA,cAAIM,YAAY,GAAG,IAAIpE,WAAW,CAACiE,YAAhB,CAA6B1D,SAA7B,CAAnB;AACA6D,UAAAA,YAAY,CAACR,UAAb,CAAwB9B,QAAQ,CAAC8B,UAAT,EAAxB;;AACA/C,UAAAA,KAAK,CAACM,cAAN,CAAqB0C,IAArB,CAA0BO,YAA1B,EAAwCL,SAAxC;AACH;AACJ,OAZD;AAaH;;AACDX,IAAAA,cAAc;AACjB,GAtBD;;AAuBAlE,EAAAA,MAAM,CAACM,cAAP,CAAsBG,eAAe,CAACwD,SAAtC,EAAiD,8BAAjD,EAAiF;AAC7EkB,IAAAA,GAAG,EAAE,YAAY;AACb,UAAI,KAAK/D,OAAL,CAAagE,YAAb,KAA8B,WAAlC,EAA+C;AAC3C,eAAO,UAAUrB,KAAV,EAAiB;AAAE,iBAAO/C,aAAa,CAACqE,SAAd,CAAwBC,uBAAxB,CAAgDvB,KAAhD,KAA0D,EAAEA,KAAK,CAACwB,WAAN,IAAqBxB,KAAK,CAACwB,WAAN,EAAvB,CAAjE;AAA+G,SAAzI;AACH;;AACD,UAAI,KAAKnE,OAAL,CAAagE,YAAb,KAA8B,SAAlC,EAA6C;AACzC,eAAO,UAAUrB,KAAV,EAAiB;AAAE,iBAAO/C,aAAa,CAACqE,SAAd,CAAwBG,qBAAxB,CAA8CzB,KAA9C,CAAP;AAA8D,SAAxF;AACH;;AACD,aAAO,YAAY;AAAE,eAAO,IAAP;AAAc,OAAnC;AACH,KAT4E;AAU7E0B,IAAAA,UAAU,EAAE,KAViE;AAW7EC,IAAAA,YAAY,EAAE;AAX+D,GAAjF;AAaA1F,EAAAA,MAAM,CAACM,cAAP,CAAsBG,eAAe,CAACwD,SAAtC,EAAiD,gBAAjD,EAAmE;AAC/DkB,IAAAA,GAAG,EAAE,YAAY;AACb,UAAIxD,KAAK,GAAG,IAAZ;;AACA,aAAO,UAAUoC,KAAV,EAAiB;AACpB,YAAI,CAACpC,KAAK,CAACgE,4BAAN,CAAmC5B,KAAnC,CAAL,EACI,OAAO,KAAP;;AACJ,YAAIA,KAAK,CAAC6B,eAAN,EAAJ,EAA6B;AACzB,iBAAO,CAACjE,KAAK,CAACF,eAAP,IAA0BE,KAAK,CAACF,eAAN,CAAsBsC,KAAtB,CAAjC;AACH,SAFD,MAGK;AACD,iBAAO,IAAP;AACH;AACJ,OATD;AAUH,KAb8D;AAc/D0B,IAAAA,UAAU,EAAE,KAdmD;AAe/DC,IAAAA,YAAY,EAAE;AAfiD,GAAnE;;AAiBAjF,EAAAA,eAAe,CAACwD,SAAhB,CAA0BV,OAA1B,GAAoC,YAAY;AAC5C,SAAK3B,YAAL,CAAkByB,OAAlB,CAA0B,UAAUnD,CAAV,EAAa;AACnCA,MAAAA,CAAC,CAACqD,OAAF;AACH,KAFD;AAGH,GAJD;;AAKAhE,EAAAA,UAAU,CAAC,CACP0B,qBAAqB,CAAC4E,gBADf,CAAD,EAEPpF,eAAe,CAACwD,SAFT,EAEoB,iBAFpB,EAEuC,IAFvC,CAAV;;AAGA1E,EAAAA,UAAU,CAAC,CACP0B,qBAAqB,CAAC4E,gBADf,CAAD,EAEPpF,eAAe,CAACwD,SAFT,EAEoB,sBAFpB,EAE4C,IAF5C,CAAV;;AAGA,SAAOxD,eAAP;AACH,CAnKsB,EAAvB;;AAoKAF,OAAO,CAACE,eAAR,GAA0BA,eAA1B","sourcesContent":["/**\r\n* DevExpress Dashboard (_data-item-surface.js)\r\n* Version:  22.1.3\r\n* Build date: Jun 13, 2022\r\n* Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n* License: https://www.devexpress.com/Support/EULAs/universal.xml\r\n*/\r\n\"use strict\";\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.DataItemSurface = void 0;\nvar ko = require(\"knockout\");\nvar _data_source_browser_1 = require(\"../../../common/_data-source-browser\");\nvar _jquery_helpers_1 = require(\"../../../data/_jquery-helpers\");\nvar data_item_1 = require(\"../../../model/data-item/data-item\");\nvar measure_1 = require(\"../../../model/data-item/measure\");\nvar _data_field_1 = require(\"../../../model/data-sources/_data-field\");\nvar _undo_engine_helper_1 = require(\"../../../model/internal/_undo-engine-helper\");\nvar _data_item_properties_composer_1 = require(\"../properties-composers/_data-item-properties-composer\");\nvar DataItemSurface = (function () {\n    function DataItemSurface(model, binding, container, dataSourceBrowser, propertiesController, unwrappedDataItem, fieldConstraint, extendTabsHandler) {\n        var _this = this;\n        this.model = model;\n        this.binding = binding;\n        this.propertiesController = propertiesController;\n        this.unwrappedDataItem = unwrappedDataItem;\n        this.fieldConstraint = fieldConstraint;\n        this.extendTabsHandler = extendTabsHandler;\n        this._disposables = [];\n        this.propertiesTabs = ko.observableArray([]);\n        this.choosenField = ko.observable();\n        this.newItemCreated = _jquery_helpers_1.createJQueryCallbacks();\n        this.itemSelected = _jquery_helpers_1.createJQueryCallbacks();\n        var composer = new _data_item_properties_composer_1.DataItemsPropertiesComposer();\n        var updatePropertiesTabs = function () {\n            var result = composer.composeTabs(_this.model, {\n                dataDashboardItem: container,\n                choosenField: _this.choosenField,\n                dataSourceBrowser: dataSourceBrowser,\n                unwrappedDataItem: _this.unwrappedDataItem,\n                constraint: _this.fullConstraint,\n                propertiesController: _this.propertiesController\n            });\n            _this.extendTabsHandler && _this.extendTabsHandler(result, _this.model.dataItem());\n            var promise = dataSourceBrowser.getDataFieldsArray(container.dataSource(), container.dataMember(), '', _data_source_browser_1.isNonCollectionDataField);\n            promise.done(function () {\n                var oldTabs = _this.propertiesTabs.peek();\n                oldTabs && oldTabs.forEach(function (tab) { return tab.dispose(); });\n                _this.propertiesTabs(result);\n            });\n        };\n        var subscribeToFieldChanges = function () {\n            _this._disposables.push(_this.choosenField.subscribe(function (newField) {\n                if (model.dataItem() && model.dataItem().dataMember()) {\n                    _this._changeExistingField(container, model, newField, updatePropertiesTabs);\n                }\n                else {\n                    _this._changeNewField(container, newField, updatePropertiesTabs);\n                }\n            }));\n            updatePropertiesTabs();\n        };\n        if (!!model.dataItem()) {\n            dataSourceBrowser\n                .findDataField(container.dataSource(), container.dataMember(), model.dataItem().dataMember())\n                .done(function (field) {\n                if (!!field && field !== _this.choosenField()) {\n                    _this.choosenField(field);\n                }\n                subscribeToFieldChanges();\n            });\n        }\n        else {\n            subscribeToFieldChanges();\n        }\n        this._disposables.push({\n            dispose: function () {\n                _this.newItemCreated.empty();\n            }\n        });\n    }\n    DataItemSurface.prototype._changeNewField = function (container, newField, additionalFunc) {\n        var _this = this;\n        if (this.model.itemType() !== 'Seed') {\n            if (!_data_field_1.IsOlapHierarchyField(newField)) {\n                var dataItem = container._createDataItem(newField, this.binding);\n                if (this.model._specifics.isAttribute && dataItem instanceof measure_1.Measure) {\n                    dataItem.summaryType('Min');\n                }\n                this.model.uniqueName(dataItem.uniqueName());\n                this.newItemCreated.fire(this.model, newField);\n                this.itemSelected.fire(this.model, newField);\n            }\n            else {\n                var groupIndex = newField.groupIndex();\n                newField['groupDataItems'].forEach(function (groupItem, index) {\n                    var dataItem = container._createDataItem(groupItem, _this.binding);\n                    dataItem.groupIndex(groupIndex);\n                    if (index === 0) {\n                        _this.model.uniqueName(dataItem.uniqueName());\n                        _this.newItemCreated.fire(_this.model, groupItem);\n                    }\n                    else {\n                        var model = new data_item_1.DataItemLink(container);\n                        model.uniqueName(dataItem.uniqueName());\n                        _this.newItemCreated.fire(model, groupItem);\n                    }\n                });\n                this.itemSelected.fire(this.model, newField['groupDataItems'][0]);\n            }\n        }\n        else {\n            this.newItemCreated.fire(this.model, newField);\n            this.itemSelected.fire(this.model, newField);\n        }\n        additionalFunc();\n    };\n    DataItemSurface.prototype._changeExistingField = function (container, model, newField, additionalFunc) {\n        var _this = this;\n        if (!_data_field_1.IsOlapHierarchyField(newField)) {\n            container._updateDataItem(model.dataItem(), this.binding, newField, model._specifics.acceptableShapingType);\n        }\n        else {\n            var groupIndex = newField.groupIndex();\n            newField['groupDataItems'].forEach(function (groupItem, index) {\n                if (index === 0) {\n                    container._updateDataItem(model.dataItem(), _this.binding, groupItem, model._specifics.acceptableShapingType);\n                    model.dataItem().groupIndex(groupIndex);\n                }\n                else {\n                    var dataItem = container._createDataItem(groupItem, _this.binding);\n                    dataItem.groupIndex(groupIndex);\n                    var dataItemLink = new data_item_1.DataItemLink(container);\n                    dataItemLink.uniqueName(dataItem.uniqueName());\n                    _this.newItemCreated.fire(dataItemLink, groupItem);\n                }\n            });\n        }\n        additionalFunc();\n    };\n    Object.defineProperty(DataItemSurface.prototype, \"commonDataItemTypeConstraint\", {\n        get: function () {\n            if (this.binding.dataItemType === 'Dimension') {\n                return function (field) { return _data_field_1.DataField.ifOlapThenOnlyDimension(field) && !(field.isAggregate && field.isAggregate()); };\n            }\n            if (this.binding.dataItemType === 'Measure') {\n                return function (field) { return _data_field_1.DataField.ifOlapThenOnlyMeasure(field); };\n            }\n            return function () { return true; };\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(DataItemSurface.prototype, \"fullConstraint\", {\n        get: function () {\n            var _this = this;\n            return function (field) {\n                if (!_this.commonDataItemTypeConstraint(field))\n                    return false;\n                if (field.isDataFieldNode()) {\n                    return !_this.fieldConstraint || _this.fieldConstraint(field);\n                }\n                else {\n                    return true;\n                }\n            };\n        },\n        enumerable: false,\n        configurable: true\n    });\n    DataItemSurface.prototype.dispose = function () {\n        this._disposables.forEach(function (d) {\n            d.dispose();\n        });\n    };\n    __decorate([\n        _undo_engine_helper_1.wrapWithUndoRedo\n    ], DataItemSurface.prototype, \"_changeNewField\", null);\n    __decorate([\n        _undo_engine_helper_1.wrapWithUndoRedo\n    ], DataItemSurface.prototype, \"_changeExistingField\", null);\n    return DataItemSurface;\n}());\nexports.DataItemSurface = DataItemSurface;\n"]},"metadata":{},"sourceType":"script"}