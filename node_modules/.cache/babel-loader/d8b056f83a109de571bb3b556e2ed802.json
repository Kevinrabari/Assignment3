{"ast":null,"code":"/**\r\n* DevExpress Dashboard (_data-item-properties-composer.js)\r\n* Version:  22.1.3\r\n* Build date: Jun 13, 2022\r\n* Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n* License: https://www.devexpress.com/Support/EULAs/universal.xml\r\n*/\n\"use strict\";\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.DataItemsPropertiesComposer = void 0;\n\nvar ko = require(\"knockout\");\n\nvar _default_1 = require(\"../../../data/localization/_default\");\n\nvar difference_calculation_1 = require(\"../../../model/data-item/calculations/difference-calculation\");\n\nvar moving_calculation_1 = require(\"../../../model/data-item/calculations/moving-calculation\");\n\nvar percent_of_total_calculation_1 = require(\"../../../model/data-item/calculations/percent-of-total-calculation\");\n\nvar rank_calculation_1 = require(\"../../../model/data-item/calculations/rank-calculation\");\n\nvar running_total_calculation_1 = require(\"../../../model/data-item/calculations/running-total-calculation\");\n\nvar data_item_1 = require(\"../../../model/data-item/data-item\");\n\nvar dimension_1 = require(\"../../../model/data-item/dimension\");\n\nvar measure_1 = require(\"../../../model/data-item/measure\");\n\nvar _data_item_1 = require(\"../../../model/data-item/metadata/_data-item\");\n\nvar _data_item_format_1 = require(\"../../../model/data-item/metadata/_data-item-format\");\n\nvar _dimension_1 = require(\"../../../model/data-item/metadata/_dimension\");\n\nvar _measure_1 = require(\"../../../model/data-item/metadata/_measure\");\n\nvar _data_field_1 = require(\"../../../model/data-sources/_data-field\");\n\nvar cells_item_format_rule_1 = require(\"../../../model/format-rules/cells-item-format-rule\");\n\nvar _dashboard_item_format_rule_1 = require(\"../../../model/format-rules/metadata/_dashboard-item-format-rule\");\n\nvar _knockout_utils_1 = require(\"../../../model/internal/_knockout-utils\");\n\nvar _undo_engine_helper_1 = require(\"../../../model/internal/_undo-engine-helper\");\n\nvar data_dashboard_item_1 = require(\"../../../model/items/data-dashboard-item\");\n\nvar _data_dashboard_item_1 = require(\"../../../model/items/metadata/_data-dashboard-item\");\n\nvar _base_metadata_1 = require(\"../../../model/metadata/_base-metadata\");\n\nvar _calculation_surface_1 = require(\"../../calculations/items/surfaces/_calculation-surface\");\n\nvar _filter_utils_1 = require(\"../../filtering/_filter-utils\");\n\nvar _item_filter_display_name_provider_1 = require(\"../../filtering/_item-filter-display-name-provider\");\n\nvar _item_filter_items_provider_1 = require(\"../../filtering/_item-filter-items-provider\");\n\nvar _form_adapter_editors_1 = require(\"../../form-adapter/_form-adapter-editors\");\n\nvar _object_properties_wrapper_1 = require(\"../../form-adapter/_object-properties-wrapper\");\n\nvar _accordion_tab_1 = require(\"../../properties-controller/_accordion-tab\");\n\nvar _properties_controller_1 = require(\"../../properties-controller/_properties-controller\");\n\nvar _collection_editor_viewmodel_1 = require(\"../../ui-widgets/collection-editor/_collection-editor-viewmodel\");\n\nvar _display_name_provider_1 = require(\"../../_display-name-provider\");\n\nvar _calculation_properties_composer_1 = require(\"./_calculation-properties-composer\");\n\nvar _shared_composers_1 = require(\"./_shared-composers\");\n\nvar DataItemsPropertiesComposer = function () {\n  function DataItemsPropertiesComposer() {}\n\n  DataItemsPropertiesComposer._addConstraint = function (wrapper, condition, propertiesInCondition) {\n    var rulesToAdd = {};\n    wrapper.getInfo().map(function (propInfo) {\n      return propInfo.propertyName;\n    }).forEach(function (propName) {\n      return rulesToAdd[propName] = condition;\n    });\n\n    DataItemsPropertiesComposer._mergeRules(wrapper.visibilityFilterRules, rulesToAdd, 'and');\n\n    propertiesInCondition.forEach(function (prop) {\n      if (wrapper.getInfo().filter(function (p) {\n        return p.propertyName === prop.info.propertyName;\n      }).length === 0) {\n        wrapper.addProperty(prop.value, prop.info);\n\n        wrapper.visibilityFilterRules[prop.info.propertyName] = function () {\n          return false;\n        };\n      }\n    });\n  };\n\n  DataItemsPropertiesComposer._mergeRules = function (into, rules, operator) {\n    Object.keys(rules).forEach(function (propName) {\n      var currentRule = into[propName];\n      var ruleToAdd = rules[propName];\n      var newRule = currentRule ? [currentRule, operator, ruleToAdd] : operator === 'and' ? ruleToAdd : [];\n      into[propName] = newRule;\n    });\n  };\n\n  DataItemsPropertiesComposer.prototype.composeTabs = function (model, args) {\n    if (args.constraint === undefined) args.constraint = function () {\n      return true;\n    };\n    if (args.propertiesController === undefined) args.propertiesController = new _properties_controller_1.PropertiesController();\n    var dataField = args.choosenField.peek(),\n        bindingTab = new _accordion_tab_1.BindingAccordionTab(_accordion_tab_1.KnownTabs.Binding, 'DashboardWebStringId.Tabs.Binding'),\n        optionsTab = new _accordion_tab_1.AccordionTab(_accordion_tab_1.KnownTabs.UnwrappedDataItem, 'DashboardWebStringId.Options'),\n        dataShapingTab = new _accordion_tab_1.AccordionTab(_accordion_tab_1.KnownTabs.DataShaping, 'DashboardWebStringId.Tabs.DataShaping'),\n        numericFormatTab = new _accordion_tab_1.AccordionTab(_accordion_tab_1.KnownTabs.NumericFormat, 'DashboardWebStringId.Tabs.Format'),\n        dateTimeFormatTab = new _accordion_tab_1.AccordionTab(_accordion_tab_1.KnownTabs.DateTimeFormat, 'DashboardWebStringId.Tabs.Format'),\n        topNTab = new _accordion_tab_1.AccordionTab(_accordion_tab_1.KnownTabs.TopN, 'DashboardStringId.CommandFormatRuleTopN'),\n        calculationsTab = new _accordion_tab_1.AccordionTab(_accordion_tab_1.KnownTabs.Calculations, 'DashboardWebStringId.Calculations'),\n        filterTab = new _accordion_tab_1.AccordionTab(_accordion_tab_1.KnownTabs.MeasureFilter, 'DashboardWebStringId.AccordionTab.MeasureFilter'),\n        result = [bindingTab, optionsTab, dataShapingTab, numericFormatTab, dateTimeFormatTab, topNTab, calculationsTab, filterTab];\n    optionsTab.orderNo = 90;\n    calculationsTab.orderNo = 190;\n    filterTab.orderNo = 195;\n    numericFormatTab.orderNo = 200;\n    dateTimeFormatTab.orderNo = 205;\n    topNTab.orderNo = 210;\n    this.fillBindingTab(bindingTab, model, args.choosenField, args.dataSourceBrowser, args.dataDashboardItem, args.constraint);\n    var dataItem = model.dataItem();\n\n    if (dataItem) {\n      var fieldType = dataField && dataField.fieldType();\n\n      if (args.unwrappedDataItem) {\n        this.fillOptionsTab(optionsTab, dataItem, model, args.dataDashboardItem);\n      }\n\n      if (dataItem instanceof dimension_1.Dimension) {\n        var measures = args.dataDashboardItem._measures.filter(function (measure) {\n          return !measure._hasCalculation();\n        });\n\n        this.fillDataShapingPropertiesTab(dataShapingTab, args.dataDashboardItem, model, dataField, measures, args.dataSourceBrowser);\n\n        if (args.dataDashboardItem._isTopNEnabled(dataItem)) {\n          this.fillTopNTab(topNTab, args.dataDashboardItem, dataItem, dataField, measures, model._specifics.supportsTopNOther, args.dataSourceBrowser);\n        }\n\n        if (!model._specifics.skipFormatting && dataField && !_data_field_1.DataField.isOlap(dataField.dataMember())) {\n          if (_data_field_1.DataField.isNumeric(dataField)) {\n            numericFormatTab.tabModel(_shared_composers_1.SharedComposers.getNumericFormatWrapper(dataItem.numericFormat));\n          } else if (fieldType === 'DateTime') {\n            this.fillDimensionDatetimeFormatTab(dateTimeFormatTab, dataItem);\n          }\n        } else if (model._specifics.forceAddOlapExactDateFormat && dataField && fieldType === 'DateTime' && _data_field_1.DataField.isOlap(dataField.dataMember())) {\n          this.fillDataItemExactDatetimeFormatTab(dateTimeFormatTab, dataItem);\n        }\n      }\n\n      if (dataItem instanceof measure_1.Measure && !model._specifics.isAttribute) {\n        if (args.dataDashboardItem._isCalculationSupported() && !_data_field_1.DataField.isOlap(dataItem.dataMember())) {\n          this.fillCalculationsTab(calculationsTab, dataItem, args.dataDashboardItem, args.dataSourceBrowser, args.propertiesController);\n        }\n\n        if (!model._specifics.skipFormatting) {\n          var numericFormatWrapper = _shared_composers_1.SharedComposers.getNumericFormatWrapper(dataItem.numericFormat);\n\n          if (!_data_field_1.DataField.isNumeric(dataField)) {\n            DataItemsPropertiesComposer._addConstraint(numericFormatWrapper, [[_measure_1.summaryTypeTemplate.propertyName, '<>', 'Min'], 'and', [_measure_1.summaryTypeTemplate.propertyName, '<>', 'Max'], 'and', [_measure_1.summaryTypeTemplate.propertyName, '<>', 'Mode']], [{\n              info: _measure_1.summaryTypeTemplate,\n              value: dataItem.summaryType\n            }]);\n          }\n\n          numericFormatTab.tabModel(numericFormatWrapper);\n\n          if (fieldType === 'DateTime') {\n            var exactDateWrapper = this._createExactDatePropertiesWrapper(dataItem);\n\n            DataItemsPropertiesComposer._addConstraint(exactDateWrapper, [[_measure_1.summaryTypeTemplate.propertyName, '=', 'Min'], 'or', [_measure_1.summaryTypeTemplate.propertyName, '=', 'Max'], 'or', [_measure_1.summaryTypeTemplate.propertyName, '=', 'Mode']], [{\n              info: _measure_1.summaryTypeTemplate,\n              value: dataItem.summaryType\n            }]);\n\n            dateTimeFormatTab.tabModel(exactDateWrapper);\n          }\n        }\n\n        this._fillFilterTab(filterTab, dataItem, args.dataDashboardItem, args.dataSourceBrowser);\n      }\n    }\n\n    return result;\n  };\n\n  DataItemsPropertiesComposer.prototype.fillBindingTab = function (bindingTab, model, choosenField, dataSourceBrowser, dataDashboardItem, constraint) {\n    bindingTab.tabModel({\n      choosenField: ko.observable(choosenField),\n      dataItemLink: model,\n      constraint: constraint,\n      dataSourceBrowser: dataSourceBrowser,\n      dataMemberPath: ko.observable(ko.computed(function () {\n        if (dataDashboardItem.dataSource() && dataDashboardItem.dataMember()) {\n          return [dataDashboardItem.dataSource(), dataDashboardItem.dataMember()].join('.');\n        } else if (dataDashboardItem.dataSource()) {\n          return dataDashboardItem.dataSource();\n        }\n\n        return '';\n      })),\n      additionalProperties: ko.observable(ko.pureComputed(function () {\n        if (model._specifics.isAttribute || !choosenField()) return null;\n        var properties = [];\n        var dataItem = model.dataItem();\n\n        if (dataItem instanceof measure_1.Measure) {\n          var summaryTypeMeta = data_dashboard_item_1.DataDashboardItem._getAvaliableSummaryTypeInfo(choosenField(), model._specifics.acceptableShapingType, dataItem);\n\n          if (summaryTypeMeta) {\n            properties.push(summaryTypeMeta);\n          }\n        }\n\n        if (model.dataItem() instanceof dimension_1.Dimension && !_data_field_1.DataField.isOlap(model.dataItem().dataMember()) && choosenField() && choosenField().fieldType() === 'DateTime') {\n          if (model._specifics.acceptableShapingType !== data_item_1.AcceptableShapingType.RangeDate) {\n            properties.push(_dimension_1.dateTimeGroupInterval);\n          } else {\n            properties.push(_dimension_1.rangeDateTimeGroupInterval);\n          }\n        }\n\n        if (properties.length) {\n          return new _object_properties_wrapper_1.ObjectPropertiesWrapper({\n            model: model.dataItem(),\n            properties: properties\n          });\n        }\n\n        return null;\n      })),\n      summary: ko.pureComputed(function () {\n        var dataItemLink = bindingTab.tabModel() && bindingTab.tabModel().dataItemLink;\n        return dataItemLink.dataItem() && dataItemLink.dataItem().dataMember() || '';\n      }),\n      summaryHint: ko.pureComputed(function () {\n        var dataItemLink = bindingTab.tabModel() && bindingTab.tabModel().dataItemLink;\n        return dataItemLink.dataItem() && dataItemLink.dataItem().dataMember() + ' (' + dataItemLink.uniqueName() + ')' || '';\n      })\n    });\n  };\n\n  DataItemsPropertiesComposer.prototype.fillOptionsTab = function (tab, dataItem, model, dataDashboardItem) {\n    var properties = [];\n    properties.push(_base_metadata_1.name);\n\n    var newProperties = model._specifics.customOptionsProperties.filter(function (p) {\n      return !p.filter || p.filter(dataItem);\n    });\n\n    properties = properties.concat(newProperties.map(function (p) {\n      return p.serializationInfo;\n    }));\n    var disabledRules = {};\n    newProperties.filter(function (x) {\n      return !!x.disabledRule;\n    }).forEach(function (property) {\n      disabledRules[property.serializationInfo.propertyName] = function (m) {\n        return property.disabledRule(dataItem);\n      };\n    });\n    tab.tabModel(new _object_properties_wrapper_1.ObjectPropertiesWrapper({\n      model: dataItem,\n      properties: properties,\n      disabledFilterRules: disabledRules\n    }));\n  };\n\n  DataItemsPropertiesComposer.prototype.fillDataShapingPropertiesTab = function (tab, dataDashboardItem, model, dataField, measures, dataSourceBrowser) {\n    var dataItem = model.dataItem();\n    var disableRules = {};\n\n    if (dataItem) {\n      var fieldType = dataField && dataField.fieldType();\n      ko.computed(function () {\n        var properties = [];\n\n        if (dataItem instanceof dimension_1.Dimension) {\n          var topNEnabledFunc = function () {\n            return dataItem.topNOptionsEnabled();\n          };\n\n          if (dataDashboardItem._isSortingEnabled()) {\n            if (dataField && _data_field_1.DataField.isOlap(dataItem.dataMember())) {\n              properties.push(_dimension_1.sortOrderOlap);\n              disableRules[_dimension_1.sortOrderOlap.propertyName] = topNEnabledFunc;\n            } else {\n              properties.push(_dimension_1.sortOrderNonOlap);\n              disableRules[_dimension_1.sortOrderNonOlap.propertyName] = topNEnabledFunc;\n            }\n\n            var values = [];\n\n            if (!_data_field_1.DataField.isOlap(dataItem.dataMember())) {\n              values.push({\n                value: 'DXValue',\n                displayValue: 'DashboardStringId.CommandDimensionSortModeValue'\n              });\n            } else {\n              values.push({\n                value: 'DXDisplayText',\n                displayValue: 'DashboardStringId.CommandDimensionSortModeDisplayText'\n              });\n              values.push({\n                value: 'DXValue',\n                displayValue: 'DashboardStringId.CommandDimensionSortModeValue'\n              });\n              values.push({\n                value: 'DXID',\n                displayValue: 'DashboardStringId.CommandDimensionSortModeID'\n              });\n              values.push({\n                value: 'DXKey',\n                displayValue: 'DashboardStringId.CommandDimensionSortModeKey'\n              });\n            }\n\n            properties.push(__assign({\n              valuesArray: values.concat(measures.filter(function (m) {\n                return m instanceof measure_1.Measure && !m.calculation.calculation() && !m.expression();\n              }).map(function (m) {\n                return {\n                  value: m.uniqueName(),\n                  displayValue: _display_name_provider_1.getDataItemDisplayName(dataSourceBrowser, dataDashboardItem, m)\n                };\n              }))\n            }, _dimension_1.realSortMode));\n            disableRules[_dimension_1.realSortMode.propertyName] = topNEnabledFunc;\n          }\n\n          switch (fieldType) {\n            case 'DateTime':\n              break;\n\n            case 'Text':\n              properties.push(_dimension_1.textGroupInterval);\n              break;\n          }\n        }\n\n        properties = properties.concat(model._specifics.customDataShapingProperties.filter(function (p) {\n          return !p.filter || p.filter(dataField);\n        }).map(function (p) {\n          return p.serializationInfo;\n        }));\n        var tabModel = properties.length > 0 ? new _object_properties_wrapper_1.ObjectPropertiesWrapper({\n          model: dataItem,\n          properties: properties,\n          disabledFilterRules: disableRules\n        }) : null;\n        tab.tabModel(tabModel);\n      });\n    }\n  };\n\n  DataItemsPropertiesComposer.prototype._createExactDateProperties = function () {\n    var properties = [_data_item_format_1.namelessYearFormat, _data_item_format_1.namelessDateFormat, _data_item_format_1.namelessDateHourFormat, _data_item_format_1.namelessDateHourMinuteFormat, _data_item_format_1.namelessDateTimeWithSecondsFormat];\n    var visibilityRules = {};\n    visibilityRules[_data_item_format_1.namelessYearFormat.propertyName] = [_data_item_format_1.namelessExactDateFormat.propertyName, '=', 'Year'];\n    visibilityRules[_data_item_format_1.namelessDateFormat.propertyName] = [_data_item_format_1.namelessExactDateFormat.propertyName, '=', 'Day'];\n    visibilityRules[_data_item_format_1.namelessDateHourFormat.propertyName] = [_data_item_format_1.namelessExactDateFormat.propertyName, '=', 'Hour'];\n    visibilityRules[_data_item_format_1.namelessDateHourMinuteFormat.propertyName] = [_data_item_format_1.namelessExactDateFormat.propertyName, '=', 'Minute'];\n    visibilityRules[_data_item_format_1.namelessDateTimeWithSecondsFormat.propertyName] = [_data_item_format_1.namelessExactDateFormat.propertyName, '=', 'Second'];\n    return {\n      properties: properties,\n      visibilityRules: visibilityRules\n    };\n  };\n\n  DataItemsPropertiesComposer.prototype.fillDataItemExactDatetimeFormatTab = function (tab, model) {\n    tab.tabModel(this._createExactDatePropertiesWrapper(model));\n  };\n\n  DataItemsPropertiesComposer.prototype._createExactDatePropertiesWrapper = function (model) {\n    var exactDateProperties = this._createExactDateProperties();\n\n    return new _object_properties_wrapper_1.ObjectPropertiesWrapper({\n      model: model,\n      properties: [{\n        container: _data_item_1.dateTimeFormat,\n        properties: [_data_item_format_1.namelessExactDateFormat]\n      }, {\n        container: _data_item_1.dateTimeFormat,\n        properties: exactDateProperties.properties\n      }],\n      visibilityFilterRules: exactDateProperties.visibilityRules\n    });\n  };\n\n  DataItemsPropertiesComposer.prototype.fillDimensionDatetimeFormatTab = function (tab, model) {\n    var visibilityRules = {};\n    var properties = [_data_item_format_1.namelessExactDateFormat, _data_item_format_1.namelessYearFormat, _data_item_format_1.namelessMonthFormat, _data_item_format_1.namelessQuarterFormat, _data_item_format_1.namelessDayOfWeekFormat, _data_item_format_1.namelessHourFormat, _data_item_format_1.namelessDateFormat, _data_item_format_1.namelessDateHourFormat, _data_item_format_1.namelessDateHourMinuteFormat, _data_item_format_1.namelessDateTimeWithSecondsFormat];\n\n    visibilityRules[_dimension_1.dateTimeGroupInterval.propertyName] = function () {\n      return false;\n    };\n\n    visibilityRules[_data_item_format_1.namelessYearFormat.propertyName] = [_dimension_1.dateTimeGroupInterval.propertyName, '=', 'Year'];\n    visibilityRules[_data_item_format_1.namelessQuarterFormat.propertyName] = [_dimension_1.dateTimeGroupInterval.propertyName, '=', 'Quarter'];\n    visibilityRules[_data_item_format_1.namelessMonthFormat.propertyName] = [_dimension_1.dateTimeGroupInterval.propertyName, '=', 'Month'];\n    visibilityRules[_data_item_format_1.namelessHourFormat.propertyName] = [_dimension_1.dateTimeGroupInterval.propertyName, '=', 'Hour'];\n    visibilityRules[_data_item_format_1.namelessDayOfWeekFormat.propertyName] = [_dimension_1.dateTimeGroupInterval.propertyName, '=', 'DayOfWeek'];\n    visibilityRules[_data_item_format_1.namelessDateFormat.propertyName] = [[_dimension_1.dateTimeGroupInterval.propertyName, '=', 'DayMonthYear'], 'or', [_dimension_1.dateTimeGroupInterval.propertyName, '=', 'WeekYear']];\n    visibilityRules[_data_item_format_1.namelessDateHourFormat.propertyName] = [_dimension_1.dateTimeGroupInterval.propertyName, '=', 'DateHour'];\n    visibilityRules[_data_item_format_1.namelessDateHourMinuteFormat.propertyName] = [_dimension_1.dateTimeGroupInterval.propertyName, '=', 'DateHourMinute'];\n    visibilityRules[_data_item_format_1.namelessDateTimeWithSecondsFormat.propertyName] = [_dimension_1.dateTimeGroupInterval.propertyName, '=', 'DateHourMinuteSecond'];\n    visibilityRules[_data_item_format_1.namelessExactDateFormat.propertyName] = [_dimension_1.dateTimeGroupInterval.propertyName, '=', 'None'];\n\n    var exactDateProperties = this._createExactDateProperties();\n\n    var exactDateIntervalConstraints = {};\n    exactDateProperties.properties.forEach(function (edProp) {\n      return exactDateIntervalConstraints[edProp.propertyName] = [_dimension_1.dateTimeGroupInterval.propertyName, '=', 'None'];\n    });\n\n    DataItemsPropertiesComposer._mergeRules(exactDateProperties.visibilityRules, exactDateIntervalConstraints, 'and');\n\n    DataItemsPropertiesComposer._mergeRules(visibilityRules, exactDateProperties.visibilityRules, 'or');\n\n    tab.tabModel(new _object_properties_wrapper_1.ObjectPropertiesWrapper({\n      model: model,\n      properties: [_dimension_1.dateTimeGroupInterval, {\n        container: _data_item_1.dateTimeFormat,\n        properties: properties\n      }],\n      visibilityFilterRules: visibilityRules\n    }));\n  };\n\n  DataItemsPropertiesComposer.prototype.fillTopNTab = function (tab, dataDashboardItem, dataItem, dataField, measures, supportsTopNOther, dataSourceBrowser) {\n    var disabledRules = {};\n\n    var isTopNUnavailable = function () {\n      return measures.length === 0;\n    };\n\n    var topNOptionsDisabled = function () {\n      return !dataItem.topNOptionsEnabled() || isTopNUnavailable();\n    };\n\n    disabledRules[_dimension_1.topNOptionsEnabled.propertyName] = isTopNUnavailable;\n    disabledRules[_dimension_1.topNOptionsCount.propertyName] = topNOptionsDisabled;\n    disabledRules[_dimension_1.topNOptionsMode.propertyName] = topNOptionsDisabled;\n    disabledRules[_dimension_1.topNOptionsMeasure.propertyName] = topNOptionsDisabled;\n    disabledRules[_dimension_1.topNOptionsShowOthers.propertyName] = topNOptionsDisabled;\n    var visibilityRules = {};\n\n    visibilityRules[_dimension_1.topNOptionsShowOthers.propertyName] = function () {\n      return supportsTopNOther;\n    };\n\n    var properties = [_dimension_1.topNOptionsEnabled, _dimension_1.topNOptionsMode, _dimension_1.topNOptionsCount, __assign({\n      valuesArray: measures.map(function (m) {\n        return {\n          value: m.uniqueName(),\n          displayValue: _display_name_provider_1.getDataItemDisplayName(dataSourceBrowser, dataDashboardItem, m)\n        };\n      })\n    }, _dimension_1.topNOptionsMeasure)];\n\n    if (dataField && !_data_field_1.DataField.isOlap(dataField.dataMember())) {\n      properties.push(_dimension_1.topNOptionsShowOthers);\n    }\n\n    tab.tabModel(new _object_properties_wrapper_1.ObjectPropertiesWrapper({\n      model: dataItem,\n      properties: properties,\n      disabledFilterRules: disabledRules,\n      visibilityFilterRules: visibilityRules,\n      summary: ko.computed(function () {\n        if (!topNOptionsDisabled()) {\n          if (!dataItem.topNOptionsMeasureName()) {\n            dataItem.topNOptionsMeasureName(measures[0] && measures[0].uniqueName());\n          }\n\n          var topNDataItem = measures.filter(function (di) {\n            return di.uniqueName.peek() === dataItem.topNOptionsMeasureName();\n          })[0];\n\n          var modeDisplayValue = _default_1.getLocalizationById(_dimension_1.topNOptionsModeValues[dataItem.topNOptionsMode()]);\n\n          return modeDisplayValue + ' ' + dataItem.topNOptionsCount() + ' - ' + (!!topNDataItem ? topNDataItem.dataMember() : '');\n        }\n\n        return '';\n      })\n    }));\n  };\n\n  DataItemsPropertiesComposer.prototype.fillCalculationsTab = function (tab, measure, dataDashboardItem, dataSourceBrowser, propertiesController) {\n    var noneCalculation = {\n      title: 'DashboardStringId.CalculationTypeNone',\n      data: {\n        type: undefined\n      }\n    };\n    var expressionCalculation = {\n      title: 'DashboardStringId.CalculationTypeExpression',\n      data: {\n        type: undefined\n      }\n    };\n\n    var calculationsInfo = __assign({}, _measure_1.calculations);\n\n    var disabledRules = {};\n\n    disabledRules[calculationsInfo.propertyName] = function () {\n      return dataDashboardItem._dimensions.some(function (dimension) {\n        return dimension.topNOptionsEnabled() && dimension.topNOptionsMeasureName() === measure.uniqueName() || dimension.sortMeasure() === measure.uniqueName();\n      });\n    };\n\n    var availableCalculations = [noneCalculation, {\n      title: 'DashboardStringId.CalculationTypePercentOfTotal',\n      data: {\n        type: percent_of_total_calculation_1.PercentOfTotalCalculation\n      }\n    }, {\n      title: 'DashboardStringId.CalculationTypeRunningTotal',\n      data: {\n        type: running_total_calculation_1.RunningTotalCalculation\n      }\n    }, {\n      title: 'DashboardStringId.CalculationTypeDifference',\n      data: {\n        type: difference_calculation_1.DifferenceCalculation,\n        isEqual: function (calc) {\n          return calc.differenceType() !== 'Percentage';\n        }\n      }\n    }, {\n      title: 'DashboardStringId.CalculationTypePercentageDifference',\n      data: {\n        type: difference_calculation_1.DifferenceCalculation,\n        default: {\n          '@DifferenceType': 'Percentage'\n        },\n        isEqual: function (calc) {\n          return calc.differenceType() === 'Percentage';\n        }\n      }\n    }, {\n      title: 'DashboardStringId.CalculationTypeMovingCalculation',\n      data: {\n        type: moving_calculation_1.MovingCalculation\n      }\n    }, {\n      title: 'DashboardStringId.CalculationTypeRank',\n      data: {\n        type: rank_calculation_1.RankCalculation\n      }\n    }, expressionCalculation];\n\n    var isEqual = function (definition) {\n      return !!definition.data.type && measure.calculation.calculation() instanceof definition.data.type && (!definition.data.isEqual || definition.data.isEqual(measure.calculation.calculation()));\n    };\n\n    var selectedPredefinedCalculation = ko.computed({\n      read: function () {\n        var result = !!measure.expression() ? expressionCalculation : undefined;\n\n        if (!result) {\n          result = availableCalculations.filter(function (definition) {\n            return isEqual(definition);\n          })[0] || noneCalculation;\n        }\n\n        return result;\n      },\n      write: _undo_engine_helper_1.wrapFuncWithUndoRedo(function (val) {\n        if (val !== noneCalculation) {\n          if (val === expressionCalculation) {\n            if (!measure.expression()) {\n              _calculation_properties_composer_1.getCalculationArgumentExpression(measure, dataDashboardItem, dataSourceBrowser).done(function (expr) {\n                measure.expression(expr);\n              });\n\n              measure.windowDefinition.windowDefinition(dataDashboardItem._getDefaultCalculationWindowDefinition());\n            }\n          } else if (!isEqual(val)) {\n            measure.expression(undefined);\n            measure.calculation.calculation(new val.data.type(val.data.default));\n            measure.windowDefinition.windowDefinition(dataDashboardItem._getDefaultCalculationWindowDefinition());\n          }\n        } else {\n          measure.expression(undefined);\n          measure.calculation.calculation(undefined);\n          measure.windowDefinition.windowDefinition(undefined);\n        }\n      })\n    });\n    var singleChoiceEditorOptions = {\n      propertyName: 'title',\n      dataSource: availableCalculations,\n      enableEditItem: function (calcDefinition) {\n        return calcDefinition !== noneCalculation;\n      },\n      editItemHandler: function (calcDefinition) {\n        if (calcDefinition !== noneCalculation) {\n          var surface = new _calculation_surface_1.CalculationSurface(calcDefinition, measure, dataDashboardItem, dataSourceBrowser, propertiesController);\n          surface.startEditing(new _collection_editor_viewmodel_1.CollectionEditorEditItemArguments());\n        }\n      }\n    };\n    tab.tabModel(new _object_properties_wrapper_1.ObjectPropertiesWrapper({\n      model: {\n        calculations: selectedPredefinedCalculation\n      },\n      properties: [__assign(__assign({}, calculationsInfo), {\n        formAdapterItem: _form_adapter_editors_1.editableListEditor(singleChoiceEditorOptions)\n      })],\n      disabledFilterRules: disabledRules,\n      summary: ko.computed(function () {\n        return selectedPredefinedCalculation().title !== noneCalculation.title ? selectedPredefinedCalculation().title : '';\n      })\n    }));\n  };\n\n  DataItemsPropertiesComposer.prototype._fillFilterTab = function (tab, model, dashboardItem, dataSourceBrowser) {\n    var _a;\n\n    if (!_data_field_1.DataField.isOlap(model.dataMember())) {\n      var measureFilterEditorParams = {\n        fieldListProvider: ko.observable(new _item_filter_items_provider_1.ItemFilterItemsProvider(dataSourceBrowser, dataSourceBrowser, dataSourceBrowser.parameters, dashboardItem, function (di) {\n          return di instanceof dimension_1.Dimension;\n        })),\n        options: _filter_utils_1.createItemFilterOptions(model.filterString, undefined, dataSourceBrowser, {\n          text: 'MeasureFilter',\n          localizationId: 'DashboardWebStringId.AccordionTab.MeasureFilter'\n        }),\n        displayNameProvider: new _item_filter_display_name_provider_1.ItemFilterDisplayNameProvider(dashboardItem, dataSourceBrowser)\n      };\n      var wrapper = new _object_properties_wrapper_1.ObjectPropertiesWrapper({\n        model: model,\n        properties: [__assign(__assign({}, _measure_1.measureFilterString), {\n          formAdapterItem: _form_adapter_editors_1.filterEditor(measureFilterEditorParams)\n        })],\n        summary: _knockout_utils_1.safeComputed({\n          filterString: model.filterString\n        }, function (args) {\n          return !!args.filterString ? _default_1.getLocalizationById('DashboardWebStringId.ButtonOn') : '';\n        }),\n        visibilityFilterRules: (_a = {}, _a[_measure_1.measureFilterString.propertyName] = function () {\n          return !model.expression();\n        }, _a)\n      });\n      tab.tabModel(wrapper);\n    }\n  };\n\n  DataItemsPropertiesComposer.getCellFormatRuleCreator = function (dataItem, dataItemApplyTo, formatRuleItemType) {\n    return function () {\n      return data_dashboard_item_1.DataDashboardItem._createFormatRule(null, {\n        '@ItemType': formatRuleItemType,\n        '@DataItem': dataItem.uniqueName(),\n        '@DataItemApplyTo': dataItemApplyTo.uniqueName()\n      });\n    };\n  };\n\n  DataItemsPropertiesComposer.getCellFormatRuleFilter = function (dataItem) {\n    return function (rule) {\n      if (rule instanceof cells_item_format_rule_1.CellsItemFormatRule) {\n        var uniqueName = dataItem.uniqueName();\n        return rule.dataItemName() === uniqueName || rule.dataItemApplyToName() === uniqueName;\n      }\n\n      return false;\n    };\n  };\n\n  DataItemsPropertiesComposer.getFormatRulesWrapper = function (model, createNewItemHandler, visibleItemsFilter, editHandler) {\n    var collectionEditorOptions = __assign(__assign({\n      propertyName: _dashboard_item_format_rule_1.classCaption.propertyName,\n      createNewItemHandler: createNewItemHandler\n    }, _dashboard_item_format_rule_1.classCaption), {\n      editItemHandler: editHandler,\n      visibleItemsFilter: visibleItemsFilter\n    });\n\n    return new _object_properties_wrapper_1.ObjectPropertiesWrapper({\n      model: model,\n      properties: [__assign(__assign({}, _data_dashboard_item_1.formatRules), {\n        formAdapterItem: _form_adapter_editors_1.collectionEditor(collectionEditorOptions)\n      })]\n    });\n  };\n\n  return DataItemsPropertiesComposer;\n}();\n\nexports.DataItemsPropertiesComposer = DataItemsPropertiesComposer;","map":{"version":3,"sources":["/Users/krunalpatel/Downloads/React-Firebase-Auth-master 3/node_modules/devexpress-dashboard/designer/items/properties-composers/_data-item-properties-composer.js"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","defineProperty","exports","value","DataItemsPropertiesComposer","ko","require","_default_1","difference_calculation_1","moving_calculation_1","percent_of_total_calculation_1","rank_calculation_1","running_total_calculation_1","data_item_1","dimension_1","measure_1","_data_item_1","_data_item_format_1","_dimension_1","_measure_1","_data_field_1","cells_item_format_rule_1","_dashboard_item_format_rule_1","_knockout_utils_1","_undo_engine_helper_1","data_dashboard_item_1","_data_dashboard_item_1","_base_metadata_1","_calculation_surface_1","_filter_utils_1","_item_filter_display_name_provider_1","_item_filter_items_provider_1","_form_adapter_editors_1","_object_properties_wrapper_1","_accordion_tab_1","_properties_controller_1","_collection_editor_viewmodel_1","_display_name_provider_1","_calculation_properties_composer_1","_shared_composers_1","_addConstraint","wrapper","condition","propertiesInCondition","rulesToAdd","getInfo","map","propInfo","propertyName","forEach","propName","_mergeRules","visibilityFilterRules","prop","filter","info","addProperty","into","rules","operator","keys","currentRule","ruleToAdd","newRule","composeTabs","model","args","constraint","undefined","propertiesController","PropertiesController","dataField","choosenField","peek","bindingTab","BindingAccordionTab","KnownTabs","Binding","optionsTab","AccordionTab","UnwrappedDataItem","dataShapingTab","DataShaping","numericFormatTab","NumericFormat","dateTimeFormatTab","DateTimeFormat","topNTab","TopN","calculationsTab","Calculations","filterTab","MeasureFilter","result","orderNo","fillBindingTab","dataSourceBrowser","dataDashboardItem","dataItem","fieldType","unwrappedDataItem","fillOptionsTab","Dimension","measures","_measures","measure","_hasCalculation","fillDataShapingPropertiesTab","_isTopNEnabled","fillTopNTab","_specifics","supportsTopNOther","skipFormatting","DataField","isOlap","dataMember","isNumeric","tabModel","SharedComposers","getNumericFormatWrapper","numericFormat","fillDimensionDatetimeFormatTab","forceAddOlapExactDateFormat","fillDataItemExactDatetimeFormatTab","Measure","isAttribute","_isCalculationSupported","fillCalculationsTab","numericFormatWrapper","summaryTypeTemplate","summaryType","exactDateWrapper","_createExactDatePropertiesWrapper","_fillFilterTab","observable","dataItemLink","dataMemberPath","computed","dataSource","join","additionalProperties","pureComputed","properties","summaryTypeMeta","DataDashboardItem","_getAvaliableSummaryTypeInfo","acceptableShapingType","push","AcceptableShapingType","RangeDate","dateTimeGroupInterval","rangeDateTimeGroupInterval","ObjectPropertiesWrapper","summary","summaryHint","uniqueName","tab","name","newProperties","customOptionsProperties","concat","serializationInfo","disabledRules","x","disabledRule","property","m","disabledFilterRules","disableRules","topNEnabledFunc","topNOptionsEnabled","_isSortingEnabled","sortOrderOlap","sortOrderNonOlap","values","displayValue","valuesArray","calculation","expression","getDataItemDisplayName","realSortMode","textGroupInterval","customDataShapingProperties","_createExactDateProperties","namelessYearFormat","namelessDateFormat","namelessDateHourFormat","namelessDateHourMinuteFormat","namelessDateTimeWithSecondsFormat","visibilityRules","namelessExactDateFormat","exactDateProperties","container","dateTimeFormat","namelessMonthFormat","namelessQuarterFormat","namelessDayOfWeekFormat","namelessHourFormat","exactDateIntervalConstraints","edProp","isTopNUnavailable","topNOptionsDisabled","topNOptionsCount","topNOptionsMode","topNOptionsMeasure","topNOptionsShowOthers","topNOptionsMeasureName","topNDataItem","di","modeDisplayValue","getLocalizationById","topNOptionsModeValues","noneCalculation","title","data","type","expressionCalculation","calculationsInfo","calculations","_dimensions","some","dimension","sortMeasure","availableCalculations","PercentOfTotalCalculation","RunningTotalCalculation","DifferenceCalculation","isEqual","calc","differenceType","default","MovingCalculation","RankCalculation","definition","selectedPredefinedCalculation","read","write","wrapFuncWithUndoRedo","val","getCalculationArgumentExpression","done","expr","windowDefinition","_getDefaultCalculationWindowDefinition","singleChoiceEditorOptions","enableEditItem","calcDefinition","editItemHandler","surface","CalculationSurface","startEditing","CollectionEditorEditItemArguments","formAdapterItem","editableListEditor","dashboardItem","_a","measureFilterEditorParams","fieldListProvider","ItemFilterItemsProvider","parameters","options","createItemFilterOptions","filterString","text","localizationId","displayNameProvider","ItemFilterDisplayNameProvider","measureFilterString","filterEditor","safeComputed","getCellFormatRuleCreator","dataItemApplyTo","formatRuleItemType","_createFormatRule","getCellFormatRuleFilter","rule","CellsItemFormatRule","dataItemName","dataItemApplyToName","getFormatRulesWrapper","createNewItemHandler","visibleItemsFilter","editHandler","collectionEditorOptions","classCaption","formatRules","collectionEditor"],"mappings":"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","sourcesContent":["/**\r\n* DevExpress Dashboard (_data-item-properties-composer.js)\r\n* Version:  22.1.3\r\n* Build date: Jun 13, 2022\r\n* Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n* License: https://www.devexpress.com/Support/EULAs/universal.xml\r\n*/\r\n\"use strict\";\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.DataItemsPropertiesComposer = void 0;\nvar ko = require(\"knockout\");\nvar _default_1 = require(\"../../../data/localization/_default\");\nvar difference_calculation_1 = require(\"../../../model/data-item/calculations/difference-calculation\");\nvar moving_calculation_1 = require(\"../../../model/data-item/calculations/moving-calculation\");\nvar percent_of_total_calculation_1 = require(\"../../../model/data-item/calculations/percent-of-total-calculation\");\nvar rank_calculation_1 = require(\"../../../model/data-item/calculations/rank-calculation\");\nvar running_total_calculation_1 = require(\"../../../model/data-item/calculations/running-total-calculation\");\nvar data_item_1 = require(\"../../../model/data-item/data-item\");\nvar dimension_1 = require(\"../../../model/data-item/dimension\");\nvar measure_1 = require(\"../../../model/data-item/measure\");\nvar _data_item_1 = require(\"../../../model/data-item/metadata/_data-item\");\nvar _data_item_format_1 = require(\"../../../model/data-item/metadata/_data-item-format\");\nvar _dimension_1 = require(\"../../../model/data-item/metadata/_dimension\");\nvar _measure_1 = require(\"../../../model/data-item/metadata/_measure\");\nvar _data_field_1 = require(\"../../../model/data-sources/_data-field\");\nvar cells_item_format_rule_1 = require(\"../../../model/format-rules/cells-item-format-rule\");\nvar _dashboard_item_format_rule_1 = require(\"../../../model/format-rules/metadata/_dashboard-item-format-rule\");\nvar _knockout_utils_1 = require(\"../../../model/internal/_knockout-utils\");\nvar _undo_engine_helper_1 = require(\"../../../model/internal/_undo-engine-helper\");\nvar data_dashboard_item_1 = require(\"../../../model/items/data-dashboard-item\");\nvar _data_dashboard_item_1 = require(\"../../../model/items/metadata/_data-dashboard-item\");\nvar _base_metadata_1 = require(\"../../../model/metadata/_base-metadata\");\nvar _calculation_surface_1 = require(\"../../calculations/items/surfaces/_calculation-surface\");\nvar _filter_utils_1 = require(\"../../filtering/_filter-utils\");\nvar _item_filter_display_name_provider_1 = require(\"../../filtering/_item-filter-display-name-provider\");\nvar _item_filter_items_provider_1 = require(\"../../filtering/_item-filter-items-provider\");\nvar _form_adapter_editors_1 = require(\"../../form-adapter/_form-adapter-editors\");\nvar _object_properties_wrapper_1 = require(\"../../form-adapter/_object-properties-wrapper\");\nvar _accordion_tab_1 = require(\"../../properties-controller/_accordion-tab\");\nvar _properties_controller_1 = require(\"../../properties-controller/_properties-controller\");\nvar _collection_editor_viewmodel_1 = require(\"../../ui-widgets/collection-editor/_collection-editor-viewmodel\");\nvar _display_name_provider_1 = require(\"../../_display-name-provider\");\nvar _calculation_properties_composer_1 = require(\"./_calculation-properties-composer\");\nvar _shared_composers_1 = require(\"./_shared-composers\");\nvar DataItemsPropertiesComposer = (function () {\n    function DataItemsPropertiesComposer() {\n    }\n    DataItemsPropertiesComposer._addConstraint = function (wrapper, condition, propertiesInCondition) {\n        var rulesToAdd = {};\n        wrapper.getInfo().map(function (propInfo) { return propInfo.propertyName; }).forEach(function (propName) { return rulesToAdd[propName] = condition; });\n        DataItemsPropertiesComposer._mergeRules(wrapper.visibilityFilterRules, rulesToAdd, 'and');\n        propertiesInCondition.forEach(function (prop) {\n            if (wrapper.getInfo().filter(function (p) { return p.propertyName === prop.info.propertyName; }).length === 0) {\n                wrapper.addProperty(prop.value, prop.info);\n                wrapper.visibilityFilterRules[prop.info.propertyName] = function () { return false; };\n            }\n        });\n    };\n    DataItemsPropertiesComposer._mergeRules = function (into, rules, operator) {\n        Object.keys(rules).forEach(function (propName) {\n            var currentRule = into[propName];\n            var ruleToAdd = rules[propName];\n            var newRule = currentRule ? [currentRule, operator, ruleToAdd] :\n                operator === 'and' ? ruleToAdd : [];\n            into[propName] = newRule;\n        });\n    };\n    DataItemsPropertiesComposer.prototype.composeTabs = function (model, args) {\n        if (args.constraint === undefined)\n            args.constraint = function () { return true; };\n        if (args.propertiesController === undefined)\n            args.propertiesController = new _properties_controller_1.PropertiesController();\n        var dataField = args.choosenField.peek(), bindingTab = new _accordion_tab_1.BindingAccordionTab(_accordion_tab_1.KnownTabs.Binding, 'DashboardWebStringId.Tabs.Binding'), optionsTab = new _accordion_tab_1.AccordionTab(_accordion_tab_1.KnownTabs.UnwrappedDataItem, 'DashboardWebStringId.Options'), dataShapingTab = new _accordion_tab_1.AccordionTab(_accordion_tab_1.KnownTabs.DataShaping, 'DashboardWebStringId.Tabs.DataShaping'), numericFormatTab = new _accordion_tab_1.AccordionTab(_accordion_tab_1.KnownTabs.NumericFormat, 'DashboardWebStringId.Tabs.Format'), dateTimeFormatTab = new _accordion_tab_1.AccordionTab(_accordion_tab_1.KnownTabs.DateTimeFormat, 'DashboardWebStringId.Tabs.Format'), topNTab = new _accordion_tab_1.AccordionTab(_accordion_tab_1.KnownTabs.TopN, 'DashboardStringId.CommandFormatRuleTopN'), calculationsTab = new _accordion_tab_1.AccordionTab(_accordion_tab_1.KnownTabs.Calculations, 'DashboardWebStringId.Calculations'), filterTab = new _accordion_tab_1.AccordionTab(_accordion_tab_1.KnownTabs.MeasureFilter, 'DashboardWebStringId.AccordionTab.MeasureFilter'), result = [bindingTab, optionsTab, dataShapingTab, numericFormatTab, dateTimeFormatTab, topNTab, calculationsTab, filterTab];\n        optionsTab.orderNo = 90;\n        calculationsTab.orderNo = 190;\n        filterTab.orderNo = 195;\n        numericFormatTab.orderNo = 200;\n        dateTimeFormatTab.orderNo = 205;\n        topNTab.orderNo = 210;\n        this.fillBindingTab(bindingTab, model, args.choosenField, args.dataSourceBrowser, args.dataDashboardItem, args.constraint);\n        var dataItem = model.dataItem();\n        if (dataItem) {\n            var fieldType = dataField && dataField.fieldType();\n            if (args.unwrappedDataItem) {\n                this.fillOptionsTab(optionsTab, dataItem, model, args.dataDashboardItem);\n            }\n            if (dataItem instanceof dimension_1.Dimension) {\n                var measures = args.dataDashboardItem._measures.filter(function (measure) { return !measure._hasCalculation(); });\n                this.fillDataShapingPropertiesTab(dataShapingTab, args.dataDashboardItem, model, dataField, measures, args.dataSourceBrowser);\n                if (args.dataDashboardItem._isTopNEnabled(dataItem)) {\n                    this.fillTopNTab(topNTab, args.dataDashboardItem, dataItem, dataField, measures, model._specifics.supportsTopNOther, args.dataSourceBrowser);\n                }\n                if (!model._specifics.skipFormatting && dataField && !_data_field_1.DataField.isOlap(dataField.dataMember())) {\n                    if (_data_field_1.DataField.isNumeric(dataField)) {\n                        numericFormatTab.tabModel(_shared_composers_1.SharedComposers.getNumericFormatWrapper(dataItem.numericFormat));\n                    }\n                    else if (fieldType === 'DateTime') {\n                        this.fillDimensionDatetimeFormatTab(dateTimeFormatTab, dataItem);\n                    }\n                }\n                else if (model._specifics.forceAddOlapExactDateFormat && dataField && fieldType === 'DateTime' && _data_field_1.DataField.isOlap(dataField.dataMember())) {\n                    this.fillDataItemExactDatetimeFormatTab(dateTimeFormatTab, dataItem);\n                }\n            }\n            if (dataItem instanceof measure_1.Measure && !model._specifics.isAttribute) {\n                if (args.dataDashboardItem._isCalculationSupported() && !_data_field_1.DataField.isOlap(dataItem.dataMember())) {\n                    this.fillCalculationsTab(calculationsTab, dataItem, args.dataDashboardItem, args.dataSourceBrowser, args.propertiesController);\n                }\n                if (!model._specifics.skipFormatting) {\n                    var numericFormatWrapper = _shared_composers_1.SharedComposers.getNumericFormatWrapper(dataItem.numericFormat);\n                    if (!_data_field_1.DataField.isNumeric(dataField)) {\n                        DataItemsPropertiesComposer._addConstraint(numericFormatWrapper, [\n                            [_measure_1.summaryTypeTemplate.propertyName, '<>', 'Min'], 'and',\n                            [_measure_1.summaryTypeTemplate.propertyName, '<>', 'Max'], 'and',\n                            [_measure_1.summaryTypeTemplate.propertyName, '<>', 'Mode']\n                        ], [{ info: _measure_1.summaryTypeTemplate, value: dataItem.summaryType }]);\n                    }\n                    numericFormatTab.tabModel(numericFormatWrapper);\n                    if (fieldType === 'DateTime') {\n                        var exactDateWrapper = this._createExactDatePropertiesWrapper(dataItem);\n                        DataItemsPropertiesComposer._addConstraint(exactDateWrapper, [\n                            [_measure_1.summaryTypeTemplate.propertyName, '=', 'Min'], 'or',\n                            [_measure_1.summaryTypeTemplate.propertyName, '=', 'Max'], 'or',\n                            [_measure_1.summaryTypeTemplate.propertyName, '=', 'Mode']\n                        ], [{ info: _measure_1.summaryTypeTemplate, value: dataItem.summaryType }]);\n                        dateTimeFormatTab.tabModel(exactDateWrapper);\n                    }\n                }\n                this._fillFilterTab(filterTab, dataItem, args.dataDashboardItem, args.dataSourceBrowser);\n            }\n        }\n        return result;\n    };\n    DataItemsPropertiesComposer.prototype.fillBindingTab = function (bindingTab, model, choosenField, dataSourceBrowser, dataDashboardItem, constraint) {\n        bindingTab.tabModel({\n            choosenField: ko.observable(choosenField),\n            dataItemLink: model,\n            constraint: constraint,\n            dataSourceBrowser: dataSourceBrowser,\n            dataMemberPath: ko.observable(ko.computed(function () {\n                if (dataDashboardItem.dataSource() && dataDashboardItem.dataMember()) {\n                    return [dataDashboardItem.dataSource(), dataDashboardItem.dataMember()].join('.');\n                }\n                else if (dataDashboardItem.dataSource()) {\n                    return dataDashboardItem.dataSource();\n                }\n                return '';\n            })),\n            additionalProperties: ko.observable(ko.pureComputed(function () {\n                if (model._specifics.isAttribute || !choosenField())\n                    return null;\n                var properties = [];\n                var dataItem = model.dataItem();\n                if (dataItem instanceof measure_1.Measure) {\n                    var summaryTypeMeta = data_dashboard_item_1.DataDashboardItem._getAvaliableSummaryTypeInfo(choosenField(), model._specifics.acceptableShapingType, dataItem);\n                    if (summaryTypeMeta) {\n                        properties.push(summaryTypeMeta);\n                    }\n                }\n                if ((model.dataItem() instanceof dimension_1.Dimension)\n                    && (!_data_field_1.DataField.isOlap(model.dataItem().dataMember()))\n                    && (choosenField() && choosenField().fieldType() === 'DateTime')) {\n                    if (model._specifics.acceptableShapingType !== data_item_1.AcceptableShapingType.RangeDate) {\n                        properties.push(_dimension_1.dateTimeGroupInterval);\n                    }\n                    else {\n                        properties.push(_dimension_1.rangeDateTimeGroupInterval);\n                    }\n                }\n                if (properties.length) {\n                    return new _object_properties_wrapper_1.ObjectPropertiesWrapper({\n                        model: model.dataItem(),\n                        properties: properties\n                    });\n                }\n                return null;\n            })),\n            summary: ko.pureComputed(function () {\n                var dataItemLink = bindingTab.tabModel() && bindingTab.tabModel().dataItemLink;\n                return dataItemLink.dataItem() && dataItemLink.dataItem().dataMember() || '';\n            }),\n            summaryHint: ko.pureComputed(function () {\n                var dataItemLink = bindingTab.tabModel() && bindingTab.tabModel().dataItemLink;\n                return dataItemLink.dataItem() && (dataItemLink.dataItem().dataMember() + ' (' + dataItemLink.uniqueName() + ')') || '';\n            })\n        });\n    };\n    DataItemsPropertiesComposer.prototype.fillOptionsTab = function (tab, dataItem, model, dataDashboardItem) {\n        var properties = [];\n        properties.push(_base_metadata_1.name);\n        var newProperties = model\n            ._specifics\n            .customOptionsProperties\n            .filter(function (p) { return !p.filter || p.filter(dataItem); });\n        properties = properties.concat(newProperties.map(function (p) { return p.serializationInfo; }));\n        var disabledRules = {};\n        newProperties\n            .filter(function (x) { return !!x.disabledRule; })\n            .forEach(function (property) {\n            disabledRules[property.serializationInfo.propertyName] = function (m) { return property.disabledRule(dataItem); };\n        });\n        tab.tabModel(new _object_properties_wrapper_1.ObjectPropertiesWrapper({\n            model: dataItem,\n            properties: properties,\n            disabledFilterRules: disabledRules\n        }));\n    };\n    DataItemsPropertiesComposer.prototype.fillDataShapingPropertiesTab = function (tab, dataDashboardItem, model, dataField, measures, dataSourceBrowser) {\n        var dataItem = model.dataItem();\n        var disableRules = {};\n        if (dataItem) {\n            var fieldType = dataField && dataField.fieldType();\n            ko.computed(function () {\n                var properties = [];\n                if (dataItem instanceof dimension_1.Dimension) {\n                    var topNEnabledFunc = function () { return dataItem.topNOptionsEnabled(); };\n                    if (dataDashboardItem._isSortingEnabled()) {\n                        if (dataField && _data_field_1.DataField.isOlap(dataItem.dataMember())) {\n                            properties.push(_dimension_1.sortOrderOlap);\n                            disableRules[_dimension_1.sortOrderOlap.propertyName] = topNEnabledFunc;\n                        }\n                        else {\n                            properties.push(_dimension_1.sortOrderNonOlap);\n                            disableRules[_dimension_1.sortOrderNonOlap.propertyName] = topNEnabledFunc;\n                        }\n                        var values = [];\n                        if (!_data_field_1.DataField.isOlap(dataItem.dataMember())) {\n                            values.push({\n                                value: 'DXValue',\n                                displayValue: 'DashboardStringId.CommandDimensionSortModeValue'\n                            });\n                        }\n                        else {\n                            values.push({\n                                value: 'DXDisplayText',\n                                displayValue: 'DashboardStringId.CommandDimensionSortModeDisplayText'\n                            });\n                            values.push({\n                                value: 'DXValue',\n                                displayValue: 'DashboardStringId.CommandDimensionSortModeValue'\n                            });\n                            values.push({\n                                value: 'DXID',\n                                displayValue: 'DashboardStringId.CommandDimensionSortModeID'\n                            });\n                            values.push({\n                                value: 'DXKey',\n                                displayValue: 'DashboardStringId.CommandDimensionSortModeKey'\n                            });\n                        }\n                        properties.push(__assign({ valuesArray: values.concat(measures.filter(function (m) { return m instanceof measure_1.Measure && !m.calculation.calculation() && !m.expression(); }).map(function (m) { return ({\n                                value: m.uniqueName(),\n                                displayValue: _display_name_provider_1.getDataItemDisplayName(dataSourceBrowser, dataDashboardItem, m)\n                            }); })) }, _dimension_1.realSortMode));\n                        disableRules[_dimension_1.realSortMode.propertyName] = topNEnabledFunc;\n                    }\n                    switch (fieldType) {\n                        case 'DateTime':\n                            break;\n                        case 'Text':\n                            properties.push(_dimension_1.textGroupInterval);\n                            break;\n                    }\n                }\n                properties = properties.concat(model\n                    ._specifics\n                    .customDataShapingProperties\n                    .filter(function (p) { return !p.filter || p.filter(dataField); })\n                    .map(function (p) { return p.serializationInfo; }));\n                var tabModel = properties.length > 0 ?\n                    new _object_properties_wrapper_1.ObjectPropertiesWrapper({\n                        model: dataItem,\n                        properties: properties,\n                        disabledFilterRules: disableRules\n                    })\n                    : null;\n                tab.tabModel(tabModel);\n            });\n        }\n    };\n    DataItemsPropertiesComposer.prototype._createExactDateProperties = function () {\n        var properties = [\n            _data_item_format_1.namelessYearFormat,\n            _data_item_format_1.namelessDateFormat,\n            _data_item_format_1.namelessDateHourFormat,\n            _data_item_format_1.namelessDateHourMinuteFormat,\n            _data_item_format_1.namelessDateTimeWithSecondsFormat\n        ];\n        var visibilityRules = {};\n        visibilityRules[_data_item_format_1.namelessYearFormat.propertyName] = [_data_item_format_1.namelessExactDateFormat.propertyName, '=', 'Year'];\n        visibilityRules[_data_item_format_1.namelessDateFormat.propertyName] = [_data_item_format_1.namelessExactDateFormat.propertyName, '=', 'Day'];\n        visibilityRules[_data_item_format_1.namelessDateHourFormat.propertyName] = [_data_item_format_1.namelessExactDateFormat.propertyName, '=', 'Hour'];\n        visibilityRules[_data_item_format_1.namelessDateHourMinuteFormat.propertyName] = [_data_item_format_1.namelessExactDateFormat.propertyName, '=', 'Minute'];\n        visibilityRules[_data_item_format_1.namelessDateTimeWithSecondsFormat.propertyName] = [_data_item_format_1.namelessExactDateFormat.propertyName, '=', 'Second'];\n        return { properties: properties, visibilityRules: visibilityRules };\n    };\n    DataItemsPropertiesComposer.prototype.fillDataItemExactDatetimeFormatTab = function (tab, model) {\n        tab.tabModel(this._createExactDatePropertiesWrapper(model));\n    };\n    DataItemsPropertiesComposer.prototype._createExactDatePropertiesWrapper = function (model) {\n        var exactDateProperties = this._createExactDateProperties();\n        return new _object_properties_wrapper_1.ObjectPropertiesWrapper({\n            model: model,\n            properties: [\n                {\n                    container: _data_item_1.dateTimeFormat,\n                    properties: [_data_item_format_1.namelessExactDateFormat]\n                },\n                {\n                    container: _data_item_1.dateTimeFormat,\n                    properties: exactDateProperties.properties\n                }\n            ],\n            visibilityFilterRules: exactDateProperties.visibilityRules\n        });\n    };\n    DataItemsPropertiesComposer.prototype.fillDimensionDatetimeFormatTab = function (tab, model) {\n        var visibilityRules = {};\n        var properties = [\n            _data_item_format_1.namelessExactDateFormat,\n            _data_item_format_1.namelessYearFormat,\n            _data_item_format_1.namelessMonthFormat,\n            _data_item_format_1.namelessQuarterFormat,\n            _data_item_format_1.namelessDayOfWeekFormat,\n            _data_item_format_1.namelessHourFormat,\n            _data_item_format_1.namelessDateFormat,\n            _data_item_format_1.namelessDateHourFormat,\n            _data_item_format_1.namelessDateHourMinuteFormat,\n            _data_item_format_1.namelessDateTimeWithSecondsFormat\n        ];\n        visibilityRules[_dimension_1.dateTimeGroupInterval.propertyName] = function () { return false; };\n        visibilityRules[_data_item_format_1.namelessYearFormat.propertyName] = [_dimension_1.dateTimeGroupInterval.propertyName, '=', 'Year'];\n        visibilityRules[_data_item_format_1.namelessQuarterFormat.propertyName] = [_dimension_1.dateTimeGroupInterval.propertyName, '=', 'Quarter'];\n        visibilityRules[_data_item_format_1.namelessMonthFormat.propertyName] = [_dimension_1.dateTimeGroupInterval.propertyName, '=', 'Month'];\n        visibilityRules[_data_item_format_1.namelessHourFormat.propertyName] = [_dimension_1.dateTimeGroupInterval.propertyName, '=', 'Hour'];\n        visibilityRules[_data_item_format_1.namelessDayOfWeekFormat.propertyName] = [_dimension_1.dateTimeGroupInterval.propertyName, '=', 'DayOfWeek'];\n        visibilityRules[_data_item_format_1.namelessDateFormat.propertyName] = [\n            [_dimension_1.dateTimeGroupInterval.propertyName, '=', 'DayMonthYear'],\n            'or',\n            [_dimension_1.dateTimeGroupInterval.propertyName, '=', 'WeekYear']\n        ];\n        visibilityRules[_data_item_format_1.namelessDateHourFormat.propertyName] = [_dimension_1.dateTimeGroupInterval.propertyName, '=', 'DateHour'];\n        visibilityRules[_data_item_format_1.namelessDateHourMinuteFormat.propertyName] = [_dimension_1.dateTimeGroupInterval.propertyName, '=', 'DateHourMinute'];\n        visibilityRules[_data_item_format_1.namelessDateTimeWithSecondsFormat.propertyName] = [_dimension_1.dateTimeGroupInterval.propertyName, '=', 'DateHourMinuteSecond'];\n        visibilityRules[_data_item_format_1.namelessExactDateFormat.propertyName] = [_dimension_1.dateTimeGroupInterval.propertyName, '=', 'None'];\n        var exactDateProperties = this._createExactDateProperties();\n        var exactDateIntervalConstraints = {};\n        exactDateProperties.properties.forEach(function (edProp) { return exactDateIntervalConstraints[edProp.propertyName] = [_dimension_1.dateTimeGroupInterval.propertyName, '=', 'None']; });\n        DataItemsPropertiesComposer._mergeRules(exactDateProperties.visibilityRules, exactDateIntervalConstraints, 'and');\n        DataItemsPropertiesComposer._mergeRules(visibilityRules, exactDateProperties.visibilityRules, 'or');\n        tab.tabModel(new _object_properties_wrapper_1.ObjectPropertiesWrapper({\n            model: model,\n            properties: [\n                _dimension_1.dateTimeGroupInterval,\n                {\n                    container: _data_item_1.dateTimeFormat,\n                    properties: properties\n                }\n            ],\n            visibilityFilterRules: visibilityRules\n        }));\n    };\n    DataItemsPropertiesComposer.prototype.fillTopNTab = function (tab, dataDashboardItem, dataItem, dataField, measures, supportsTopNOther, dataSourceBrowser) {\n        var disabledRules = {};\n        var isTopNUnavailable = function () { return measures.length === 0; };\n        var topNOptionsDisabled = function () { return !dataItem.topNOptionsEnabled() || isTopNUnavailable(); };\n        disabledRules[_dimension_1.topNOptionsEnabled.propertyName] = isTopNUnavailable;\n        disabledRules[_dimension_1.topNOptionsCount.propertyName] = topNOptionsDisabled;\n        disabledRules[_dimension_1.topNOptionsMode.propertyName] = topNOptionsDisabled;\n        disabledRules[_dimension_1.topNOptionsMeasure.propertyName] = topNOptionsDisabled;\n        disabledRules[_dimension_1.topNOptionsShowOthers.propertyName] = topNOptionsDisabled;\n        var visibilityRules = {};\n        visibilityRules[_dimension_1.topNOptionsShowOthers.propertyName] = function () { return supportsTopNOther; };\n        var properties = [\n            _dimension_1.topNOptionsEnabled,\n            _dimension_1.topNOptionsMode,\n            _dimension_1.topNOptionsCount,\n            __assign({ valuesArray: measures.map(function (m) { return { value: m.uniqueName(), displayValue: _display_name_provider_1.getDataItemDisplayName(dataSourceBrowser, dataDashboardItem, m) }; }) }, _dimension_1.topNOptionsMeasure)\n        ];\n        if (dataField && !_data_field_1.DataField.isOlap(dataField.dataMember())) {\n            properties.push(_dimension_1.topNOptionsShowOthers);\n        }\n        tab.tabModel(new _object_properties_wrapper_1.ObjectPropertiesWrapper({\n            model: dataItem,\n            properties: properties,\n            disabledFilterRules: disabledRules,\n            visibilityFilterRules: visibilityRules,\n            summary: ko.computed(function () {\n                if (!topNOptionsDisabled()) {\n                    if (!dataItem.topNOptionsMeasureName()) {\n                        dataItem.topNOptionsMeasureName(measures[0] && measures[0].uniqueName());\n                    }\n                    var topNDataItem = measures.filter(function (di) { return di.uniqueName.peek() === dataItem.topNOptionsMeasureName(); })[0];\n                    var modeDisplayValue = _default_1.getLocalizationById(_dimension_1.topNOptionsModeValues[dataItem.topNOptionsMode()]);\n                    return modeDisplayValue + ' ' + dataItem.topNOptionsCount() + ' - ' + (!!topNDataItem ? topNDataItem.dataMember() : '');\n                }\n                return '';\n            })\n        }));\n    };\n    DataItemsPropertiesComposer.prototype.fillCalculationsTab = function (tab, measure, dataDashboardItem, dataSourceBrowser, propertiesController) {\n        var noneCalculation = { title: 'DashboardStringId.CalculationTypeNone', data: { type: undefined } };\n        var expressionCalculation = { title: 'DashboardStringId.CalculationTypeExpression', data: { type: undefined } };\n        var calculationsInfo = __assign({}, _measure_1.calculations);\n        var disabledRules = {};\n        disabledRules[calculationsInfo.propertyName] = function () {\n            return dataDashboardItem\n                ._dimensions\n                .some(function (dimension) {\n                return (dimension.topNOptionsEnabled() && dimension.topNOptionsMeasureName() === measure.uniqueName()) || (dimension.sortMeasure() === measure.uniqueName());\n            });\n        };\n        var availableCalculations = [\n            noneCalculation,\n            { title: 'DashboardStringId.CalculationTypePercentOfTotal', data: { type: percent_of_total_calculation_1.PercentOfTotalCalculation } },\n            { title: 'DashboardStringId.CalculationTypeRunningTotal', data: { type: running_total_calculation_1.RunningTotalCalculation } },\n            { title: 'DashboardStringId.CalculationTypeDifference', data: { type: difference_calculation_1.DifferenceCalculation, isEqual: function (calc) { return calc.differenceType() !== 'Percentage'; } } },\n            { title: 'DashboardStringId.CalculationTypePercentageDifference', data: { type: difference_calculation_1.DifferenceCalculation, default: { '@DifferenceType': 'Percentage' }, isEqual: function (calc) { return calc.differenceType() === 'Percentage'; } } },\n            { title: 'DashboardStringId.CalculationTypeMovingCalculation', data: { type: moving_calculation_1.MovingCalculation } },\n            { title: 'DashboardStringId.CalculationTypeRank', data: { type: rank_calculation_1.RankCalculation } },\n            expressionCalculation\n        ];\n        var isEqual = function (definition) {\n            return !!definition.data.type && measure.calculation.calculation() instanceof definition.data.type && (!definition.data.isEqual || definition.data.isEqual(measure.calculation.calculation()));\n        };\n        var selectedPredefinedCalculation = ko.computed({\n            read: function () {\n                var result = !!measure.expression() ? expressionCalculation : undefined;\n                if (!result) {\n                    result = availableCalculations.filter(function (definition) { return isEqual(definition); })[0] || noneCalculation;\n                }\n                return result;\n            },\n            write: _undo_engine_helper_1.wrapFuncWithUndoRedo(function (val) {\n                if (val !== noneCalculation) {\n                    if (val === expressionCalculation) {\n                        if (!measure.expression()) {\n                            _calculation_properties_composer_1.getCalculationArgumentExpression(measure, dataDashboardItem, dataSourceBrowser).done(function (expr) {\n                                measure.expression(expr);\n                            });\n                            measure.windowDefinition.windowDefinition(dataDashboardItem._getDefaultCalculationWindowDefinition());\n                        }\n                    }\n                    else if (!isEqual(val)) {\n                        measure.expression(undefined);\n                        measure.calculation.calculation(new (val.data.type)(val.data.default));\n                        measure.windowDefinition.windowDefinition(dataDashboardItem._getDefaultCalculationWindowDefinition());\n                    }\n                }\n                else {\n                    measure.expression(undefined);\n                    measure.calculation.calculation(undefined);\n                    measure.windowDefinition.windowDefinition(undefined);\n                }\n            })\n        });\n        var singleChoiceEditorOptions = {\n            propertyName: 'title',\n            dataSource: availableCalculations,\n            enableEditItem: function (calcDefinition) { return calcDefinition !== noneCalculation; },\n            editItemHandler: function (calcDefinition) {\n                if (calcDefinition !== noneCalculation) {\n                    var surface = new _calculation_surface_1.CalculationSurface(calcDefinition, measure, dataDashboardItem, dataSourceBrowser, propertiesController);\n                    surface.startEditing(new _collection_editor_viewmodel_1.CollectionEditorEditItemArguments());\n                }\n            },\n        };\n        tab.tabModel(new _object_properties_wrapper_1.ObjectPropertiesWrapper({\n            model: {\n                calculations: selectedPredefinedCalculation,\n            },\n            properties: [__assign(__assign({}, calculationsInfo), { formAdapterItem: _form_adapter_editors_1.editableListEditor(singleChoiceEditorOptions) })],\n            disabledFilterRules: disabledRules,\n            summary: ko.computed(function () { return selectedPredefinedCalculation().title !== noneCalculation.title ? selectedPredefinedCalculation().title : ''; })\n        }));\n    };\n    DataItemsPropertiesComposer.prototype._fillFilterTab = function (tab, model, dashboardItem, dataSourceBrowser) {\n        var _a;\n        if (!_data_field_1.DataField.isOlap(model.dataMember())) {\n            var measureFilterEditorParams = {\n                fieldListProvider: ko.observable(new _item_filter_items_provider_1.ItemFilterItemsProvider(dataSourceBrowser, dataSourceBrowser, dataSourceBrowser.parameters, dashboardItem, function (di) { return di instanceof dimension_1.Dimension; })),\n                options: _filter_utils_1.createItemFilterOptions(model.filterString, undefined, dataSourceBrowser, { text: 'MeasureFilter', localizationId: 'DashboardWebStringId.AccordionTab.MeasureFilter' }),\n                displayNameProvider: new _item_filter_display_name_provider_1.ItemFilterDisplayNameProvider(dashboardItem, dataSourceBrowser)\n            };\n            var wrapper = new _object_properties_wrapper_1.ObjectPropertiesWrapper({\n                model: model,\n                properties: [\n                    __assign(__assign({}, _measure_1.measureFilterString), { formAdapterItem: _form_adapter_editors_1.filterEditor(measureFilterEditorParams) })\n                ],\n                summary: _knockout_utils_1.safeComputed({ filterString: model.filterString }, function (args) { return !!args.filterString ? _default_1.getLocalizationById('DashboardWebStringId.ButtonOn') : ''; }),\n                visibilityFilterRules: (_a = {},\n                    _a[_measure_1.measureFilterString.propertyName] = function () { return !model.expression(); },\n                    _a)\n            });\n            tab.tabModel(wrapper);\n        }\n    };\n    DataItemsPropertiesComposer.getCellFormatRuleCreator = function (dataItem, dataItemApplyTo, formatRuleItemType) {\n        return function () {\n            return data_dashboard_item_1.DataDashboardItem._createFormatRule(null, {\n                '@ItemType': formatRuleItemType,\n                '@DataItem': dataItem.uniqueName(),\n                '@DataItemApplyTo': dataItemApplyTo.uniqueName()\n            });\n        };\n    };\n    DataItemsPropertiesComposer.getCellFormatRuleFilter = function (dataItem) {\n        return function (rule) {\n            if (rule instanceof cells_item_format_rule_1.CellsItemFormatRule) {\n                var uniqueName = dataItem.uniqueName();\n                return rule.dataItemName() === uniqueName || rule.dataItemApplyToName() === uniqueName;\n            }\n            return false;\n        };\n    };\n    DataItemsPropertiesComposer.getFormatRulesWrapper = function (model, createNewItemHandler, visibleItemsFilter, editHandler) {\n        var collectionEditorOptions = __assign(__assign({ propertyName: _dashboard_item_format_rule_1.classCaption.propertyName, createNewItemHandler: createNewItemHandler }, _dashboard_item_format_rule_1.classCaption), { editItemHandler: editHandler, visibleItemsFilter: visibleItemsFilter });\n        return new _object_properties_wrapper_1.ObjectPropertiesWrapper({\n            model: model,\n            properties: [__assign(__assign({}, _data_dashboard_item_1.formatRules), { formAdapterItem: _form_adapter_editors_1.collectionEditor(collectionEditorOptions) })]\n        });\n    };\n    return DataItemsPropertiesComposer;\n}());\nexports.DataItemsPropertiesComposer = DataItemsPropertiesComposer;\n"]},"metadata":{},"sourceType":"script"}