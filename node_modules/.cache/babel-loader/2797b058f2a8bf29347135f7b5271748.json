{"ast":null,"code":"/**\r\n * DevExtreme (esm/ui/diagram/diagram.items_option.js)\r\n * Version: 22.1.3\r\n * Build date: Mon Jun 13 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport { extend } from \"../../core/utils/extend\";\nimport { Component } from \"../../core/component\";\nimport DataHelperMixin from \"../../data_helper\";\nvar ItemsOptionBase = Component.inherit({}).include(DataHelperMixin);\n\nclass ItemsOption extends ItemsOptionBase {\n  constructor(diagramWidget) {\n    super();\n    this._diagramWidget = diagramWidget;\n\n    this._resetCache();\n  }\n\n  _dataSourceChangedHandler(newItems, e) {\n    this._resetCache();\n\n    this._items = newItems.map(item => extend(true, {}, item));\n    this._dataSourceItems = newItems.slice();\n\n    if (e && e.changes) {\n      var internalChanges = e.changes.filter(change => change.internalChange);\n      var externalChanges = e.changes.filter(change => !change.internalChange);\n\n      if (internalChanges.length) {\n        this._reloadContentByChanges(internalChanges, false);\n      }\n\n      if (externalChanges.length) {\n        this._reloadContentByChanges(externalChanges, true);\n      }\n    } else {\n      this._diagramWidget._onDataSourceChanged();\n    }\n  }\n\n  _dataSourceLoadingChangedHandler(isLoading) {\n    if (isLoading && !this._dataSource.isLoaded()) {\n      this._diagramWidget._showLoadingIndicator();\n    } else {\n      this._diagramWidget._hideLoadingIndicator();\n    }\n  }\n\n  _prepareData(dataObj) {\n    for (var key in dataObj) {\n      if (!Object.prototype.hasOwnProperty.call(dataObj, key)) {\n        continue;\n      }\n\n      if (void 0 === dataObj[key]) {\n        dataObj[key] = null;\n      }\n    }\n\n    return dataObj;\n  }\n\n  insert(data, callback, errorCallback) {\n    this._resetCache();\n\n    var store = this._getStore();\n\n    store.insert(this._prepareData(data)).done((data, key) => {\n      store.push([{\n        type: \"insert\",\n        key: key,\n        data: data,\n        internalChange: true\n      }]);\n\n      if (callback) {\n        callback(data);\n      }\n\n      this._resetCache();\n    }).fail(error => {\n      if (errorCallback) {\n        errorCallback(error);\n      }\n\n      this._resetCache();\n    });\n  }\n\n  update(key, data, callback, errorCallback) {\n    var store = this._getStore();\n\n    var storeKey = this._getStoreKey(store, key, data);\n\n    store.update(storeKey, this._prepareData(data)).done((data, key) => {\n      store.push([{\n        type: \"update\",\n        key: key,\n        data: data,\n        internalChange: true\n      }]);\n\n      if (callback) {\n        callback(key, data);\n      }\n    }).fail(error => {\n      if (errorCallback) {\n        errorCallback(error);\n      }\n    });\n  }\n\n  remove(key, data, callback, errorCallback) {\n    this._resetCache();\n\n    var store = this._getStore();\n\n    var storeKey = this._getStoreKey(store, key, data);\n\n    store.remove(storeKey).done(key => {\n      store.push([{\n        type: \"remove\",\n        key: key,\n        internalChange: true\n      }]);\n\n      if (callback) {\n        callback(key);\n      }\n\n      this._resetCache();\n    }).fail(error => {\n      if (errorCallback) {\n        errorCallback(error);\n      }\n\n      this._resetCache();\n    });\n  }\n\n  findItem(itemKey) {\n    if (!this._items) {\n      return null;\n    }\n\n    return this._getItemByKey(itemKey);\n  }\n\n  getItems() {\n    return this._items;\n  }\n\n  hasItems() {\n    return !!this._items;\n  }\n\n  _reloadContentByChanges(changes, isExternalChanges) {\n    changes = changes.map(change => extend(change, {\n      internalKey: this._getInternalKey(change.key)\n    }));\n\n    this._diagramWidget._reloadContentByChanges(changes, isExternalChanges);\n  }\n\n  _getItemByKey(key) {\n    this._ensureCache();\n\n    var cache = this._cache;\n\n    var index = this._getIndexByKey(key);\n\n    return cache.items[index];\n  }\n\n  _getIndexByKey(key) {\n    this._ensureCache();\n\n    var cache = this._cache;\n\n    if (\"object\" === typeof key) {\n      for (var i = 0, length = cache.keys.length; i < length; i++) {\n        if (cache.keys[i] === key) {\n          return i;\n        }\n      }\n    } else {\n      var keySet = cache.keySet || cache.keys.reduce((accumulator, key, index) => {\n        accumulator[key] = index;\n        return accumulator;\n      }, {});\n\n      if (!cache.keySet) {\n        cache.keySet = keySet;\n      }\n\n      return keySet[key];\n    }\n\n    return -1;\n  }\n\n  _ensureCache() {\n    var cache = this._cache;\n\n    if (!cache.keys) {\n      cache.keys = [];\n      cache.items = [];\n\n      this._fillCache(cache, this._items);\n    }\n  }\n\n  _fillCache(cache, items) {\n    if (!items || !items.length) {\n      return;\n    }\n\n    var keyExpr = this._getKeyExpr();\n\n    if (keyExpr) {\n      items.forEach(item => {\n        cache.keys.push(keyExpr(item));\n        cache.items.push(item);\n      });\n    }\n\n    var itemsExpr = this._getItemsExpr();\n\n    if (itemsExpr) {\n      items.forEach(item => this._fillCache(cache, itemsExpr(item)));\n    }\n\n    var containerChildrenExpr = this._getContainerChildrenExpr();\n\n    if (containerChildrenExpr) {\n      items.forEach(item => this._fillCache(cache, containerChildrenExpr(item)));\n    }\n  }\n\n  _getKeyExpr() {\n    throw \"Not Implemented\";\n  }\n\n  _getItemsExpr() {}\n\n  _getContainerChildrenExpr() {}\n\n  _initDataSource() {\n    super._initDataSource();\n\n    this._dataSource && this._dataSource.paginate(false);\n  }\n\n  _dataSourceOptions() {\n    return {\n      paginate: false\n    };\n  }\n\n  _getStore() {\n    return this._dataSource && this._dataSource.store();\n  }\n\n  _getStoreKey(store, internalKey, data) {\n    var storeKey = store.keyOf(data);\n\n    if (storeKey === data) {\n      var keyExpr = this._getKeyExpr();\n\n      this._dataSourceItems.forEach(item => {\n        if (keyExpr(item) === internalKey) {\n          storeKey = item;\n        }\n      });\n    }\n\n    return storeKey;\n  }\n\n  _getInternalKey(storeKey) {\n    if (\"object\" === typeof storeKey) {\n      var keyExpr = this._getKeyExpr();\n\n      return keyExpr(storeKey);\n    }\n\n    return storeKey;\n  }\n\n  _resetCache() {\n    this._cache = {};\n  }\n\n}\n\nexport default ItemsOption;","map":{"version":3,"sources":["/Users/krunalpatel/Downloads/React-Firebase-Auth-master 3/node_modules/devextreme/esm/ui/diagram/diagram.items_option.js"],"names":["extend","Component","DataHelperMixin","ItemsOptionBase","inherit","include","ItemsOption","constructor","diagramWidget","_diagramWidget","_resetCache","_dataSourceChangedHandler","newItems","e","_items","map","item","_dataSourceItems","slice","changes","internalChanges","filter","change","internalChange","externalChanges","length","_reloadContentByChanges","_onDataSourceChanged","_dataSourceLoadingChangedHandler","isLoading","_dataSource","isLoaded","_showLoadingIndicator","_hideLoadingIndicator","_prepareData","dataObj","key","Object","prototype","hasOwnProperty","call","insert","data","callback","errorCallback","store","_getStore","done","push","type","fail","error","update","storeKey","_getStoreKey","remove","findItem","itemKey","_getItemByKey","getItems","hasItems","isExternalChanges","internalKey","_getInternalKey","_ensureCache","cache","_cache","index","_getIndexByKey","items","i","keys","keySet","reduce","accumulator","_fillCache","keyExpr","_getKeyExpr","forEach","itemsExpr","_getItemsExpr","containerChildrenExpr","_getContainerChildrenExpr","_initDataSource","paginate","_dataSourceOptions","keyOf"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (esm/ui/diagram/diagram.items_option.js)\r\n * Version: 22.1.3\r\n * Build date: Mon Jun 13 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport {\r\n    extend\r\n} from \"../../core/utils/extend\";\r\nimport {\r\n    Component\r\n} from \"../../core/component\";\r\nimport DataHelperMixin from \"../../data_helper\";\r\nvar ItemsOptionBase = Component.inherit({}).include(DataHelperMixin);\r\nclass ItemsOption extends ItemsOptionBase {\r\n    constructor(diagramWidget) {\r\n        super();\r\n        this._diagramWidget = diagramWidget;\r\n        this._resetCache()\r\n    }\r\n    _dataSourceChangedHandler(newItems, e) {\r\n        this._resetCache();\r\n        this._items = newItems.map(item => extend(true, {}, item));\r\n        this._dataSourceItems = newItems.slice();\r\n        if (e && e.changes) {\r\n            var internalChanges = e.changes.filter(change => change.internalChange);\r\n            var externalChanges = e.changes.filter(change => !change.internalChange);\r\n            if (internalChanges.length) {\r\n                this._reloadContentByChanges(internalChanges, false)\r\n            }\r\n            if (externalChanges.length) {\r\n                this._reloadContentByChanges(externalChanges, true)\r\n            }\r\n        } else {\r\n            this._diagramWidget._onDataSourceChanged()\r\n        }\r\n    }\r\n    _dataSourceLoadingChangedHandler(isLoading) {\r\n        if (isLoading && !this._dataSource.isLoaded()) {\r\n            this._diagramWidget._showLoadingIndicator()\r\n        } else {\r\n            this._diagramWidget._hideLoadingIndicator()\r\n        }\r\n    }\r\n    _prepareData(dataObj) {\r\n        for (var key in dataObj) {\r\n            if (!Object.prototype.hasOwnProperty.call(dataObj, key)) {\r\n                continue\r\n            }\r\n            if (void 0 === dataObj[key]) {\r\n                dataObj[key] = null\r\n            }\r\n        }\r\n        return dataObj\r\n    }\r\n    insert(data, callback, errorCallback) {\r\n        this._resetCache();\r\n        var store = this._getStore();\r\n        store.insert(this._prepareData(data)).done((data, key) => {\r\n            store.push([{\r\n                type: \"insert\",\r\n                key: key,\r\n                data: data,\r\n                internalChange: true\r\n            }]);\r\n            if (callback) {\r\n                callback(data)\r\n            }\r\n            this._resetCache()\r\n        }).fail(error => {\r\n            if (errorCallback) {\r\n                errorCallback(error)\r\n            }\r\n            this._resetCache()\r\n        })\r\n    }\r\n    update(key, data, callback, errorCallback) {\r\n        var store = this._getStore();\r\n        var storeKey = this._getStoreKey(store, key, data);\r\n        store.update(storeKey, this._prepareData(data)).done((data, key) => {\r\n            store.push([{\r\n                type: \"update\",\r\n                key: key,\r\n                data: data,\r\n                internalChange: true\r\n            }]);\r\n            if (callback) {\r\n                callback(key, data)\r\n            }\r\n        }).fail(error => {\r\n            if (errorCallback) {\r\n                errorCallback(error)\r\n            }\r\n        })\r\n    }\r\n    remove(key, data, callback, errorCallback) {\r\n        this._resetCache();\r\n        var store = this._getStore();\r\n        var storeKey = this._getStoreKey(store, key, data);\r\n        store.remove(storeKey).done(key => {\r\n            store.push([{\r\n                type: \"remove\",\r\n                key: key,\r\n                internalChange: true\r\n            }]);\r\n            if (callback) {\r\n                callback(key)\r\n            }\r\n            this._resetCache()\r\n        }).fail(error => {\r\n            if (errorCallback) {\r\n                errorCallback(error)\r\n            }\r\n            this._resetCache()\r\n        })\r\n    }\r\n    findItem(itemKey) {\r\n        if (!this._items) {\r\n            return null\r\n        }\r\n        return this._getItemByKey(itemKey)\r\n    }\r\n    getItems() {\r\n        return this._items\r\n    }\r\n    hasItems() {\r\n        return !!this._items\r\n    }\r\n    _reloadContentByChanges(changes, isExternalChanges) {\r\n        changes = changes.map(change => extend(change, {\r\n            internalKey: this._getInternalKey(change.key)\r\n        }));\r\n        this._diagramWidget._reloadContentByChanges(changes, isExternalChanges)\r\n    }\r\n    _getItemByKey(key) {\r\n        this._ensureCache();\r\n        var cache = this._cache;\r\n        var index = this._getIndexByKey(key);\r\n        return cache.items[index]\r\n    }\r\n    _getIndexByKey(key) {\r\n        this._ensureCache();\r\n        var cache = this._cache;\r\n        if (\"object\" === typeof key) {\r\n            for (var i = 0, length = cache.keys.length; i < length; i++) {\r\n                if (cache.keys[i] === key) {\r\n                    return i\r\n                }\r\n            }\r\n        } else {\r\n            var keySet = cache.keySet || cache.keys.reduce((accumulator, key, index) => {\r\n                accumulator[key] = index;\r\n                return accumulator\r\n            }, {});\r\n            if (!cache.keySet) {\r\n                cache.keySet = keySet\r\n            }\r\n            return keySet[key]\r\n        }\r\n        return -1\r\n    }\r\n    _ensureCache() {\r\n        var cache = this._cache;\r\n        if (!cache.keys) {\r\n            cache.keys = [];\r\n            cache.items = [];\r\n            this._fillCache(cache, this._items)\r\n        }\r\n    }\r\n    _fillCache(cache, items) {\r\n        if (!items || !items.length) {\r\n            return\r\n        }\r\n        var keyExpr = this._getKeyExpr();\r\n        if (keyExpr) {\r\n            items.forEach(item => {\r\n                cache.keys.push(keyExpr(item));\r\n                cache.items.push(item)\r\n            })\r\n        }\r\n        var itemsExpr = this._getItemsExpr();\r\n        if (itemsExpr) {\r\n            items.forEach(item => this._fillCache(cache, itemsExpr(item)))\r\n        }\r\n        var containerChildrenExpr = this._getContainerChildrenExpr();\r\n        if (containerChildrenExpr) {\r\n            items.forEach(item => this._fillCache(cache, containerChildrenExpr(item)))\r\n        }\r\n    }\r\n    _getKeyExpr() {\r\n        throw \"Not Implemented\"\r\n    }\r\n    _getItemsExpr() {}\r\n    _getContainerChildrenExpr() {}\r\n    _initDataSource() {\r\n        super._initDataSource();\r\n        this._dataSource && this._dataSource.paginate(false)\r\n    }\r\n    _dataSourceOptions() {\r\n        return {\r\n            paginate: false\r\n        }\r\n    }\r\n    _getStore() {\r\n        return this._dataSource && this._dataSource.store()\r\n    }\r\n    _getStoreKey(store, internalKey, data) {\r\n        var storeKey = store.keyOf(data);\r\n        if (storeKey === data) {\r\n            var keyExpr = this._getKeyExpr();\r\n            this._dataSourceItems.forEach(item => {\r\n                if (keyExpr(item) === internalKey) {\r\n                    storeKey = item\r\n                }\r\n            })\r\n        }\r\n        return storeKey\r\n    }\r\n    _getInternalKey(storeKey) {\r\n        if (\"object\" === typeof storeKey) {\r\n            var keyExpr = this._getKeyExpr();\r\n            return keyExpr(storeKey)\r\n        }\r\n        return storeKey\r\n    }\r\n    _resetCache() {\r\n        this._cache = {}\r\n    }\r\n}\r\nexport default ItemsOption;\r\n"]},"metadata":{},"sourceType":"module"}