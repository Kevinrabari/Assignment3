{"ast":null,"code":"/**\r\n* DevExpress Dashboard (_calc-field-editor.js)\r\n* Version:  22.1.3\r\n* Build date: Jun 13, 2022\r\n* Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n* License: https://www.devexpress.com/Support/EULAs/universal.xml\r\n*/\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.CalcFieldEditorViewModel = exports.CalcFieldEditor = void 0;\n\nvar ko = require(\"knockout\");\n\nvar _data_source_browser_1 = require(\"../../common/_data-source-browser\");\n\nvar _default_1 = require(\"../../data/localization/_default\");\n\nvar _jquery_helpers_1 = require(\"../../data/_jquery-helpers\");\n\nvar calculated_field_1 = require(\"../../model/data-sources/calculated-field\");\n\nvar ef_data_source_1 = require(\"../../model/data-sources/ef-data-source\");\n\nvar federation_data_source_1 = require(\"../../model/data-sources/federation-data-source\");\n\nvar _calculated_field_1 = require(\"../../model/data-sources/metadata/_calculated-field\");\n\nvar mongodb_data_source_1 = require(\"../../model/data-sources/mongodb-data-source\");\n\nvar sql_data_source_1 = require(\"../../model/data-sources/sql-data-source\");\n\nvar _helper_classes_1 = require(\"../../model/internal/_helper-classes\");\n\nvar _base_metadata_1 = require(\"../../model/metadata/_base-metadata\");\n\nvar _expression_editor_display_name_provider_1 = require(\"../expression-editor/_expression-editor-display-name-provider\");\n\nvar _expression_editor_item_provider_1 = require(\"../expression-editor/_expression-editor-item-provider\");\n\nvar CalcFieldEditor = function () {\n  function CalcFieldEditor(dataSourceBrowser) {\n    this.dataSourceBrowser = dataSourceBrowser;\n    this.viewModel = ko.observable(null);\n  }\n\n  CalcFieldEditor.prototype.canAddCalculatedField = function (dataSourceName) {\n    var dataSource = this.dataSourceBrowser.findDataSource(dataSourceName);\n\n    if (dataSource && dataSource.hasCalculatedFields) {\n      if (dataSource instanceof sql_data_source_1.SqlDataSource) {\n        return dataSource.queries().length > 0;\n      } else if (dataSource instanceof ef_data_source_1.EFDataSource) {\n        return dataSource._tables().length > 0;\n      } else if (dataSource instanceof federation_data_source_1.FederationDataSource) {\n        return dataSource.queries().length > 0;\n      } else if (dataSource instanceof mongodb_data_source_1.MongoDBDataSource) {\n        return dataSource.queries().length > 0;\n      }\n\n      return !!dataSource;\n    } else {\n      return false;\n    }\n  };\n\n  CalcFieldEditor.prototype.showAddDialog = function (dataSourceName, dataMemberName) {\n    var def = _jquery_helpers_1.createJQueryDeferred();\n\n    if (this.canAddCalculatedField) {\n      var dataSourceInstance = this.dataSourceBrowser.findDataSource(dataSourceName);\n\n      var newCalculatedFieldName = _helper_classes_1.NameGenerator.generateName(_default_1.getLocalizationById('DashboardStringId.NewCalculatedFieldNamePrefix') + ' ', dataSourceInstance.calculatedFields(), 'name', 1);\n\n      var newCalculatedField = new calculated_field_1.CalculatedField({\n        '@Name': newCalculatedFieldName,\n        '@DataMember': dataMemberName,\n        '@DataType': 'Auto'\n      });\n      this.show(newCalculatedField, dataSourceName, dataMemberName).then(function (calcField) {\n        return def.resolve(calcField);\n      }, function (calcField) {\n        return def.reject(calcField);\n      });\n    } else {\n      def.reject();\n    }\n\n    return def.promise();\n  };\n\n  CalcFieldEditor.prototype.showEditDialog = function (calculatedField, dataSourceName, dataMemberName) {\n    return this.show(calculatedField, dataSourceName, dataMemberName);\n  };\n\n  CalcFieldEditor.prototype.removeCalcField = function (calculatedField, dataSourceName) {\n    var dataSourceInstance = this.dataSourceBrowser.findDataSource(dataSourceName);\n    var dataMemberName = calculatedField.dataMember();\n    var pathInCache = [dataSourceName].concat(dataMemberName ? [dataMemberName] : []);\n    this.dataSourceBrowser.clearFieldsCache(pathInCache.join('.'));\n    dataSourceInstance.calculatedFields.remove(calculatedField);\n    return _jquery_helpers_1.createJQueryDeferred().resolve(calculatedField).promise();\n  };\n\n  CalcFieldEditor.prototype.show = function (calculatedField, dataSourceName, dataMemberName) {\n    var _this = this;\n\n    var def = _jquery_helpers_1.createJQueryDeferred();\n\n    var pathInCache = [dataSourceName].concat(dataMemberName ? [dataMemberName] : []);\n    this.viewModel(new CalcFieldEditorViewModel(calculatedField, this.dataSourceBrowser, dataSourceName, function (calcField) {\n      var dsi = _this.dataSourceBrowser.findDataSource(dataSourceName);\n\n      if (dsi && dsi.calculatedFields.indexOf(calcField) === -1) {\n        dsi.calculatedFields.push(calcField);\n      }\n\n      def.resolve(calcField);\n    }, function () {\n      return _this.dataSourceBrowser.clearFieldsCache(pathInCache.join('.'));\n    }));\n    return def.promise();\n  };\n\n  return CalcFieldEditor;\n}();\n\nexports.CalcFieldEditor = CalcFieldEditor;\n\nvar CalcFieldEditorViewModel = function () {\n  function CalcFieldEditorViewModel(calculatedField, dataSourceBrowser, dataSourceName, onSave, onBeforeSave) {\n    var _this = this;\n\n    this.toolbarItems = [];\n    this.isCalcFieldNameValid = ko.observable(true);\n    this.popupVisible = ko.observable(true);\n    var dataSource = dataSourceBrowser.findDataSource(dataSourceName);\n\n    this.getInfo = function () {\n      return [_base_metadata_1.name, _calculated_field_1.calculatedFieldType, _calculated_field_1.calcFieldExpressionEditable];\n    };\n\n    this.nameValidationRules = [{\n      type: 'required'\n    }, {\n      type: 'custom',\n      validationCallback: function (params) {\n        var previousParams = false;\n        var dataSource = dataSourceBrowser.findDataSource(dataSourceName);\n        var dataMembers = [''];\n\n        if (dataSource instanceof sql_data_source_1.SqlDataSource) {\n          dataMembers = dataSource.queries().map(function (dm) {\n            return dm.name();\n          });\n        } else if (dataSource instanceof ef_data_source_1.EFDataSource) {\n          dataMembers = dataSource._tables().map(function (dm) {\n            return dm.name();\n          });\n        } else if (dataSource instanceof federation_data_source_1.FederationDataSource) {\n          dataMembers = dataSource.queries().map(function (dm) {\n            return dm.alias();\n          });\n        } else if (dataSource instanceof mongodb_data_source_1.MongoDBDataSource) {\n          dataMembers = dataSource.queries().map(function (dm) {\n            return dm._actualName();\n          });\n        }\n\n        var promises = dataMembers.map(function (dataMember) {\n          return dataSourceBrowser.findDataField(dataSourceName, dataMember, params.value);\n        });\n\n        _jquery_helpers_1.jqueryWhen.apply(void 0, promises).done(function () {\n          var fields = [];\n\n          for (var _i = 0; _i < arguments.length; _i++) {\n            fields[_i] = arguments[_i];\n          }\n\n          previousParams = true;\n          params.rule.isValid = fields.reduce(function (result, curField) {\n            return result && !curField;\n          }, true);\n          params.validator.validate();\n        });\n\n        if (previousParams) return params.rule.isValid;\n        return false;\n      },\n      message: _default_1.getLocalizationById('DashboardWebStringId.DataSources.CalculatedField.UniqueNameError')\n    }];\n    this.calculatedField = calculatedField;\n    this.dataMember = ko.observable(calculatedField.dataMember());\n    this.fieldType = ko.observable(calculatedField.fieldType());\n    this.availableTypes = Object.keys(_calculated_field_1.calculatedFieldType.values);\n    this.name = ko.observable(calculatedField.name());\n    this.expression = ko.observable(calculatedField.expression());\n    this.expressionEditable = {\n      value: this.expression,\n      path: ko.observable(calculatedField.dataMember() ? [dataSourceName, calculatedField.dataMember()].join('.') : dataSourceName),\n      fieldName: calculatedField.name,\n      patchFieldName: function (fieldPath) {\n        return _data_source_browser_1.patchCalcFieldPath(dataSource, calculatedField, fieldPath);\n      },\n      isValid: ko.observable(true),\n      customizeCategories: function (sender, categories, dblclick) {\n        var treeList = categories[0].content.data.fields().treeListController;\n        var putSelectionHandlerBase = treeList.putSelectionHandler;\n\n        treeList.putSelectionHandler = function (data, element) {\n          if (!data.data.isList) {\n            putSelectionHandlerBase.call(treeList, data, element);\n          }\n        };\n      }\n    };\n    this.itemsProvider = new _expression_editor_item_provider_1.ExpressionEditorItemsProvider(dataSourceBrowser, dataSourceBrowser, dataSourceBrowser.parameters && dataSourceBrowser.parameters(), ko.pureComputed(function () {\n      return dataSourceName;\n    }), calculatedField.dataMember);\n    this.displayNameProvider = _expression_editor_display_name_provider_1.ExpressionEditorDisplayNameProvider.create(dataSourceBrowser, dataSourceBrowser, dataSourceName, calculatedField.dataMember());\n    this.saveHandler = ko.observable();\n\n    var saveHandler = function (sender) {\n      _this.saveHandler()(function () {\n        onBeforeSave && onBeforeSave();\n        calculatedField.expression(_this.expression());\n        calculatedField.name(_this.name());\n        calculatedField.fieldType(_this.fieldType());\n        onSave && onSave(calculatedField);\n\n        _this.popupVisible(false);\n      });\n    };\n\n    this.toolbarItems = [{\n      toolbar: 'bottom',\n      location: 'after',\n      widget: 'dxButton',\n      options: {\n        text: _default_1.getLocalizationById('DashboardWebStringId.DashboardMenuSave'),\n        onClick: saveHandler,\n        disabled: ko.computed(function () {\n          return !_this.isCalcFieldNameValid();\n        }),\n        type: 'default'\n      }\n    }, {\n      toolbar: 'bottom',\n      location: 'after',\n      widget: 'dxButton',\n      options: {\n        text: _default_1.getLocalizationById('DashboardWebStringId.DataSources.Cancel'),\n        onClick: function () {\n          return _this.popupVisible(false);\n        }\n      }\n    }];\n    this.popupVisible(true);\n  }\n\n  return CalcFieldEditorViewModel;\n}();\n\nexports.CalcFieldEditorViewModel = CalcFieldEditorViewModel;","map":{"version":3,"sources":["/Users/krunalpatel/Downloads/React-Firebase-Auth-master 3/node_modules/devexpress-dashboard/designer/calc-field-editor/_calc-field-editor.js"],"names":["Object","defineProperty","exports","value","CalcFieldEditorViewModel","CalcFieldEditor","ko","require","_data_source_browser_1","_default_1","_jquery_helpers_1","calculated_field_1","ef_data_source_1","federation_data_source_1","_calculated_field_1","mongodb_data_source_1","sql_data_source_1","_helper_classes_1","_base_metadata_1","_expression_editor_display_name_provider_1","_expression_editor_item_provider_1","dataSourceBrowser","viewModel","observable","prototype","canAddCalculatedField","dataSourceName","dataSource","findDataSource","hasCalculatedFields","SqlDataSource","queries","length","EFDataSource","_tables","FederationDataSource","MongoDBDataSource","showAddDialog","dataMemberName","def","createJQueryDeferred","dataSourceInstance","newCalculatedFieldName","NameGenerator","generateName","getLocalizationById","calculatedFields","newCalculatedField","CalculatedField","show","then","calcField","resolve","reject","promise","showEditDialog","calculatedField","removeCalcField","dataMember","pathInCache","concat","clearFieldsCache","join","remove","_this","dsi","indexOf","push","onSave","onBeforeSave","toolbarItems","isCalcFieldNameValid","popupVisible","getInfo","name","calculatedFieldType","calcFieldExpressionEditable","nameValidationRules","type","validationCallback","params","previousParams","dataMembers","map","dm","alias","_actualName","promises","findDataField","jqueryWhen","apply","done","fields","_i","arguments","rule","isValid","reduce","result","curField","validator","validate","message","fieldType","availableTypes","keys","values","expression","expressionEditable","path","fieldName","patchFieldName","fieldPath","patchCalcFieldPath","customizeCategories","sender","categories","dblclick","treeList","content","data","treeListController","putSelectionHandlerBase","putSelectionHandler","element","isList","call","itemsProvider","ExpressionEditorItemsProvider","parameters","pureComputed","displayNameProvider","ExpressionEditorDisplayNameProvider","create","saveHandler","toolbar","location","widget","options","text","onClick","disabled","computed"],"mappings":"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","sourcesContent":["/**\r\n* DevExpress Dashboard (_calc-field-editor.js)\r\n* Version:  22.1.3\r\n* Build date: Jun 13, 2022\r\n* Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n* License: https://www.devexpress.com/Support/EULAs/universal.xml\r\n*/\r\n\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.CalcFieldEditorViewModel = exports.CalcFieldEditor = void 0;\nvar ko = require(\"knockout\");\nvar _data_source_browser_1 = require(\"../../common/_data-source-browser\");\nvar _default_1 = require(\"../../data/localization/_default\");\nvar _jquery_helpers_1 = require(\"../../data/_jquery-helpers\");\nvar calculated_field_1 = require(\"../../model/data-sources/calculated-field\");\nvar ef_data_source_1 = require(\"../../model/data-sources/ef-data-source\");\nvar federation_data_source_1 = require(\"../../model/data-sources/federation-data-source\");\nvar _calculated_field_1 = require(\"../../model/data-sources/metadata/_calculated-field\");\nvar mongodb_data_source_1 = require(\"../../model/data-sources/mongodb-data-source\");\nvar sql_data_source_1 = require(\"../../model/data-sources/sql-data-source\");\nvar _helper_classes_1 = require(\"../../model/internal/_helper-classes\");\nvar _base_metadata_1 = require(\"../../model/metadata/_base-metadata\");\nvar _expression_editor_display_name_provider_1 = require(\"../expression-editor/_expression-editor-display-name-provider\");\nvar _expression_editor_item_provider_1 = require(\"../expression-editor/_expression-editor-item-provider\");\nvar CalcFieldEditor = (function () {\n    function CalcFieldEditor(dataSourceBrowser) {\n        this.dataSourceBrowser = dataSourceBrowser;\n        this.viewModel = ko.observable(null);\n    }\n    CalcFieldEditor.prototype.canAddCalculatedField = function (dataSourceName) {\n        var dataSource = this.dataSourceBrowser.findDataSource(dataSourceName);\n        if (dataSource && dataSource.hasCalculatedFields) {\n            if (dataSource instanceof sql_data_source_1.SqlDataSource) {\n                return dataSource.queries().length > 0;\n            }\n            else if (dataSource instanceof ef_data_source_1.EFDataSource) {\n                return dataSource._tables().length > 0;\n            }\n            else if (dataSource instanceof federation_data_source_1.FederationDataSource) {\n                return dataSource.queries().length > 0;\n            }\n            else if (dataSource instanceof mongodb_data_source_1.MongoDBDataSource) {\n                return dataSource.queries().length > 0;\n            }\n            return !!dataSource;\n        }\n        else {\n            return false;\n        }\n    };\n    CalcFieldEditor.prototype.showAddDialog = function (dataSourceName, dataMemberName) {\n        var def = _jquery_helpers_1.createJQueryDeferred();\n        if (this.canAddCalculatedField) {\n            var dataSourceInstance = this.dataSourceBrowser.findDataSource(dataSourceName);\n            var newCalculatedFieldName = _helper_classes_1.NameGenerator.generateName(_default_1.getLocalizationById('DashboardStringId.NewCalculatedFieldNamePrefix') + ' ', dataSourceInstance.calculatedFields(), 'name', 1);\n            var newCalculatedField = new calculated_field_1.CalculatedField({ '@Name': newCalculatedFieldName, '@DataMember': dataMemberName, '@DataType': 'Auto' });\n            this.show(newCalculatedField, dataSourceName, dataMemberName).then(function (calcField) { return def.resolve(calcField); }, function (calcField) { return def.reject(calcField); });\n        }\n        else {\n            def.reject();\n        }\n        return def.promise();\n    };\n    CalcFieldEditor.prototype.showEditDialog = function (calculatedField, dataSourceName, dataMemberName) {\n        return this.show(calculatedField, dataSourceName, dataMemberName);\n    };\n    CalcFieldEditor.prototype.removeCalcField = function (calculatedField, dataSourceName) {\n        var dataSourceInstance = this.dataSourceBrowser.findDataSource(dataSourceName);\n        var dataMemberName = calculatedField.dataMember();\n        var pathInCache = [dataSourceName].concat(dataMemberName ? [dataMemberName] : []);\n        this.dataSourceBrowser.clearFieldsCache(pathInCache.join('.'));\n        dataSourceInstance.calculatedFields.remove(calculatedField);\n        return _jquery_helpers_1.createJQueryDeferred().resolve(calculatedField).promise();\n    };\n    CalcFieldEditor.prototype.show = function (calculatedField, dataSourceName, dataMemberName) {\n        var _this = this;\n        var def = _jquery_helpers_1.createJQueryDeferred();\n        var pathInCache = [dataSourceName].concat(dataMemberName ? [dataMemberName] : []);\n        this.viewModel(new CalcFieldEditorViewModel(calculatedField, this.dataSourceBrowser, dataSourceName, function (calcField) {\n            var dsi = _this.dataSourceBrowser.findDataSource(dataSourceName);\n            if (dsi && dsi.calculatedFields.indexOf(calcField) === -1) {\n                dsi.calculatedFields.push(calcField);\n            }\n            def.resolve(calcField);\n        }, function () { return _this.dataSourceBrowser.clearFieldsCache(pathInCache.join('.')); }));\n        return def.promise();\n    };\n    return CalcFieldEditor;\n}());\nexports.CalcFieldEditor = CalcFieldEditor;\nvar CalcFieldEditorViewModel = (function () {\n    function CalcFieldEditorViewModel(calculatedField, dataSourceBrowser, dataSourceName, onSave, onBeforeSave) {\n        var _this = this;\n        this.toolbarItems = [];\n        this.isCalcFieldNameValid = ko.observable(true);\n        this.popupVisible = ko.observable(true);\n        var dataSource = dataSourceBrowser.findDataSource(dataSourceName);\n        this.getInfo = function () {\n            return [_base_metadata_1.name, _calculated_field_1.calculatedFieldType, _calculated_field_1.calcFieldExpressionEditable];\n        };\n        this.nameValidationRules = [{\n                type: 'required'\n            }, {\n                type: 'custom',\n                validationCallback: function (params) {\n                    var previousParams = false;\n                    var dataSource = dataSourceBrowser.findDataSource(dataSourceName);\n                    var dataMembers = [''];\n                    if (dataSource instanceof sql_data_source_1.SqlDataSource) {\n                        dataMembers = dataSource.queries().map(function (dm) { return dm.name(); });\n                    }\n                    else if (dataSource instanceof ef_data_source_1.EFDataSource) {\n                        dataMembers = dataSource._tables().map(function (dm) { return dm.name(); });\n                    }\n                    else if (dataSource instanceof federation_data_source_1.FederationDataSource) {\n                        dataMembers = dataSource.queries().map(function (dm) { return dm.alias(); });\n                    }\n                    else if (dataSource instanceof mongodb_data_source_1.MongoDBDataSource) {\n                        dataMembers = dataSource.queries().map(function (dm) { return dm._actualName(); });\n                    }\n                    var promises = dataMembers.map(function (dataMember) { return dataSourceBrowser.findDataField(dataSourceName, dataMember, params.value); });\n                    _jquery_helpers_1.jqueryWhen.apply(void 0, promises).done(function () {\n                        var fields = [];\n                        for (var _i = 0; _i < arguments.length; _i++) {\n                            fields[_i] = arguments[_i];\n                        }\n                        previousParams = true;\n                        params.rule.isValid = fields.reduce(function (result, curField) { return result && !curField; }, true);\n                        params.validator.validate();\n                    });\n                    if (previousParams)\n                        return params.rule.isValid;\n                    return false;\n                },\n                message: _default_1.getLocalizationById('DashboardWebStringId.DataSources.CalculatedField.UniqueNameError')\n            }];\n        this.calculatedField = calculatedField;\n        this.dataMember = ko.observable(calculatedField.dataMember());\n        this.fieldType = ko.observable(calculatedField.fieldType());\n        this.availableTypes = Object.keys(_calculated_field_1.calculatedFieldType.values);\n        this.name = ko.observable(calculatedField.name());\n        this.expression = ko.observable(calculatedField.expression());\n        this.expressionEditable = {\n            value: this.expression,\n            path: ko.observable(calculatedField.dataMember() ? [dataSourceName, calculatedField.dataMember()].join('.') : dataSourceName),\n            fieldName: calculatedField.name,\n            patchFieldName: function (fieldPath) { return _data_source_browser_1.patchCalcFieldPath(dataSource, calculatedField, fieldPath); },\n            isValid: ko.observable(true),\n            customizeCategories: function (sender, categories, dblclick) {\n                var treeList = categories[0].content.data.fields().treeListController;\n                var putSelectionHandlerBase = treeList.putSelectionHandler;\n                treeList.putSelectionHandler = function (data, element) {\n                    if (!data.data.isList) {\n                        putSelectionHandlerBase.call(treeList, data, element);\n                    }\n                };\n            }\n        };\n        this.itemsProvider = new _expression_editor_item_provider_1.ExpressionEditorItemsProvider(dataSourceBrowser, dataSourceBrowser, dataSourceBrowser.parameters && dataSourceBrowser.parameters(), ko.pureComputed(function () { return dataSourceName; }), calculatedField.dataMember);\n        this.displayNameProvider = _expression_editor_display_name_provider_1.ExpressionEditorDisplayNameProvider.create(dataSourceBrowser, dataSourceBrowser, dataSourceName, calculatedField.dataMember());\n        this.saveHandler = ko.observable();\n        var saveHandler = function (sender) {\n            _this.saveHandler()(function () {\n                onBeforeSave && onBeforeSave();\n                calculatedField.expression(_this.expression());\n                calculatedField.name(_this.name());\n                calculatedField.fieldType(_this.fieldType());\n                onSave && onSave(calculatedField);\n                _this.popupVisible(false);\n            });\n        };\n        this.toolbarItems = [\n            {\n                toolbar: 'bottom', location: 'after', widget: 'dxButton',\n                options: {\n                    text: _default_1.getLocalizationById('DashboardWebStringId.DashboardMenuSave'),\n                    onClick: saveHandler,\n                    disabled: ko.computed(function () { return !_this.isCalcFieldNameValid(); }),\n                    type: 'default'\n                }\n            },\n            { toolbar: 'bottom', location: 'after', widget: 'dxButton', options: { text: _default_1.getLocalizationById('DashboardWebStringId.DataSources.Cancel'), onClick: function () { return _this.popupVisible(false); } } }\n        ];\n        this.popupVisible(true);\n    }\n    return CalcFieldEditorViewModel;\n}());\nexports.CalcFieldEditorViewModel = CalcFieldEditorViewModel;\n"]},"metadata":{},"sourceType":"script"}