{"ast":null,"code":"/**\r\n* DevExpress Dashboard (_data-source-browser.js)\r\n* Version:  22.1.3\r\n* Build date: Jun 13, 2022\r\n* Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n* License: https://www.devexpress.com/Support/EULAs/universal.xml\r\n*/\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getDataFields = exports.isNonCollectionDataField = exports.DataSourceBrowser = exports.getFirstDataMember = exports.findDataMember = exports.isStartedWith = exports.splitFullFieldName = exports.trimLeadingPathElement = exports.patchCalcFieldPath = void 0;\n\nvar analytics_data_1 = require(\"@devexpress/analytics-core/analytics-data\");\n\nvar analytics_utils_1 = require(\"@devexpress/analytics-core/analytics-utils\");\n\nvar ko = require(\"knockout\");\n\nvar _jquery_helpers_1 = require(\"../data/_jquery-helpers\");\n\nvar ef_data_source_1 = require(\"../model/data-sources/ef-data-source\");\n\nvar federation_data_source_1 = require(\"../model/data-sources/federation-data-source\");\n\nvar mongodb_data_source_1 = require(\"../model/data-sources/mongodb-data-source\");\n\nvar object_data_source_1 = require(\"../model/data-sources/object-data-source\");\n\nvar sql_data_source_1 = require(\"../model/data-sources/sql-data-source\");\n\nvar _data_field_1 = require(\"../model/data-sources/_data-field\");\n\nvar _date_utils_1 = require(\"../model/internal/_date-utils\");\n\nvar _knockout_utils_1 = require(\"../model/internal/_knockout-utils\");\n\nfunction patchCalcFieldPath(dataSource, calculatedField, fieldName) {\n  if (fieldName.indexOf('Parameters.Parameters.') === 0) {\n    return 'Parameters.' + fieldName.split('.')[2];\n  }\n\n  if (dataSource instanceof sql_data_source_1.SqlDataSource) {\n    var query = dataSource.queries().filter(function (query) {\n      return query.name() === calculatedField.dataMember();\n    })[0];\n\n    if (!!query && query instanceof analytics_data_1.TableQuery) {\n      var table = query.tables().filter(function (table) {\n        return fieldName.indexOf((table.alias() || table.name()) + '.') === 0;\n      })[0];\n\n      if (!!table) {\n        return trimLeadingPathElement(fieldName, table.alias() || table.name());\n      }\n    }\n  }\n\n  return fieldName;\n}\n\nexports.patchCalcFieldPath = patchCalcFieldPath;\n\nfunction trimLeadingPathElement(path, element) {\n  if (path === void 0) {\n    path = '';\n  }\n\n  var str = path;\n\n  if (path.indexOf(element) === 0) {\n    str = path.substring(element.length);\n  }\n\n  return str[0] === '.' ? str.substring(1) : str;\n}\n\nexports.trimLeadingPathElement = trimLeadingPathElement;\n\nfunction splitFullFieldName(fullFieldName) {\n  var parts = fullFieldName.split('.');\n  return {\n    path: parts.slice(0, parts.length - 1).join('.'),\n    name: parts[parts.length - 1] || ''\n  };\n}\n\nexports.splitFullFieldName = splitFullFieldName;\n\nfunction isStartedWith(path, value) {\n  return path.indexOf(value) === 0 && (path.length === value.length || path[value.length] === '.');\n}\n\nexports.isStartedWith = isStartedWith;\n\nfunction findDataMember(dataSource, path) {\n  var dataMember = '';\n  var fieldPath = path;\n\n  if (dataSource instanceof sql_data_source_1.SqlDataSource) {\n    var query = dataSource.queries().filter(function (q) {\n      return isStartedWith(path, q.name());\n    })[0];\n\n    if (!!query) {\n      dataMember = query.name();\n      fieldPath = trimLeadingPathElement(path, dataMember);\n    }\n  } else if (dataSource instanceof ef_data_source_1.EFDataSource) {\n    var table = dataSource._tables().filter(function (t) {\n      return isStartedWith(path, t.dataMember());\n    })[0];\n\n    if (!!table) {\n      dataMember = table.dataMember();\n      fieldPath = trimLeadingPathElement(path, dataMember);\n    }\n  } else if (dataSource instanceof federation_data_source_1.FederationDataSource) {\n    var query = dataSource.queries().filter(function (q) {\n      return isStartedWith(path, q.alias());\n    })[0];\n\n    if (!!query) {\n      dataMember = query.alias();\n      fieldPath = trimLeadingPathElement(path, dataMember);\n    }\n  } else if (dataSource instanceof mongodb_data_source_1.MongoDBDataSource) {\n    var query = dataSource.queries().filter(function (q) {\n      return isStartedWith(path, q._actualName());\n    })[0];\n\n    if (!!query) {\n      dataMember = query._actualName();\n      fieldPath = trimLeadingPathElement(path, dataMember);\n    }\n  }\n\n  return {\n    dataMember: dataMember,\n    fieldPath: fieldPath\n  };\n}\n\nexports.findDataMember = findDataMember;\n\nfunction getFirstDataMember(dataSource) {\n  if (dataSource instanceof sql_data_source_1.SqlDataSource && dataSource.queries().length > 0) {\n    return dataSource.queries()[0].name();\n  } else if (dataSource instanceof ef_data_source_1.EFDataSource && dataSource._tables().length > 0) {\n    return dataSource._tables()[0].dataMember();\n  } else if (dataSource instanceof federation_data_source_1.FederationDataSource && dataSource.queries().length > 0) {\n    return dataSource.queries()[0].alias();\n  } else if (dataSource instanceof mongodb_data_source_1.MongoDBDataSource && dataSource.queries().length > 0) {\n    return dataSource.queries()[0]._actualName();\n  } else if (dataSource instanceof object_data_source_1.ObjectDataSource) return undefined;\n\n  throw new Error();\n}\n\nexports.getFirstDataMember = getFirstDataMember;\n\nvar DataSourceBrowser = function () {\n  function DataSourceBrowser(_dataSources, isDesignMode, parameters, _serviceClient, isLoading) {\n    var _this = this;\n\n    if (isLoading === void 0) {\n      isLoading = ko.observable(false);\n    }\n\n    this._dataSources = _dataSources;\n    this.isDesignMode = isDesignMode;\n    this.parameters = parameters;\n    this._serviceClient = _serviceClient;\n    this.isLoading = isLoading;\n    this._disposables = [];\n    this._dynamicParametersValueCache = {};\n    this._dimensionValuesCache = {};\n    this._fieldsCache = {};\n\n    this.removeDataSource = function (dataSource) {\n      _this._dataSources.remove(dataSource);\n\n      _this.clearFieldsCache(dataSource.componentName());\n    };\n\n    if (isDesignMode()) {\n      this._subscribeDataSources();\n    }\n\n    this._disposables.push(this.isDesignMode.subscribe(function (isDesignMode) {\n      if (isDesignMode) {\n        _this._subscribeDataSources();\n      } else {\n        _this._unsubscribeDataSources();\n      }\n    }));\n  }\n\n  DataSourceBrowser.prototype._cacheNestedFields = function (path, field) {\n    var _this = this;\n\n    if (field.childNodes().length > 0 && !!field.childNodes()[0].dataMember()) {\n      var nestedPath = !!path ? path + '.' + field.dataMember() : field.dataMember();\n      this._fieldsCache[nestedPath] = _jquery_helpers_1.createJQueryDeferred().resolve(field.childNodes()).promise();\n      field.childNodes().forEach(function (member) {\n        return _this._cacheNestedFields(nestedPath, member);\n      });\n    }\n  };\n\n  DataSourceBrowser.prototype._findInFieldsCache = function (dataSourceName, dataMemberName, fieldName, constraint, separateGroupFields) {\n    var deferred = _jquery_helpers_1.createJQueryDeferred();\n\n    var result = {\n      path: '',\n      field: undefined\n    };\n    var keys = Object.keys(this._fieldsCache);\n    var fieldPath = dataMemberName ? [dataSourceName, dataMemberName].join('.') : dataSourceName;\n    var i = 0;\n    var findPromises = [];\n\n    while (!result.field && i < keys.length) {\n      var path = keys[i];\n\n      if (path === fieldPath || path.indexOf(fieldPath + '.') === 0) {\n        var a = function (notClosuredPath, notClosuredFieldPath) {\n          return function (fields) {\n            var filteredFields = fields.filter(isNonCollectionDataField);\n\n            for (var i_1 = 0; i_1 < filteredFields.length; i_1++) {\n              var field = filteredFields[i_1];\n              var foundField = field.dataMember() === fieldName && constraint(field) ? field : undefined;\n              var groupDataItems = field['groupDataItems'];\n\n              if ((!foundField || separateGroupFields) && !!groupDataItems && groupDataItems.length > 0) {\n                var foundGroupField = groupDataItems.filter(function (groupField) {\n                  return groupField.dataMember() === fieldName;\n                })[0];\n\n                if (foundGroupField) {\n                  foundField = separateGroupFields ? foundGroupField : field;\n                }\n              }\n\n              if (!!foundField) {\n                result.path = notClosuredPath.substr(notClosuredFieldPath.length).split('.').filter(function (item) {\n                  return !!item;\n                }).join('.');\n                result.field = foundField;\n                deferred.resolve(result);\n                break;\n              }\n            }\n          };\n        };\n\n        findPromises.push(this._fieldsCache[path].done(a(path, fieldPath)));\n      }\n\n      i++;\n    }\n\n    _jquery_helpers_1.jqueryWhenArray(findPromises).done(function () {\n      if (!result.field) {\n        deferred.resolve(result);\n      }\n    });\n\n    return deferred.promise();\n  };\n\n  DataSourceBrowser.prototype.getDimensionFilterItems = function (dashboardItem, dimensionDataMember, previousState, branch) {\n    var deferred = _jquery_helpers_1.createJQueryDeferred();\n\n    var result = deferred.promise();\n\n    if (!!dashboardItem && !!dimensionDataMember) {\n      this._serviceClient.peek().getDimensionFilterItems(dashboardItem, dimensionDataMember, previousState, branch).done(function (list) {\n        deferred.resolve(list);\n      }).fail(function () {\n        deferred.resolve([]);\n      });\n    } else {\n      deferred.resolve([]);\n    }\n\n    return result;\n  };\n\n  DataSourceBrowser.prototype.getDimensionFilterString = function (dashboardItem, dimensionDataMember, previousState) {\n    var deferred = _jquery_helpers_1.createJQueryDeferred();\n\n    var result = deferred.promise();\n\n    if (!!dashboardItem && !!dimensionDataMember) {\n      this._serviceClient.peek().getDimensionFilterString(dashboardItem, dimensionDataMember, previousState).done(function (filterString) {\n        deferred.resolve(filterString);\n      }).fail(function () {\n        deferred.resolve('');\n      });\n    } else {\n      deferred.resolve('');\n    }\n\n    return result;\n  };\n\n  DataSourceBrowser.prototype.getDataFieldsArray = function (dataSourceName, dataMember, fieldPath, filterDelegate) {\n    var _this = this;\n\n    if (filterDelegate === void 0) {\n      filterDelegate = function () {\n        return true;\n      };\n    }\n\n    var id = !!dataMember ? [dataSourceName, dataMember].join('.') : dataSourceName;\n    id = !!fieldPath ? [id, fieldPath].join('.') : id;\n    var dataSource = this.findDataSource(dataSourceName);\n\n    if (!dataSource) {\n      return _jquery_helpers_1.createJQueryDeferred().resolve([]).promise();\n    }\n\n    dataSource.calculatedFields().forEach(function (calcField) {\n      var expression = calcField.expression();\n      var fieldType = calcField.fieldType();\n      var name = calcField.name();\n    });\n\n    var result = _jquery_helpers_1.createJQueryDeferred();\n\n    var parentRequests = Object.keys(this._fieldsCache).filter(function (cachedKey) {\n      return id.indexOf(cachedKey) === 0;\n    }).map(function (cachedKey) {\n      return _this._fieldsCache[cachedKey];\n    });\n\n    if (parentRequests.length === 0) {\n      parentRequests = [_jquery_helpers_1.createJQueryDeferred().resolve().promise()];\n    }\n\n    _jquery_helpers_1.jqueryWhenArray(parentRequests).done(function () {\n      var cachedValue = _this._fieldsCache[id];\n\n      if (cachedValue) {\n        cachedValue.done(function (dataFields) {\n          result.resolve(dataFields.filter(filterDelegate));\n        });\n      } else {\n        if (!!dataSourceName && !!dataSource && !!_this._serviceClient) {\n          var valueToCache_1 = _jquery_helpers_1.createJQueryDeferred();\n\n          _this._fieldsCache[id] = valueToCache_1.promise();\n          setTimeout(function () {\n            _this._serviceClient.peek().getFieldList(dataSource, dataMember, fieldPath).done(function (list) {\n              var members = [];\n              (list || []).forEach(function (field) {\n                var dataField = new _data_field_1.DataField(field);\n                members.push(dataField);\n\n                _this._cacheNestedFields(id, dataField);\n              });\n\n              if (!fieldPath) {\n                members = members.sort(function (f1, f2) {\n                  return f1.displayName().localeCompare(f2.displayName());\n                });\n              }\n\n              valueToCache_1.resolve(members).done(function (dataFields) {\n                return result.resolve(dataFields.filter(filterDelegate));\n              });\n            }).fail(function () {\n              valueToCache_1.resolve([]).done(function (dataFields) {\n                result.resolve(dataFields);\n              });\n            });\n          }, 1);\n        } else {\n          result.resolve([]);\n        }\n      }\n    });\n\n    return result.promise();\n  };\n\n  DataSourceBrowser.prototype.isFolder = function (path) {\n    return !!this._fieldsCache[path];\n  };\n\n  DataSourceBrowser.prototype.findPathToFieldInTree = function (dataSourceName, dataMemberName, fieldName, constraint) {\n    var _this = this;\n\n    var deferred = _jquery_helpers_1.createJQueryDeferred();\n\n    this.getDataFieldsArray(dataSourceName, dataMemberName, '', isNonCollectionDataField).done(function () {\n      _this._findInFieldsCache(dataSourceName, dataMemberName, fieldName, constraint, false).done(function (info) {\n        return deferred.resolve(info.path);\n      });\n    });\n    return deferred.promise();\n  };\n\n  DataSourceBrowser.prototype.findDataField = function (dataSourceName, dataMemberName, fullFieldName, separateGroupFields) {\n    var _this = this;\n\n    if (separateGroupFields === void 0) {\n      separateGroupFields = false;\n    }\n\n    var deferred = _jquery_helpers_1.createJQueryDeferred();\n\n    var dataSource = this._dataSources().filter(function (ds) {\n      return ds.componentName() === dataSourceName;\n    })[0];\n\n    var info = {\n      path: '',\n      name: fullFieldName\n    };\n\n    if (dataSource instanceof object_data_source_1.ObjectDataSource || dataSource instanceof ef_data_source_1.EFDataSource) {\n      info = splitFullFieldName(fullFieldName);\n    }\n\n    this.getDataFieldsArray(dataSourceName, dataMemberName, info.path, isNonCollectionDataField).done(function () {\n      _this._findInFieldsCache(dataSourceName, dataMemberName, fullFieldName, function (field) {\n        return true;\n      }, separateGroupFields).done(function (info) {\n        return deferred.resolve(info.field);\n      });\n    });\n    return deferred.promise();\n  };\n\n  DataSourceBrowser.prototype.fuzzyFindFields = function (startPath, searchFor) {\n    var _this = this;\n\n    var deferred = _jquery_helpers_1.createJQueryDeferred(),\n        result = [],\n        findPromises = [];\n\n    var strContains = function (str, substr) {\n      return str.toLowerCase().indexOf(substr.toLowerCase()) !== -1;\n    };\n\n    Object.keys(this._fieldsCache).forEach(function (path) {\n      if (path === startPath || path.indexOf(startPath + '.') === 0) {\n        findPromises.push(_this._fieldsCache[path].done(function (fields) {\n          fields.filter(function (field) {\n            return isNonCollectionDataField;\n          }).filter(function (field) {\n            return strContains(field.dataMember(), searchFor) || strContains(field.displayName(), searchFor);\n          }).forEach(function (field) {\n            return result.push({\n              path: path,\n              field: field\n            });\n          });\n        }));\n      }\n    });\n\n    _jquery_helpers_1.jqueryWhenArray(findPromises).done(function () {\n      return deferred.resolve(result);\n    });\n\n    return deferred.promise();\n  };\n\n  DataSourceBrowser.prototype.findDataSource = function (dsName) {\n    return this._dataSources().filter(function (ds) {\n      return ds.componentName() === dsName;\n    })[0];\n  };\n\n  DataSourceBrowser.prototype.dataMembersSupported = function (dsc) {\n    var dataSource = dsc && this.findDataSource(dsc.dataSource()) || null;\n    return dataSource && dataSource.supportDataMembers;\n  };\n\n  DataSourceBrowser.prototype.getDataFields = function (dsc) {\n    var result = ko.observableArray();\n\n    if (dsc) {\n      this.getDataFieldsArray(dsc.dataSource(), dsc.dataMember(), '', isNonCollectionDataField).done(function (members) {\n        result(members.map(function (member) {\n          return member.displayName();\n        }));\n      });\n    }\n\n    return result;\n  };\n\n  DataSourceBrowser.prototype.clearFieldsCache = function (path) {\n    var _this = this;\n\n    Object.keys(this._fieldsCache).forEach(function (key) {\n      if (key === path || key.indexOf(path + '.') === 0) {\n        delete _this._fieldsCache[key];\n      }\n    });\n  };\n\n  DataSourceBrowser.prototype.clearDynamicParametersValueCache = function () {\n    this._dynamicParametersValueCache = {};\n  };\n\n  DataSourceBrowser.prototype.initDataSource = function (dataSource) {\n    var _this = this;\n\n    if (dataSource instanceof sql_data_source_1.SqlDataSource) {\n      this._fieldsCache[dataSource.componentName()] = _jquery_helpers_1.createJQueryDeferred().resolve(dataSource.queries().map(function (query) {\n        var queryField = new _data_field_1.DataField({\n          'DataMember': query.name(),\n          'Name': query.name(),\n          'DisplayName': query.name()\n        });\n        queryField.hasCalculatedFields = true;\n        queryField.isDataSourceNode(true);\n        return queryField;\n      })).promise();\n    } else if (dataSource instanceof ef_data_source_1.EFDataSource) {\n      this.isLoading(true);\n      this.getDataFieldsArray(dataSource.componentName(), '', '', isNonCollectionDataField).done(function (members) {\n        dataSource._tables(members);\n\n        _this.isLoading(false);\n      });\n    }\n  };\n\n  DataSourceBrowser.prototype.getParameterValues = function (parameterType, dynamicListLookUpSettings) {\n    var _this = this;\n\n    var dsc = dynamicListLookUpSettings;\n    var valueMember = dynamicListLookUpSettings.valueMemberName();\n    var displayMember = dynamicListLookUpSettings.displayMemberName() || valueMember;\n    var sortOrder = dynamicListLookUpSettings.sortOrder();\n    var sortByMember = dynamicListLookUpSettings.sortByMember();\n    var selectedValues = '';\n\n    if (this.parameters) {\n      selectedValues = this.parameters.peek().map(function (p) {\n        return {\n          name: p.name(),\n          value: _date_utils_1.toStringArray(p._actualValue.peek())\n        };\n      }).sort(function (p1, p2) {\n        return p1.name.localeCompare(p2.name);\n      }).reduce(function (acc, param) {\n        var value = param.name + \":\" + (param.value instanceof Array ? param.value.slice().sort().join('|') : param.value);\n        return !!acc ? acc + \",\" + value : value;\n      }, '');\n    }\n\n    var key = [parameterType, dsc.dataSource(), dsc.dataMember(), valueMember, displayMember, sortOrder, sortByMember, selectedValues].join('.');\n    var parameterValues = this._dynamicParametersValueCache[key];\n\n    if (!parameterValues) {\n      parameterValues = ko.observableArray();\n\n      if (!!valueMember && !!displayMember) {\n        this._dynamicParametersValueCache[key] = parameterValues;\n\n        this._serviceClient.peek().getParameterValues(dsc.dataSource(), this.findDataSource(dsc.dataSource()), dsc.dataMember(), valueMember, displayMember, sortOrder, sortByMember, parameterType).done(function (result) {\n          parameterValues(result ? result.map(function (value) {\n            return {\n              Value: _date_utils_1.tryConvertToDateTime(value.Value),\n              DisplayText: value.DisplayText\n            };\n          }) : undefined);\n          _this.dynamicLookUpValuesLoaded && _this.dynamicLookUpValuesLoaded(dynamicListLookUpSettings);\n        });\n      }\n    }\n\n    return parameterValues;\n  };\n\n  DataSourceBrowser.prototype.getDimensionUniqueValues = function (dataSourceName, dataMember, dimension) {\n    var def = _jquery_helpers_1.createJQueryDeferred();\n\n    var key = 'DataSource=' + dataSourceName + 'DataMember=' + dataMember + 'Dimension=' + JSON.stringify(new analytics_utils_1.ModelSerializer({\n      useRefs: false\n    }).serialize(dimension));\n    var dimensionValues = this._dimensionValuesCache[key];\n\n    if (!dimensionValues) {\n      dimensionValues = ko.observableArray();\n      var dataSource = this.findDataSource(dataSourceName);\n\n      if (!!dataSource && !!dimension) {\n        this._dimensionValuesCache[key] = dimensionValues;\n\n        this._serviceClient.peek().getDimensionUniqueValues(dataSource, dataMember, dimension).done(function (result) {\n          if (Array.isArray(result)) result = result.map(function (val) {\n            return _date_utils_1.tryConvertToDateTime(val);\n          });\n          dimensionValues(result);\n          def.resolve(dimensionValues());\n        });\n      }\n    } else {\n      def.resolve(dimensionValues());\n    }\n\n    return def.promise();\n  };\n\n  DataSourceBrowser.prototype.splitFullPath = function (fullPath) {\n    if (fullPath === void 0) {\n      fullPath = '';\n    }\n\n    var dataSource = '';\n\n    var dataSourceObj = this._dataSources().filter(function (ds) {\n      return isStartedWith(fullPath, ds.componentName());\n    })[0];\n\n    if (!!dataSourceObj) {\n      dataSource = dataSourceObj.componentName();\n    }\n\n    var _a = findDataMember(dataSourceObj, trimLeadingPathElement(fullPath, dataSource)),\n        dataMember = _a.dataMember,\n        fieldPath = _a.fieldPath;\n\n    return {\n      dataSource: dataSource,\n      dataMember: dataMember,\n      fieldPath: fieldPath\n    };\n  };\n\n  DataSourceBrowser.prototype._subscribeDataSources = function () {\n    var _this = this;\n\n    this._dataSources().forEach(function (dataSource) {\n      _this.initDataSource(dataSource);\n    });\n\n    this._dataSourcesSubscription = _knockout_utils_1.subscribeArrayChange(this._dataSources, {\n      added: function (ds) {\n        return _this.initDataSource(ds);\n      },\n      deleted: function (ds) {\n        return _this.clearFieldsCache(ds.componentName());\n      }\n    });\n\n    this._disposables.push(this._dataSourcesSubscription);\n  };\n\n  DataSourceBrowser.prototype._unsubscribeDataSources = function () {\n    var _this = this;\n\n    if (this._dataSourcesSubscription) {\n      this._disposables.splice(this._disposables.indexOf(this._dataSourcesSubscription), 1);\n\n      this._dataSourcesSubscription.dispose();\n\n      this._dataSourcesSubscription = undefined;\n\n      this._dataSources().forEach(function (dataSource) {\n        _this.clearFieldsCache(dataSource.componentName());\n      });\n    }\n  };\n\n  DataSourceBrowser.prototype.dispose = function () {\n    this.dynamicLookUpValuesLoaded = null;\n\n    this._disposables.forEach(function (d) {\n      d.dispose();\n    });\n  };\n\n  return DataSourceBrowser;\n}();\n\nexports.DataSourceBrowser = DataSourceBrowser;\n\nfunction isNonCollectionDataField(dataField) {\n  if (!dataField) return;\n  var nodeType = ko.unwrap(dataField.nodeType);\n  var childNodes = ko.unwrap(dataField.childNodes);\n  var isList = dataField.isList && ko.unwrap(dataField.isList);\n  return !(nodeType === 'DataMember' && isList);\n}\n\nexports.isNonCollectionDataField = isNonCollectionDataField;\n\nfunction getDataFields(fieldsNames, dataSource, dataMember, dataFieldProvider) {\n  var deferred = _jquery_helpers_1.createJQueryDeferred();\n\n  var promises = fieldsNames.map(function (field) {\n    return dataFieldProvider.findDataField(dataSource, dataMember, field, true);\n  });\n\n  _jquery_helpers_1.jqueryWhen.apply(void 0, promises).done(function () {\n    var fields = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      fields[_i] = arguments[_i];\n    }\n\n    deferred.resolve(fields.filter(function (field) {\n      return !!field;\n    }));\n  });\n\n  return deferred.promise();\n}\n\nexports.getDataFields = getDataFields;","map":{"version":3,"sources":["/Users/krunalpatel/Downloads/React-Firebase-Auth-master 3/node_modules/devexpress-dashboard/common/_data-source-browser.js"],"names":["Object","defineProperty","exports","value","getDataFields","isNonCollectionDataField","DataSourceBrowser","getFirstDataMember","findDataMember","isStartedWith","splitFullFieldName","trimLeadingPathElement","patchCalcFieldPath","analytics_data_1","require","analytics_utils_1","ko","_jquery_helpers_1","ef_data_source_1","federation_data_source_1","mongodb_data_source_1","object_data_source_1","sql_data_source_1","_data_field_1","_date_utils_1","_knockout_utils_1","dataSource","calculatedField","fieldName","indexOf","split","SqlDataSource","query","queries","filter","name","dataMember","TableQuery","table","tables","alias","path","element","str","substring","length","fullFieldName","parts","slice","join","fieldPath","q","EFDataSource","_tables","t","FederationDataSource","MongoDBDataSource","_actualName","ObjectDataSource","undefined","Error","_dataSources","isDesignMode","parameters","_serviceClient","isLoading","_this","observable","_disposables","_dynamicParametersValueCache","_dimensionValuesCache","_fieldsCache","removeDataSource","remove","clearFieldsCache","componentName","_subscribeDataSources","push","subscribe","_unsubscribeDataSources","prototype","_cacheNestedFields","field","childNodes","nestedPath","createJQueryDeferred","resolve","promise","forEach","member","_findInFieldsCache","dataSourceName","dataMemberName","constraint","separateGroupFields","deferred","result","keys","i","findPromises","a","notClosuredPath","notClosuredFieldPath","fields","filteredFields","i_1","foundField","groupDataItems","foundGroupField","groupField","substr","item","done","jqueryWhenArray","getDimensionFilterItems","dashboardItem","dimensionDataMember","previousState","branch","peek","list","fail","getDimensionFilterString","filterString","getDataFieldsArray","filterDelegate","id","findDataSource","calculatedFields","calcField","expression","fieldType","parentRequests","cachedKey","map","cachedValue","dataFields","valueToCache_1","setTimeout","getFieldList","members","dataField","DataField","sort","f1","f2","displayName","localeCompare","isFolder","findPathToFieldInTree","info","findDataField","ds","fuzzyFindFields","startPath","searchFor","strContains","toLowerCase","dsName","dataMembersSupported","dsc","supportDataMembers","observableArray","key","clearDynamicParametersValueCache","initDataSource","queryField","hasCalculatedFields","isDataSourceNode","getParameterValues","parameterType","dynamicListLookUpSettings","valueMember","valueMemberName","displayMember","displayMemberName","sortOrder","sortByMember","selectedValues","p","toStringArray","_actualValue","p1","p2","reduce","acc","param","Array","parameterValues","Value","tryConvertToDateTime","DisplayText","dynamicLookUpValuesLoaded","getDimensionUniqueValues","dimension","def","JSON","stringify","ModelSerializer","useRefs","serialize","dimensionValues","isArray","val","splitFullPath","fullPath","dataSourceObj","_a","_dataSourcesSubscription","subscribeArrayChange","added","deleted","splice","dispose","d","nodeType","unwrap","isList","fieldsNames","dataFieldProvider","promises","jqueryWhen","apply","_i","arguments"],"mappings":"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","sourcesContent":["/**\r\n* DevExpress Dashboard (_data-source-browser.js)\r\n* Version:  22.1.3\r\n* Build date: Jun 13, 2022\r\n* Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n* License: https://www.devexpress.com/Support/EULAs/universal.xml\r\n*/\r\n\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.getDataFields = exports.isNonCollectionDataField = exports.DataSourceBrowser = exports.getFirstDataMember = exports.findDataMember = exports.isStartedWith = exports.splitFullFieldName = exports.trimLeadingPathElement = exports.patchCalcFieldPath = void 0;\nvar analytics_data_1 = require(\"@devexpress/analytics-core/analytics-data\");\nvar analytics_utils_1 = require(\"@devexpress/analytics-core/analytics-utils\");\nvar ko = require(\"knockout\");\nvar _jquery_helpers_1 = require(\"../data/_jquery-helpers\");\nvar ef_data_source_1 = require(\"../model/data-sources/ef-data-source\");\nvar federation_data_source_1 = require(\"../model/data-sources/federation-data-source\");\nvar mongodb_data_source_1 = require(\"../model/data-sources/mongodb-data-source\");\nvar object_data_source_1 = require(\"../model/data-sources/object-data-source\");\nvar sql_data_source_1 = require(\"../model/data-sources/sql-data-source\");\nvar _data_field_1 = require(\"../model/data-sources/_data-field\");\nvar _date_utils_1 = require(\"../model/internal/_date-utils\");\nvar _knockout_utils_1 = require(\"../model/internal/_knockout-utils\");\nfunction patchCalcFieldPath(dataSource, calculatedField, fieldName) {\n    if (fieldName.indexOf('Parameters.Parameters.') === 0) {\n        return 'Parameters.' + fieldName.split('.')[2];\n    }\n    if (dataSource instanceof sql_data_source_1.SqlDataSource) {\n        var query = dataSource.queries().filter(function (query) { return query.name() === calculatedField.dataMember(); })[0];\n        if (!!query && query instanceof analytics_data_1.TableQuery) {\n            var table = query.tables().filter(function (table) { return fieldName.indexOf((table.alias() || table.name()) + '.') === 0; })[0];\n            if (!!table) {\n                return trimLeadingPathElement(fieldName, table.alias() || table.name());\n            }\n        }\n    }\n    return fieldName;\n}\nexports.patchCalcFieldPath = patchCalcFieldPath;\nfunction trimLeadingPathElement(path, element) {\n    if (path === void 0) { path = ''; }\n    var str = path;\n    if (path.indexOf(element) === 0) {\n        str = path.substring(element.length);\n    }\n    return str[0] === '.' ? str.substring(1) : str;\n}\nexports.trimLeadingPathElement = trimLeadingPathElement;\nfunction splitFullFieldName(fullFieldName) {\n    var parts = fullFieldName.split('.');\n    return {\n        path: parts.slice(0, parts.length - 1).join('.'),\n        name: parts[parts.length - 1] || ''\n    };\n}\nexports.splitFullFieldName = splitFullFieldName;\nfunction isStartedWith(path, value) {\n    return path.indexOf(value) === 0 && (path.length === value.length || path[value.length] === '.');\n}\nexports.isStartedWith = isStartedWith;\nfunction findDataMember(dataSource, path) {\n    var dataMember = '';\n    var fieldPath = path;\n    if (dataSource instanceof sql_data_source_1.SqlDataSource) {\n        var query = dataSource.queries().filter(function (q) { return isStartedWith(path, q.name()); })[0];\n        if (!!query) {\n            dataMember = query.name();\n            fieldPath = trimLeadingPathElement(path, dataMember);\n        }\n    }\n    else if (dataSource instanceof ef_data_source_1.EFDataSource) {\n        var table = dataSource._tables().filter(function (t) { return isStartedWith(path, t.dataMember()); })[0];\n        if (!!table) {\n            dataMember = table.dataMember();\n            fieldPath = trimLeadingPathElement(path, dataMember);\n        }\n    }\n    else if (dataSource instanceof federation_data_source_1.FederationDataSource) {\n        var query = dataSource.queries().filter(function (q) { return isStartedWith(path, q.alias()); })[0];\n        if (!!query) {\n            dataMember = query.alias();\n            fieldPath = trimLeadingPathElement(path, dataMember);\n        }\n    }\n    else if (dataSource instanceof mongodb_data_source_1.MongoDBDataSource) {\n        var query = dataSource.queries().filter(function (q) { return isStartedWith(path, q._actualName()); })[0];\n        if (!!query) {\n            dataMember = query._actualName();\n            fieldPath = trimLeadingPathElement(path, dataMember);\n        }\n    }\n    return {\n        dataMember: dataMember,\n        fieldPath: fieldPath\n    };\n}\nexports.findDataMember = findDataMember;\nfunction getFirstDataMember(dataSource) {\n    if (dataSource instanceof sql_data_source_1.SqlDataSource && dataSource.queries().length > 0) {\n        return dataSource.queries()[0].name();\n    }\n    else if (dataSource instanceof ef_data_source_1.EFDataSource && dataSource._tables().length > 0) {\n        return dataSource._tables()[0].dataMember();\n    }\n    else if (dataSource instanceof federation_data_source_1.FederationDataSource && dataSource.queries().length > 0) {\n        return dataSource.queries()[0].alias();\n    }\n    else if (dataSource instanceof mongodb_data_source_1.MongoDBDataSource && dataSource.queries().length > 0) {\n        return dataSource.queries()[0]._actualName();\n    }\n    else if (dataSource instanceof object_data_source_1.ObjectDataSource)\n        return undefined;\n    throw new Error();\n}\nexports.getFirstDataMember = getFirstDataMember;\nvar DataSourceBrowser = (function () {\n    function DataSourceBrowser(_dataSources, isDesignMode, parameters, _serviceClient, isLoading) {\n        var _this = this;\n        if (isLoading === void 0) { isLoading = ko.observable(false); }\n        this._dataSources = _dataSources;\n        this.isDesignMode = isDesignMode;\n        this.parameters = parameters;\n        this._serviceClient = _serviceClient;\n        this.isLoading = isLoading;\n        this._disposables = [];\n        this._dynamicParametersValueCache = {};\n        this._dimensionValuesCache = {};\n        this._fieldsCache = {};\n        this.removeDataSource = function (dataSource) {\n            _this._dataSources.remove(dataSource);\n            _this.clearFieldsCache(dataSource.componentName());\n        };\n        if (isDesignMode()) {\n            this._subscribeDataSources();\n        }\n        this._disposables.push(this.isDesignMode.subscribe(function (isDesignMode) {\n            if (isDesignMode) {\n                _this._subscribeDataSources();\n            }\n            else {\n                _this._unsubscribeDataSources();\n            }\n        }));\n    }\n    DataSourceBrowser.prototype._cacheNestedFields = function (path, field) {\n        var _this = this;\n        if (field.childNodes().length > 0 && !!field.childNodes()[0].dataMember()) {\n            var nestedPath = !!path ? path + '.' + field.dataMember() : field.dataMember();\n            this._fieldsCache[nestedPath] = _jquery_helpers_1.createJQueryDeferred().resolve(field.childNodes()).promise();\n            field.childNodes().forEach(function (member) { return _this._cacheNestedFields(nestedPath, member); });\n        }\n    };\n    DataSourceBrowser.prototype._findInFieldsCache = function (dataSourceName, dataMemberName, fieldName, constraint, separateGroupFields) {\n        var deferred = _jquery_helpers_1.createJQueryDeferred();\n        var result = { path: '', field: undefined };\n        var keys = Object.keys(this._fieldsCache);\n        var fieldPath = dataMemberName ? [dataSourceName, dataMemberName].join('.') : dataSourceName;\n        var i = 0;\n        var findPromises = [];\n        while (!result.field && i < keys.length) {\n            var path = keys[i];\n            if (path === fieldPath || path.indexOf(fieldPath + '.') === 0) {\n                var a = function (notClosuredPath, notClosuredFieldPath) {\n                    return function (fields) {\n                        var filteredFields = fields.filter(isNonCollectionDataField);\n                        for (var i_1 = 0; i_1 < filteredFields.length; i_1++) {\n                            var field = filteredFields[i_1];\n                            var foundField = field.dataMember() === fieldName && constraint(field) ? field : undefined;\n                            var groupDataItems = field['groupDataItems'];\n                            if ((!foundField || separateGroupFields) && !!groupDataItems && groupDataItems.length > 0) {\n                                var foundGroupField = groupDataItems.filter(function (groupField) { return groupField.dataMember() === fieldName; })[0];\n                                if (foundGroupField) {\n                                    foundField = separateGroupFields ? foundGroupField : field;\n                                }\n                            }\n                            if (!!foundField) {\n                                result.path = notClosuredPath.substr(notClosuredFieldPath.length).split('.').filter(function (item) { return !!item; }).join('.');\n                                result.field = foundField;\n                                deferred.resolve(result);\n                                break;\n                            }\n                        }\n                    };\n                };\n                findPromises.push(this._fieldsCache[path].done(a(path, fieldPath)));\n            }\n            i++;\n        }\n        _jquery_helpers_1.jqueryWhenArray(findPromises).done(function () {\n            if (!result.field) {\n                deferred.resolve(result);\n            }\n        });\n        return deferred.promise();\n    };\n    DataSourceBrowser.prototype.getDimensionFilterItems = function (dashboardItem, dimensionDataMember, previousState, branch) {\n        var deferred = _jquery_helpers_1.createJQueryDeferred();\n        var result = deferred.promise();\n        if (!!dashboardItem && !!dimensionDataMember) {\n            this._serviceClient.peek().getDimensionFilterItems(dashboardItem, dimensionDataMember, previousState, branch).done(function (list) {\n                deferred.resolve(list);\n            }).fail(function () {\n                deferred.resolve([]);\n            });\n        }\n        else {\n            deferred.resolve([]);\n        }\n        return result;\n    };\n    DataSourceBrowser.prototype.getDimensionFilterString = function (dashboardItem, dimensionDataMember, previousState) {\n        var deferred = _jquery_helpers_1.createJQueryDeferred();\n        var result = deferred.promise();\n        if (!!dashboardItem && !!dimensionDataMember) {\n            this._serviceClient.peek().getDimensionFilterString(dashboardItem, dimensionDataMember, previousState).done(function (filterString) {\n                deferred.resolve(filterString);\n            }).fail(function () {\n                deferred.resolve('');\n            });\n        }\n        else {\n            deferred.resolve('');\n        }\n        return result;\n    };\n    DataSourceBrowser.prototype.getDataFieldsArray = function (dataSourceName, dataMember, fieldPath, filterDelegate) {\n        var _this = this;\n        if (filterDelegate === void 0) { filterDelegate = function () { return true; }; }\n        var id = !!dataMember ? [dataSourceName, dataMember].join('.') : dataSourceName;\n        id = !!fieldPath ? [id, fieldPath].join('.') : id;\n        var dataSource = this.findDataSource(dataSourceName);\n        if (!dataSource) {\n            return _jquery_helpers_1.createJQueryDeferred().resolve([]).promise();\n        }\n        dataSource.calculatedFields().forEach(function (calcField) {\n            var expression = calcField.expression();\n            var fieldType = calcField.fieldType();\n            var name = calcField.name();\n        });\n        var result = _jquery_helpers_1.createJQueryDeferred();\n        var parentRequests = Object.keys(this._fieldsCache)\n            .filter(function (cachedKey) { return id.indexOf(cachedKey) === 0; })\n            .map(function (cachedKey) { return _this._fieldsCache[cachedKey]; });\n        if (parentRequests.length === 0) {\n            parentRequests = [_jquery_helpers_1.createJQueryDeferred().resolve().promise()];\n        }\n        _jquery_helpers_1.jqueryWhenArray(parentRequests).done(function () {\n            var cachedValue = _this._fieldsCache[id];\n            if (cachedValue) {\n                cachedValue.done(function (dataFields) {\n                    result.resolve(dataFields.filter(filterDelegate));\n                });\n            }\n            else {\n                if (!!dataSourceName && !!dataSource && !!_this._serviceClient) {\n                    var valueToCache_1 = _jquery_helpers_1.createJQueryDeferred();\n                    _this._fieldsCache[id] = valueToCache_1.promise();\n                    setTimeout(function () {\n                        _this._serviceClient.peek().getFieldList(dataSource, dataMember, fieldPath).done(function (list) {\n                            var members = [];\n                            (list || []).forEach(function (field) {\n                                var dataField = new _data_field_1.DataField(field);\n                                members.push(dataField);\n                                _this._cacheNestedFields(id, dataField);\n                            });\n                            if (!fieldPath) {\n                                members = members\n                                    .sort(function (f1, f2) { return f1.displayName().localeCompare(f2.displayName()); });\n                            }\n                            valueToCache_1\n                                .resolve(members)\n                                .done(function (dataFields) { return result.resolve(dataFields.filter(filterDelegate)); });\n                        }).fail(function () {\n                            valueToCache_1\n                                .resolve([])\n                                .done(function (dataFields) {\n                                result.resolve(dataFields);\n                            });\n                        });\n                    }, 1);\n                }\n                else {\n                    result.resolve([]);\n                }\n            }\n        });\n        return result.promise();\n    };\n    DataSourceBrowser.prototype.isFolder = function (path) {\n        return !!this._fieldsCache[path];\n    };\n    DataSourceBrowser.prototype.findPathToFieldInTree = function (dataSourceName, dataMemberName, fieldName, constraint) {\n        var _this = this;\n        var deferred = _jquery_helpers_1.createJQueryDeferred();\n        this.getDataFieldsArray(dataSourceName, dataMemberName, '', isNonCollectionDataField).done(function () {\n            _this._findInFieldsCache(dataSourceName, dataMemberName, fieldName, constraint, false).done(function (info) { return deferred.resolve(info.path); });\n        });\n        return deferred.promise();\n    };\n    DataSourceBrowser.prototype.findDataField = function (dataSourceName, dataMemberName, fullFieldName, separateGroupFields) {\n        var _this = this;\n        if (separateGroupFields === void 0) { separateGroupFields = false; }\n        var deferred = _jquery_helpers_1.createJQueryDeferred();\n        var dataSource = this._dataSources().filter(function (ds) { return ds.componentName() === dataSourceName; })[0];\n        var info = {\n            path: '',\n            name: fullFieldName\n        };\n        if (dataSource instanceof object_data_source_1.ObjectDataSource || dataSource instanceof ef_data_source_1.EFDataSource) {\n            info = splitFullFieldName(fullFieldName);\n        }\n        this.getDataFieldsArray(dataSourceName, dataMemberName, info.path, isNonCollectionDataField).done(function () {\n            _this._findInFieldsCache(dataSourceName, dataMemberName, fullFieldName, function (field) { return true; }, separateGroupFields).done(function (info) { return deferred.resolve(info.field); });\n        });\n        return deferred.promise();\n    };\n    DataSourceBrowser.prototype.fuzzyFindFields = function (startPath, searchFor) {\n        var _this = this;\n        var deferred = _jquery_helpers_1.createJQueryDeferred(), result = [], findPromises = [];\n        var strContains = function (str, substr) { return str.toLowerCase().indexOf(substr.toLowerCase()) !== -1; };\n        Object.keys(this._fieldsCache).forEach(function (path) {\n            if (path === startPath || path.indexOf(startPath + '.') === 0) {\n                findPromises.push(_this._fieldsCache[path].done(function (fields) {\n                    fields\n                        .filter(function (field) { return isNonCollectionDataField; })\n                        .filter(function (field) { return strContains(field.dataMember(), searchFor) || strContains(field.displayName(), searchFor); })\n                        .forEach(function (field) { return result.push({ path: path, field: field }); });\n                }));\n            }\n        });\n        _jquery_helpers_1.jqueryWhenArray(findPromises).done(function () { return deferred.resolve(result); });\n        return deferred.promise();\n    };\n    DataSourceBrowser.prototype.findDataSource = function (dsName) {\n        return this._dataSources().filter(function (ds) { return ds.componentName() === dsName; })[0];\n    };\n    DataSourceBrowser.prototype.dataMembersSupported = function (dsc) {\n        var dataSource = dsc && this.findDataSource(dsc.dataSource()) || null;\n        return dataSource && dataSource.supportDataMembers;\n    };\n    DataSourceBrowser.prototype.getDataFields = function (dsc) {\n        var result = ko.observableArray();\n        if (dsc) {\n            this.getDataFieldsArray(dsc.dataSource(), dsc.dataMember(), '', isNonCollectionDataField).done(function (members) {\n                result(members.map(function (member) { return member.displayName(); }));\n            });\n        }\n        return result;\n    };\n    DataSourceBrowser.prototype.clearFieldsCache = function (path) {\n        var _this = this;\n        Object.keys(this._fieldsCache).forEach(function (key) {\n            if (key === path || key.indexOf(path + '.') === 0) {\n                delete _this._fieldsCache[key];\n            }\n        });\n    };\n    DataSourceBrowser.prototype.clearDynamicParametersValueCache = function () {\n        this._dynamicParametersValueCache = {};\n    };\n    DataSourceBrowser.prototype.initDataSource = function (dataSource) {\n        var _this = this;\n        if (dataSource instanceof sql_data_source_1.SqlDataSource) {\n            this._fieldsCache[dataSource.componentName()] = _jquery_helpers_1.createJQueryDeferred().resolve(dataSource.queries().map(function (query) {\n                var queryField = new _data_field_1.DataField({ 'DataMember': query.name(), 'Name': query.name(), 'DisplayName': query.name() });\n                queryField.hasCalculatedFields = true;\n                queryField.isDataSourceNode(true);\n                return queryField;\n            })).promise();\n        }\n        else if (dataSource instanceof ef_data_source_1.EFDataSource) {\n            this.isLoading(true);\n            this.getDataFieldsArray(dataSource.componentName(), '', '', isNonCollectionDataField).done(function (members) {\n                dataSource._tables(members);\n                _this.isLoading(false);\n            });\n        }\n    };\n    DataSourceBrowser.prototype.getParameterValues = function (parameterType, dynamicListLookUpSettings) {\n        var _this = this;\n        var dsc = dynamicListLookUpSettings;\n        var valueMember = dynamicListLookUpSettings.valueMemberName();\n        var displayMember = dynamicListLookUpSettings.displayMemberName() || valueMember;\n        var sortOrder = dynamicListLookUpSettings.sortOrder();\n        var sortByMember = dynamicListLookUpSettings.sortByMember();\n        var selectedValues = '';\n        if (this.parameters) {\n            selectedValues = this.parameters.peek()\n                .map(function (p) {\n                return {\n                    name: p.name(),\n                    value: _date_utils_1.toStringArray(p._actualValue.peek())\n                };\n            })\n                .sort(function (p1, p2) { return p1.name.localeCompare(p2.name); })\n                .reduce(function (acc, param) {\n                var value = param.name + \":\" + (param.value instanceof Array ? param.value.slice().sort().join('|') : param.value);\n                return !!acc ? acc + \",\" + value : value;\n            }, '');\n        }\n        var key = [parameterType, dsc.dataSource(), dsc.dataMember(), valueMember, displayMember, sortOrder, sortByMember, selectedValues].join('.');\n        var parameterValues = this._dynamicParametersValueCache[key];\n        if (!parameterValues) {\n            parameterValues = ko.observableArray();\n            if (!!valueMember && !!displayMember) {\n                this._dynamicParametersValueCache[key] = parameterValues;\n                this._serviceClient.peek().getParameterValues(dsc.dataSource(), this.findDataSource(dsc.dataSource()), dsc.dataMember(), valueMember, displayMember, sortOrder, sortByMember, parameterType)\n                    .done(function (result) {\n                    parameterValues(result ? result.map(function (value) { return ({\n                        Value: _date_utils_1.tryConvertToDateTime(value.Value),\n                        DisplayText: value.DisplayText\n                    }); }) : undefined);\n                    _this.dynamicLookUpValuesLoaded && _this.dynamicLookUpValuesLoaded(dynamicListLookUpSettings);\n                });\n            }\n        }\n        return parameterValues;\n    };\n    DataSourceBrowser.prototype.getDimensionUniqueValues = function (dataSourceName, dataMember, dimension) {\n        var def = _jquery_helpers_1.createJQueryDeferred();\n        var key = 'DataSource=' + dataSourceName\n            + 'DataMember=' + dataMember\n            + 'Dimension=' + JSON.stringify(new analytics_utils_1.ModelSerializer({ useRefs: false }).serialize(dimension));\n        var dimensionValues = this._dimensionValuesCache[key];\n        if (!dimensionValues) {\n            dimensionValues = ko.observableArray();\n            var dataSource = this.findDataSource(dataSourceName);\n            if (!!dataSource && !!dimension) {\n                this._dimensionValuesCache[key] = dimensionValues;\n                this._serviceClient.peek().getDimensionUniqueValues(dataSource, dataMember, dimension)\n                    .done(function (result) {\n                    if (Array.isArray(result))\n                        result = result.map(function (val) { return _date_utils_1.tryConvertToDateTime(val); });\n                    dimensionValues(result);\n                    def.resolve(dimensionValues());\n                });\n            }\n        }\n        else {\n            def.resolve(dimensionValues());\n        }\n        return def.promise();\n    };\n    DataSourceBrowser.prototype.splitFullPath = function (fullPath) {\n        if (fullPath === void 0) { fullPath = ''; }\n        var dataSource = '';\n        var dataSourceObj = this._dataSources().filter(function (ds) { return isStartedWith(fullPath, ds.componentName()); })[0];\n        if (!!dataSourceObj) {\n            dataSource = dataSourceObj.componentName();\n        }\n        var _a = findDataMember(dataSourceObj, trimLeadingPathElement(fullPath, dataSource)), dataMember = _a.dataMember, fieldPath = _a.fieldPath;\n        return {\n            dataSource: dataSource,\n            dataMember: dataMember,\n            fieldPath: fieldPath\n        };\n    };\n    DataSourceBrowser.prototype._subscribeDataSources = function () {\n        var _this = this;\n        this._dataSources().forEach(function (dataSource) {\n            _this.initDataSource(dataSource);\n        });\n        this._dataSourcesSubscription = _knockout_utils_1.subscribeArrayChange(this._dataSources, {\n            added: function (ds) { return _this.initDataSource(ds); },\n            deleted: function (ds) { return _this.clearFieldsCache(ds.componentName()); }\n        });\n        this._disposables.push(this._dataSourcesSubscription);\n    };\n    DataSourceBrowser.prototype._unsubscribeDataSources = function () {\n        var _this = this;\n        if (this._dataSourcesSubscription) {\n            this._disposables.splice(this._disposables.indexOf(this._dataSourcesSubscription), 1);\n            this._dataSourcesSubscription.dispose();\n            this._dataSourcesSubscription = undefined;\n            this._dataSources().forEach(function (dataSource) {\n                _this.clearFieldsCache(dataSource.componentName());\n            });\n        }\n    };\n    DataSourceBrowser.prototype.dispose = function () {\n        this.dynamicLookUpValuesLoaded = null;\n        this._disposables.forEach(function (d) {\n            d.dispose();\n        });\n    };\n    return DataSourceBrowser;\n}());\nexports.DataSourceBrowser = DataSourceBrowser;\nfunction isNonCollectionDataField(dataField) {\n    if (!dataField)\n        return;\n    var nodeType = ko.unwrap(dataField.nodeType);\n    var childNodes = ko.unwrap(dataField.childNodes);\n    var isList = dataField.isList && ko.unwrap(dataField.isList);\n    return !(nodeType === 'DataMember' && isList);\n}\nexports.isNonCollectionDataField = isNonCollectionDataField;\nfunction getDataFields(fieldsNames, dataSource, dataMember, dataFieldProvider) {\n    var deferred = _jquery_helpers_1.createJQueryDeferred();\n    var promises = fieldsNames.map(function (field) {\n        return dataFieldProvider.findDataField(dataSource, dataMember, field, true);\n    });\n    _jquery_helpers_1.jqueryWhen.apply(void 0, promises).done(function () {\n        var fields = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            fields[_i] = arguments[_i];\n        }\n        deferred.resolve(fields.filter(function (field) { return !!field; }));\n    });\n    return deferred.promise();\n}\nexports.getDataFields = getDataFields;\n"]},"metadata":{},"sourceType":"script"}