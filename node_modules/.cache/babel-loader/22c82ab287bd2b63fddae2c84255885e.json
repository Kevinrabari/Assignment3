{"ast":null,"code":"/**\r\n * DevExtreme (esm/ui/html_editor/utils/image_uploader_helper.js)\r\n * Version: 22.1.3\r\n * Build date: Mon Jun 13 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _objectWithoutPropertiesLoose from \"@babel/runtime/helpers/esm/objectWithoutPropertiesLoose\";\nvar _excluded = [\"imageSrc\", \"src\"];\nimport $ from \"../../../core/renderer\";\nimport localizationMessage from \"../../../localization/message\";\nimport { map } from \"../../../core/utils/iterator\";\nimport { extend } from \"../../../core/utils/extend\";\nimport { getHeight, getWidth } from \"../../../core/utils/size\";\nimport devices from \"../../../core/devices\";\nimport { isDefined } from \"../../../core/utils/type\";\nvar isMobile = \"phone\" === devices.current().deviceType;\nvar DIALOG_IMAGE_CAPTION = \"dxHtmlEditor-dialogImageCaption\";\nvar DIALOG_UPDATE_IMAGE_CAPTION = \"dxHtmlEditor-dialogUpdateImageCaption\";\nvar DIALOG_IMAGE_FIELD_URL = \"dxHtmlEditor-dialogImageUrlField\";\nvar DIALOG_IMAGE_FIELD_ALT = \"dxHtmlEditor-dialogImageAltField\";\nvar DIALOG_IMAGE_FIELD_WIDTH = \"dxHtmlEditor-dialogImageWidthField\";\nvar DIALOG_IMAGE_FIELD_HEIGHT = \"dxHtmlEditor-dialogImageHeightField\";\nvar DIALOG_IMAGE_ADD_BUTTON = \"dxHtmlEditor-dialogImageAddButton\";\nvar DIALOG_IMAGE_UPDATE_BUTTON = \"dxHtmlEditor-dialogImageUpdateButton\";\nvar DIALOG_IMAGE_SPECIFY_URL = \"dxHtmlEditor-dialogImageSpecifyUrl\";\nvar DIALOG_IMAGE_SELECT_FILE = \"dxHtmlEditor-dialogImageSelectFile\";\nvar DIALOG_IMAGE_KEEP_ASPECT_RATIO = \"dxHtmlEditor-dialogImageKeepAspectRatio\";\nvar DIALOG_IMAGE_ENCODE_TO_BASE64 = \"dxHtmlEditor-dialogImageEncodeToBase64\";\nvar DIALOG_IMAGE_POPUP_CLASS = \"dx-htmleditor-add-image-popup\";\nvar DIALOG_IMAGE_POPUP_WITH_TABS_CLASS = \"dx-htmleditor-add-image-popup-with-tabs\";\nvar DIALOG_IMAGE_FIX_RATIO_CONTAINER = \"dx-fix-ratio-container\";\nvar FORM_DIALOG_CLASS = \"dx-formdialog\";\nvar USER_ACTION = \"user\";\nvar SILENT_ACTION = \"silent\";\nvar FILE_UPLOADER_NAME = \"dx-htmleditor-image\";\nimport ButtonGroup from \"../../button_group\";\nimport FileUploader from \"../../file_uploader\";\nimport TextBox from \"../../text_box\";\nexport class ImageUploader {\n  constructor(module, config) {\n    this.module = module;\n    this.config = null !== config && void 0 !== config ? config : {};\n    this.quill = this.module.quill;\n    this.editorInstance = this.module.editorInstance;\n  }\n\n  render() {\n    var _this$config$tabs;\n\n    this.tabPanelIndex = 0;\n    this.formData = this.getFormData();\n    this.isUpdating = this.isImageUpdating();\n    this.actualTabs = null === (_this$config$tabs = this.config.tabs) || void 0 === _this$config$tabs ? void 0 : _this$config$tabs.slice();\n    this.tabs = this.createTabs(this.formData);\n    var formConfig = this.getFormConfig();\n    this.modifyDialogPopupOptions();\n    this.editorInstance.showFormDialog(formConfig).done((formData, event) => {\n      this.tabs[this.getActiveTabIndex()].strategy.pasteImage(formData, event);\n    }).always(() => {\n      this.resetDialogPopupOptions();\n      this.quill.focus();\n    });\n  }\n\n  getActiveTabIndex() {\n    return this.isUpdating ? 0 : this.tabPanelIndex;\n  }\n\n  getFormData() {\n    return this.getUpdateDialogFormData(this.quill.getFormat());\n  }\n\n  getUpdateDialogFormData(formData) {\n    var {\n      imageSrc: imageSrc,\n      src: src\n    } = formData,\n        props = _objectWithoutPropertiesLoose(formData, _excluded);\n\n    return _extends({\n      src: null !== imageSrc && void 0 !== imageSrc ? imageSrc : src\n    }, props);\n  }\n\n  createTabs(formData) {\n    var result = [];\n\n    if (!this.actualTabs || this.isUpdating) {\n      this.actualTabs = [\"url\"];\n    }\n\n    this.actualTabs = this.normalizeTabs(this.actualTabs);\n    this.actualTabs.forEach(tabName => {\n      var newTab = \"url\" === tabName ? new UrlTab(this.module, {\n        config: this.config,\n        formData: formData,\n        isUpdating: this.isUpdating\n      }) : new FileTab(this.module, {\n        config: this.config\n      });\n      result.push(newTab);\n    });\n    return result;\n  }\n\n  normalizeTabs(tabsConfig) {\n    return tabsConfig.map(item => \"object\" === typeof item ? item.name : item);\n  }\n\n  isImageUpdating() {\n    var _this$module$quill$ge;\n\n    return Object.prototype.hasOwnProperty.call(null !== (_this$module$quill$ge = this.module.quill.getFormat()) && void 0 !== _this$module$quill$ge ? _this$module$quill$ge : {}, \"imageSrc\");\n  }\n\n  modifyDialogPopupOptions() {\n    var wrapperClasses = \"\".concat(DIALOG_IMAGE_POPUP_CLASS, \" \").concat(FORM_DIALOG_CLASS);\n\n    if (this.useTabbedItems()) {\n      wrapperClasses += \" \".concat(DIALOG_IMAGE_POPUP_WITH_TABS_CLASS);\n    }\n\n    this.editorInstance.formDialogOption({\n      title: localizationMessage.format(this.isUpdating ? DIALOG_UPDATE_IMAGE_CAPTION : DIALOG_IMAGE_CAPTION),\n      \"toolbarItems[0].options.text\": localizationMessage.format(this.isUpdating ? DIALOG_IMAGE_UPDATE_BUTTON : DIALOG_IMAGE_ADD_BUTTON),\n      \"toolbarItems[0].options.visible\": !this.shouldHideAddButton(),\n      wrapperAttr: {\n        class: wrapperClasses\n      }\n    });\n  }\n\n  shouldHideAddButton() {\n    return !this.isUpdating && 1 === this.actualTabs.length && \"url\" !== this.actualTabs[0];\n  }\n\n  resetDialogPopupOptions() {\n    this.editorInstance.formDialogOption({\n      \"toolbarItems[0].options.text\": localizationMessage.format(\"OK\"),\n      \"toolbarItems[0].options.visible\": true,\n      wrapperAttr: {\n        class: FORM_DIALOG_CLASS\n      }\n    });\n  }\n\n  useTabbedItems() {\n    return this.actualTabs.length > 1;\n  }\n\n  getFormWidth() {\n    return isMobile ? \"100%\" : 493;\n  }\n\n  getFormConfig() {\n    return {\n      formData: this.formData,\n      width: this.getFormWidth(),\n      labelLocation: \"top\",\n      colCount: this.useTabbedItems() ? 1 : 11,\n      items: this.getItemsConfig()\n    };\n  }\n\n  getItemsConfig() {\n    var config = {};\n\n    if (this.useTabbedItems()) {\n      var tabsConfig = map(this.tabs, tabController => ({\n        title: tabController.getTabName(),\n        colCount: 11,\n        items: tabController.getItemsConfig()\n      }));\n      config = [{\n        itemType: \"tabbed\",\n        tabPanelOptions: {\n          onSelectionChanged: e => {\n            this.tabPanelIndex = e.component.option(\"selectedIndex\");\n          }\n        },\n        tabs: tabsConfig\n      }];\n    } else {\n      config = this.tabs[0].getItemsConfig();\n    }\n\n    return config;\n  }\n\n}\n\nclass BaseTab {\n  constructor(module, _ref) {\n    var {\n      config: config,\n      formData: formData,\n      isUpdating: isUpdating\n    } = _ref;\n    this.module = module;\n    this.config = config;\n    this.formData = formData;\n    this.isUpdating = isUpdating;\n    this.strategy = this.getStrategy();\n  }\n\n  getItemsConfig() {\n    return this.strategy.getItemsConfig();\n  }\n\n}\n\nclass UrlTab extends BaseTab {\n  getTabName() {\n    return localizationMessage.format(DIALOG_IMAGE_SPECIFY_URL);\n  }\n\n  getStrategy() {\n    return this.isUpdating ? new UpdateUrlStrategy(this.module, this.config, this.formData) : new AddUrlStrategy(this.module, this.config);\n  }\n\n}\n\nclass FileTab extends BaseTab {\n  getTabName() {\n    return localizationMessage.format(DIALOG_IMAGE_SELECT_FILE);\n  }\n\n  getStrategy() {\n    return new FileStrategy(this.module, this.config);\n  }\n\n}\n\nclass BaseStrategy {\n  constructor(module, config) {\n    this.module = module;\n    this.config = config;\n    this.editorInstance = module.editorInstance;\n    this.quill = module.quill;\n    this.selection = this.getQuillSelection();\n  }\n\n  getQuillSelection() {\n    var selection = this.quill.getSelection();\n    return null !== selection && void 0 !== selection ? selection : {\n      index: this.quill.getLength(),\n      length: 0\n    };\n  }\n\n  pasteImage() {}\n\n}\n\nclass AddUrlStrategy extends BaseStrategy {\n  constructor(module, config) {\n    super(module, config);\n    this.shouldKeepAspectRatio = true;\n  }\n\n  pasteImage(formData, event) {\n    this.module.saveValueChangeEvent(event);\n    urlUpload(this.quill, this.selection.index, formData);\n  }\n\n  keepAspectRatio(data, _ref2) {\n    var {\n      dependentEditor: dependentEditor,\n      e: e\n    } = _ref2;\n    var newValue = parseInt(e.value);\n    var previousValue = parseInt(e.previousValue);\n    var previousDependentEditorValue = parseInt(dependentEditor.option(\"value\"));\n    data.component.updateData(data.dataField, newValue);\n\n    if (this.shouldKeepAspectRatio && previousDependentEditorValue && previousValue && !this.preventRecalculating) {\n      this.preventRecalculating = true;\n      dependentEditor.option(\"value\", Math.round(newValue * previousDependentEditorValue / parseInt(previousValue)).toString());\n    }\n\n    this.preventRecalculating = false;\n  }\n\n  createKeepAspectRatioEditor($container, data, dependentEditorDataField) {\n    return this.editorInstance._createComponent($container, TextBox, extend(true, data.editorOptions, {\n      value: data.component.option(\"formData\")[data.dataField],\n      onEnterKey: data.component.option(\"onEditorEnterKey\").bind(this.editorInstance._formDialog, data),\n      onValueChanged: e => {\n        this.keepAspectRatio(data, {\n          dependentEditor: this[dependentEditorDataField + \"Editor\"],\n          e: e\n        });\n      }\n    }));\n  }\n\n  getItemsConfig() {\n    return [{\n      dataField: \"src\",\n      colSpan: 11,\n      label: {\n        text: localizationMessage.format(DIALOG_IMAGE_FIELD_URL)\n      }\n    }, {\n      dataField: \"width\",\n      colSpan: 6,\n      label: {\n        text: localizationMessage.format(DIALOG_IMAGE_FIELD_WIDTH)\n      },\n      template: data => {\n        var $content = $(\"<div>\").addClass(DIALOG_IMAGE_FIX_RATIO_CONTAINER);\n        var $widthEditor = $(\"<div>\").appendTo($content);\n        this.widthEditor = this.createKeepAspectRatioEditor($widthEditor, data, \"height\");\n        var $ratioEditor = $(\"<div>\").appendTo($content);\n\n        this.editorInstance._createComponent($ratioEditor, ButtonGroup, {\n          items: [{\n            icon: \"imgarlock\",\n            value: \"keepRatio\"\n          }],\n          hint: localizationMessage.format(DIALOG_IMAGE_KEEP_ASPECT_RATIO),\n          focusStateEnabled: false,\n          keyExpr: \"value\",\n          stylingMode: \"outlined\",\n          selectionMode: \"multiple\",\n          selectedItemKeys: [\"keepRatio\"],\n          onSelectionChanged: e => {\n            this.shouldKeepAspectRatio = !!e.component.option(\"selectedItems\").length;\n          }\n        });\n\n        return $content;\n      }\n    }, {\n      dataField: \"height\",\n      colSpan: 5,\n      label: {\n        text: localizationMessage.format(DIALOG_IMAGE_FIELD_HEIGHT)\n      },\n      template: data => {\n        var $content = $(\"<div>\");\n        this.heightEditor = this.createKeepAspectRatioEditor($content, data, \"width\");\n        return $content;\n      }\n    }, {\n      dataField: \"alt\",\n      colSpan: 11,\n      label: {\n        text: localizationMessage.format(DIALOG_IMAGE_FIELD_ALT)\n      }\n    }];\n  }\n\n}\n\nclass UpdateUrlStrategy extends AddUrlStrategy {\n  constructor(module, config, formData) {\n    super(module, config);\n    this.formData = formData;\n    this.modifyFormData();\n  }\n\n  modifyFormData() {\n    var {\n      imageSrc: imageSrc\n    } = this.quill.getFormat(this.selection.index - 1, 1);\n\n    if (!imageSrc || 0 === this.selection.index) {\n      this.selection = {\n        index: this.selection.index + 1,\n        length: 0\n      };\n      this.quill.setSelection(this.selection.index, this.selection.length, SILENT_ACTION);\n    }\n\n    var imgElement = this.quill.getLeaf(this.selection.index)[0].domNode;\n\n    if (imgElement) {\n      var _this$formData$width, _this$formData$height;\n\n      this.formData.width = null !== (_this$formData$width = this.formData.width) && void 0 !== _this$formData$width ? _this$formData$width : getWidth($(imgElement));\n      this.formData.height = null !== (_this$formData$height = this.formData.height) && void 0 !== _this$formData$height ? _this$formData$height : getHeight($(imgElement));\n    }\n  }\n\n  pasteImage(formData, event) {\n    this.quill.deleteText(this.embedFormatIndex(), 1, SILENT_ACTION);\n    this.selection.index -= 1;\n    super.pasteImage(formData, event);\n  }\n\n  embedFormatIndex() {\n    var _this$selection;\n\n    var selection = null !== (_this$selection = this.selection) && void 0 !== _this$selection ? _this$selection : this.quill.getSelection();\n\n    if (selection) {\n      if (selection.length) {\n        return selection.index;\n      } else {\n        return selection.index - 1;\n      }\n    } else {\n      return this.quill.getLength();\n    }\n  }\n\n}\n\nclass FileStrategy extends BaseStrategy {\n  constructor(module, config) {\n    super(module, config);\n    this.useBase64 = !isDefined(this.config.fileUploadMode) || \"base64\" === this.config.fileUploadMode;\n  }\n\n  closeDialogPopup(data) {\n    this.editorInstance._formDialog.hide({\n      file: data.value ? data.value[0] : data.file\n    }, data.event);\n  }\n\n  serverUpload(data) {\n    if (!this.useBase64) {\n      var imageUrl = correctSlashesInUrl(this.config.uploadDirectory) + data.file.name;\n      urlUpload(this.quill, this.selection.index, {\n        src: imageUrl\n      });\n      this.closeDialogPopup(data);\n    }\n  }\n\n  base64Upload(data) {\n    this.quill.getModule(\"uploader\").upload(this.selection, data.value, true);\n    this.closeDialogPopup(data);\n  }\n\n  pasteImage(formData, event) {\n    if (this.useBase64) {\n      super.pasteImage(formData, event);\n    }\n  }\n\n  isBase64Editable() {\n    return \"both\" === this.config.fileUploadMode;\n  }\n\n  getFileUploaderOptions() {\n    var fileUploaderOptions = {\n      uploadUrl: this.config.uploadUrl,\n      onValueChanged: data => {\n        if (this.useBase64) {\n          this.base64Upload(data);\n        } else if (data.value.length) {\n          data.component.upload();\n        }\n      },\n      onUploaded: data => {\n        this.serverUpload(data);\n      }\n    };\n    return extend({}, getFileUploaderBaseOptions(), fileUploaderOptions, this.config.fileUploaderOptions);\n  }\n\n  getItemsConfig() {\n    return [{\n      itemType: \"simple\",\n      dataField: \"files\",\n      colSpan: 11,\n      label: {\n        visible: false\n      },\n      template: () => {\n        var $content = $(\"<div>\");\n\n        this.module.editorInstance._createComponent($content, FileUploader, this.getFileUploaderOptions());\n\n        return $content;\n      }\n    }, {\n      itemType: \"simple\",\n      colSpan: 11,\n      label: {\n        visible: false\n      },\n      editorType: \"dxCheckBox\",\n      editorOptions: {\n        value: this.useBase64,\n        visible: this.isBase64Editable(),\n        text: localizationMessage.format(DIALOG_IMAGE_ENCODE_TO_BASE64),\n        onValueChanged: e => {\n          if (this.isBase64Editable()) {\n            this.useBase64 = e.value;\n          }\n        }\n      }\n    }];\n  }\n\n}\n\nexport function correctSlashesInUrl(url) {\n  return \"/\" !== url[url.length - 1] ? url + \"/\" : url;\n}\nexport function getFileUploaderBaseOptions() {\n  return {\n    value: [],\n    name: FILE_UPLOADER_NAME,\n    accept: \"image/*\",\n    uploadMode: \"useButtons\"\n  };\n}\nexport function urlUpload(quill, index, attributes) {\n  quill.insertEmbed(index, \"extendedImage\", attributes, USER_ACTION);\n  quill.setSelection(index + 1, 0, USER_ACTION);\n}","map":{"version":3,"sources":["/Users/krunalpatel/Downloads/React-Firebase-Auth-master 3/node_modules/devextreme/esm/ui/html_editor/utils/image_uploader_helper.js"],"names":["_extends","_objectWithoutPropertiesLoose","_excluded","$","localizationMessage","map","extend","getHeight","getWidth","devices","isDefined","isMobile","current","deviceType","DIALOG_IMAGE_CAPTION","DIALOG_UPDATE_IMAGE_CAPTION","DIALOG_IMAGE_FIELD_URL","DIALOG_IMAGE_FIELD_ALT","DIALOG_IMAGE_FIELD_WIDTH","DIALOG_IMAGE_FIELD_HEIGHT","DIALOG_IMAGE_ADD_BUTTON","DIALOG_IMAGE_UPDATE_BUTTON","DIALOG_IMAGE_SPECIFY_URL","DIALOG_IMAGE_SELECT_FILE","DIALOG_IMAGE_KEEP_ASPECT_RATIO","DIALOG_IMAGE_ENCODE_TO_BASE64","DIALOG_IMAGE_POPUP_CLASS","DIALOG_IMAGE_POPUP_WITH_TABS_CLASS","DIALOG_IMAGE_FIX_RATIO_CONTAINER","FORM_DIALOG_CLASS","USER_ACTION","SILENT_ACTION","FILE_UPLOADER_NAME","ButtonGroup","FileUploader","TextBox","ImageUploader","constructor","module","config","quill","editorInstance","render","_this$config$tabs","tabPanelIndex","formData","getFormData","isUpdating","isImageUpdating","actualTabs","tabs","slice","createTabs","formConfig","getFormConfig","modifyDialogPopupOptions","showFormDialog","done","event","getActiveTabIndex","strategy","pasteImage","always","resetDialogPopupOptions","focus","getUpdateDialogFormData","getFormat","imageSrc","src","props","result","normalizeTabs","forEach","tabName","newTab","UrlTab","FileTab","push","tabsConfig","item","name","_this$module$quill$ge","Object","prototype","hasOwnProperty","call","wrapperClasses","concat","useTabbedItems","formDialogOption","title","format","shouldHideAddButton","wrapperAttr","class","length","getFormWidth","width","labelLocation","colCount","items","getItemsConfig","tabController","getTabName","itemType","tabPanelOptions","onSelectionChanged","e","component","option","BaseTab","_ref","getStrategy","UpdateUrlStrategy","AddUrlStrategy","FileStrategy","BaseStrategy","selection","getQuillSelection","getSelection","index","getLength","shouldKeepAspectRatio","saveValueChangeEvent","urlUpload","keepAspectRatio","data","_ref2","dependentEditor","newValue","parseInt","value","previousValue","previousDependentEditorValue","updateData","dataField","preventRecalculating","Math","round","toString","createKeepAspectRatioEditor","$container","dependentEditorDataField","_createComponent","editorOptions","onEnterKey","bind","_formDialog","onValueChanged","colSpan","label","text","template","$content","addClass","$widthEditor","appendTo","widthEditor","$ratioEditor","icon","hint","focusStateEnabled","keyExpr","stylingMode","selectionMode","selectedItemKeys","heightEditor","modifyFormData","setSelection","imgElement","getLeaf","domNode","_this$formData$width","_this$formData$height","height","deleteText","embedFormatIndex","_this$selection","useBase64","fileUploadMode","closeDialogPopup","hide","file","serverUpload","imageUrl","correctSlashesInUrl","uploadDirectory","base64Upload","getModule","upload","isBase64Editable","getFileUploaderOptions","fileUploaderOptions","uploadUrl","onUploaded","getFileUploaderBaseOptions","visible","editorType","url","accept","uploadMode","attributes","insertEmbed"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (esm/ui/html_editor/utils/image_uploader_helper.js)\r\n * Version: 22.1.3\r\n * Build date: Mon Jun 13 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\r\nimport _objectWithoutPropertiesLoose from \"@babel/runtime/helpers/esm/objectWithoutPropertiesLoose\";\r\nvar _excluded = [\"imageSrc\", \"src\"];\r\nimport $ from \"../../../core/renderer\";\r\nimport localizationMessage from \"../../../localization/message\";\r\nimport {\r\n    map\r\n} from \"../../../core/utils/iterator\";\r\nimport {\r\n    extend\r\n} from \"../../../core/utils/extend\";\r\nimport {\r\n    getHeight,\r\n    getWidth\r\n} from \"../../../core/utils/size\";\r\nimport devices from \"../../../core/devices\";\r\nimport {\r\n    isDefined\r\n} from \"../../../core/utils/type\";\r\nvar isMobile = \"phone\" === devices.current().deviceType;\r\nvar DIALOG_IMAGE_CAPTION = \"dxHtmlEditor-dialogImageCaption\";\r\nvar DIALOG_UPDATE_IMAGE_CAPTION = \"dxHtmlEditor-dialogUpdateImageCaption\";\r\nvar DIALOG_IMAGE_FIELD_URL = \"dxHtmlEditor-dialogImageUrlField\";\r\nvar DIALOG_IMAGE_FIELD_ALT = \"dxHtmlEditor-dialogImageAltField\";\r\nvar DIALOG_IMAGE_FIELD_WIDTH = \"dxHtmlEditor-dialogImageWidthField\";\r\nvar DIALOG_IMAGE_FIELD_HEIGHT = \"dxHtmlEditor-dialogImageHeightField\";\r\nvar DIALOG_IMAGE_ADD_BUTTON = \"dxHtmlEditor-dialogImageAddButton\";\r\nvar DIALOG_IMAGE_UPDATE_BUTTON = \"dxHtmlEditor-dialogImageUpdateButton\";\r\nvar DIALOG_IMAGE_SPECIFY_URL = \"dxHtmlEditor-dialogImageSpecifyUrl\";\r\nvar DIALOG_IMAGE_SELECT_FILE = \"dxHtmlEditor-dialogImageSelectFile\";\r\nvar DIALOG_IMAGE_KEEP_ASPECT_RATIO = \"dxHtmlEditor-dialogImageKeepAspectRatio\";\r\nvar DIALOG_IMAGE_ENCODE_TO_BASE64 = \"dxHtmlEditor-dialogImageEncodeToBase64\";\r\nvar DIALOG_IMAGE_POPUP_CLASS = \"dx-htmleditor-add-image-popup\";\r\nvar DIALOG_IMAGE_POPUP_WITH_TABS_CLASS = \"dx-htmleditor-add-image-popup-with-tabs\";\r\nvar DIALOG_IMAGE_FIX_RATIO_CONTAINER = \"dx-fix-ratio-container\";\r\nvar FORM_DIALOG_CLASS = \"dx-formdialog\";\r\nvar USER_ACTION = \"user\";\r\nvar SILENT_ACTION = \"silent\";\r\nvar FILE_UPLOADER_NAME = \"dx-htmleditor-image\";\r\nimport ButtonGroup from \"../../button_group\";\r\nimport FileUploader from \"../../file_uploader\";\r\nimport TextBox from \"../../text_box\";\r\nexport class ImageUploader {\r\n    constructor(module, config) {\r\n        this.module = module;\r\n        this.config = null !== config && void 0 !== config ? config : {};\r\n        this.quill = this.module.quill;\r\n        this.editorInstance = this.module.editorInstance\r\n    }\r\n    render() {\r\n        var _this$config$tabs;\r\n        this.tabPanelIndex = 0;\r\n        this.formData = this.getFormData();\r\n        this.isUpdating = this.isImageUpdating();\r\n        this.actualTabs = null === (_this$config$tabs = this.config.tabs) || void 0 === _this$config$tabs ? void 0 : _this$config$tabs.slice();\r\n        this.tabs = this.createTabs(this.formData);\r\n        var formConfig = this.getFormConfig();\r\n        this.modifyDialogPopupOptions();\r\n        this.editorInstance.showFormDialog(formConfig).done((formData, event) => {\r\n            this.tabs[this.getActiveTabIndex()].strategy.pasteImage(formData, event)\r\n        }).always(() => {\r\n            this.resetDialogPopupOptions();\r\n            this.quill.focus()\r\n        })\r\n    }\r\n    getActiveTabIndex() {\r\n        return this.isUpdating ? 0 : this.tabPanelIndex\r\n    }\r\n    getFormData() {\r\n        return this.getUpdateDialogFormData(this.quill.getFormat())\r\n    }\r\n    getUpdateDialogFormData(formData) {\r\n        var {\r\n            imageSrc: imageSrc,\r\n            src: src\r\n        } = formData, props = _objectWithoutPropertiesLoose(formData, _excluded);\r\n        return _extends({\r\n            src: null !== imageSrc && void 0 !== imageSrc ? imageSrc : src\r\n        }, props)\r\n    }\r\n    createTabs(formData) {\r\n        var result = [];\r\n        if (!this.actualTabs || this.isUpdating) {\r\n            this.actualTabs = [\"url\"]\r\n        }\r\n        this.actualTabs = this.normalizeTabs(this.actualTabs);\r\n        this.actualTabs.forEach(tabName => {\r\n            var newTab = \"url\" === tabName ? new UrlTab(this.module, {\r\n                config: this.config,\r\n                formData: formData,\r\n                isUpdating: this.isUpdating\r\n            }) : new FileTab(this.module, {\r\n                config: this.config\r\n            });\r\n            result.push(newTab)\r\n        });\r\n        return result\r\n    }\r\n    normalizeTabs(tabsConfig) {\r\n        return tabsConfig.map(item => \"object\" === typeof item ? item.name : item)\r\n    }\r\n    isImageUpdating() {\r\n        var _this$module$quill$ge;\r\n        return Object.prototype.hasOwnProperty.call(null !== (_this$module$quill$ge = this.module.quill.getFormat()) && void 0 !== _this$module$quill$ge ? _this$module$quill$ge : {}, \"imageSrc\")\r\n    }\r\n    modifyDialogPopupOptions() {\r\n        var wrapperClasses = \"\".concat(DIALOG_IMAGE_POPUP_CLASS, \" \").concat(FORM_DIALOG_CLASS);\r\n        if (this.useTabbedItems()) {\r\n            wrapperClasses += \" \".concat(DIALOG_IMAGE_POPUP_WITH_TABS_CLASS)\r\n        }\r\n        this.editorInstance.formDialogOption({\r\n            title: localizationMessage.format(this.isUpdating ? DIALOG_UPDATE_IMAGE_CAPTION : DIALOG_IMAGE_CAPTION),\r\n            \"toolbarItems[0].options.text\": localizationMessage.format(this.isUpdating ? DIALOG_IMAGE_UPDATE_BUTTON : DIALOG_IMAGE_ADD_BUTTON),\r\n            \"toolbarItems[0].options.visible\": !this.shouldHideAddButton(),\r\n            wrapperAttr: {\r\n                class: wrapperClasses\r\n            }\r\n        })\r\n    }\r\n    shouldHideAddButton() {\r\n        return !this.isUpdating && 1 === this.actualTabs.length && \"url\" !== this.actualTabs[0]\r\n    }\r\n    resetDialogPopupOptions() {\r\n        this.editorInstance.formDialogOption({\r\n            \"toolbarItems[0].options.text\": localizationMessage.format(\"OK\"),\r\n            \"toolbarItems[0].options.visible\": true,\r\n            wrapperAttr: {\r\n                class: FORM_DIALOG_CLASS\r\n            }\r\n        })\r\n    }\r\n    useTabbedItems() {\r\n        return this.actualTabs.length > 1\r\n    }\r\n    getFormWidth() {\r\n        return isMobile ? \"100%\" : 493\r\n    }\r\n    getFormConfig() {\r\n        return {\r\n            formData: this.formData,\r\n            width: this.getFormWidth(),\r\n            labelLocation: \"top\",\r\n            colCount: this.useTabbedItems() ? 1 : 11,\r\n            items: this.getItemsConfig()\r\n        }\r\n    }\r\n    getItemsConfig() {\r\n        var config = {};\r\n        if (this.useTabbedItems()) {\r\n            var tabsConfig = map(this.tabs, tabController => ({\r\n                title: tabController.getTabName(),\r\n                colCount: 11,\r\n                items: tabController.getItemsConfig()\r\n            }));\r\n            config = [{\r\n                itemType: \"tabbed\",\r\n                tabPanelOptions: {\r\n                    onSelectionChanged: e => {\r\n                        this.tabPanelIndex = e.component.option(\"selectedIndex\")\r\n                    }\r\n                },\r\n                tabs: tabsConfig\r\n            }]\r\n        } else {\r\n            config = this.tabs[0].getItemsConfig()\r\n        }\r\n        return config\r\n    }\r\n}\r\nclass BaseTab {\r\n    constructor(module, _ref) {\r\n        var {\r\n            config: config,\r\n            formData: formData,\r\n            isUpdating: isUpdating\r\n        } = _ref;\r\n        this.module = module;\r\n        this.config = config;\r\n        this.formData = formData;\r\n        this.isUpdating = isUpdating;\r\n        this.strategy = this.getStrategy()\r\n    }\r\n    getItemsConfig() {\r\n        return this.strategy.getItemsConfig()\r\n    }\r\n}\r\nclass UrlTab extends BaseTab {\r\n    getTabName() {\r\n        return localizationMessage.format(DIALOG_IMAGE_SPECIFY_URL)\r\n    }\r\n    getStrategy() {\r\n        return this.isUpdating ? new UpdateUrlStrategy(this.module, this.config, this.formData) : new AddUrlStrategy(this.module, this.config)\r\n    }\r\n}\r\nclass FileTab extends BaseTab {\r\n    getTabName() {\r\n        return localizationMessage.format(DIALOG_IMAGE_SELECT_FILE)\r\n    }\r\n    getStrategy() {\r\n        return new FileStrategy(this.module, this.config)\r\n    }\r\n}\r\nclass BaseStrategy {\r\n    constructor(module, config) {\r\n        this.module = module;\r\n        this.config = config;\r\n        this.editorInstance = module.editorInstance;\r\n        this.quill = module.quill;\r\n        this.selection = this.getQuillSelection()\r\n    }\r\n    getQuillSelection() {\r\n        var selection = this.quill.getSelection();\r\n        return null !== selection && void 0 !== selection ? selection : {\r\n            index: this.quill.getLength(),\r\n            length: 0\r\n        }\r\n    }\r\n    pasteImage() {}\r\n}\r\nclass AddUrlStrategy extends BaseStrategy {\r\n    constructor(module, config) {\r\n        super(module, config);\r\n        this.shouldKeepAspectRatio = true\r\n    }\r\n    pasteImage(formData, event) {\r\n        this.module.saveValueChangeEvent(event);\r\n        urlUpload(this.quill, this.selection.index, formData)\r\n    }\r\n    keepAspectRatio(data, _ref2) {\r\n        var {\r\n            dependentEditor: dependentEditor,\r\n            e: e\r\n        } = _ref2;\r\n        var newValue = parseInt(e.value);\r\n        var previousValue = parseInt(e.previousValue);\r\n        var previousDependentEditorValue = parseInt(dependentEditor.option(\"value\"));\r\n        data.component.updateData(data.dataField, newValue);\r\n        if (this.shouldKeepAspectRatio && previousDependentEditorValue && previousValue && !this.preventRecalculating) {\r\n            this.preventRecalculating = true;\r\n            dependentEditor.option(\"value\", Math.round(newValue * previousDependentEditorValue / parseInt(previousValue)).toString())\r\n        }\r\n        this.preventRecalculating = false\r\n    }\r\n    createKeepAspectRatioEditor($container, data, dependentEditorDataField) {\r\n        return this.editorInstance._createComponent($container, TextBox, extend(true, data.editorOptions, {\r\n            value: data.component.option(\"formData\")[data.dataField],\r\n            onEnterKey: data.component.option(\"onEditorEnterKey\").bind(this.editorInstance._formDialog, data),\r\n            onValueChanged: e => {\r\n                this.keepAspectRatio(data, {\r\n                    dependentEditor: this[dependentEditorDataField + \"Editor\"],\r\n                    e: e\r\n                })\r\n            }\r\n        }))\r\n    }\r\n    getItemsConfig() {\r\n        return [{\r\n            dataField: \"src\",\r\n            colSpan: 11,\r\n            label: {\r\n                text: localizationMessage.format(DIALOG_IMAGE_FIELD_URL)\r\n            }\r\n        }, {\r\n            dataField: \"width\",\r\n            colSpan: 6,\r\n            label: {\r\n                text: localizationMessage.format(DIALOG_IMAGE_FIELD_WIDTH)\r\n            },\r\n            template: data => {\r\n                var $content = $(\"<div>\").addClass(DIALOG_IMAGE_FIX_RATIO_CONTAINER);\r\n                var $widthEditor = $(\"<div>\").appendTo($content);\r\n                this.widthEditor = this.createKeepAspectRatioEditor($widthEditor, data, \"height\");\r\n                var $ratioEditor = $(\"<div>\").appendTo($content);\r\n                this.editorInstance._createComponent($ratioEditor, ButtonGroup, {\r\n                    items: [{\r\n                        icon: \"imgarlock\",\r\n                        value: \"keepRatio\"\r\n                    }],\r\n                    hint: localizationMessage.format(DIALOG_IMAGE_KEEP_ASPECT_RATIO),\r\n                    focusStateEnabled: false,\r\n                    keyExpr: \"value\",\r\n                    stylingMode: \"outlined\",\r\n                    selectionMode: \"multiple\",\r\n                    selectedItemKeys: [\"keepRatio\"],\r\n                    onSelectionChanged: e => {\r\n                        this.shouldKeepAspectRatio = !!e.component.option(\"selectedItems\").length\r\n                    }\r\n                });\r\n                return $content\r\n            }\r\n        }, {\r\n            dataField: \"height\",\r\n            colSpan: 5,\r\n            label: {\r\n                text: localizationMessage.format(DIALOG_IMAGE_FIELD_HEIGHT)\r\n            },\r\n            template: data => {\r\n                var $content = $(\"<div>\");\r\n                this.heightEditor = this.createKeepAspectRatioEditor($content, data, \"width\");\r\n                return $content\r\n            }\r\n        }, {\r\n            dataField: \"alt\",\r\n            colSpan: 11,\r\n            label: {\r\n                text: localizationMessage.format(DIALOG_IMAGE_FIELD_ALT)\r\n            }\r\n        }]\r\n    }\r\n}\r\nclass UpdateUrlStrategy extends AddUrlStrategy {\r\n    constructor(module, config, formData) {\r\n        super(module, config);\r\n        this.formData = formData;\r\n        this.modifyFormData()\r\n    }\r\n    modifyFormData() {\r\n        var {\r\n            imageSrc: imageSrc\r\n        } = this.quill.getFormat(this.selection.index - 1, 1);\r\n        if (!imageSrc || 0 === this.selection.index) {\r\n            this.selection = {\r\n                index: this.selection.index + 1,\r\n                length: 0\r\n            };\r\n            this.quill.setSelection(this.selection.index, this.selection.length, SILENT_ACTION)\r\n        }\r\n        var imgElement = this.quill.getLeaf(this.selection.index)[0].domNode;\r\n        if (imgElement) {\r\n            var _this$formData$width, _this$formData$height;\r\n            this.formData.width = null !== (_this$formData$width = this.formData.width) && void 0 !== _this$formData$width ? _this$formData$width : getWidth($(imgElement));\r\n            this.formData.height = null !== (_this$formData$height = this.formData.height) && void 0 !== _this$formData$height ? _this$formData$height : getHeight($(imgElement))\r\n        }\r\n    }\r\n    pasteImage(formData, event) {\r\n        this.quill.deleteText(this.embedFormatIndex(), 1, SILENT_ACTION);\r\n        this.selection.index -= 1;\r\n        super.pasteImage(formData, event)\r\n    }\r\n    embedFormatIndex() {\r\n        var _this$selection;\r\n        var selection = null !== (_this$selection = this.selection) && void 0 !== _this$selection ? _this$selection : this.quill.getSelection();\r\n        if (selection) {\r\n            if (selection.length) {\r\n                return selection.index\r\n            } else {\r\n                return selection.index - 1\r\n            }\r\n        } else {\r\n            return this.quill.getLength()\r\n        }\r\n    }\r\n}\r\nclass FileStrategy extends BaseStrategy {\r\n    constructor(module, config) {\r\n        super(module, config);\r\n        this.useBase64 = !isDefined(this.config.fileUploadMode) || \"base64\" === this.config.fileUploadMode\r\n    }\r\n    closeDialogPopup(data) {\r\n        this.editorInstance._formDialog.hide({\r\n            file: data.value ? data.value[0] : data.file\r\n        }, data.event)\r\n    }\r\n    serverUpload(data) {\r\n        if (!this.useBase64) {\r\n            var imageUrl = correctSlashesInUrl(this.config.uploadDirectory) + data.file.name;\r\n            urlUpload(this.quill, this.selection.index, {\r\n                src: imageUrl\r\n            });\r\n            this.closeDialogPopup(data)\r\n        }\r\n    }\r\n    base64Upload(data) {\r\n        this.quill.getModule(\"uploader\").upload(this.selection, data.value, true);\r\n        this.closeDialogPopup(data)\r\n    }\r\n    pasteImage(formData, event) {\r\n        if (this.useBase64) {\r\n            super.pasteImage(formData, event)\r\n        }\r\n    }\r\n    isBase64Editable() {\r\n        return \"both\" === this.config.fileUploadMode\r\n    }\r\n    getFileUploaderOptions() {\r\n        var fileUploaderOptions = {\r\n            uploadUrl: this.config.uploadUrl,\r\n            onValueChanged: data => {\r\n                if (this.useBase64) {\r\n                    this.base64Upload(data)\r\n                } else if (data.value.length) {\r\n                    data.component.upload()\r\n                }\r\n            },\r\n            onUploaded: data => {\r\n                this.serverUpload(data)\r\n            }\r\n        };\r\n        return extend({}, getFileUploaderBaseOptions(), fileUploaderOptions, this.config.fileUploaderOptions)\r\n    }\r\n    getItemsConfig() {\r\n        return [{\r\n            itemType: \"simple\",\r\n            dataField: \"files\",\r\n            colSpan: 11,\r\n            label: {\r\n                visible: false\r\n            },\r\n            template: () => {\r\n                var $content = $(\"<div>\");\r\n                this.module.editorInstance._createComponent($content, FileUploader, this.getFileUploaderOptions());\r\n                return $content\r\n            }\r\n        }, {\r\n            itemType: \"simple\",\r\n            colSpan: 11,\r\n            label: {\r\n                visible: false\r\n            },\r\n            editorType: \"dxCheckBox\",\r\n            editorOptions: {\r\n                value: this.useBase64,\r\n                visible: this.isBase64Editable(),\r\n                text: localizationMessage.format(DIALOG_IMAGE_ENCODE_TO_BASE64),\r\n                onValueChanged: e => {\r\n                    if (this.isBase64Editable()) {\r\n                        this.useBase64 = e.value\r\n                    }\r\n                }\r\n            }\r\n        }]\r\n    }\r\n}\r\nexport function correctSlashesInUrl(url) {\r\n    return \"/\" !== url[url.length - 1] ? url + \"/\" : url\r\n}\r\nexport function getFileUploaderBaseOptions() {\r\n    return {\r\n        value: [],\r\n        name: FILE_UPLOADER_NAME,\r\n        accept: \"image/*\",\r\n        uploadMode: \"useButtons\"\r\n    }\r\n}\r\nexport function urlUpload(quill, index, attributes) {\r\n    quill.insertEmbed(index, \"extendedImage\", attributes, USER_ACTION);\r\n    quill.setSelection(index + 1, 0, USER_ACTION)\r\n}\r\n"]},"metadata":{},"sourceType":"module"}